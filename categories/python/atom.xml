<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh">
  <title>紅楓吟 - Python</title>
    <subtitle>风落花语风落天，花落风雨花落田.</subtitle>
  <link href="https://honmaple.me/categories/python/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="https://honmaple.me"/>
  <generator uri="https://github.com/honmaple/snow">Snow</generator>
    <updated>Wed, 07 Jul 2021 17:56:51 +0800</updated>
  <id>https://honmaple.me</id>
    <entry xml:lang="zh">
      <title>python2升级至python3</title>
      <link href="" rel="alternate"></link>
      <published>Mon, 22 Mar 2021 16:35:34 +0800</published>
      <updated>Wed, 07 Jul 2021 17:56:51 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2021/03/python2升级至python3.html" type="text/html"/>
      <id>https://honmaple.me/articles/2021/03/python2升级至python3.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
首先使用工具 &lt;b&gt;2to3&lt;/b&gt; 转换
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;2to3 目录名 -w -n&lt;/pre&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;print&lt;/h2&gt;
&lt;p&gt;
   &lt;a href=&quot;stackoverflow.com/questions/55559825/how-to-fix-print-double-parentheses-after-2to3-conversion&quot;&gt;stackoverflow.com/questions/55559825/how-to-fix-print-double-parentheses-after-2to3-conversion&lt;/a&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 问题:
     如果在python2项目里使用了python3的写法，比如在 &lt;b&gt;python2&lt;/b&gt; 里的 &lt;code&gt;print(&amp;#34;test&amp;#34;)&lt;/code&gt;, 使用 &lt;b&gt;2to3&lt;/b&gt; 就会转换成
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;((&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;))&lt;/pre&gt;
&lt;p&gt;
     所以需要找到 &lt;code&gt;print((&lt;/code&gt; 并修复该转换(其实不转也没什么问题)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;ag -Gpy &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;print((&amp;#39;&lt;/span&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 修复:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;- print((&amp;#34;...&lt;/span&gt;&lt;/pre&gt;&lt;/li&gt;&lt;/ul&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;print&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;string&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;比值问题&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4&quot;&gt;编码问题&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.1&quot;&gt;sys.setdefaultencoding(&amp;#39;utf-8&amp;#39;)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.2&quot;&gt;encode、decode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.3&quot;&gt;编码转换&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5&quot;&gt;cmp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-6&quot;&gt;sorted&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-7&quot;&gt;Exception&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-8&quot;&gt;SSL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-9&quot;&gt;file.read&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10&quot;&gt;redis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-11&quot;&gt;requests&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-11.1&quot;&gt;自定义编码请求&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-11.1.1&quot;&gt;post json&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-11.1.2&quot;&gt;post form&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-11.2&quot;&gt;响应编码&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-11.3&quot;&gt;请求headers顺序&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-12&quot;&gt;django&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;
首先使用工具 &lt;b&gt;2to3&lt;/b&gt; 转换
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;2to3 目录名 -w -n&lt;/pre&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;print&lt;/h2&gt;
&lt;p&gt;
   &lt;a href=&quot;stackoverflow.com/questions/55559825/how-to-fix-print-double-parentheses-after-2to3-conversion&quot;&gt;stackoverflow.com/questions/55559825/how-to-fix-print-double-parentheses-after-2to3-conversion&lt;/a&gt;
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 问题:
     如果在python2项目里使用了python3的写法，比如在 &lt;b&gt;python2&lt;/b&gt; 里的 &lt;code&gt;print(&amp;#34;test&amp;#34;)&lt;/code&gt;, 使用 &lt;b&gt;2to3&lt;/b&gt; 就会转换成
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;((&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;))&lt;/pre&gt;
&lt;p&gt;
     所以需要找到 &lt;code&gt;print((&lt;/code&gt; 并修复该转换(其实不转也没什么问题)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;ag -Gpy &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;print((&amp;#39;&lt;/span&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 修复:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;- print((&amp;#34;test&amp;#34;))
&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+ print(&amp;#34;test&amp;#34;)
&lt;/span&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-2&quot;&gt;string&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 问题1:
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;module &amp;#39;string&amp;#39; has no attribute &amp;#39;letters&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 修复:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;- string.letters
&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+ string.ascii_letters
&lt;/span&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 问题2:
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;&amp;#39;str&amp;#39; object has no attribute &amp;#39;decode&amp;#39;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 修复:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;- str.decode(xxx)
&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+ str.encode(xxx).decode(&amp;#39;unicode_escape&amp;#39;)
&lt;/span&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-3&quot;&gt;比值问题&lt;/h2&gt;
&lt;pre class=&quot;src src-example&quot;&gt;slice indices must be integers or None or have an __index__ method&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 问题:
     python2里 &lt;code&gt;3/2&lt;/code&gt; 返回的是整型 &lt;code&gt;1&lt;/code&gt;
     python3里 &lt;code&gt;3/2&lt;/code&gt; 返回的是浮点型 &lt;code&gt;1.5&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 修复:
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;print(3//2)
# 或者
print(int(3/2))&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-4&quot;&gt;编码问题&lt;/h2&gt;
&lt;h3 id=&quot;heading-4.1&quot;&gt;sys.setdefaultencoding(&amp;#39;utf-8&amp;#39;)&lt;/h3&gt;
&lt;p&gt;
    python2里的 &lt;code&gt;sys.setdefaultencoding(&amp;#39;utf-8&amp;#39;)&lt;/code&gt; 需要删除
&lt;/p&gt;

&lt;h3 id=&quot;heading-4.2&quot;&gt;encode、decode&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 问题:
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;LookupError: &amp;#39;base64&amp;#39; is not a text encoding; use codecs.encode() to handle arbitrary codecs&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 语法:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python2
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;Python 2.7.16 (default, Dec 21 2020, 23:00:36)
[GCC Apple LLVM 12.0.0 (clang-1200.0.30.4) [+internal-os, ptrauth-isa=sign+stri on darwin
Type &amp;#34;help&amp;#34;, &amp;#34;copyright&amp;#34;, &amp;#34;credits&amp;#34; or &amp;#34;license&amp;#34; for more information.
&amp;gt;&amp;gt;&amp;gt; a = &amp;#34;a&amp;#34;
&amp;gt;&amp;gt;&amp;gt; a.encode(&amp;#34;base64&amp;#34;)
&amp;#39;YQ==\n&amp;#39;
&amp;gt;&amp;gt;&amp;gt; b = a.encode(&amp;#34;base64&amp;#34;)
&amp;gt;&amp;gt;&amp;gt; b.decode(&amp;#34;base64&amp;#34;)
&amp;#39;a&amp;#39;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;Python 3.7.4 (default, Sep  7 2020, 15:30:33)
[Clang 11.0.3 (clang-1103.0.32.29)] on darwin
Type &amp;#34;help&amp;#34;, &amp;#34;copyright&amp;#34;, &amp;#34;credits&amp;#34; or &amp;#34;license&amp;#34; for more information.
&amp;gt;&amp;gt;&amp;gt; a = &amp;#34;a&amp;#34;
&amp;gt;&amp;gt;&amp;gt; a.encode(&amp;#34;base64&amp;#34;)
Traceback (most recent call last):
  File &amp;#34;&lt;stdin&gt;&amp;#34;, line 1, in &lt;module&gt;
LookupError: &amp;#39;base64&amp;#39; is not a text encoding; use codecs.encode() to handle arbitrary codecs&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 修复:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; base64

&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;b64encode&lt;/span&gt;(s):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; isinstance(s, bytes):
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; base64&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;b64encode(s)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; base64&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;b64encode(s&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;encode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;utf-8&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;))&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;decode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;utf-8&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)

&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;b64decode&lt;/span&gt;(s):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; base64&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;b64decode(s)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;decode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;utf-8&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;/pre&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;- x.encode(&amp;#39;base64&amp;#39;)
&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;- x.decode(&amp;#39;base64&amp;#39;)
&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+ b64encode(x)
&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+ b64decode(x)
&lt;/span&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-4.3&quot;&gt;编码转换&lt;/h3&gt;
&lt;p&gt;
    utf-8转换为gbk
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python2
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;&amp;#39;hello世界&amp;#39;.decode(&amp;#39;utf-8&amp;#39;).encode(&amp;#39;gbk&amp;#39;)&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;&amp;#39;&amp;#39;.join([chr(i) for i in &amp;#39;hello世界&amp;#39;.encode(&amp;#39;gbk&amp;#39;)])
# 或者
&amp;#39;hello世界&amp;#39;.encode(&amp;#39;gbk&amp;#39;).decode(&amp;#39;unicode_escape&amp;#39;)&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-5&quot;&gt;cmp&lt;/h2&gt;
&lt;p&gt;
   python3里cmp内置函数不再存在，需要自定义函数
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;cmp&lt;/span&gt;(a, b):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; (a &lt;span style=&quot;color:#f92672&quot;&gt;&amp;gt;&lt;/span&gt; b) &lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt; (a &lt;span style=&quot;color:#f92672&quot;&gt;&amp;lt;&lt;/span&gt; b)&lt;/pre&gt;

&lt;h2 id=&quot;heading-6&quot;&gt;sorted&lt;/h2&gt;
&lt;p&gt;
   python2里sorted有一个cmp参数，python3里统一为key参数
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python2
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;sorted(keys, &lt;span style=&quot;color:#66d9ef&quot;&gt;lambda&lt;/span&gt; x, y: cmp(len(x), len(y)), reverse&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;True)&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; functools &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; cmp_to_key

sorted(keys, key&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;cmp_to_key(&lt;span style=&quot;color:#66d9ef&quot;&gt;lambda&lt;/span&gt; x, y: cmp(len(x), len(y))), reverse&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;True)&lt;/pre&gt;
&lt;p&gt;
     注意: &lt;code&gt;must use keyword argument for key function&lt;/code&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-7&quot;&gt;Exception&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python3里没有 &lt;code&gt;.message&lt;/code&gt;, 所以需要修改 &lt;code&gt;e.message&lt;/code&gt; 为 &lt;code&gt;str(e)&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3无法使用 &lt;code&gt;as&lt;/code&gt; 直接对变量赋值
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;main&lt;/span&gt;():
    err &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; None
    &lt;span style=&quot;color:#66d9ef&quot;&gt;try&lt;/span&gt;:
        &lt;span style=&quot;color:#66d9ef&quot;&gt;raise&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;ValueError&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;sss&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
    &lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;    &lt;span style=&quot;color:#66d9ef&quot;&gt;except&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Exception&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;as&lt;/span&gt; err:
    &lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;       &lt;span style=&quot;color:#66d9ef&quot;&gt;pass&lt;/span&gt;
    &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt;    &lt;span style=&quot;color:#66d9ef&quot;&gt;except&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Exception&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;as&lt;/span&gt; e:
    &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt;       err &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; e
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; err

&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(main())&lt;/pre&gt;

&lt;pre class=&quot;src src-example&quot;&gt;UnboundLocalError: local variable &amp;#39;err&amp;#39; referenced before assignment&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-8&quot;&gt;SSL&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 问题:
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;File &amp;#34;/usr/local/lib/python3.6/dist-packages/OpenSSL/SSL.py&amp;#34;, line 1591, in set_tlsext_host_name
raise TypeError(&amp;#34;name must be a byte string&amp;#34;)&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 解决
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;- s.set_tlsext_host_name(hostname)
+ s.set_tlsext_host_name(hostname.encode(&amp;#39;utf-8&amp;#39;))&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-9&quot;&gt;file.read&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;with&lt;/span&gt; open(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;test.txt&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;rb&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;) &lt;span style=&quot;color:#66d9ef&quot;&gt;as&lt;/span&gt; f:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; i &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; f&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;read(&lt;span style=&quot;color:#ae81ff&quot;&gt;10&lt;/span&gt;):
        &lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(i, type(i))&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python2
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;(&amp;#39;\x7f&amp;#39;, &lt;type &#39;str&#39;=&quot;&quot;&gt;)
(&amp;#39;E&amp;#39;, &lt;type &#39;str&#39;=&quot;&quot;&gt;)
(&amp;#39;\x00&amp;#39;, &lt;type &#39;str&#39;=&quot;&quot;&gt;)&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;127 &lt;class &#39;int&#39;=&quot;&quot;&gt;
69 &lt;class &#39;int&#39;=&quot;&quot;&gt;
0 &lt;class &#39;int&#39;=&quot;&quot;&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;两者之间的转换&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;ord(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;\x7f&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;) &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;127&lt;/span&gt;
chr(&lt;span style=&quot;color:#ae81ff&quot;&gt;127&lt;/span&gt;) &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;\x7f&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-10&quot;&gt;redis&lt;/h2&gt;
&lt;p&gt;
   python3里默认取出的值是 &lt;code&gt;bytes&lt;/code&gt; 类型, 需要客户端添加 &lt;code&gt;decode_responses=True&lt;/code&gt; 参数, 取出的值才是 &lt;code&gt;str&lt;/code&gt; 类型
&lt;/p&gt;

&lt;h2 id=&quot;heading-11&quot;&gt;requests&lt;/h2&gt;
&lt;h3 id=&quot;heading-11.1&quot;&gt;自定义编码请求&lt;/h3&gt;
&lt;p&gt;
    &lt;a href=&quot;github.com/psf/requests/issues/4133&quot;&gt;github.com/psf/requests/issues/4133&lt;/a&gt;
&lt;/p&gt;
&lt;h4 id=&quot;heading-11.1.1&quot;&gt;post json&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python2
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;data &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;hello世界&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;decode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;utf-8&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;encode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;gbk&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)}
headers &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Content-Type&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;application/json;charset=gbk&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;}
data&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;json&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;dumps(data,ensure_ascii&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;False)
rsp &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; requests&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;post(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/dynamic/test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;, data&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;data,headers&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;headers)&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;data &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;hello世界&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;}
headers &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Content-Type&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;application/json;charset=gbk&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;}
data&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;json&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;dumps(data, ensure_ascii&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;False)
resp &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; requests&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;post(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/dynamic/test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;, data&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;data&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;encode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;gbk&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;), headers&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;headers)&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;heading-11.1.2&quot;&gt;post form&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python2
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;data &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;hello世界&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;decode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;utf-8&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;encode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;gbk&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)}
headers &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Content-Type&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;application/x-www-form-urlencoded;charset=gbk&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;}
resp &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; requests&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;post(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/dynamic/test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;, data&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;data,headers&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;headers)&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;data &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;hello世界&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;encode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;gbk&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)}
headers &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Content-Type&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;application/x-www-form-urlencoded;charset=gbk&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;}
resp &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; requests&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;post(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/dynamic/test&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;, data&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;data,headers&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;headers)&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-11.2&quot;&gt;响应编码&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;resp &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; requests&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;get(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;...&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(type(resp&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;content))
&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(type(resp&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;text))&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python2
      &lt;code&gt;resp.content&lt;/code&gt; 是 &lt;code&gt;str&lt;/code&gt; 类型, &lt;code&gt;resp.text&lt;/code&gt; 是 &lt;code&gt;unicode&lt;/code&gt; 类型
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3
      &lt;code&gt;resp.content&lt;/code&gt; 是 &lt;code&gt;bytes&lt;/code&gt; 类型, &lt;code&gt;resp.text&lt;/code&gt; 是 &lt;code&gt;str&lt;/code&gt; 类型
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-11.3&quot;&gt;请求headers顺序&lt;/h3&gt;
&lt;p&gt;
    根源主要在 &lt;code&gt;requests.structures&lt;/code&gt; 的 &lt;code&gt;CaseInsensitiveDict&lt;/code&gt; 类
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; requests.structures &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; CaseInsensitiveDict
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; collections &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; OrderedDict

headers &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Accept-Language&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Accept-Encoding&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;gzip, deflate, sdch&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;cache&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;,
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;host&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Host1.com&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Accept&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;User-Agent&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;curl/7.29.0&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Host&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Host2.com&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;
}
&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(headers)

r &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; CaseInsensitiveDict()
r&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;update(headers)
&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(r)&lt;/pre&gt;

&lt;p&gt;
    不同的python版本结果会输出
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 python2
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;OrderedDict([(&amp;#39;Accept-Language&amp;#39;, &amp;#39;en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4&amp;#39;), (&amp;#39;Accept-Encoding&amp;#39;, &amp;#39;gzip, deflate, sdch&amp;#39;), (&amp;#39;cache&amp;#39;, 0), (&amp;#39;Host&amp;#39;, &amp;#39;Host2.com&amp;#39;), (&amp;#39;Accept&amp;#39;, &amp;#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&amp;#39;), (&amp;#39;User-Agent&amp;#39;, &amp;#39;curl/7.29.0&amp;#39;), (&amp;#39;host&amp;#39;, &amp;#39;Host1.com&amp;#39;)])
CaseInsensitiveDict({&amp;#39;Accept-Language&amp;#39;: &amp;#39;en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4&amp;#39;, &amp;#39;Accept-Encoding&amp;#39;: &amp;#39;gzip, deflate, sdch&amp;#39;, &amp;#39;cache&amp;#39;: 0, &amp;#39;Accept&amp;#39;: &amp;#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&amp;#39;, &amp;#39;User-Agent&amp;#39;: &amp;#39;curl/7.29.0&amp;#39;, &amp;#39;host&amp;#39;: &amp;#39;Host1.com&amp;#39;})&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 python3
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;OrderedDict([(&amp;#39;Accept-Language&amp;#39;, &amp;#39;en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4&amp;#39;), (&amp;#39;Accept-Encoding&amp;#39;, &amp;#39;gzip, deflate, sdch&amp;#39;), (&amp;#39;cache&amp;#39;, 0), (&amp;#39;host&amp;#39;, &amp;#39;Host1.com&amp;#39;), (&amp;#39;Accept&amp;#39;, &amp;#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&amp;#39;), (&amp;#39;User-Agent&amp;#39;, &amp;#39;curl/7.29.0&amp;#39;), (&amp;#39;Host&amp;#39;, &amp;#39;Host2.com&amp;#39;)])
{&amp;#39;Accept-Language&amp;#39;: &amp;#39;en-US,en;q=0.8,zh-CN;q=0.6,zh;q=0.4&amp;#39;, &amp;#39;Accept-Encoding&amp;#39;: &amp;#39;gzip, deflate, sdch&amp;#39;, &amp;#39;cache&amp;#39;: 0, &amp;#39;Host&amp;#39;: &amp;#39;Host2.com&amp;#39;, &amp;#39;Accept&amp;#39;: &amp;#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&amp;#39;, &amp;#39;User-Agent&amp;#39;: &amp;#39;curl/7.29.0&amp;#39;}&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
    所以如果要兼容两个版本，需要显示的传入
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;headers &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; OrderedDict(sorted(headers&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;items(), key&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;lambda&lt;/span&gt; x: x[&lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;]))&lt;/pre&gt;

&lt;h2 id=&quot;heading-12&quot;&gt;django&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;- for k, v in request.GET.iterlists():
&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+ for k, v in request.GET.lists():
&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;
   并且k和v的类型在python3里默认为 &lt;code&gt;str&lt;/code&gt; ， 不需要使用 &lt;code&gt;k.encode(&amp;#34;utf-8&amp;#34;)&lt;/code&gt; 进行转换
&lt;/p&gt;</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>Flask支持多语言站点</title>
      <link href="" rel="alternate"></link>
      <published>Sun, 13 Jan 2019 01:32:11 +0800</published>
      <updated>Mon, 15 Jul 2019 21:31:55 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2019/01/Flask支持多语言站点.html" type="text/html"/>
      <id>https://honmaple.me/articles/2019/01/Flask支持多语言站点.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
Flask的多语言国际化可以使用&lt;b&gt;Flask-Babel&lt;/b&gt;插件，在此不再细述，但对于所谓的多语言站点(即形如&lt;b&gt;example.com/zh/uri、example.com/en/uri&lt;/b&gt;或者&lt;b&gt;zh.example.com、en.example.com&lt;/b&gt;)文档上却未作细述
&lt;/p&gt;

&lt;p&gt;
有一个 &lt;a href=&quot;https://flask.palletsprojects.com/en/1.1.x/patterns/urlprocessors/&quot;&gt;Flask URL Processors&lt;/a&gt; 需要对所有的&lt;b&gt;uri&lt;/b&gt;都额外增加一个&lt;b&gt;lang_code&lt;/b&gt;的前缀，路由数较少时没什么问题，但路由数较多时太过麻烦
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
实现&lt;b&gt;example.com/en/uri&lt;/b&gt;可以有多种方式，除了使用&lt;b&gt;Flask URL Processors&lt;/b&gt;中介绍的外，还可以
&lt;/p&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;使用nginx重定向uri&lt;/h2&gt;
&lt;p&gt;
   这应该是各种方式里最简单的一种...&lt;/p&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;使用nginx重定向uri&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;使用uri获取对应非302响应&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;使用url_map复制并alias路由&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4&quot;&gt;演示效果&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;
Flask的多语言国际化可以使用&lt;b&gt;Flask-Babel&lt;/b&gt;插件，在此不再细述，但对于所谓的多语言站点(即形如&lt;b&gt;example.com/zh/uri、example.com/en/uri&lt;/b&gt;或者&lt;b&gt;zh.example.com、en.example.com&lt;/b&gt;)文档上却未作细述
&lt;/p&gt;

&lt;p&gt;
有一个 &lt;a href=&quot;https://flask.palletsprojects.com/en/1.1.x/patterns/urlprocessors/&quot;&gt;Flask URL Processors&lt;/a&gt; 需要对所有的&lt;b&gt;uri&lt;/b&gt;都额外增加一个&lt;b&gt;lang_code&lt;/b&gt;的前缀，路由数较少时没什么问题，但路由数较多时太过麻烦
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
实现&lt;b&gt;example.com/en/uri&lt;/b&gt;可以有多种方式，除了使用&lt;b&gt;Flask URL Processors&lt;/b&gt;中介绍的外，还可以
&lt;/p&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;使用nginx重定向uri&lt;/h2&gt;
&lt;p&gt;
   这应该是各种方式里最简单的一种
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;location&lt;/span&gt; ~ &lt;span style=&quot;color:#e6db74&quot;&gt;^/en/&lt;/span&gt; {
    &lt;span style=&quot;color:#f92672&quot;&gt;rewrite&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;^/en/(.*)&lt;/span&gt;$ &lt;span style=&quot;color:#e6db74&quot;&gt;/&lt;/span&gt;$1 &lt;span style=&quot;color:#e6db74&quot;&gt;last&lt;/span&gt;;
}
&lt;span style=&quot;color:#66d9ef&quot;&gt;location&lt;/span&gt; = &lt;span style=&quot;color:#e6db74&quot;&gt;/en&lt;/span&gt; {
    &lt;span style=&quot;color:#f92672&quot;&gt;rewrite&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;^/(.*)&lt;/span&gt;$ &lt;span style=&quot;color:#e6db74&quot;&gt;/index&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;last&lt;/span&gt;;
}&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;使用uri获取对应非302响应&lt;/h2&gt;
&lt;p&gt;
   即增加一个url为&lt;b&gt;/en/&lt;path:uri&gt;&lt;/b&gt;的路由，在此路由&lt;b&gt;func&lt;/b&gt;中，根据&lt;b&gt;&lt;path:uri&gt;&lt;/b&gt;信息获取已注册路由的&lt;b&gt;view_function&lt;/b&gt;，不使用重定向，而是直接调用&lt;b&gt;view_function&lt;/b&gt;返回实际响应
&lt;/p&gt;

&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;# https://stackoverflow.com/questions/38488134/get-the-flask-view-function-that-matches-a-url&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;get_view_function&lt;/span&gt;(url, method&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;GET&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;):
    adapter &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; current_app&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;url_map&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;bind(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;localhost&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;try&lt;/span&gt;:
        match &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; adapter&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;match(url, method&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;method)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;except&lt;/span&gt; RequestRedirect &lt;span style=&quot;color:#66d9ef&quot;&gt;as&lt;/span&gt; e:
        &lt;span style=&quot;color:#75715e&quot;&gt;# recursively match redirects&lt;/span&gt;
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; get_view_function(e&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;new_url, method)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;except&lt;/span&gt; (MethodNotAllowed, NotFound):
        &lt;span style=&quot;color:#75715e&quot;&gt;# no match&lt;/span&gt;
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; None

    &lt;span style=&quot;color:#66d9ef&quot;&gt;try&lt;/span&gt;:
        &lt;span style=&quot;color:#75715e&quot;&gt;# return the view function and arguments&lt;/span&gt;
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; current_app&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;view_functions[match[&lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;]], match[&lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;]
    &lt;span style=&quot;color:#66d9ef&quot;&gt;except&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;KeyError&lt;/span&gt;:
        &lt;span style=&quot;color:#75715e&quot;&gt;# no view is associated with the endpoint&lt;/span&gt;
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; None&lt;/pre&gt;

&lt;p&gt;
   提高查找对应&lt;code&gt;view-function&lt;/code&gt;的性能，增加缓存到内存中
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;FUNCTION &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; dict()

&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;view_function_cache&lt;/span&gt;(func):
    &lt;span style=&quot;color:#a6e22e&quot;&gt;@wraps&lt;/span&gt;(func)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;_view_function&lt;/span&gt;(url, method&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;GET&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;):
        &lt;span style=&quot;color:#75715e&quot;&gt;# 避免故意访问&lt;/span&gt;
        &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; len(FUNCTION) &lt;span style=&quot;color:#f92672&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;100&lt;/span&gt;:
            &lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; k, v &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; FUNCTION&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;items():
                &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; v &lt;span style=&quot;color:#f92672&quot;&gt;is&lt;/span&gt; None:
                    FUNCTION&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;pop(k)

        key &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; method &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; url
        key &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; str(hashlib&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;md5(key&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;encode(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;UTF-8&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;))&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;hexdigest())
        &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; key &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; FUNCTION:
            &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; FUNCTION[key]
        FUNCTION[key] &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; func(url, method)
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; FUNCTION[key]

    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; _view_function&lt;/pre&gt;

&lt;p&gt;
   这样就可以定义&lt;b&gt;/en/&lt;uri&gt;&lt;/b&gt;实际的&lt;code&gt;view_function&lt;/code&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;redirect_en&lt;/span&gt;(uri):
    view_function &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; get_view_function(
        &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; uri,
        request&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;method,
    )
    &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; view_function &lt;span style=&quot;color:#f92672&quot;&gt;is&lt;/span&gt; None:
        abort(&lt;span style=&quot;color:#ae81ff&quot;&gt;404&lt;/span&gt;)
    &lt;span style=&quot;color:#75715e&quot;&gt;# 注：因为我使用Flask-Babel是根据accept_language来区别不同语言&lt;/span&gt;
    request&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;environ[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;HTTP_ACCEPT_LANGUAGE&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;] &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;en-US,en;q=0.5&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; view_function[&lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;](&lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt;view_function[&lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;])&lt;/pre&gt;

&lt;h2 id=&quot;heading-3&quot;&gt;使用url_map复制并alias路由&lt;/h2&gt;
&lt;p&gt;
   原理同&lt;b&gt;Flask URL Processors&lt;/b&gt; ，为所有的路由都额外增加&lt;b&gt;/en&lt;/b&gt;前缀，并在&lt;code&gt;before_request&lt;/code&gt;中匹配到以&lt;b&gt;/en&lt;/b&gt;开头的请求就修改对应&lt;b&gt;accept_language&lt;/b&gt;信息
&lt;/p&gt;

&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;@app.before_request&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;before_request&lt;/span&gt;():
    &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; request&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;path&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;startswith(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/en/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;):
        request&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;environ[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;HTTP_ACCEPT_LANGUAGE&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;] &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;en-US,en;q=0.5&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;

url_map &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; list(app&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;url_map&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;iter_rules())
&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; rule &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; url_map:
    app&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;add_url_rule(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/en&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; rule&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;rule, rule&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;endpoint, alias&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;True)&lt;/pre&gt;

&lt;p&gt;
   咦，感觉这种方式更简单一些，但最好还是能够对一些特殊的路由比如: &lt;b&gt;static&lt;/b&gt;, &lt;b&gt;admin&lt;/b&gt;, &lt;b&gt;subdomain&lt;/b&gt;等进行特殊处理
&lt;/p&gt;

&lt;h2 id=&quot;heading-4&quot;&gt;演示效果&lt;/h2&gt;
&lt;p&gt;
   &lt;a href=&quot;https://honmaple.com/en/article&quot;&gt;切换成English&lt;/a&gt;
&lt;/p&gt;
</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>为pelican添加子站点功能</title>
      <link href="" rel="alternate"></link>
      <published>Sun, 03 Jun 2018 00:26:43 +0800</published>
      <updated>Tue, 05 Mar 2019 01:25:12 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2018/06/为pelican添加子站点功能.html" type="text/html"/>
      <id>https://honmaple.me/articles/2018/06/为pelican添加子站点功能.html</id>
      <summary type="html">
&lt;h2 id=&quot;heading-1&quot;&gt;创建翻译&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;babel-init:
    cd &lt;span style=&quot;color:#66d9ef&quot;&gt;$(&lt;/span&gt;THEMEDIR&lt;span style=&quot;color:#66d9ef&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pybabel extract -F babel.cfg -k lazy_gettext -o messages.pot ./ &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pybabel init -i messages.pot -d translations -l en

babel-update:
    cd &lt;span style=&quot;color:#66d9ef&quot;&gt;$(&lt;/span&gt;THEMEDIR&lt;span style=&quot;color:#66d9ef&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pybabel extract -F babel.cfg -k lazy_gettext -o messages.pot ./ &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;...&lt;/span&gt;&lt;/pre&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;创建翻译&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;动态变量&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;创建翻译&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;babel-init:
    cd &lt;span style=&quot;color:#66d9ef&quot;&gt;$(&lt;/span&gt;THEMEDIR&lt;span style=&quot;color:#66d9ef&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pybabel extract -F babel.cfg -k lazy_gettext -o messages.pot ./ &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pybabel init -i messages.pot -d translations -l en

babel-update:
    cd &lt;span style=&quot;color:#66d9ef&quot;&gt;$(&lt;/span&gt;THEMEDIR&lt;span style=&quot;color:#66d9ef&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pybabel extract -F babel.cfg -k lazy_gettext -o messages.pot ./ &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pybabel update -i messages.pot -d translations

babel-compile:
    cd &lt;span style=&quot;color:#66d9ef&quot;&gt;$(&lt;/span&gt;THEMEDIR&lt;span style=&quot;color:#66d9ef&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pybabel compile -d translations&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;动态变量&lt;/h2&gt;
&lt;p&gt;
   在模板里，我有一些动态变量需要翻译，比如在分类里的 &lt;code&gt;Python&lt;/code&gt; 需要翻译成 &lt;code&gt;生活苦短&lt;/code&gt;,但很不幸, &lt;b&gt;Babel&lt;/b&gt;并不支持动态变量的翻译。
   刚开始，在我没使用&lt;code&gt;i18n_subsites&lt;/code&gt;时，我采用加载一个&lt;code&gt;i18n.html&lt;/code&gt;文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;{%&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;macro&lt;/span&gt; gettext&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;string&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt; -&lt;span style=&quot;color:#75715e&quot;&gt;%}&lt;/span&gt;
&lt;span style=&quot;color:#75715e&quot;&gt;{%&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;set&lt;/span&gt; _gettext&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;dict&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;
    python&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;人生苦短&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;,&lt;/span&gt;
    security&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;极客安全&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;,&lt;/span&gt;
    archives&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;文章归档&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;,&lt;/span&gt;
&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color:#75715e&quot;&gt;%}&lt;/span&gt;
&lt;span style=&quot;color:#75715e&quot;&gt;{{&lt;/span&gt; _gettext.get&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;string.lower&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;,&lt;/span&gt;string&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt; &lt;span style=&quot;color:#75715e&quot;&gt;}}&lt;/span&gt;
&lt;span style=&quot;color:#75715e&quot;&gt;{%&lt;/span&gt;- &lt;span style=&quot;color:#66d9ef&quot;&gt;endmacro&lt;/span&gt; &lt;span style=&quot;color:#75715e&quot;&gt;%}&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
   类似字典的形式对部分变量进行翻译，这能够工作的很好，虽然有些麻烦。
&lt;/p&gt;

&lt;p&gt;
   在使用&lt;b&gt;Babel&lt;/b&gt;之后，我想要把它和&lt;code&gt;messages.po&lt;/code&gt;统一管理，所以采用另一种比较折中的方案: &lt;code&gt;jinja2 filter&lt;/code&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; babel &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; support

&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;gettrans&lt;/span&gt;(text, locale&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;DEFAULT_LANG):
    translations &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; support&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Translations()
    catalog &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; support&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Translations&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;load(
        os&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;path&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;abspath(os&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;path&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;join(THEME, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;translations&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)), locale)
    translations&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;merge(catalog)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; hasattr(catalog, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;plural&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;):
        translations&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;plural &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; catalog&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;plural
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; translations&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;gettext(text)

JINJA_FILTERS &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;gettrans&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: gettrans,
}&lt;/pre&gt;
&lt;p&gt;
   这样就可以通过传递变量来获取对应的翻译, 而我所需要做的就是写好&lt;code&gt;messages.po&lt;/code&gt;然后编译成&lt;code&gt;messages.mo&lt;/code&gt;即可，同样为了每次使用&lt;code&gt;pybabel update&lt;/code&gt; 都可以得到相同的内容，我使用了一种取巧的办法, 同样是&lt;b&gt;i18n.html&lt;/b&gt;文件，把所需要国际化的可能变量全部放到一起，但不要在其它模板里&lt;code&gt;import&lt;/code&gt;这个模板，这样每次更新翻译文件，&lt;b&gt;Babel&lt;/b&gt; 都能自动找到并生成相同的&lt;code&gt;messages.po&lt;/code&gt;文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;{%&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;macro&lt;/span&gt; gettrans&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;string&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt; -&lt;span style=&quot;color:#75715e&quot;&gt;%}&lt;/span&gt;
  &lt;span style=&quot;color:#75715e&quot;&gt;{%&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;set&lt;/span&gt; _gettrans&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;[&lt;/span&gt;
      &lt;span style=&quot;color:#66d9ef&quot;&gt;_&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Linux&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;,&lt;/span&gt;
      &lt;span style=&quot;color:#66d9ef&quot;&gt;_&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Python&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;,&lt;/span&gt;
      &lt;span style=&quot;color:#66d9ef&quot;&gt;_&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Security&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;,&lt;/span&gt;
      &lt;span style=&quot;color:#66d9ef&quot;&gt;_&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;友链&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;,&lt;/span&gt;
      &lt;span style=&quot;color:#66d9ef&quot;&gt;_&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;联系&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;]&lt;/span&gt; &lt;span style=&quot;color:#75715e&quot;&gt;%}&lt;/span&gt;
&lt;span style=&quot;color:#75715e&quot;&gt;{%&lt;/span&gt;- &lt;span style=&quot;color:#66d9ef&quot;&gt;endmacro&lt;/span&gt; &lt;span style=&quot;color:#75715e&quot;&gt;%}&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;
   这种方式同样解决了我的另一个问题: 我可能在中文站点使用的是英文变量，但需要显示翻译后的中文，而在英文站点使用英文变量，显示的却同样是英文。说起来比较绕口，简单来说就是，中文站点里有一个&lt;code&gt;Python&lt;/code&gt;变量,我需要显示为&lt;code&gt;人生苦短&lt;/code&gt; ， 而在英文站点，则显示为 &lt;code&gt;Python&lt;/code&gt;，毕竟我可以在&lt;code&gt;zh_CN/LC_MESSAGES/messages.po&lt;/code&gt;写上翻译后的内容,而在&lt;code&gt;en/LC_MESSAGES/messages.po&lt;/code&gt;里保持原样,很方便地做到中英文分离。
&lt;/p&gt;
</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>为pelican添加文章加密功能</title>
      <link href="" rel="alternate"></link>
      <published>Sat, 17 Mar 2018 21:20:06 +0800</published>
      <updated>Fri, 21 Dec 2018 18:43:59 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2018/03/为pelican添加文章加密功能.html" type="text/html"/>
      <id>https://honmaple.me/articles/2018/03/为pelican添加文章加密功能.html</id>
      <summary type="html">
  &lt;div class=&quot;encrypt-container entry-encrypt&quot;&gt;
    &lt;div class=&quot;encrypt-form form-group has-feedback&quot;&gt;
      &lt;input type=&quot;password&quot; class=&quot;encrypt-password form-control input-sm&quot; placeholder=&quot;请输入密码&quot; /&gt;
      &lt;i class=&quot;fa fa-key form-control-feedback entry-decrypt&quot;&gt;&lt;/i&gt;&lt;span class=&quot;help-block&quot;&gt;这是一篇加密的文章，密码是蟒蛇英文&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class=&quot;encrypt-content entry-encrypt-content&quot; style=&quot;display:none;&quot;&gt;MsLQDQwSepsQm6LphTgw7qnKSTKyclGVLX6NhGwidzN95hh4NSluq2gIXevgdHnYuutgLrh+0rlaj4NzKk9xkCQ4IBndo1ZBSji4KWTKiHS+3YcLqjHqjzR+LbeMHnHDbkRYmYUxyuQVxWSPpCLlko/cjV2pSgvZ2DrgnYjqHP17iEo8NMy3Qr8isXxFNZAkhCEbkgrglYW1H5ArLjuOXRJD8yOwQVp0RbyZB7z9rpsYBr1aMS4t1BPJJbdIKytLdT9wgjU8dombx7fAPwkMICRNw6WBNHt4JPsAFC9QxxmIIMZ8sAeRybtVuTpD+pFGLpwu4EdLs2vCokUVHJu4OhHr1NryjYp3K5uhve4ePtLVFyWDOZ2Zqb9uIHSbHSR3YAL5D5MBTGdDngLqybkfrI47wE0OBdBHum8E1cBxmaVrcWxOHmx1l7d7Cq8sf9sYZKeXVX7xYwHLKagTpYAvqpqv5c+DgRjMpCnUaJbo2JqIdpezakSfwDpbJHBFAM+IrmdbUVwPAm5z1ZsnqnvD+32kOIGRg0jfT74xaPJ1ZzHJjPfsxuXR1+MnH/Sya1Ol7umoFa2fNbSltMglrpCMzk+B8LOcQNXiobzjt09C1v1qUpyBHtquzSvuMuQkX2EJBkEOEpZMhXhzBDKWOx23FdUCwHEM7Fwmua8Eiee5IiDgbI851d9QvUbkS2qF2dHgtMuxLwUg5i1IQWeTMXNeETG3ZK06+Ywm2vxtAXep7kDyF9zQm5nTNmWAn5awJHcUUacyikmodWOoukqCvWcNa/G7H1mXbB28FVNZ4QnFwUSw++dWZPPmDYEOx7KOs4hlaHaGmFhgiA8+Es4webJy9ZgCHacBUS9/bmRJt8oEfC7o6q8qR9L4Cn5sLRZgw7hgRxae1iuEOzRZl+dZcJFqDc670+h0FLIfO0UExxB85z6nUEZKkhoIDYbpYmnby2PZmmCLSZ3N15wZiOMBS7vnbiu15jhcGFlc54IV3mTsrQr9v+HDT8HUkAq3p4phKQkE7VII3bRYKKhDT8LDYZHgq9xXsdDFy5ITNWZFO7X3dP/ROzzPH4BPpgGwewgsiE17KcKDtD3iS6fOBuT07NKorFjftvL68bCwp+mZclOM8syo6zfpRVgZPjJ0d0Mkc3UVZleOCwRb2RXnMoM9Z1enzqFAmBQVIcuVnwcSy/3DrmSjEKmBvHDVSJrrZZkplYiRqOK4irclKpaiz67tJXsmZYhUa5iKYnM/3oSrSCZY3jS4Ii1a7ifDWdns61XInsBQVHg0xrsr7Yy2qL6GVqF6ZwYokUs2sFM2bktJkXKtx3ZTk3GsvOupjOc4jAdoDOQaMXHbiIlnKOfbByk5ycAh3ZqV7phcpAvAucIa6JWCHg7PbAc8WmdqCfpbXAzOJCfpg7aqeJaEOaQw9dvQ8FCzQsW0er+/WXF6S3SL2tcbyYDDJxDSMsK5v7i1Ti7pJ3jR53IE0pJhjGvPzEKgxBHuYoQsxv4GPrWsVUOPFlU7pgce89KCoPJ2Xwz2DextlSSoKMhUoSu7wpUEA4qaZYB6QaDrIXQVJIxIhTidTrST7BD3RFyxrTKrOx6E0b4zI3uswmIlknpih4uSSqTH8Sdc22VOGzVtj0nOkX2cmYoUzyzMgQM3YXMA//mqYjVQt43h83DX8dMeEaw34NrIfWpZNZgMlsL310/ROSFrL8T1jndZhPG5rGWdqwqWKveEgBK7B6+QpPE+O9/n2RDgjgDBCzglHQdyu8s1yutvfZcxQgjYjjAgMKcNjlYb80XskJCKhdmpNvnSD4TyCMmSVHb/shOMykSniiM/9VYHaYFl7TqikdAb6xMzZzdEpSsY8dvCQPeZNLTujG1GRvu60Z9KqA==&lt;/div&gt;
  &lt;/div&gt;



  
  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot; crossorigin=&quot;anonymous&quot; referrerpolicy=&quot;no-referrer&quot;&gt;&lt;/script&gt;
  
  
    &lt;script&gt;
       const  _do_decrypt = function(encrypted, password) {
         let key = CryptoJS.enc.Utf8.parse(password);
         let iv = CryptoJS.enc.Utf8.parse(password.substr(0, 16));

         return CryptoJS.AES.decrypt(encrypted, key, {
           iv: iv,
           mode: CryptoJS.mode.CBC,
           padding: CryptoJS.pad.Pkcs7
         }).toString(CryptoJS.enc.Utf8);
       }

       const decrypt = function(element) {
         let parent = element.parentNode.parentNode;
         let encrypted = parent.querySelector(
           &quot;.encrypt-content&quot;).innerText;
         let password = parent.querySelector(
           &quot;.encrypt-password&quot;).value;

         password = CryptoJS.MD5(password).toString()

         let decrypted = &quot;&quot;;
         try {
           decrypted = _do_decrypt(encrypted, password);
         } catch (err) {
           console.error(err);
           alert(&quot;Failed to decrypt.&quot;);
           return;
         }
         if (decrypted == &quot;&quot;) {
           alert(&quot;Failed to decrypt.&quot;);
         }else {
           parent.innerHTML = decrypted;

           let index = -1;
           let elements = document.querySelectorAll(&quot;.encrypt-container&quot;);
           for (index = 0; index &lt; elements.length; ++index) {
             if (elements[index].isSameNode(parent)) {
               break;
             }
           }
           let storage = sessionStorage;
           let key = location.pathname + &quot;.password.&quot; + index;
           storage.setItem(key, password);
         }
       }

       window.onload = () =&gt; {
         let elements = document.querySelectorAll(&quot;.encrypt-container&quot;);
         elements.forEach(function (value, index) {
           let key = location.pathname + &quot;.password.&quot; + index;
           let password = sessionStorage.getItem(key);

           if (password) {
             console.log(&quot;Found password for part &quot; + index);

             let parent = elements[index];
             let encrypted = parent.querySelector(&quot;.encrypt-content&quot;).innerText;
             let decrypted = _do_decrypt(encrypted, password);
             elements[index].innerHTML = decrypted;
           }
         });
       };
    &lt;/script&gt;
  

</summary>
      <content type="html">
  &lt;div class=&quot;encrypt-container entry-encrypt&quot;&gt;
    &lt;div class=&quot;encrypt-form form-group has-feedback&quot;&gt;
      &lt;input type=&quot;password&quot; class=&quot;encrypt-password form-control input-sm&quot; placeholder=&quot;请输入密码&quot; /&gt;
      &lt;i class=&quot;fa fa-key form-control-feedback entry-decrypt&quot;&gt;&lt;/i&gt;&lt;span class=&quot;help-block&quot;&gt;这是一篇加密的文章，密码是蟒蛇英文&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class=&quot;encrypt-content entry-encrypt-content&quot; style=&quot;display:none;&quot;&gt;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&lt;/div&gt;
  &lt;/div&gt;



  
  &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js&quot; crossorigin=&quot;anonymous&quot; referrerpolicy=&quot;no-referrer&quot;&gt;&lt;/script&gt;
  
  
    &lt;script&gt;
       const  _do_decrypt = function(encrypted, password) {
         let key = CryptoJS.enc.Utf8.parse(password);
         let iv = CryptoJS.enc.Utf8.parse(password.substr(0, 16));

         return CryptoJS.AES.decrypt(encrypted, key, {
           iv: iv,
           mode: CryptoJS.mode.CBC,
           padding: CryptoJS.pad.Pkcs7
         }).toString(CryptoJS.enc.Utf8);
       }

       const decrypt = function(element) {
         let parent = element.parentNode.parentNode;
         let encrypted = parent.querySelector(
           &quot;.encrypt-content&quot;).innerText;
         let password = parent.querySelector(
           &quot;.encrypt-password&quot;).value;

         password = CryptoJS.MD5(password).toString()

         let decrypted = &quot;&quot;;
         try {
           decrypted = _do_decrypt(encrypted, password);
         } catch (err) {
           console.error(err);
           alert(&quot;Failed to decrypt.&quot;);
           return;
         }
         if (decrypted == &quot;&quot;) {
           alert(&quot;Failed to decrypt.&quot;);
         }else {
           parent.innerHTML = decrypted;

           let index = -1;
           let elements = document.querySelectorAll(&quot;.encrypt-container&quot;);
           for (index = 0; index &lt; elements.length; ++index) {
             if (elements[index].isSameNode(parent)) {
               break;
             }
           }
           let storage = sessionStorage;
           let key = location.pathname + &quot;.password.&quot; + index;
           storage.setItem(key, password);
         }
       }

       window.onload = () =&gt; {
         let elements = document.querySelectorAll(&quot;.encrypt-container&quot;);
         elements.forEach(function (value, index) {
           let key = location.pathname + &quot;.password.&quot; + index;
           let password = sessionStorage.getItem(key);

           if (password) {
             console.log(&quot;Found password for part &quot; + index);

             let parent = elements[index];
             let encrypted = parent.querySelector(&quot;.encrypt-content&quot;).innerText;
             let decrypted = _do_decrypt(encrypted, password);
             elements[index].innerHTML = decrypted;
           }
         });
       };
    &lt;/script&gt;
  

</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>flask_maple文档</title>
      <link href="" rel="alternate"></link>
      <published>Fri, 23 Feb 2018 22:49:01 +0800</published>
      <updated>Fri, 23 Feb 2018 23:08:55 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2018/02/flask_maple文档.html" type="text/html"/>
      <id>https://honmaple.me/articles/2018/02/flask_maple文档.html</id>
      <summary type="html">
&lt;h2 id=&quot;heading-1&quot;&gt;安装&lt;/h2&gt;
&lt;p&gt;
   To install Flask-Maple:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;pip install flask&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;maple&lt;/pre&gt;

&lt;p&gt;
   Or alternatively, you can download the repository and install manually by doing:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;git clone git&lt;span style=&quot;color:#a6e22e&quot;&gt;@github.com&lt;/span&gt;:honmaple&lt;span style=&quot;color:#f92672&quot;&gt;/&lt;/span&gt;flask&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;maple&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;git
cd flask&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;maple
python setup&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;py install&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;用户系统&lt;/h2&gt;
&lt;p&gt;
   在 &lt;b&gt;flask_maple/auth/model.py&lt;/b&gt; 中默认实现了 &lt;b&gt;GroupMixin&lt;/b&gt; 与 &lt;b&gt;UserMixin&lt;/b&gt;
   如果要创建...&lt;/p&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;用户系统&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;权限&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3.1&quot;&gt;使用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3.2&quot;&gt;权限缓存&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4&quot;&gt;登录&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.1&quot;&gt;使用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.2&quot;&gt;注意事项&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5&quot;&gt;验证码&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5.1&quot;&gt;使用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5.2&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-6&quot;&gt;错误处理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-7&quot;&gt;邮箱&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-8&quot;&gt;表单&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-9&quot;&gt;数据库&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-9.1&quot;&gt;基本查询(已实现)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-9.2&quot;&gt;关系查询&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-9.3&quot;&gt;其它&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10&quot;&gt;序列化&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10.1&quot;&gt;多个实例&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10.2&quot;&gt;单个实例&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10.3&quot;&gt;排除字段&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10.4&quot;&gt;仅包括字段&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10.5&quot;&gt;关系查询深度&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10.6&quot;&gt;额外的字段&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-10.7&quot;&gt;自定义&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-11&quot;&gt;中间件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-12&quot;&gt;日志&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-13&quot;&gt;App&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-13.1&quot;&gt;使用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-13.2&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-14&quot;&gt;Bootstrap&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-14.1&quot;&gt;使用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-14.2&quot;&gt;模板&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-14.3&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-15&quot;&gt;Redis&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-15.1&quot;&gt;使用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-15.2&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;安装&lt;/h2&gt;
&lt;p&gt;
   To install Flask-Maple:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;pip install flask&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;maple&lt;/pre&gt;

&lt;p&gt;
   Or alternatively, you can download the repository and install manually by doing:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;git clone git&lt;span style=&quot;color:#a6e22e&quot;&gt;@github.com&lt;/span&gt;:honmaple&lt;span style=&quot;color:#f92672&quot;&gt;/&lt;/span&gt;flask&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;maple&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;git
cd flask&lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt;maple
python setup&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;py install&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;用户系统&lt;/h2&gt;
&lt;p&gt;
   在 &lt;b&gt;flask_maple/auth/model.py&lt;/b&gt; 中默认实现了 &lt;b&gt;GroupMixin&lt;/b&gt; 与 &lt;b&gt;UserMixin&lt;/b&gt;
   如果要创建 user 表与 group 表,只需要
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.auth.models &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; UserMixin, GroupMixin

&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;User&lt;/span&gt;(db&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Model, UserMixin):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;pass&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Group&lt;/span&gt;(db&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Model, GroupMixin):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;pass&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
   即可
&lt;/p&gt;

&lt;p&gt;
   &lt;b&gt;user&lt;/b&gt; 表默认创建以下字段, 可添加更多想要的字段
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 id
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 username
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 password
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 email
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 is_superuser
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 is_confirmed
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 register_time
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 last_login
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 groups
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
   &lt;b&gt;group&lt;/b&gt; 表默认创建以下字段
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 id
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 name
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 users
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 parent_group
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 child_groups
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-3&quot;&gt;权限&lt;/h2&gt;
&lt;h3 id=&quot;heading-3.1&quot;&gt;使用&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.permission.models &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; PermissionMixin

&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Permission&lt;/span&gt;(db&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Model, PermissionMixin):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;pass&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;
    user 表与 group 表可继承 &lt;b&gt;flask_maple.permission.models.UserMixin&lt;/b&gt; 与 &lt;b&gt;flask_maple.permission.models.GroupMixin&lt;/b&gt;
    或者直接使用 &lt;b&gt;flask_maple.auth.models.UserMixin&lt;/b&gt; 与 &lt;b&gt;flask_maple.auth.models.GroupMixin&lt;/b&gt;
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 添加权限
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;identity &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; user &lt;span style=&quot;color:#75715e&quot;&gt;# or group&lt;/span&gt;
identity&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;add_perm(
    action,
    resource,
    resource_type&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;endpoint&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
    description&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;None)&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 删除权限
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;identity&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;remove_perm(
    action,
    resource,
    resource_type&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;endpoint&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 检查权限
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;identity&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;has_perm(action, resource, resource_type&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;endpoint&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, and_&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;False)&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-3.2&quot;&gt;权限缓存&lt;/h3&gt;
&lt;p&gt;
    默认权限会从数据库获取, 如果经常使用，可自行添加缓存, 并在添加删除权限后自行对缓存进行操作
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;User&lt;/span&gt;(db&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Model, UserMixin):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;perm_cache&lt;/span&gt;(self,
                   action,
                   resource,
                   resource_type&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;endpoint&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
                   and_&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;False):
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt;&lt;/pre&gt;

&lt;h2 id=&quot;heading-4&quot;&gt;登录&lt;/h2&gt;
&lt;p&gt;
   依赖于 &lt;b&gt;flask-login&lt;/b&gt;, &lt;b&gt;flask-mail&lt;/b&gt;
&lt;/p&gt;

&lt;h3 id=&quot;heading-4.1&quot;&gt;使用&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; auth

auth&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;init_app(app)

&lt;span style=&quot;color:#75715e&quot;&gt;# 或者&lt;/span&gt;
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.auth.views &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Auth

Auth(app)&lt;/pre&gt;

&lt;p&gt;
    将会创建6个 &lt;b&gt;url&lt;/b&gt;
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 /login
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 /logout
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 /register
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 /forget
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 /confirm
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 /confirm/&lt;token&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
    可以自定义登陆，注册，忘记密码页面，以登陆页面为例 (templates/maple/login.html)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{% extends &amp;#34;base/base.html&amp;#34; %}
{%- block content -%}
{% import &amp;#39;maple/auth.html&amp;#39; as auth %}
&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;div&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;panel panel-primary&amp;#34;&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;div&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;panel-heading&amp;#34;&lt;/span&gt;&amp;gt;
        &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;a&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;href&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{{ url_for(&amp;#39;auth.login&amp;#39;) }}&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;style&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;color:#fff&amp;#34;&lt;/span&gt;&amp;gt;{{ _(&amp;#39;Login&amp;#39;)}}&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;a&lt;/span&gt;&amp;gt;
    &amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;div&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;div&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;panel-body&amp;#34;&lt;/span&gt;&amp;gt;
        {{ auth.login()}}
    &amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;div&lt;/span&gt;&amp;gt;
&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;div&lt;/span&gt;&amp;gt;
{% endblock %}&lt;/pre&gt;

&lt;h3 id=&quot;heading-4.2&quot;&gt;注意事项&lt;/h3&gt;
&lt;p&gt;
    登陆与登出默认使用 &lt;b&gt;user.login(remember)&lt;/b&gt; , &lt;b&gt;user.logout()&lt;/b&gt;, 如果未使用 &lt;b&gt;flask_maple/auth/model.py&lt;/b&gt; 中的 &lt;b&gt;UserMixin&lt;/b&gt;,则需要自己定义
&lt;/p&gt;

&lt;h2 id=&quot;heading-5&quot;&gt;验证码&lt;/h2&gt;
&lt;p&gt;
   使用 &lt;b&gt;Pillow&lt;/b&gt; 生成验证码
&lt;/p&gt;

&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;pip install pillow&lt;/pre&gt;

&lt;h3 id=&quot;heading-5.1&quot;&gt;使用&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Captcha
captcha &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Captcha(app)

&lt;span style=&quot;color:#75715e&quot;&gt;# 因为字体可能存在侵权，所以需要指定自己服务器字体, 默认为 /usr/share/fonts/TTF/DejaVuSans.ttf&lt;/span&gt;
captcha &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Captcha(app, font&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)&lt;/pre&gt;
&lt;p&gt;
    然后访问 &lt;a href=&quot;http://127.0.0.1/captcha&quot;&gt;http://127.0.0.1/captcha&lt;/a&gt;
&lt;/p&gt;

&lt;h3 id=&quot;heading-5.2&quot;&gt;配置&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;CAPTCHA_URL &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;The captcha url,default &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;captcha&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;/pre&gt;

&lt;h2 id=&quot;heading-6&quot;&gt;错误处理&lt;/h2&gt;
&lt;p&gt;
   主要是对发生错误时的页面进行定制(403,404,500)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Error
error &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Error(app)&lt;/pre&gt;

&lt;p&gt;
   定制图片源于&lt;b&gt;flask&lt;/b&gt;官网,侵删
&lt;/p&gt;

&lt;h2 id=&quot;heading-7&quot;&gt;邮箱&lt;/h2&gt;
&lt;p&gt;
   依赖于 &lt;b&gt;flask-mail&lt;/b&gt;, 区别使用多线程发送
&lt;/p&gt;

&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.mail &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Mail

mail &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Mail(app)
mail&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;send_email(&lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt;args, &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt;kwargs)&lt;/pre&gt;

&lt;p&gt;
   此外，还有一个 &lt;b&gt;MailMixin&lt;/b&gt;,实现了邮箱验证需要的密钥,
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.mail &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; MailMixin

&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;User&lt;/span&gt;(db&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Model, MailMixin):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;pass&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(user&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;email_token)
&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(User&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;check_email_token(token, max_age&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;259200&lt;/span&gt;))&lt;/pre&gt;
&lt;h2 id=&quot;heading-8&quot;&gt;表单&lt;/h2&gt;
&lt;h2 id=&quot;heading-9&quot;&gt;数据库&lt;/h2&gt;
&lt;p&gt;
   像django一样使用 &lt;b&gt;flask-sqlalchemy&lt;/b&gt;
   &lt;b&gt;djang orm&lt;/b&gt; 与sqlalchemy相比,为什么很多人都认为django orm更好用,大概就是因为django orm更方便
&lt;/p&gt;

&lt;h3 id=&quot;heading-9.1&quot;&gt;基本查询(已实现)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 gt
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 lt
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 lte
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 gte
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 contains
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 in
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 exact
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 iexact
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 startswith
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 istartswith
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 iendswith
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 endswith
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 isnull
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 range
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 year
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 month
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 day
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
    示例:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;filter_by(title__contains &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;sql&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;all()
Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;exclude_by(title__contains &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;sql&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;all()&lt;/pre&gt;

&lt;h3 id=&quot;heading-9.2&quot;&gt;关系查询&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;filter_by(tags__name__contains &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;sql&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;all()&lt;/pre&gt;

&lt;h3 id=&quot;heading-9.3&quot;&gt;其它&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;filter_by(tags__name__contains &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;sql&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;or&lt;/span&gt;(Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;id &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;,Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;id &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;all()
Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;filter_by(tags__name__contains &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;sql&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;and&lt;/span&gt;(Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;id &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;,Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;id &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;all()
Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;filter_by(tags__name__contains &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;sql&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;exists()
Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;load_only(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)&lt;/pre&gt;

&lt;h2 id=&quot;heading-10&quot;&gt;序列化&lt;/h2&gt;
&lt;p&gt;
   把 &lt;b&gt;sqlalchemy&lt;/b&gt; 对象序列化为 &lt;b&gt;json&lt;/b&gt;, 使用方法参考于 &lt;b&gt;django rest framework&lt;/b&gt;
&lt;/p&gt;

&lt;h3 id=&quot;heading-10.1&quot;&gt;多个实例&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.serializer &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Serializer

posts &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;all()
serializer &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Serializer(posts)
data &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; serializer&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;data&lt;/pre&gt;

&lt;h3 id=&quot;heading-10.2&quot;&gt;单个实例&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;post &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Post&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;query&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;first()
serializer &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Serializer(post)
data &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; serializer&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;data&lt;/pre&gt;

&lt;h3 id=&quot;heading-10.3&quot;&gt;排除字段&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;serializer &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Seralizer(post,exclude&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;])&lt;/pre&gt;

&lt;h3 id=&quot;heading-10.4&quot;&gt;仅包括字段&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;serializer &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Seralizer(post,include&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;])&lt;/pre&gt;

&lt;h3 id=&quot;heading-10.5&quot;&gt;关系查询深度&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;serializer &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Seralizer(post,depth&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;3&lt;/span&gt;)&lt;/pre&gt;
&lt;p&gt;
    depth默认为&lt;b&gt;2&lt;/b&gt;
&lt;/p&gt;

&lt;h3 id=&quot;heading-10.6&quot;&gt;额外的字段&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Post&lt;/span&gt;(Model):
    &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;get_post_count&lt;/span&gt;(self):
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;11&lt;/span&gt;

serializer &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Serializer(post,extra&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;get_post_count&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;])&lt;/pre&gt;

&lt;h3 id=&quot;heading-10.7&quot;&gt;自定义&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.serializer &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Serializer

&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;PostSerializer&lt;/span&gt;(Serializer):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Meta&lt;/span&gt;:
        include &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; []
        depth &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;
        include &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; []
        exclude &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; []
        extra &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; [&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;count&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;]

serializer &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; PostSerializer(post,include&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;])&lt;/pre&gt;

&lt;h2 id=&quot;heading-11&quot;&gt;中间件&lt;/h2&gt;
&lt;p&gt;
   参考于 &lt;b&gt;django&lt;/b&gt; 
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.middleware &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Middleware

app &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;
Middleware(app)&lt;/pre&gt;

&lt;p&gt;
   中间件写法(以一个简单的性能测试中间件为例)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;ProfileMiddleware&lt;/span&gt;(object):
    &lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;preprocess_request&lt;/span&gt;(self):
        pr &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; cProfile&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Profile()
        pr&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;enable()
        request&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;pr &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; pr

    &lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;process_response&lt;/span&gt;(self, response):
        pr &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; request&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;pr
        pr&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;disable()
        s &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; StringIO()
        sortby &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;cumulative&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;
        ps &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; pstats&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Stats(pr, stream&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;s)&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;sort_stats(sortby)
        ps&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;print_stats()
        &lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(s&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;getvalue())
        &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; response&lt;/pre&gt;

&lt;p&gt;
   &lt;b&gt;重要&lt;/b&gt; ，需要加入中间件配置
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;MIDDLEWARE = [&amp;#34;path.to.ProfileMiddleware&amp;#34;]&lt;/pre&gt;

&lt;h2 id=&quot;heading-12&quot;&gt;日志&lt;/h2&gt;
&lt;p&gt;
   记录 &lt;b&gt;info&lt;/b&gt; 和 &lt;b&gt;error&lt;/b&gt; 两个日志level, 使用很简单
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.log &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Logging

app &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;
Logging(app)&lt;/pre&gt;

&lt;p&gt;
   配置文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;LOGGING &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; {
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;info&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;logs/info.log&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,   &lt;span style=&quot;color:#75715e&quot;&gt;# 记录info level的日志,与配置文件同级下的logs目录,可修改&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;error&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;logs/error.log&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#75715e&quot;&gt;# 记录error level的日志&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;send_mail&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: False,        &lt;span style=&quot;color:#75715e&quot;&gt;# 当有错误发生时，是否发送邮件到管理员邮箱&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;toaddrs&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: [],             &lt;span style=&quot;color:#75715e&quot;&gt;# 管理员邮箱，可为多个&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;subject&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Your Application Failed&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
    &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;formatter&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;            Message type:       &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%(levelname)s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;            Location:           &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%(pathname)s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%(lineno)d&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;            Module:             &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%(module)s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;            Function:           &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%(funcName)s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;            Time:               &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%(asctime)s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;            Message:&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%(message)s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
}&lt;/pre&gt;

&lt;p&gt;
   当&lt;b&gt;send_mail&lt;/b&gt;为 &lt;b&gt;True&lt;/b&gt;时, 配置依赖于 &lt;b&gt;flask_mail&lt;/b&gt;的配置(主要是不想写多份)
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;MAIL_USERNAME
MAIL_PASSWORD
MAIL_SERVER
MAIL_PORT
MAIL_DEFAULT_SENDER&lt;/pre&gt;
&lt;h2 id=&quot;heading-13&quot;&gt;App&lt;/h2&gt;
&lt;p&gt;
   创建两个常用的 &lt;b&gt;url&lt;/b&gt;
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 /robots.txt
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 /favicon.ico
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-13.1&quot;&gt;使用&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.app &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; App

App(app)&lt;/pre&gt;

&lt;p&gt;
    此外,因为国际化等原因,可以传递 &lt;b&gt;flask_maple.json.CustomJSONEncoder&lt;/b&gt; 给App
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.app &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; App
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.json &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; CustomJSONEncoder

App(app, json&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;CustomJSONEncoder)&lt;/pre&gt;

&lt;h3 id=&quot;heading-13.2&quot;&gt;配置&lt;/h3&gt;
&lt;p&gt;
    参考于 django,可以懒加载 blueprint
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;INSTALLED_APPS = [
    &amp;#34;path.to.blueprint1&amp;#34;,
    &amp;#34;path.to.blueprint2&amp;#34;,
    {
        &amp;#34;kwargs&amp;#34;:{},
        &amp;#34;blueprint&amp;#34;:{}
    }
]&lt;/pre&gt;
&lt;h2 id=&quot;heading-14&quot;&gt;Bootstrap&lt;/h2&gt;
&lt;p&gt;
   主要是个人经常使用的一些模板,比如bootstrap的js,css文件，分页模板, 上下撑满等
   并依赖于 &lt;b&gt;flask-assets&lt;/b&gt; ,对js,css文件进行压缩
&lt;/p&gt;

&lt;h3 id=&quot;heading-14.1&quot;&gt;使用&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Bootstrap
bootstrap &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Bootstrap(
    app,
    css&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;styles/monokai.css&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;styles/mine.css&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;),
    js&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;styles/upload.js&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;styles/forums.js&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;styles/following.js&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;,
        &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;styles/topic.js&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;),
    use_auth&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;True)&lt;/pre&gt;

&lt;p&gt;
    或者
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;bootstrap &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Bootstrap()
bootstrap&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;init_app(app)&lt;/pre&gt;

&lt;h3 id=&quot;heading-14.2&quot;&gt;模板&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{% extends &amp;#39;maple/base.html&amp;#39; %}
{% block main -%}
&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;button&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;btn btn-primary&amp;#34;&lt;/span&gt;&amp;gt;submit&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;button&lt;/span&gt;&amp;gt;
&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;span&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;glyphicon glyphicon-search&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;aria-hidden&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;true&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;span&lt;/span&gt;&amp;gt;
{% endblock -%}&lt;/pre&gt;

&lt;h3 id=&quot;heading-14.3&quot;&gt;配置&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;AUTHOR_NAME &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;This will show you name at html footer&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;/pre&gt;

&lt;h2 id=&quot;heading-15&quot;&gt;Redis&lt;/h2&gt;
&lt;p&gt;
   默认会加载 &lt;b&gt;rediscluster.StrictRedisCluster&lt;/b&gt; ,如果rediscluster未安装则加载 &lt;b&gt;redis.StrictRedis&lt;/b&gt;
&lt;/p&gt;

&lt;h3 id=&quot;heading-15.1&quot;&gt;使用&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_maple.redis &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Redis

redis &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Redis(app)

&lt;span style=&quot;color:#75715e&quot;&gt;# 像平时使用redispy一样使用&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(redis&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;get(&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;))&lt;/pre&gt;

&lt;h3 id=&quot;heading-15.2&quot;&gt;配置&lt;/h3&gt;
&lt;pre class=&quot;src src-example&quot;&gt;REDSI = {...}&lt;/pre&gt;
</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>为pelican增加上一篇下一篇功能</title>
      <link href="" rel="alternate"></link>
      <published>Sun, 22 Oct 2017 22:40:28 +0800</published>
      <updated>Fri, 24 Feb 2023 00:25:02 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2017/10/为pelican增加上一篇下一篇功能.html" type="text/html"/>
      <id>https://honmaple.me/articles/2017/10/为pelican增加上一篇下一篇功能.html</id>
      <summary type="html">
&lt;p&gt;
功能实现很简单, &lt;b&gt;pelican&lt;/b&gt;也有类似的插件实现 &lt;a href=&quot;https://github.com/getpelican/pelican-plugins/tree/master/neighbors&quot;&gt;https://github.com/getpelican/pelican-plugins/tree/master/neighbors&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
不过自己实现起来更爽不是吗? 而且类似&lt;b&gt;prev_article_in_category&lt;/b&gt;和&lt;b&gt;prev_article_in_subcategory&lt;/b&gt;的功能我并不需要
&lt;/p&gt;

&lt;p&gt;
首先参考&lt;b&gt;pelican&lt;/b&gt;的文档,基础实现
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;add_neighbors&lt;/span&gt;(generator):
    &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;register&lt;/span&gt;():
    signals&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;article_generator_finalized&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;connect(add_neighbors)&lt;/pre&gt;

&lt;p&gt;
然后在&lt;b&gt;generator.articles&lt;/b&gt;列表上进行操作,为article增加&lt;b&gt;previous_article&lt;/b&gt;和...&lt;/p&gt;</summary>
      <content type="html">
&lt;p&gt;
功能实现很简单, &lt;b&gt;pelican&lt;/b&gt;也有类似的插件实现 &lt;a href=&quot;https://github.com/getpelican/pelican-plugins/tree/master/neighbors&quot;&gt;https://github.com/getpelican/pelican-plugins/tree/master/neighbors&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
不过自己实现起来更爽不是吗? 而且类似&lt;b&gt;prev_article_in_category&lt;/b&gt;和&lt;b&gt;prev_article_in_subcategory&lt;/b&gt;的功能我并不需要
&lt;/p&gt;

&lt;p&gt;
首先参考&lt;b&gt;pelican&lt;/b&gt;的文档,基础实现
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;add_neighbors&lt;/span&gt;(generator):
    &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;register&lt;/span&gt;():
    signals&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;article_generator_finalized&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;connect(add_neighbors)&lt;/pre&gt;

&lt;p&gt;
然后在&lt;b&gt;generator.articles&lt;/b&gt;列表上进行操作,为article增加&lt;b&gt;previous_article&lt;/b&gt;和&lt;b&gt;next_article&lt;/b&gt;对象
&lt;/p&gt;

&lt;p&gt;
先进行排序(按时间)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;articles &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; generator&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;articles
articles&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;sort(key&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;(&lt;span style=&quot;color:#66d9ef&quot;&gt;lambda&lt;/span&gt; x: x&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;date), reverse&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;True)&lt;/pre&gt;

&lt;p&gt;
然后可以使用&lt;b&gt;iter&lt;/b&gt;关键字,把列表变成生成器,使用next()( &lt;code&gt;python2用a.next(),python3用a.__next__()&lt;/code&gt;)获取下一个可迭代对象
&lt;/p&gt;

&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;pre_article &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; None
articles_iter &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; iter(articles[&lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;:])
&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; article &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; articles:
    next_article &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; next(articles_iter, None)
    setattr(article, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;previous_article&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, pre_article)
    setattr(article, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;next_article&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, next_article)
    pre_article &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; article&lt;/pre&gt;

&lt;p&gt;
最后，在模板template中增加相关html代码，示例:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{% if article.previous_article %}
&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;li&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;previous&amp;#34;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;a&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;href&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{{ SITEURL }}/{{ article.previous_article.url }}&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Previous article: {{ article.previous_article.title }}&amp;#34;&lt;/span&gt;&amp;gt;
    &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;i&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;fa fa-chevron-left&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;i&lt;/span&gt;&amp;gt;
    {{ article.previous_article.title }}
  &amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;a&lt;/span&gt;&amp;gt;
&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;li&lt;/span&gt;&amp;gt;
{% endif %}
{% if article.next_article %}
&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;li&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;next&amp;#34;&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;a&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;href&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{{ SITEURL }}/{{ article.next_article.url }}&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Next article: {{ article.previous_article.title }}&amp;#34;&lt;/span&gt;&amp;gt;
    {{ article.next_article.title }}
    &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;i&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;class&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;fa fa-chevron-right&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;i&lt;/span&gt;&amp;gt;
  &amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;a&lt;/span&gt;&amp;gt;
&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;li&lt;/span&gt;&amp;gt;
{% endif %}&lt;/pre&gt;

&lt;p&gt;
ok,就这样
&lt;/p&gt;</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>一个简单的数据分组算法</title>
      <link href="" rel="alternate"></link>
      <published>Wed, 26 Jul 2017 00:00:00 +0800</published>
      <updated>Fri, 24 Feb 2023 00:25:02 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2017/07/一个简单的数据分组算法.html" type="text/html"/>
      <id>https://honmaple.me/articles/2017/07/一个简单的数据分组算法.html</id>
      <summary type="html">
&lt;p&gt;
之前有这么一个需求
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;
将数据按照时间分组，比如说每5分钟为一组，或者每30分钟为一组，开始时间如果分钟数大于等于30分钟，则设置为30,如果小于30,则设置为0（也可以设置为更复杂的逻辑）
&lt;/p&gt;

&lt;p&gt;
当然中间还有一些数据的统计，分析和计算暂时不管
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;heading-1&quot;&gt;获取开始时间&lt;/h1&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;get_start_date&lt;/span&gt;(start_date):
    time &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; datetime&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;fromtimestamp(int(start_date) &lt;span style=&quot;color:#f92672&quot;&gt;/&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1000&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;minute &lt;span style=&quot;color:#f92672&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;30&lt;/span&gt;:
        minute &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;30&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;else&lt;/span&gt;:
        minute &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;
    start_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; datetime(time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;year, time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;month, time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;day...&lt;/pre&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;获取开始时间&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;时间分组&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;
之前有这么一个需求
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;
将数据按照时间分组，比如说每5分钟为一组，或者每30分钟为一组，开始时间如果分钟数大于等于30分钟，则设置为30,如果小于30,则设置为0（也可以设置为更复杂的逻辑）
&lt;/p&gt;

&lt;p&gt;
当然中间还有一些数据的统计，分析和计算暂时不管
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;heading-1&quot;&gt;获取开始时间&lt;/h1&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;get_start_date&lt;/span&gt;(start_date):
    time &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; datetime&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;fromtimestamp(int(start_date) &lt;span style=&quot;color:#f92672&quot;&gt;/&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1000&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;minute &lt;span style=&quot;color:#f92672&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;30&lt;/span&gt;:
        minute &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;30&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;else&lt;/span&gt;:
        minute &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;
    start_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; datetime(time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;year, time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;month, time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;day, time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;hour, minute,
                          &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;)
    start_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; mktime(start_date&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;timetuple()) &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1000&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; start_date&lt;/pre&gt;

&lt;p&gt;
开始时间很简单，需要注意的是设置分钟，需要将时间戳转换为datetime，设置分钟数后再将datetime转为时间戳
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;time &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; datetime&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;fromtimestamp(int(start_date) &lt;span style=&quot;color:#f92672&quot;&gt;/&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1000&lt;/span&gt;)
start_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; datetime(time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;year, time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;month, time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;day, time&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;hour, minute, &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;)
start_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; mktime(start_date&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;timetuple()) &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1000&lt;/span&gt;&lt;/pre&gt;

&lt;h1 id=&quot;heading-2&quot;&gt;时间分组&lt;/h1&gt;
&lt;p&gt;
  直接给出源码
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;gen_date_group&lt;/span&gt;(start_date, datas, interval):
    &lt;span style=&quot;color:#75715e&quot;&gt;# datas是一组含时间戳的数据&lt;/span&gt;
    interval &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; int(interval)
    &lt;span style=&quot;color:#75715e&quot;&gt;# 获取开始时间&lt;/span&gt;
    start_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; get_start_date(start_date)
    end_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; start_date &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; interval

    count &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;
    type_count &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; data &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; datas:
        &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; data[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;date&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;] &lt;span style=&quot;color:#f92672&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; end_date:
            &lt;span style=&quot;color:#66d9ef&quot;&gt;yield&lt;/span&gt; (start_date, get_count_average(type_count, count))
            &lt;span style=&quot;color:#75715e&quot;&gt;# 一些数据统计与计算&lt;/span&gt;
            type_count &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; data[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;type_count&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;]
            count &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; data[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;count&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;]
            start_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; end_date
            end_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; start_date &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; interval
            &lt;span style=&quot;color:#75715e&quot;&gt;# 注意这里，即使dates里没有某个时间区间的数据，也要不断循环分组&lt;/span&gt;
            &lt;span style=&quot;color:#66d9ef&quot;&gt;while&lt;/span&gt; data[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;date&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;] &lt;span style=&quot;color:#f92672&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; end_date:
                &lt;span style=&quot;color:#66d9ef&quot;&gt;yield&lt;/span&gt; (start_date, &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;)
                start_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; end_date
                end_date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; start_date &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; interval
        &lt;span style=&quot;color:#66d9ef&quot;&gt;else&lt;/span&gt;:
            type_count &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; data[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;type_count&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;]
            count &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; data[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;count&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;]&lt;/pre&gt;</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>基于whoosh实现的flask全文搜索插件</title>
      <link href="" rel="alternate"></link>
      <published>Sun, 16 Apr 2017 00:00:00 +0800</published>
      <updated>Fri, 24 Feb 2023 00:25:02 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2017/04/基于whoosh实现的flask全文搜索插件.html" type="text/html"/>
      <id>https://honmaple.me/articles/2017/04/基于whoosh实现的flask全文搜索插件.html</id>
      <summary type="html">
&lt;p&gt;
flask 貌似很少全文搜索的插件,有一个 &lt;a href=&quot;github.com/gyllstromk/Flask-WhooshAlchemy&quot;&gt;github.com/gyllstromk/Flask-WhooshAlchemy&lt;/a&gt;WhooshAlchemy 自己写了一个
&lt;/p&gt;

&lt;h1 id=&quot;heading-1&quot;&gt;Quickstart&lt;/h1&gt;
&lt;p&gt;
  插件基于 whoosh,纯 python 编写,使用上很简单
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_msearch &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Search
[&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;]
search &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Search()
search&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;init_app(app)

&lt;span style=&quot;color:#75715e&quot;&gt;# models.py&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Post&lt;/span&gt;(db&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Model):
    __tablename__ &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;post&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;
    __searchable__ &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; [&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;content&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;]

&lt;span style=&quot;color:#75715e&quot;&gt;# views...&lt;/span&gt;&lt;/pre&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;Quickstart&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;Usage&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1&quot;&gt;创建更新删除索引&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2&quot;&gt;自定义analyzer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;Configure&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;
flask 貌似很少全文搜索的插件,有一个 &lt;a href=&quot;github.com/gyllstromk/Flask-WhooshAlchemy&quot;&gt;github.com/gyllstromk/Flask-WhooshAlchemy&lt;/a&gt;WhooshAlchemy 自己写了一个
&lt;/p&gt;

&lt;h1 id=&quot;heading-1&quot;&gt;Quickstart&lt;/h1&gt;
&lt;p&gt;
  插件基于 whoosh,纯 python 编写,使用上很简单
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; flask_msearch &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Search
[&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;]
search &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Search()
search&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;init_app(app)

&lt;span style=&quot;color:#75715e&quot;&gt;# models.py&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;class&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;Post&lt;/span&gt;(db&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Model):
    __tablename__ &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;post&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;
    __searchable__ &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; [&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;content&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;]

&lt;span style=&quot;color:#75715e&quot;&gt;# views.py&lt;/span&gt;
&lt;span style=&quot;color:#a6e22e&quot;&gt;@app.route&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/search&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;w_search&lt;/span&gt;():
    keyword &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; request&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;args&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;get(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;keyword&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)
    results &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; search&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;whoosh_search(Post,query&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;keyword,fields&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;title&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;],limit&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;20&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;/pre&gt;

&lt;h1 id=&quot;heading-2&quot;&gt;Usage&lt;/h1&gt;
&lt;h2 id=&quot;heading-2.1&quot;&gt;创建更新删除索引&lt;/h2&gt;
&lt;p&gt;
   如果要对已存在的数据创建索引(全部)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;# 创建&lt;/span&gt;
search&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;create_index()
&lt;span style=&quot;color:#75715e&quot;&gt;# 更新&lt;/span&gt;
search&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;create_index(update&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;True)
&lt;span style=&quot;color:#75715e&quot;&gt;# 删除&lt;/span&gt;
search&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;create_index(delete&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;True)&lt;/pre&gt;

&lt;p&gt;
   如果只想要为指定的表创建索引
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;search&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;create_index(Model)&lt;/pre&gt;

&lt;h2 id=&quot;heading-2.2&quot;&gt;自定义analyzer&lt;/h2&gt;

&lt;p&gt;
   比如使用jieba的中文分词
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; jieba.analyse &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; ChineseAnalyzer
search &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Search(analyzer&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;ChineseAnalyzer())&lt;/pre&gt;

&lt;h1 id=&quot;heading-3&quot;&gt;Configure&lt;/h1&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;WHOOSH_BASE &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;whoosh_index&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;
WHOOSH_ENABLE &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; True&lt;/pre&gt;

&lt;p&gt;
  项目地址:&lt;a href=&quot;github.com/honmaple/flask-msearch&quot;&gt;github.com/honmaple/flask-msearch&lt;/a&gt;
&lt;/p&gt;</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>himawari8图片下载改进版</title>
      <link href="" rel="alternate"></link>
      <published>Thu, 23 Mar 2017 00:00:00 +0800</published>
      <updated>Fri, 24 Feb 2023 00:25:02 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2017/03/himawari8图片下载改进版.html" type="text/html"/>
      <id>https://honmaple.me/articles/2017/03/himawari8图片下载改进版.html</id>
      <summary type="html">
&lt;p&gt;
第一版下载图片后设为壁纸,四周都是黑黑的不好看,
所以结合本地壁纸将两张图片进行合成
&lt;/p&gt;

&lt;p&gt;
只要计算一下要缩减的大小与要放置的位置
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;
我的方法是:打开 &lt;b&gt;gimp&lt;/b&gt;,合成两张图片,记下缩减的大小(214,214)与位置(160,160)
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
每次只要运行一下
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;python himawari8.py&lt;/pre&gt;

&lt;p&gt;
源码
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; PIL &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Image, ImageOps, ImageDraw
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; io &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; BytesIO
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; urllib.request &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Request, urlopen
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; datetime &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; datetime, timedelta
&lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; json

SCALE &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;
WIDTH &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1368&lt;/span&gt;
HEIGHT...&lt;/pre&gt;</summary>
      <content type="html">
&lt;p&gt;
第一版下载图片后设为壁纸,四周都是黑黑的不好看,
所以结合本地壁纸将两张图片进行合成
&lt;/p&gt;

&lt;p&gt;
只要计算一下要缩减的大小与要放置的位置
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;
我的方法是:打开 &lt;b&gt;gimp&lt;/b&gt;,合成两张图片,记下缩减的大小(214,214)与位置(160,160)
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
每次只要运行一下
&lt;/p&gt;
&lt;pre class=&quot;src src-example&quot;&gt;python himawari8.py&lt;/pre&gt;

&lt;p&gt;
源码
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; PIL &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Image, ImageOps, ImageDraw
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; io &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; BytesIO
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; urllib.request &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Request, urlopen
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; datetime &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; datetime, timedelta
&lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; json

SCALE &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;
WIDTH &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1368&lt;/span&gt;
HEIGHT &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;768&lt;/span&gt;


&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;get_info&lt;/span&gt;():
    url &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;http://himawari8-dl.nict.go.jp/himawari8/img/D531106/latest.json&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;
    request &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Request(url)
    response &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; urlopen(request, timeout&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;10&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; json&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;loads(response&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;read())


&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;download&lt;/span&gt;():
    png &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;new(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;RGB&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, (&lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; SCALE, &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; SCALE))
    &lt;span style=&quot;color:#75715e&quot;&gt;# desktop = Image.new(&amp;#39;RGB&amp;#39;, (WIDTH, HEIGHT))&lt;/span&gt;
    desktop &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;open(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/home/jianglin/Pictures/308556.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)
    url_format &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;http://himawari8-dl.nict.go.jp/himawari8/img/D531106/{}d/{}/{}_{}_{}.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;
    info &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; get_info()
    &lt;span style=&quot;color:#75715e&quot;&gt;# date = datetime.strptime(info[&amp;#39;date&amp;#39;], &amp;#39;%Y-%m-%d %H:%M:%S&amp;#39;) + timedelta(&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;#     hours=-8)&lt;/span&gt;
    date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; datetime&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;strptime(info[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;date&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;], &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Y-&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;m-&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;H:&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;M:&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;S&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; x &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; range(SCALE):
        &lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; y &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; range(SCALE):
            url &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; url_format&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;format(SCALE, &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt;,
                                    date&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;strftime(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Y/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;m/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;H&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;M&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;S&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;), x, y)
            &lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(url)
            request &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Request(url)
            response &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; urlopen(request, timeout&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;10&lt;/span&gt;)
            img &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;open(BytesIO(response&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;read()))
            png&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;paste(img, (&lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; x, &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; y, &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; (x &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;), &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; (y &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;)))
    png &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; circle(png)
    desktop&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;paste(png, (&lt;span style=&quot;color:#ae81ff&quot;&gt;160&lt;/span&gt;, &lt;span style=&quot;color:#ae81ff&quot;&gt;160&lt;/span&gt;), png)
    desktop&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;save(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/tmp/earth.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;PNG&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
    set_background()


&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;circle&lt;/span&gt;(img):
    width &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; SCALE &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt;
    height &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; SCALE &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt;
    size &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; (width, height)
    mask &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;new(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;L&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, size, &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;)
    draw &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; ImageDraw&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;Draw(mask)
    draw&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;ellipse((&lt;span style=&quot;color:#ae81ff&quot;&gt;3&lt;/span&gt;, &lt;span style=&quot;color:#ae81ff&quot;&gt;3&lt;/span&gt;, width &lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;3&lt;/span&gt;, height &lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;3&lt;/span&gt;), fill&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;255&lt;/span&gt;)
    output &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; ImageOps&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;fit(img, mask&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;size, centering&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;(&lt;span style=&quot;color:#ae81ff&quot;&gt;0.5&lt;/span&gt;, &lt;span style=&quot;color:#ae81ff&quot;&gt;0.5&lt;/span&gt;))
    output&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;putalpha(mask)
    output&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;thumbnail((&lt;span style=&quot;color:#ae81ff&quot;&gt;214&lt;/span&gt;, &lt;span style=&quot;color:#ae81ff&quot;&gt;214&lt;/span&gt;), Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;ANTIALIAS)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; output


&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;convert&lt;/span&gt;():
    &lt;span style=&quot;color:#75715e&quot;&gt;# size = (768, 768)&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# mask = Image.new(&amp;#39;L&amp;#39;, size, 0)&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# draw = ImageDraw.Draw(mask)&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# draw.ellipse((3, 3, 765, 765), fill=255)&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# im = Image.open(&amp;#39;/tmp/earth.png&amp;#39;)&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# output = ImageOps.fit(im, mask.size, centering=(0.5, 0.5))&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# output.putalpha(mask)&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# output.thumbnail((256, 256), Image.ANTIALIAS)&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# output.save(&amp;#39;output.png&amp;#39;)&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# output.convert(&amp;#34;RGBA&amp;#34;)&lt;/span&gt;
    output &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;open(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;output.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)
    output&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;thumbnail((&lt;span style=&quot;color:#ae81ff&quot;&gt;214&lt;/span&gt;, &lt;span style=&quot;color:#ae81ff&quot;&gt;214&lt;/span&gt;), Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;ANTIALIAS)
    desktop &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;open(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/home/jianglin/Pictures/308556.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)
    desktop&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;paste(output, (&lt;span style=&quot;color:#ae81ff&quot;&gt;160&lt;/span&gt;, &lt;span style=&quot;color:#ae81ff&quot;&gt;160&lt;/span&gt;), output)
    desktop&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;save(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/tmp/earch.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;PNG&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)


&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;set_background&lt;/span&gt;():
    &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; os
    os&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;system(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;feh --bg-scale /tmp/earth.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)


&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; __name__ &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;__main__&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;:
    download()&lt;/pre&gt;
&lt;p&gt;

&lt;a href=&quot;https://static.honmaple.com/images/2017/03/149023917874284.png?type=show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://static.honmaple.com/images/2017/03/149023917874284.png?type=thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;

&lt;a href=&quot;https://static.honmaple.com/images/2017/03/149023928036061.png?type=show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://static.honmaple.com/images/2017/03/149023928036061.png?type=thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;

&lt;a href=&quot;https://static.honmaple.com/images/2017/03/149023934880774.png?type=show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://static.honmaple.com/images/2017/03/149023934880774.png?type=thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;</content>
        <category term="Python"></category>
    </entry>
    <entry xml:lang="zh">
      <title>下载Himawari8拍摄的实时地球图片</title>
      <link href="" rel="alternate"></link>
      <published>Wed, 22 Mar 2017 00:00:00 +0800</published>
      <updated>Fri, 24 Feb 2023 00:25:03 +0800</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2017/03/下载Himawari8拍摄的实时地球图片.html" type="text/html"/>
      <id>https://honmaple.me/articles/2017/03/下载Himawari8拍摄的实时地球图片.html</id>
      <summary type="html">
&lt;p&gt;
直接给出源码
&lt;/p&gt;

&lt;p&gt;
设置壁纸
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;feh --bg-scale /tmp/earth.png&lt;/pre&gt;

&lt;p&gt;
设置桌面大小,及图片放大倍数
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;SCALE &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;4&lt;/span&gt;
WIDTH &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1368&lt;/span&gt;
HEIGHT &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;768&lt;/span&gt;&lt;/pre&gt;

&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; PIL &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Image
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; io &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; BytesIO
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; urllib.request &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Request, urlopen
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; datetime &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; datetime
&lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; json

SCALE &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;4&lt;/span&gt;
WIDTH &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1368&lt;/span&gt;
HEIGHT &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;768&lt;/span&gt;


&lt;span style=&quot;color:#66d9ef&quot;&gt;def...&lt;/span&gt;&lt;/pre&gt;</summary>
      <content type="html">
&lt;p&gt;
直接给出源码
&lt;/p&gt;

&lt;p&gt;
设置壁纸
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;feh --bg-scale /tmp/earth.png&lt;/pre&gt;

&lt;p&gt;
设置桌面大小,及图片放大倍数
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;SCALE &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;4&lt;/span&gt;
WIDTH &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1368&lt;/span&gt;
HEIGHT &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;768&lt;/span&gt;&lt;/pre&gt;

&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; PIL &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Image
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; io &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; BytesIO
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; urllib.request &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; Request, urlopen
&lt;span style=&quot;color:#f92672&quot;&gt;from&lt;/span&gt; datetime &lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; datetime
&lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; json

SCALE &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;4&lt;/span&gt;
WIDTH &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1368&lt;/span&gt;
HEIGHT &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;768&lt;/span&gt;


&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;get_info&lt;/span&gt;():
    url &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;http://himawari8-dl.nict.go.jp/himawari8/img/D531106/latest.json&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;
    request &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Request(url)
    response &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; urlopen(request, timeout&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;10&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; json&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;loads(response&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;read())


&lt;span style=&quot;color:#66d9ef&quot;&gt;def&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;download&lt;/span&gt;():
    png &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;new(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;RGB&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, (&lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; SCALE, &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; SCALE))
    desktop &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;new(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;RGB&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, (WIDTH, HEIGHT))
    url_format &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;http://himawari8-dl.nict.go.jp/himawari8/img/D531106/{}d/{}/{}_{}_{}.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;
    info &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; get_info()
    date &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; datetime&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;strptime(info[&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;date&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;], &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Y-&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;m-&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;H:&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;M:&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;S&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; x &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; range(SCALE):
        &lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; y &lt;span style=&quot;color:#f92672&quot;&gt;in&lt;/span&gt; range(SCALE):
            url &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; url_format&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;format(SCALE, &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt;,
                                    date&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;strftime(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Y/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;m/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%d&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;H&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;M&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;%&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;S&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;), x, y)
            &lt;span style=&quot;color:#66d9ef&quot;&gt;print&lt;/span&gt;(url)
            request &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Request(url)
            response &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; urlopen(request, timeout&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;10&lt;/span&gt;)
            img &lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt; Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;open(BytesIO(response&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;read()))
            png&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;paste(img, (&lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; x, &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; y, &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; (x &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;), &lt;span style=&quot;color:#ae81ff&quot;&gt;550&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt; (y &lt;span style=&quot;color:#f92672&quot;&gt;+&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;)))
    png&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;thumbnail((HEIGHT, HEIGHT), Image&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;ANTIALIAS)
    desktop&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;paste(png, ((WIDTH &lt;span style=&quot;color:#f92672&quot;&gt;-&lt;/span&gt; HEIGHT) &lt;span style=&quot;color:#f92672&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;/&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;, &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;))
    desktop&lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt;save(&lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/tmp/earth.png&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;PNG&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)

&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; __name__ &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;__main__&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;&lt;/span&gt;:
    download()&lt;/pre&gt;

&lt;p&gt;
或许应该找一张有星星的照片

&lt;a href=&quot;https://static.honmaple.com/images/2017/03/149019162934663.png?type=show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://static.honmaple.com/images/2017/03/149019162934663.png?type=thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;

&lt;a href=&quot;https://static.honmaple.com/images/2017/03/149019186230320.png?type=show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://static.honmaple.com/images/2017/03/149019186230320.png?type=thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;</content>
        <category term="Python"></category>
    </entry>
</feed>