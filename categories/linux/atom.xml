<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh">
  <title>紅楓吟 - Linux</title>
    <subtitle>风落花语风落天，花落风雨花落田.</subtitle>
  <link href="https://honmaple.me/categories/linux/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="https://honmaple.me"/>
  <generator uri="https://github.com/honmaple/snow">Snow</generator>
    <updated>Wed, 15 Nov 2023 15:21:38 +0000</updated>
  <id>https://honmaple.me</id>
    <entry xml:lang="zh">
      <title>重复造轮子之Emacs翻译插件maple-translate</title>
      <link href="" rel="alternate"></link>
      <published>Fri, 03 Nov 2023 22:19:03 +0000</published>
      <updated>Wed, 15 Nov 2023 15:21:38 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2023/11/zhong-fu-zao-lun-zi-zhi-emacsfan-yi-cha-jian-maple-translate.html" type="text/html"/>
      <id>https://honmaple.me/articles/2023/11/zhong-fu-zao-lun-zi-zhi-emacsfan-yi-cha-jian-maple-translate.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
我之前一直都在使用 &lt;a href=&quot;https://github.com/xuchunyang/youdao-dictionary.el&quot;&gt;youdao-dictionary&lt;/a&gt; 这个插件，虽然没有配置过秘钥，这时会有使用次数的限制(反正是每天1000次还是多少来着，有些忘了)，但是我平时使用次数不多，所以也不会达到使用限制，不管是单词翻译还是长句翻译都很不错。但最近几个月 &lt;b&gt;youdao-dictionary&lt;/b&gt; 如果不配置私钥，处于一个完全不可用的状态。
&lt;/p&gt;

&lt;p&gt;
我曾寻找过它的替代品，并且使用过一段时间的 &lt;a href=&quot;https://github.com/condy0919/fanyi.el&quot;&gt;fanyi.el&lt;/a&gt;，不可否认，这同样是一个非常不错的插件，不管是UI还是功能，但是，可能是因为 &lt;b&gt;fanyi.el&lt;/b&gt; 使用异步请求的原因，偶尔会出现一些意想不到的报错，更重要的是它不支持长句翻译和离线翻译。
&lt;/p&gt;

&lt;p&gt;
考虑再三，还是决定自己造一个轮子，主要功能就按照我之前使用 &lt;b&gt;youdao-dictionary&lt;/b&gt; 的习惯...&lt;/p&gt;&lt;/blockquote&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;如何使用?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;长句翻译&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;谷歌翻译&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4&quot;&gt;离线翻译&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5&quot;&gt;多引擎翻译&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-6&quot;&gt;翻译原理&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;
我之前一直都在使用 &lt;a href=&quot;https://github.com/xuchunyang/youdao-dictionary.el&quot;&gt;youdao-dictionary&lt;/a&gt; 这个插件，虽然没有配置过秘钥，这时会有使用次数的限制(反正是每天1000次还是多少来着，有些忘了)，但是我平时使用次数不多，所以也不会达到使用限制，不管是单词翻译还是长句翻译都很不错。但最近几个月 &lt;b&gt;youdao-dictionary&lt;/b&gt; 如果不配置私钥，处于一个完全不可用的状态。
&lt;/p&gt;

&lt;p&gt;
我曾寻找过它的替代品，并且使用过一段时间的 &lt;a href=&quot;https://github.com/condy0919/fanyi.el&quot;&gt;fanyi.el&lt;/a&gt;，不可否认，这同样是一个非常不错的插件，不管是UI还是功能，但是，可能是因为 &lt;b&gt;fanyi.el&lt;/b&gt; 使用异步请求的原因，偶尔会出现一些意想不到的报错，更重要的是它不支持长句翻译和离线翻译。
&lt;/p&gt;

&lt;p&gt;
考虑再三，还是决定自己造一个轮子，主要功能就按照我之前使用 &lt;b&gt;youdao-dictionary&lt;/b&gt; 的习惯:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 翻译光标下的单词，以及选中的单词或句子
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 翻译的内容输出到 &lt;code&gt;echoarea&lt;/code&gt; 或者新的 &lt;code&gt;buffer&lt;/code&gt;，方便复制
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 增加一个离线翻译的功能，并且可以不依赖外部工具
&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;
基于上述，所以有了这个新的轮子 &lt;a href=&quot;https://github.com/honmaple/emacs-maple-translate&quot;&gt;maple-translate&lt;/a&gt;
&lt;/p&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;如何使用?&lt;/h2&gt;
&lt;p&gt;
   可以使用 &lt;b&gt;quelpa&lt;/b&gt; 安装
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(use-package maple-translate
  :quelpa (:fetcher github :repo &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;honmaple/emacs-maple-translate&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
  :commands (maple-translate maple-translate+))&lt;/pre&gt;

&lt;p&gt;
   或者手动下载仓库
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;git clone https://github.com/honmaple/emacs-maple-translate ~/.emacs.d/site-lisp/maple-translate&lt;/pre&gt;

&lt;p&gt;
   然后进行配置
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(use-package maple-translate
  :ensure &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
  :commands (maple-translate maple-translate+))&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;长句翻译&lt;/h2&gt;
&lt;p&gt;
   &lt;del&gt;目前长句翻译仅支持 &lt;code&gt;youdao&lt;/code&gt;&lt;/del&gt;, 目前支持 &lt;code&gt;youdao&lt;/code&gt; 和 &lt;code&gt;google&lt;/code&gt; 两种翻译引擎，可以修改设置
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(setq maple-translate-engine &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;youdao&lt;/span&gt;)
&lt;span style=&quot;color:#75715e&quot;&gt;;; 或者&lt;/span&gt;
(setq maple-translate-engine &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;google&lt;/span&gt;)&lt;/pre&gt;

&lt;h2 id=&quot;heading-3&quot;&gt;谷歌翻译&lt;/h2&gt;
&lt;p&gt;
   国内无法直接使用，但是可以单独为谷歌翻译设置代理
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(setq maple-translate-google-url &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;https://translate.googleapis.com/translate_a/single&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
(setq maple-translate-google-proxies
      &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#39;&lt;/span&gt;((&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;http&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;127.0.0.1:1086&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
        (&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;https&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;127.0.0.1:1086&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)))&lt;/pre&gt;

&lt;h2 id=&quot;heading-4&quot;&gt;离线翻译&lt;/h2&gt;
&lt;p&gt;
   我个人平时在使用 &lt;b&gt;Emacs&lt;/b&gt; 时不太习惯依赖外部的工具，比如我之前就写过一个markdown，org-mode实时预览插件 &lt;a href=&quot;https://github.com/honmaple/emacs-maple-preview&quot;&gt;maple-preview&lt;/a&gt;，它区别于其它插件，并不会依赖外部的工具，比如 &lt;b&gt;Pandoc&lt;/b&gt;，甚至不会生出任何文件到我的本地环境
&lt;/p&gt;

&lt;p&gt;
   同样的，我也不希望使用离线翻译时还要依赖外部诸如 &lt;b&gt;sdcv，goldendict&lt;/b&gt; 等工具，我想要直接使用 &lt;code&gt;Elisp&lt;/code&gt; 来对词典进行解析。所幸前人栽树，后人乘凉，已经有了一个纯 &lt;code&gt;Elisp&lt;/code&gt; 实现的解析器 &lt;a href=&quot;https://www.emacswiki.org/emacs/stardict.el&quot;&gt;https://www.emacswiki.org/emacs/stardict.el&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
   我所需要做的，就是下载需要的词典到本地(这个步骤是必须的，即使我不喜欢)，然后设置
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;;; 离线词典所在的目录&lt;/span&gt;
(setq maple-translate-sdcv-dir &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;~/.stardict/dicts&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
&lt;span style=&quot;color:#75715e&quot;&gt;;; 所使用的词典 -&amp;gt; (词典名词 . 词典具体目录)&lt;/span&gt;
(setq maple-translate-sdcv-dicts
      &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#39;&lt;/span&gt;((&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;lazyworm-ec&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;stardict-lazyworm-ec-2.4.2&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
        (&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;lazyworm-ce&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;stardict-lazyworm-ce-2.4.2&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)))&lt;/pre&gt;

&lt;p&gt;
   最后修改翻译引擎
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(setq maple-translate-engine &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;sdcv&lt;/span&gt;)&lt;/pre&gt;
&lt;p&gt;
   注意：&lt;b&gt;第一次使用离线翻译需要等待词典初始化，这会需要耗费一段时间，后面就快了&lt;/b&gt;
&lt;/p&gt;

&lt;h2 id=&quot;heading-5&quot;&gt;多引擎翻译&lt;/h2&gt;
&lt;p&gt;
   &lt;b&gt;maple-translate&lt;/b&gt; 同样支持&lt;b&gt;多引擎&lt;/b&gt;，需要修改设置为一个列表
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(setq maple-translate-engine &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#39;&lt;/span&gt;(youdao dictcn sdcv))&lt;/pre&gt;

&lt;h2 id=&quot;heading-6&quot;&gt;翻译原理&lt;/h2&gt;
&lt;p&gt;
   目前支持的几个引擎: &lt;code&gt;youdao(有道)&lt;/code&gt;、&lt;code&gt;dictcn(海词)&lt;/code&gt;、&lt;code&gt;iciba(金山词霸)&lt;/code&gt;、&lt;code&gt;bing(必应)&lt;/code&gt;、&lt;code&gt;google(谷歌)&lt;/code&gt;、&lt;code&gt;sdcv(离线)&lt;/code&gt;。除 &lt;code&gt;sdcv&lt;/code&gt; 外，其它几个都依赖于网络，&lt;b&gt;maple-translate&lt;/b&gt; 可以看作是一个爬虫，通过爬取翻译页面，然后使用Emacs内置的 &lt;code&gt;dom&lt;/code&gt; 对HTML进行解析，最后获取到想要的内容(谷歌使用API获取)。基于此，我还写了一个超简单的 &lt;code&gt;类xpath&lt;/code&gt; 解析器
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(defun maple-translate-dom-by-key(dom key)
  (let (func num)
    (when (&lt;span style=&quot;color:#a6e22e&quot;&gt;string-match&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\\&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\\&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;([0-9]+&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\\&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\\&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; key)
      (setq num (match-string &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt; key))
      (setq key (&lt;span style=&quot;color:#a6e22e&quot;&gt;substring&lt;/span&gt; key &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;-&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;length&lt;/span&gt; key) (&lt;span style=&quot;color:#a6e22e&quot;&gt;length&lt;/span&gt; num) &lt;span style=&quot;color:#ae81ff&quot;&gt;2&lt;/span&gt;))))
    (cond ((string-prefix-p &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; key)
           (setq key (&lt;span style=&quot;color:#a6e22e&quot;&gt;substring&lt;/span&gt; key &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;) func &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;dom-by-class&lt;/span&gt;))
          ((string-prefix-p &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; key)
           (setq key (&lt;span style=&quot;color:#a6e22e&quot;&gt;substring&lt;/span&gt; key &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;) func &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;dom-by-id&lt;/span&gt;))
          ((string-prefix-p &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; key)
           (setq func (lambda(p _) (dom-children p))))
          (&lt;span style=&quot;color:#66d9ef&quot;&gt;t&lt;/span&gt; (setq key (&lt;span style=&quot;color:#a6e22e&quot;&gt;intern&lt;/span&gt; key) func &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;dom-by-tag&lt;/span&gt;)))
    (if (&lt;span style=&quot;color:#a6e22e&quot;&gt;null&lt;/span&gt; num)
        (&lt;span style=&quot;color:#a6e22e&quot;&gt;funcall&lt;/span&gt; func dom key)
      (&lt;span style=&quot;color:#a6e22e&quot;&gt;nth&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;string-to-number&lt;/span&gt; num) (&lt;span style=&quot;color:#a6e22e&quot;&gt;funcall&lt;/span&gt; func dom key)))))

(defun maple-translate-dom-find(dom xpath)
  (cl-loop for key in (string-split (string-trim xpath) &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;/&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
           if (&lt;span style=&quot;color:#a6e22e&quot;&gt;consp&lt;/span&gt; dom)
           do (setq dom (maple-translate-dom-by-key dom key))
           else return dom)
  dom)&lt;/pre&gt;

&lt;p&gt;
   这样，我就能通过一些简单的语法来定位想要的内容，比如在有道里面使用
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(maple-translate-dom-find dom &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;.simple dict-module/.trans-container/.word-exp&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)&lt;/pre&gt;
&lt;p&gt;
   获取到 &lt;b&gt;class&lt;/b&gt; 名称为 &lt;code&gt;simple dict-module&lt;/code&gt; 下的 &lt;b&gt;class&lt;/b&gt; 名称为 &lt;code&gt;trans-container&lt;/code&gt; 下的 &lt;b&gt;class&lt;/b&gt; 名称为 &lt;code&gt;word-exp&lt;/code&gt; 的所有元素, 也就是&lt;b&gt;基本释义&lt;/b&gt;
&lt;/p&gt;</content>
        <category term="Linux/Emacs"></category>
    </entry>
    <entry xml:lang="zh">
      <title>使用acme.sh申请SSL证书</title>
      <link href="" rel="alternate"></link>
      <published>Sun, 24 Sep 2023 13:57:51 +0000</published>
      <updated>Sun, 24 Sep 2023 19:06:00 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2023/09/shi-yong-acme-shshen-qing-sslzheng-shu.html" type="text/html"/>
      <id>https://honmaple.me/articles/2023/09/shi-yong-acme-shshen-qing-sslzheng-shu.html</id>
      <summary type="html">
&lt;h2 id=&quot;heading-1&quot;&gt;部署教程&lt;/h2&gt;
&lt;h3 id=&quot;heading-1.1&quot;&gt;安装并配置acme.sh&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 安装&lt;br/&gt;
       这里使用 &lt;b&gt;Docker&lt;/b&gt; 安装，方便环境隔离。&lt;code&gt;/opt/acme.sh&lt;/code&gt; 为挂载目录
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker run -d --name acme.sh \
-e AUTO_UPGRADE=0 \
-e TZ=Asia/Shanghai \
-v /opt/acme.sh:/acme.sh \
neilpang/acme.sh daemon&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 配置&lt;br/&gt;
       &lt;b&gt;acme...&lt;/b&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;部署教程&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.1&quot;&gt;安装并配置acme.sh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.2&quot;&gt;固定域名(webroot)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.2.1&quot;&gt;申请证书&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.2.2&quot;&gt;配置SSL证书&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.2.3&quot;&gt;配置NGINX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.2.4&quot;&gt;重启NGINX&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.3&quot;&gt;泛域名(DNS)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.3.1&quot;&gt;令牌获取&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.3.2&quot;&gt;账户ID获取&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.3.3&quot;&gt;编辑配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.3.4&quot;&gt;申请证书&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.3.5&quot;&gt;安装证书&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.4&quot;&gt;搭配NginxProxyManager&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.5&quot;&gt;更新证书(手动)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;参考资料&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;部署教程&lt;/h2&gt;
&lt;h3 id=&quot;heading-1.1&quot;&gt;安装并配置acme.sh&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 安装&lt;br/&gt;
       这里使用 &lt;b&gt;Docker&lt;/b&gt; 安装，方便环境隔离。&lt;code&gt;/opt/acme.sh&lt;/code&gt; 为挂载目录
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker run -d --name acme.sh \
-e AUTO_UPGRADE=0 \
-e TZ=Asia/Shanghai \
-v /opt/acme.sh:/acme.sh \
neilpang/acme.sh daemon&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 配置&lt;br/&gt;
       &lt;b&gt;acme.sh&lt;/b&gt; 默认使用的是 &lt;b&gt;ZeroSSL&lt;/b&gt;，我这里修改为 &lt;b&gt;Let&amp;#39;s Encrypt&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker exec acme.sh --set-default-ca --server letsencrypt
docker exec acme.sh --set-default-chain --preferred-chain &amp;#34;ISRG&amp;#34; --server letsencrypt&lt;/pre&gt;
&lt;p&gt;
       注：&lt;code&gt;--preferred-chain &amp;#34;ISRG&amp;#34;&lt;/code&gt; 表示设置根证书为 &lt;b&gt;ISRG Root X1&lt;/b&gt;, 它与 &lt;b&gt;DST Root CA X3&lt;/b&gt; 的区别主要是
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;ISRG Root X1&lt;/b&gt; 会更新一些，&lt;b&gt;DST Root CA X3&lt;/b&gt; 已于2021年9月30日到期
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 一些旧的设备（例如，iPhone 4 或 HTC Dream）不会信任 &lt;b&gt;ISRG Root X1&lt;/b&gt;，因为它们没有获得软件更新
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 虽说 &lt;b&gt;DST Root CA X3&lt;/b&gt; 已到期，但Android设备仍能够继续正常访问使用 Let’s Encrypt 证书加密的网站，其它旧设备将会得到证书过期警告
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 注册账号(&lt;b&gt;记得修改为自己的邮箱&lt;/b&gt;)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker exec acme.sh --register-account --server letsencrypt -m i@example.com
[Sun Sep 24 15:49:59 CST 2023] Create account key ok.
[Sun Sep 24 15:49:59 CST 2023] Registering account: https://acme-v02.api.letsencrypt.org/directory
[Sun Sep 24 15:50:05 CST 2023] Registered
[Sun Sep 24 15:50:05 CST 2023] ACCOUNT_THUMBPRINT=&amp;#39;xxx&amp;#39;&lt;/pre&gt;
&lt;p&gt;
       这时会在 &lt;code&gt;/acme.sh&lt;/code&gt; 目录下生成一个 &lt;code&gt;http.header&lt;/code&gt; 文件，申请证书时会使用该文件
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;heading-1.2&quot;&gt;固定域名(webroot)&lt;/h3&gt;
&lt;p&gt;
    如果只有少数几个固定的域名，这时可以使用 &lt;b&gt;webroot&lt;/b&gt; 方式申请SSL证书。&lt;b&gt;webroot&lt;/b&gt; 方式会在本地生成一个验证文件，申请证书时通过验证该文件验证域名所有权
&lt;/p&gt;

&lt;h4 id=&quot;heading-1.2.1&quot;&gt;申请证书&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker exec acme.sh --issue -d example.com -d www.example.com,nas.example.com -w /acme.sh/example.com&lt;/pre&gt;
&lt;p&gt;
     执行后会在挂载目录 &lt;code&gt;/opt/acme.sh&lt;/code&gt; 下生成SSL证书相关的 &lt;b&gt;cert&lt;/b&gt; 文件和 &lt;b&gt;key&lt;/b&gt; 文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ ls example.com
ca.cer  fullchain.cer  example.com.cer  example.com.conf  example.com.csr  example.com.csr.conf  example.com.key&lt;/pre&gt;
&lt;h4 id=&quot;heading-1.2.2&quot;&gt;配置SSL证书&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;ssl_certificate&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;/opt/acme.sh/example.com/fullchain.cer&lt;/span&gt;;
&lt;span style=&quot;color:#66d9ef&quot;&gt;ssl_certificate_key&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;/opt/acme.sh/example.com/example.com.key&lt;/span&gt;;
&lt;span style=&quot;color:#66d9ef&quot;&gt;ssl_dhparam&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;/opt/acme.sh/example.com/dhparam.pem&lt;/span&gt;;

&lt;span style=&quot;color:#66d9ef&quot;&gt;ssl_session_cache&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;shared:SSL:1m&lt;/span&gt;;
&lt;span style=&quot;color:#66d9ef&quot;&gt;ssl_session_timeout&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;5m&lt;/span&gt;;

&lt;span style=&quot;color:#66d9ef&quot;&gt;ssl_protocols&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;TLSv1&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;TLSv1.1&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;TLSv1.2&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;TLSv1.3&lt;/span&gt;;
&lt;span style=&quot;color:#66d9ef&quot;&gt;ssl_ciphers&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5&lt;/span&gt;;
&lt;span style=&quot;color:#66d9ef&quot;&gt;ssl_prefer_server_ciphers&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;on&lt;/span&gt;;&lt;/pre&gt;

&lt;p&gt;
     如何生成 &lt;b&gt;dhparam&lt;/b&gt; 的证书?
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;openssl dhparam -out /opt/acme.sh/example.com/dhparam.pem 2048&lt;/pre&gt;
&lt;h4 id=&quot;heading-1.2.3&quot;&gt;配置NGINX&lt;/h4&gt;
&lt;p&gt;
     &lt;b&gt;Let&amp;#39;s Encrypt&lt;/b&gt; 只会在 &lt;b&gt;80&lt;/b&gt; 端口验证域名所有权，所以只需要在 &lt;b&gt;80&lt;/b&gt; 端口添加一个 &lt;b&gt;location&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;server&lt;/span&gt; {
    &lt;span style=&quot;color:#f92672&quot;&gt;listen&lt;/span&gt;       &lt;span style=&quot;color:#ae81ff&quot;&gt;80&lt;/span&gt;;
    &lt;span style=&quot;color:#f92672&quot;&gt;listen&lt;/span&gt;  &lt;span style=&quot;color:#e6db74&quot;&gt;[::]:80&lt;/span&gt;;
    &lt;span style=&quot;color:#f92672&quot;&gt;server_name&lt;/span&gt;  &lt;span style=&quot;color:#e6db74&quot;&gt;www.example.com&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;nas.example.com&lt;/span&gt;;

    &lt;span style=&quot;color:#f92672&quot;&gt;location&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;/&lt;/span&gt; {
        &lt;span style=&quot;color:#f92672&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;301&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;https://example.com&lt;/span&gt;$request_uri;
    }
    &lt;span style=&quot;color:#f92672&quot;&gt;location&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;^~&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;/.well-known/acme-challenge&lt;/span&gt; {
        &lt;span style=&quot;color:#f92672&quot;&gt;alias&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;/opt/acme.sh/example.com/.well-known/acme-challenge&lt;/span&gt;;
    }
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;server&lt;/span&gt; {
    &lt;span style=&quot;color:#f92672&quot;&gt;listen&lt;/span&gt;       &lt;span style=&quot;color:#ae81ff&quot;&gt;443&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;ssl&lt;/span&gt;;
    &lt;span style=&quot;color:#f92672&quot;&gt;listen&lt;/span&gt;       &lt;span style=&quot;color:#e6db74&quot;&gt;[::]:443&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;ssl&lt;/span&gt;;
    &lt;span style=&quot;color:#f92672&quot;&gt;server_name&lt;/span&gt;  &lt;span style=&quot;color:#e6db74&quot;&gt;nas.example.com&lt;/span&gt;;
    &lt;span style=&quot;color:#f92672&quot;&gt;include&lt;/span&gt;      &lt;span style=&quot;color:#e6db74&quot;&gt;/etc/nginx/conf.d/ssl/example.com.conf&lt;/span&gt;;

    &lt;span style=&quot;color:#f92672&quot;&gt;......&lt;/span&gt;
&lt;span style=&quot;color:#960050;background-color:#1e0010&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;
&lt;h4 id=&quot;heading-1.2.4&quot;&gt;重启NGINX&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;nginx -t
nginx -s reload&lt;/pre&gt;
&lt;h3 id=&quot;heading-1.3&quot;&gt;泛域名(DNS)&lt;/h3&gt;
&lt;p&gt;
    &lt;b&gt;webroot&lt;/b&gt; 无法申请泛域名证书，泛域名证书的申请需要利用&lt;b&gt;DNS服务提供商&lt;/b&gt;的API，动态添加一个TEXT记录，这里以 &lt;b&gt;Cloudflare&lt;/b&gt; 为例
&lt;/p&gt;
&lt;h4 id=&quot;heading-1.3.1&quot;&gt;令牌获取&lt;/h4&gt;
&lt;p&gt;
     右上角点击&lt;b&gt;我的个人资料&lt;/b&gt;, 然后点击&lt;b&gt;创建令牌&lt;/b&gt;
     
&lt;a href=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-01.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-01.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
     然后选择&lt;b&gt;DNS模版&lt;/b&gt;
     
&lt;a href=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-02.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-02.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;令牌名称&lt;/b&gt;可以随意
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;权限&lt;/b&gt;设置为 &lt;code&gt;区域 -&amp;gt; DNS -&amp;gt; 编辑&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;区域资源&lt;/b&gt;设置为 &lt;code&gt;包括 -&amp;gt; 特定区域 -&amp;gt; 域名(example.com)&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
     
&lt;a href=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-03.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-03.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
     继续以显示摘要, 然后创建令牌
     
&lt;a href=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-04.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-04.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
     最后记得保存令牌到本地
     
&lt;a href=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-05.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-05.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;h4 id=&quot;heading-1.3.2&quot;&gt;账户ID获取&lt;/h4&gt;
&lt;p&gt;
     选择对应的域名，在&lt;b&gt;概况&lt;/b&gt;的右下角会有账户ID显示
     
&lt;a href=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-06.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/cloudflare-token-06.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;h4 id=&quot;heading-1.3.3&quot;&gt;编辑配置&lt;/h4&gt;
&lt;p&gt;
     编辑 &lt;code&gt;/opt/acme.sh&lt;/code&gt; 目录下的 &lt;code&gt;account.conf&lt;/code&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+ CF_Token=&amp;#39;xxx&amp;#39;
&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+ CF_Account_ID=&amp;#39;xxx&amp;#39;
&lt;/span&gt;&lt;/pre&gt;

&lt;h4 id=&quot;heading-1.3.4&quot;&gt;申请证书&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker exec acme.sh --issue --dns dns_cf -d &amp;#34;nas.example.com&amp;#34; -d &amp;#34;*.nas.example.com&amp;#34;&lt;/pre&gt;

&lt;h4 id=&quot;heading-1.3.5&quot;&gt;安装证书&lt;/h4&gt;
&lt;p&gt;
     如果想要修改默认安装的目录，则可以使用 &lt;code&gt;--install-cert&lt;/code&gt; 命令
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker exec acme.sh --install-cert -d nas.example.com \
--key-file /nginx/data/custom_ssl/npm-1/privkey.pem \
--fullchain-file /nginx/data/custom_ssl/npm-1/fullchain.pem&lt;/pre&gt;

&lt;p&gt;
     如果想要更新证书后同步重启NGINX，可以继续添加命令参数
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;--reloadcmd &amp;#34;nginx -s reload&amp;#34;&lt;/pre&gt;

&lt;h3 id=&quot;heading-1.4&quot;&gt;搭配NginxProxyManager&lt;/h3&gt;
&lt;p&gt;
    首先打开 &lt;b&gt;NginxProxyManager&lt;/b&gt;, 选择 &lt;b&gt;SSL Cetificates&lt;/b&gt;
    
&lt;a href=&quot;https://s.libforest.com/images/2023/09/acme.sh-nginx-01.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/acme.sh-nginx-01.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
    然后选择 &lt;b&gt;Add SSL Cetificates -&amp;gt; Custom&lt;/b&gt;
    
&lt;a href=&quot;https://s.libforest.com/images/2023/09/acme.sh-nginx-02.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/acme.sh-nginx-02.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
    最后添加相关文件:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;Certificate&lt;/b&gt;: &lt;code&gt;nas.example.com.cer&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;Certificate Key&lt;/b&gt;: &lt;code&gt;nas.example.com.key&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;Intermediate Certificate&lt;/b&gt;: &lt;code&gt;ca.cer&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
    
&lt;a href=&quot;https://s.libforest.com/images/2023/09/acme.sh-nginx-03.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/acme.sh-nginx-03.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
    为了避免证书过期后重新添加，需要把&lt;b&gt;NginxProxyManager&lt;/b&gt;挂载目录也挂载到 &lt;b&gt;acme.sh&lt;/b&gt; 容器
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker stop acme.sh
docker rm acme.sh
docker run -d --name acme.sh \
-e AUTO_UPGRADE=0 \
-e TZ=Asia/Shanghai \
-v /opt/acme.sh:/acme.sh \
-v /opt/nginx:/nginx \
neilpang/acme.sh daemon&lt;/pre&gt;

&lt;p&gt;
    然后修改申请证书的命令
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker exec acme.sh --issue --dns dns_cf -d &amp;#34;nas.example.com&amp;#34; -d &amp;#34;*.nas.example.com&amp;#34; \
--renew-hook &amp;#34;acme.sh --install-cert -d nas.example.com \
--key-file /nginx/data/custom_ssl/npm-1/privkey.pem \
--fullchain-file /nginx/data/custom_ssl/npm-1/fullchain.pem&amp;#34;&lt;/pre&gt;

&lt;p&gt;
    如果提示 &lt;code&gt;Domains not changed&lt;/code&gt;, 则需要使用 &lt;code&gt;--force&lt;/code&gt; 重新申请
&lt;/p&gt;

&lt;h3 id=&quot;heading-1.5&quot;&gt;更新证书(手动)&lt;/h3&gt;
&lt;p&gt;
    从 &lt;b&gt;Let&amp;#39;s Encrypt&lt;/b&gt; 申请到的证书有效期是90天，&lt;b&gt;acme.sh&lt;/b&gt; 每60天会对证书进行更新，你也可以手动强制更新：
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;# 查询证书申请信息
acme.sh --list

# 手动强制更新证书
acme.sh --renew -d nas.example.com -d *.nas.example.com --force&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;参考资料&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://github.com/acmesh-official/acme.sh/wiki/Preferred-Chain&quot;&gt;https://github.com/acmesh-official/acme.sh/wiki/Preferred-Chain&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://letsencrypt.org/zh-cn/docs/dst-root-ca-x3-expiration-september-2021/&quot;&gt;https://letsencrypt.org/zh-cn/docs/dst-root-ca-x3-expiration-september-2021/&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://shiping.date/82.html&quot;&gt;https://shiping.date/82.html&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
        <category term="Linux"></category>
    </entry>
    <entry xml:lang="zh">
      <title>Zerotier笔记</title>
      <link href="" rel="alternate"></link>
      <published>Sun, 17 Sep 2023 15:41:40 +0000</published>
      <updated>Sun, 24 Sep 2023 16:52:48 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2023/09/zerotier-note.html" type="text/html"/>
      <id>https://honmaple.me/articles/2023/09/zerotier-note.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
&lt;b&gt;zerotier&lt;/b&gt; 可谓是慕名许久，但之前一直没有太多内网穿透和异地组网的需求，此次准备在外网访问家里NAS部署的部分应用，所以也调研了一些相关的应用，最终选择了 &lt;b&gt;zerotier&lt;/b&gt; 来对我现有的机器进行组网
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;FRP&lt;/b&gt;: 需要将服务器的端口映射出去，不太喜欢这种暴力的方式。我目前的服务基本上只会在 &lt;code&gt;0.0.0.0&lt;/code&gt; 监听80、443等常用端口，其它服务一律监听 &lt;code&gt;127.0.0.1&lt;/code&gt;，通过nginx访问内部的服务
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;DDNS&lt;/b&gt;: 家里的NAS直接暴露在公网，这非常不安全，而且家用宽带无法使用80，443端口，只能使用高位端口
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;ZEROTIER&lt;/b&gt;: 使用 &lt;b&gt;P2P&lt;/b&gt; 的方式对多台服务器进行组网，映射的端口只允许加入组网的设备访问，这在速度和安全性上确实是我所需要的...&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;相关概念&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;部署教程&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1&quot;&gt;UI界面&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2&quot;&gt;Zerotier客户端&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.3&quot;&gt;私有Planet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.4&quot;&gt;私有Planet服务器加入组网&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.5&quot;&gt;UI和Zerotier分开部署&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;组网教程&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3.1&quot;&gt;创建网络&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3.2&quot;&gt;加入网络&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3.3&quot;&gt;跨网段访问&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3.4&quot;&gt;安全限制&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4&quot;&gt;FAQ&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.1&quot;&gt;如何修改默认的9993端口?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5&quot;&gt;参考资料&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;
&lt;b&gt;zerotier&lt;/b&gt; 可谓是慕名许久，但之前一直没有太多内网穿透和异地组网的需求，此次准备在外网访问家里NAS部署的部分应用，所以也调研了一些相关的应用，最终选择了 &lt;b&gt;zerotier&lt;/b&gt; 来对我现有的机器进行组网
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;FRP&lt;/b&gt;: 需要将服务器的端口映射出去，不太喜欢这种暴力的方式。我目前的服务基本上只会在 &lt;code&gt;0.0.0.0&lt;/code&gt; 监听80、443等常用端口，其它服务一律监听 &lt;code&gt;127.0.0.1&lt;/code&gt;，通过nginx访问内部的服务
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;DDNS&lt;/b&gt;: 家里的NAS直接暴露在公网，这非常不安全，而且家用宽带无法使用80，443端口，只能使用高位端口
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;ZEROTIER&lt;/b&gt;: 使用 &lt;b&gt;P2P&lt;/b&gt; 的方式对多台服务器进行组网，映射的端口只允许加入组网的设备访问，这在速度和安全性上确实是我所需要的
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;相关概念&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;Planet&lt;/b&gt;: 行星服务器，也称根服务器。主要用于管理 &lt;b&gt;zerotier&lt;/b&gt; 客户端的地址信息
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;Moon&lt;/b&gt;: 月亮服务器，也称中继服务器、跳转服务器。主要用于当两台设备无法直连时，可以通过Moon中转连接
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;Leaf&lt;/b&gt;: 组网使用的设备，可以是一台服务器，一台NAS，甚至一台手机
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-2&quot;&gt;部署教程&lt;/h2&gt;
&lt;p&gt;
   现在我有三台设备需要进行组网，一台A在国外， 一台B在国内(腾讯云)，还有一台C在家里(NAS)。我准备将私有Planet部署到机器A，同时机器A也会加入到内网里，A、B、C三台设备可以通过内网相互访问
&lt;/p&gt;

&lt;h3 id=&quot;heading-2.1&quot;&gt;UI界面&lt;/h3&gt;
&lt;p&gt;
    以 &lt;code&gt;jonnyan404/zerotier-planet&lt;/code&gt; 为例
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 创建目录
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;mkdir /opt/zerotier /opt/ztncui&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 部署服务
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker run -d --name ztncui --restart always \
-p 4000:4000 -p 9993:9993/tcp -p 9993:9993/udp \
-e MYADDR={服务器公网IP} \
-e HTTP_PORT=4000 \
-e HTTP_ALL_INTERFACES=yes \
-e ZTNCUI_PASSWD=mrdoc.fun \
-v /opt/zerotier:/var/lib/zerotier-one \
-v /opt/ztncui:/opt/key-networks/ztncui/etc \
keynetworks/ztncui&lt;/pre&gt;
&lt;p&gt;
       然后就可以通过 &lt;code&gt;服务器公网IP:4000&lt;/code&gt; 访问UI管理界面，默认的用户名和密码: &lt;code&gt;admin,mrdoc.fun&lt;/code&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;heading-2.2&quot;&gt;Zerotier客户端&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;Linux&lt;/b&gt;: 部署方式很简单，注意区分 &lt;b&gt;host网络&lt;/b&gt; 和 &lt;b&gt;bridge网络&lt;/b&gt;，这两个在安全性有所区别(具体在下面讲)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker run --name zerotier -d \
--restart always \
--net host \
--cap-add NET_ADMIN \
--device /dev/net/tun \
-v /opt/zerotier:/var/lib/zerotier-one \
zerotier/zerotier:latest&lt;/pre&gt;
&lt;p&gt;
      如果使用私有Planet，记得替换 &lt;code&gt;/opt/zerotier/planet&lt;/code&gt; 文件
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;Android&lt;/b&gt;: 推荐使用 &lt;a href=&quot;https://github.com/kaaass/ZerotierFix&quot;&gt;https://github.com/kaaass/ZerotierFix&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-2.3&quot;&gt;私有Planet&lt;/h3&gt;
&lt;p&gt;
    默认的Planet信息是硬编码在zertier代码里，如果安装好客户端后会在 &lt;code&gt;zerotier-cli peers&lt;/code&gt; 看到官方的Planet服务器。
&lt;/p&gt;

&lt;p&gt;
    而部署私有的Planet的目的:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 官方的服务器基本都位于国外或者香港，服务连通性无法得到保证
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 安全性。试想一个陌生的设备加入到网络，而这个设备的许可只需要得到官方的认证即可。当然，官方是基本不可能发生这样的情况，但如果有一个完全控制的网络，何乐而不为呢
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
    如何生成私有Planet文件?
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;git clone https://github.com/jonnyan404/zerotier-planet --depth=1
cd zerotier-planet
docker cp mkmoonworld-x86_64 ztncui:/tmp
docker cp patch.sh ztncui:/tmp
docker exec -it ztncui bash /tmp/patch.sh
docker restart ztncui&lt;/pre&gt;
&lt;p&gt;
    这样就会在挂载目录 &lt;code&gt;/opt/zerotier&lt;/code&gt; 下生成一个新的 &lt;b&gt;planet&lt;/b&gt; 文件，记得下载并备份。&lt;b&gt;所有加入组网的客户端都需要替换该文件&lt;/b&gt;
&lt;/p&gt;

&lt;h3 id=&quot;heading-2.4&quot;&gt;私有Planet服务器加入组网&lt;/h3&gt;
&lt;p&gt;
    如果按照上述部署流程也可以正常使用 &lt;code&gt;zerotier&lt;/code&gt; 组网，&lt;b&gt;但是&lt;/b&gt;，如果想要把部署了私有Planet的设备也加入到内网，貌似没有一篇文章说到。 所以我专门研究了一下，想要把私有Planet的机器也加入到内网，大概是可以分为下面几种方式:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 (&lt;b&gt;不推荐&lt;/b&gt;) 修改ztncui内部zerotier的默认端口9993 &lt;br/&gt;
       在 &lt;code&gt;/opt/zerotier&lt;/code&gt; 目录下添加一个 &lt;code&gt;local.conf&lt;/code&gt;，并设置
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{
    &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#34;settings&amp;#34;&lt;/span&gt;: {
        &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#34;primaryPort&amp;#34;&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;9995&lt;/span&gt;
    }
}&lt;/pre&gt;
&lt;p&gt;
       然后修改 &lt;code&gt;patch.sh&lt;/code&gt; 文件里的 &lt;code&gt;9993&lt;/code&gt; 端口，以及 &lt;code&gt;/start_ztncui.sh&lt;/code&gt; 添加一行
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;echo &amp;#34;ZT_ADDR=localhost:$ZT_PORT&amp;#34; &amp;gt; /opt/key-networks/ztncui/.env&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 部署两个zerotier: 除了ztncui容器内部的一个zerotier，再在机器上部署一个客户端，并修改端口，避免端口冲突
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 (&lt;b&gt;推荐&lt;/b&gt;) ztncui镜像的UI和zerotier分开部署&lt;br/&gt;
       我研究后才发现 &lt;code&gt;ztncui&lt;/code&gt; 的相关镜像把事情弄的很复杂，都把 &lt;code&gt;ztncui&lt;/code&gt; 和 &lt;code&gt;zerotier&lt;/code&gt; 放到同一个镜像，专门去连接 &lt;code&gt;localhost:9993&lt;/code&gt; 。其实是可以把两个镜像分开的，&lt;b&gt;UI&lt;/b&gt; 只做 &lt;b&gt;UI&lt;/b&gt; ，使用 &lt;b&gt;API&lt;/b&gt; 去连接 &lt;b&gt;zerotier&lt;/b&gt; 官方的镜像
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;heading-2.5&quot;&gt;UI和Zerotier分开部署&lt;/h3&gt;
&lt;p&gt;
    如果想要自己构建Docker镜像，可以参考 &lt;a href=&quot;https://github.com/honmaple/ztncui-aio&quot;&gt;honmaple/ztncui-aio&lt;/a&gt;
&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 部署 &lt;b&gt;zerotier&lt;/b&gt; 的客户端(部署过的可以忽略)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker run -d --name zerotier --restart always --net=host --cap-add NET_ADMIN --device /dev/net/tun -v /opt/zerotier:/var/lib/zerotier-one zerotier/zerotier:latest&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 部署 &lt;b&gt;UI&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker run -d --name ztncui --restart always \
-e MYADDR={服务器IP} \
-e HTTP_PORT=4000 \
-e HTTP_ALL_INTERFACES=yes \
-e ZT_ADDR={zerotier地址, 比如Docker网关:9993} \
-e ZT_TOKEN={可以为空，但需要挂载zerotier-one的配置路径} \
-v /opt/ztncui:/opt/ztncui/etc \
-v /opt/zerotier:/var/lib/zerotier-one \
-p 4000:4000 \
honmaple/ztncui:latest&lt;/pre&gt;
&lt;p&gt;
       &lt;b&gt;ZT_ADDR&lt;/b&gt;: 由于 &lt;b&gt;zerotier&lt;/b&gt; 和 &lt;b&gt;ztncui&lt;/b&gt; 没有部署在一个容器，所以需要从UI内部访问宿主机的 &lt;b&gt;&lt;b&gt;9993&lt;/b&gt;&lt;/b&gt; 端口，这里可以使用UI容器的网关访问，比如UI容器的IP是 &lt;b&gt;&lt;b&gt;172.17.0.12&lt;/b&gt;&lt;/b&gt;，则访问 &lt;b&gt;&lt;b&gt;172.17.0.1&lt;/b&gt;&lt;/b&gt;
&lt;/p&gt;

&lt;p&gt;
       另外，&lt;b&gt;zerotier&lt;/b&gt; 默认的API接口只允许 &lt;b&gt;&lt;b&gt;127.0.0.1&lt;/b&gt;&lt;/b&gt; 访问，所以需要在挂载目录 &lt;code&gt;/opt/zerotier&lt;/code&gt; 下新建一个 &lt;b&gt;&lt;b&gt;local.conf&lt;/b&gt;&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{
    &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#34;settings&amp;#34;&lt;/span&gt;: {
        &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#34;allowManagementFrom&amp;#34;&lt;/span&gt;: [&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;127.0.0.1/24&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;::1&amp;#34;&lt;/span&gt;, &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;172.17.0.1/24&amp;#34;&lt;/span&gt;]
    }
}&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 修改归属的用户和用户组
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker exec -it zerotier bash
cd /var/lib/zerotier-one
chown zerotier-one:zerotier-one local.conf
exit&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 生成私有Planet文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;git clone https://github.com/honmaple/ztncui-aio --depth=1
cd ztncui-aio
docker cp script/mkmoonworld-x86_64 zerotier:/tmp
docker cp script/patch.sh zerotier:/tmp
docker exec -it zerotier bash /tmp/patch.sh {服务器IP}&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 重启
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker restart zerotier&lt;/pre&gt;
&lt;p&gt;
       这样就能使私有Planet和zerotier客户端共存，让Planet服务器也能加入到内网环境了
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;heading-3&quot;&gt;组网教程&lt;/h2&gt;
&lt;h3 id=&quot;heading-3.1&quot;&gt;创建网络&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 使用浏览器打开UI管理界面 &lt;code&gt;{服务器公网IP}:4000&lt;/code&gt;，&lt;code&gt;honmaple/ztncui&lt;/code&gt; 默认用户名密码是 &lt;code&gt;admin,password&lt;/code&gt;
       
&lt;a href=&quot;https://s.libforest.com/images/2023/09/zerotier-01.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/zerotier-01.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 点击 &lt;code&gt;Add network&lt;/code&gt;，输入一个网络名称，比如 &lt;b&gt;testlab&lt;/b&gt;。然后选择 &lt;code&gt;Easy setup&lt;/code&gt;
       
&lt;a href=&quot;https://s.libforest.com/images/2023/09/zerotier-02.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/zerotier-02.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 添加一个内网网段，记得这个内网网段不能和需要加入组网的设备网段相同，比如我的设备C网段是 &lt;code&gt;192.168.31.0/24&lt;/code&gt; ，就不能添加该网段，另外Docker所使用的网段 &lt;code&gt;172.0.0.0/8&lt;/code&gt; 也需要避免添加，所以我这里选择 &lt;code&gt;10.8.230.0/24&lt;/code&gt;。&lt;b&gt;不同的设备内网网段不同，请根据实际添加&lt;/b&gt;
       
&lt;a href=&quot;https://s.libforest.com/images/2023/09/zerotier-03.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/zerotier-03.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;heading-3.2&quot;&gt;加入网络&lt;/h3&gt;
&lt;p&gt;
    创建好网络后就会得到一串网络ID，登录到设备，然后使用
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker exec zerotier zerotier-cli join {网络ID}&lt;/pre&gt;

&lt;p&gt;
    加入网络，正常情况下会得到
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;200 join OK&lt;/pre&gt;
&lt;p&gt;
    刷新管理界面就会出现一个新的成员
    
&lt;a href=&quot;https://s.libforest.com/images/2023/09/zerotier-04.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/zerotier-04.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
    然后勾选 &lt;b&gt;Authorizerd&lt;/b&gt; 允许加入，再次刷新，就能看到该设备分配了一个新的IP &lt;code&gt;10.8.230.170&lt;/code&gt;
    
&lt;a href=&quot;https://s.libforest.com/images/2023/09/zerotier-05.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/zerotier-05.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
    返回设备，可以看到设备多了一个新的IP
    
&lt;a href=&quot;https://s.libforest.com/images/2023/09/zerotier-06.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/zerotier-06.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;h3 id=&quot;heading-3.3&quot;&gt;跨网段访问&lt;/h3&gt;
&lt;p&gt;
    什么是跨网段访问? 比如现在我可以通过 &lt;b&gt;10.8.230.0/24&lt;/b&gt; 访问已经加入组网的设备，但我想要在&lt;b&gt;设备B&lt;/b&gt;上访问我家里的其它设备，但是，我家里设备的网段是 &lt;b&gt;192.168.31.0/24&lt;/b&gt;，正常是无法访问的，只能访问已经加入组网的Nas。这时需要配置静态路由，让设备B访问 &lt;b&gt;192.168.31.0/24&lt;/b&gt; 网段时走zerotier配置好的IP。
&lt;/p&gt;

&lt;p&gt;
    如果手动添加就是
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;ip route add 192.168.31.0/24 via 10.8.230.170 dev {zerotier建立的网卡}&lt;/pre&gt;

&lt;p&gt;
    当然，也可以直接使用zerotier管理界面添加，选择 &lt;code&gt;Routes&lt;/code&gt;
    
&lt;a href=&quot;https://s.libforest.com/images/2023/09/zerotier-07.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/zerotier-07.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
    &lt;b&gt;Target&lt;/b&gt; 输入想要访问的网段：&lt;code&gt;192.168.31.0/24&lt;/code&gt;，&lt;b&gt;Gateway&lt;/b&gt; 输入之前分配的IP：&lt;code&gt;10.8.230.170&lt;/code&gt;。
    
&lt;a href=&quot;https://s.libforest.com/images/2023/09/zerotier-08.jpg-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/09/zerotier-08.jpg-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
    创建好后可以在设备B上执行
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;ping 192.168.31.XX(除设备C之外的内网设备IP)&lt;/pre&gt;
&lt;p&gt;
    查看网络是否连通
&lt;/p&gt;

&lt;h3 id=&quot;heading-3.4&quot;&gt;安全限制&lt;/h3&gt;
&lt;p&gt;
    正因为跨网段访问只需要添加一个静态路由，就能访问我家里的其它设备，这无疑是非常不安全的。如果私有Planet服务器遭到入侵，我家里的所有联网设备都会暴露出去，即使加入组网只是其中的一台。基于此原因，我专门调整了一下zerotier的部署方式，不再使用 &lt;b&gt;host网络&lt;/b&gt; 的方式部署，而是创建一个新的Docker网络 &lt;code&gt;zerotier&lt;/code&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker network create --driver=bridge --subnet=192.168.100.0/24 --gateway=192.168.100.1 zerotier&lt;/pre&gt;
&lt;p&gt;
    注: &lt;code&gt;192.168.100.0/24&lt;/code&gt; 是一个全新的网段，不要使用172网段
&lt;/p&gt;

&lt;p&gt;
    然后删除之前部署的 &lt;b&gt;zerotier&lt;/b&gt; 客户端，并使用 &lt;b&gt;zerotier网络&lt;/b&gt; 重新部署
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker stop zerotier
docker rm zerotier
docker run -d --name zerotier --restart always --net zerotier --cap-add NET_ADMIN --device /dev/net/tun -v /opt/zerotier:/var/lib/zerotier-one zerotier/zerotier:latest&lt;/pre&gt;
&lt;p&gt;
    细心的朋友应该会发现我这里没有将 &lt;b&gt;9993&lt;/b&gt; 端口映射给宿主机，这是由于我测试发现两台设备只需要其中一台开放 &lt;code&gt;9993&lt;/code&gt; 端口，两台设备之间就能直连。如果两台设备都不开放端口，则会通过开放了端口的其它设备进行跳转，查看 &lt;b&gt;peers&lt;/b&gt; 会看到一直是 &lt;b&gt;RELAY&lt;/b&gt; 状态
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;root@cf5f973bd294:/# zerotier-cli peers
200 peers
&amp;lt;ztaddr&amp;gt;   &amp;lt;ver&amp;gt;  &amp;lt;role&amp;gt; &amp;lt;lat&amp;gt; &amp;lt;link&amp;gt;   &amp;lt;lastTX&amp;gt; &amp;lt;lastRX&amp;gt; &amp;lt;path&amp;gt;
xxxxxxxxx  1.12.1 LEAF      -1 RELAY&lt;/pre&gt;

&lt;p&gt;
    这时想要从设备B访问我家里其它联网的设备已是不可能，除非突破Docker的限制。而正常情况下，我想要从设备B上访问的是部署在设备C的其它服务(以Docker服务为主)，所以，现在可以添加一个新的路由 &lt;b&gt;192.168.100.0/24&lt;/b&gt; 指向 &lt;b&gt;10.8.230.170&lt;/b&gt;，然后修改其它镜像使用的网络为 &lt;b&gt;zerotier&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;docker run -d --rm --name=test-nginx --net=zerotier nginx:stable-alpine
docker exec -it test-nginx ip a&lt;/pre&gt;

&lt;p&gt;
    接着在设备B上执行
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;ping 192.168.100.3(test-nginx的IP)
curl 192.168.100.3&lt;/pre&gt;

&lt;p&gt;
    如果无法访问，需要在Docker所在宿主机上添加路由
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;ip route add 10.8.230.0/24 via 192.168.100.2(zerotier客户端的IP)&lt;/pre&gt;

&lt;p&gt;
    另外，由于Docker的IP可能会发生改变，除创建容器时指定 &lt;code&gt;--ip&lt;/code&gt; 外，还可以将服务的端口映射出去，比如 &lt;b&gt;NasTools&lt;/b&gt; 使用端口为 3000，那么可以在创建容器时指定
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;-p 11300:3000&lt;/pre&gt;
&lt;p&gt;
    然后在设备B上访问 &lt;code&gt;192.168.100.1:11300&lt;/code&gt;，即&lt;b&gt;网关地址+映射的端口&lt;/b&gt;，这样就能避免Docker重启后IP发生改变而导致服务异常的情况
&lt;/p&gt;

&lt;h2 id=&quot;heading-4&quot;&gt;FAQ&lt;/h2&gt;
&lt;h3 id=&quot;heading-4.1&quot;&gt;如何修改默认的9993端口?&lt;/h3&gt;
&lt;p&gt;
    在 &lt;b&gt;zerotier&lt;/b&gt; 挂载的目录下新建一个 &lt;code&gt;local.conf&lt;/code&gt; 文件，并设置
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{
    &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#34;settings&amp;#34;&lt;/span&gt;: {
        &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#34;primaryPort&amp;#34;&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;9995&lt;/span&gt;
    }
}&lt;/pre&gt;

&lt;h2 id=&quot;heading-5&quot;&gt;参考资料&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://github.com/honmaple/ztncui-aio&quot;&gt;https://github.com/honmaple/ztncui-aio&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://github.com/jonnyan404/zerotier-planet&quot;&gt;https://github.com/jonnyan404/zerotier-planet&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://github.com/zerotier/ZeroTierOne/blob/dev/README.docker.md&quot;&gt;https://github.com/zerotier/ZeroTierOne/blob/dev/README.docker.md&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://docs.zerotier.com/zerotier/zerotier.conf/&quot;&gt;https://docs.zerotier.com/zerotier/zerotier.conf/&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
        <category term="Linux"></category>
    </entry>
    <entry xml:lang="zh">
      <title>使用Github Actions自动打包Go项目</title>
      <link href="" rel="alternate"></link>
      <published>Mon, 06 Mar 2023 02:22:23 +0000</published>
      <updated>Mon, 06 Mar 2023 20:23:31 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2023/03/使用Github Actions自动打包Go项目.html" type="text/html"/>
      <id>https://honmaple.me/articles/2023/03/使用Github Actions自动打包Go项目.html</id>
      <summary type="html">
&lt;h2 id=&quot;heading-1&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;
   如果用过 &lt;b&gt;Gitlab Ci&lt;/b&gt;, 相信对此也非常熟悉，&lt;b&gt;GitHub Actions&lt;/b&gt; 是 &lt;b&gt;GitHub&lt;/b&gt; 推出的持续集成（Continuous Integration，简称 CI）服务，它提供了整套虚拟服务器环境，基于它可以进行构建、测试、打包、部署项目等等操作
&lt;/p&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;快速开始(Quickstart)&lt;/h2&gt;
&lt;p&gt;
   在自己的 &lt;code&gt;Github&lt;/code&gt; 仓库中找到 &lt;code&gt;Actions&lt;/code&gt; 标签页
   
&lt;a href=&quot;https://s.libforest.com/images/2023/03/github-actions-01.png-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/03/github-actions-01.png-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
   点击 &lt;code&gt;Configure&lt;/code&gt;, 此时会生成一个 &lt;code&gt;.github/workflow/go.yml&lt;/code&gt; 文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;# This...&lt;/span&gt;&lt;/pre&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;前言&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;快速开始(Quickstart)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;多平台编译(Cross Compile)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3.1&quot;&gt;交叉编译&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3.2&quot;&gt;跨平台编译&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4&quot;&gt;发布(Release)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5&quot;&gt;FAQ&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5.1&quot;&gt;version `GLIBC_2.33&amp;#39; not found&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;
   如果用过 &lt;b&gt;Gitlab Ci&lt;/b&gt;, 相信对此也非常熟悉，&lt;b&gt;GitHub Actions&lt;/b&gt; 是 &lt;b&gt;GitHub&lt;/b&gt; 推出的持续集成（Continuous Integration，简称 CI）服务，它提供了整套虚拟服务器环境，基于它可以进行构建、测试、打包、部署项目等等操作
&lt;/p&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;快速开始(Quickstart)&lt;/h2&gt;
&lt;p&gt;
   在自己的 &lt;code&gt;Github&lt;/code&gt; 仓库中找到 &lt;code&gt;Actions&lt;/code&gt; 标签页
   
&lt;a href=&quot;https://s.libforest.com/images/2023/03/github-actions-01.png-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/03/github-actions-01.png-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;p&gt;
   点击 &lt;code&gt;Configure&lt;/code&gt;, 此时会生成一个 &lt;code&gt;.github/workflow/go.yml&lt;/code&gt; 文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;# This workflow will build a golang project&lt;/span&gt;
&lt;span style=&quot;color:#75715e&quot;&gt;# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Go

&lt;span style=&quot;color:#66d9ef&quot;&gt;on&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;push&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;branches&lt;/span&gt;: [ &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;master&amp;#34;&lt;/span&gt; ]
  &lt;span style=&quot;color:#66d9ef&quot;&gt;pull_request&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;branches&lt;/span&gt;: [ &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;master&amp;#34;&lt;/span&gt; ]

&lt;span style=&quot;color:#66d9ef&quot;&gt;jobs&lt;/span&gt;:

  &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;runs-on&lt;/span&gt;: ubuntu-latest
    &lt;span style=&quot;color:#66d9ef&quot;&gt;steps&lt;/span&gt;:
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;uses&lt;/span&gt;: actions/checkout@v3
        - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Set up Go
          &lt;span style=&quot;color:#66d9ef&quot;&gt;uses&lt;/span&gt;: actions/setup-go@v3
        &lt;span style=&quot;color:#66d9ef&quot;&gt;with&lt;/span&gt;:
          &lt;span style=&quot;color:#66d9ef&quot;&gt;go-version&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;1.19&lt;/span&gt;
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Build
        &lt;span style=&quot;color:#66d9ef&quot;&gt;run&lt;/span&gt;: go build -v ./...
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Test
        &lt;span style=&quot;color:#66d9ef&quot;&gt;run&lt;/span&gt;: go test -v ./...&lt;/pre&gt;

&lt;h2 id=&quot;heading-3&quot;&gt;多平台编译(Cross Compile)&lt;/h2&gt;
&lt;h3 id=&quot;heading-3.1&quot;&gt;交叉编译&lt;/h3&gt;
&lt;p&gt;
    对于非 &lt;code&gt;CGO&lt;/code&gt; 项目，&lt;code&gt;Go&lt;/code&gt; 提供了一种十分方便的方式来进行交叉编译，只需要指定 &lt;code&gt;GOOS&lt;/code&gt; 和 &lt;code&gt;GOARCH&lt;/code&gt; 环境变量
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
  Mac下编译Linux, Windows平台的64位可执行程序：
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ CGO_ENABLED&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt; GOOS&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;linux GOARCH&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;amd64 go build .
$ CGO_ENABLED&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt; GOOS&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;windows GOARCH&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;amd64 go build .&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 Linux下编译Mac, Windows平台的64位可执行程序：
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ CGO_ENABLED&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt; GOOS&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;darwin GOARCH&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;amd64 go build .
$ CGO_ENABLED&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt; GOOS&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;windows GOARCH&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;amd64 go build .&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
    同样的，我们可以在 &lt;code&gt;Gtihub Actions&lt;/code&gt; 中设置环境变量来编译非 &lt;code&gt;CGO&lt;/code&gt; 项目，这里需要使用 &lt;code&gt;matrix&lt;/code&gt; 策略，让我们基于不同的参数创建并行的任务，比如编译Go时指定不同的环境变量
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 首先编写任务
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;jobs&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;strategy&lt;/span&gt;:
      &lt;span style=&quot;color:#66d9ef&quot;&gt;matrix&lt;/span&gt;:
        &lt;span style=&quot;color:#66d9ef&quot;&gt;goos&lt;/span&gt;: [linux, darwin]
        &lt;span style=&quot;color:#66d9ef&quot;&gt;goarch&lt;/span&gt;: [amd64]

    &lt;span style=&quot;color:#66d9ef&quot;&gt;runs-on&lt;/span&gt;: ubuntu-latest

    &lt;span style=&quot;color:#66d9ef&quot;&gt;steps&lt;/span&gt;:
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Checkout
        &lt;span style=&quot;color:#66d9ef&quot;&gt;uses&lt;/span&gt;: actions/checkout@v3
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Set up Go
        &lt;span style=&quot;color:#66d9ef&quot;&gt;uses&lt;/span&gt;: actions/setup-go@v3
        &lt;span style=&quot;color:#66d9ef&quot;&gt;with&lt;/span&gt;:
          &lt;span style=&quot;color:#66d9ef&quot;&gt;go-version&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;1.19&lt;/span&gt;
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Download dependencies
        &lt;span style=&quot;color:#66d9ef&quot;&gt;run&lt;/span&gt;: go mod download
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Build
        &lt;span style=&quot;color:#66d9ef&quot;&gt;run&lt;/span&gt;: go build -v -o snow .
        &lt;span style=&quot;color:#75715e&quot;&gt;# 指定编译时的环境变量&lt;/span&gt;
        &lt;span style=&quot;color:#66d9ef&quot;&gt;env&lt;/span&gt;:
          &lt;span style=&quot;color:#66d9ef&quot;&gt;GOOS&lt;/span&gt;: ${{ matrix.goos }}
          &lt;span style=&quot;color:#66d9ef&quot;&gt;GOARCH&lt;/span&gt;: ${{ matrix.goarch }}
          &lt;span style=&quot;color:#66d9ef&quot;&gt;CGO_ENABLED&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
      这样就创建了 &lt;code&gt;GOOS=linux GOARCH=amd64&lt;/code&gt; 和 &lt;code&gt;GOOS=darwin GOARCH=amd64&lt;/code&gt; 的两个任务, 当 &lt;code&gt;goarch&lt;/code&gt; 增加一个 &lt;code&gt;arm&lt;/code&gt; 的参数后，会组合成四个任务, 如果需要指定或者排除某个选项，可以使用 &lt;code&gt;include&lt;/code&gt; 或者 &lt;code&gt;exclude&lt;/code&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;matrix&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;goos&lt;/span&gt;: [linux, darwin]
  &lt;span style=&quot;color:#66d9ef&quot;&gt;goarch&lt;/span&gt;: [amd64, arm]
  &lt;span style=&quot;color:#75715e&quot;&gt;# 只包括linux编译选项&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;include&lt;/span&gt;:
    - &lt;span style=&quot;color:#66d9ef&quot;&gt;goos&lt;/span&gt;: linux
      &lt;span style=&quot;color:#66d9ef&quot;&gt;goarch&lt;/span&gt;: amd64
    - &lt;span style=&quot;color:#66d9ef&quot;&gt;goos&lt;/span&gt;: linux
      &lt;span style=&quot;color:#66d9ef&quot;&gt;goarch&lt;/span&gt;: arm
  &lt;span style=&quot;color:#75715e&quot;&gt;# 排除所有关于arm的编译选项&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;exclude&lt;/span&gt;:
    - &lt;span style=&quot;color:#66d9ef&quot;&gt;goarch&lt;/span&gt;: arm&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 然后执行 &lt;code&gt;git push&lt;/code&gt;, 这样就能在 &lt;code&gt;Github&lt;/code&gt; 的 &lt;code&gt;Actions&lt;/code&gt; 标签页看到执行结果
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-3.2&quot;&gt;跨平台编译&lt;/h3&gt;
&lt;p&gt;
    如果是非 &lt;code&gt;CGO&lt;/code&gt; 项目，可以使用Go内置的交叉编译，但如果是 &lt;code&gt;CGO&lt;/code&gt; 项目，上述的交叉编译大概率会失败(相关问题:&lt;a href=&quot;https://github.com/wellington/go-libsass/issues/67&quot;&gt;go-libsass&lt;/a&gt;)， 所以我们需要基于不同的平台来进行编译，幸运的是，&lt;code&gt;Github Actions&lt;/code&gt; 对此支持的非常好,
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 编写新任务
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;jobs&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;strategy&lt;/span&gt;:
      &lt;span style=&quot;color:#66d9ef&quot;&gt;matrix&lt;/span&gt;:
        &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;: [macos, linux]
        &lt;span style=&quot;color:#66d9ef&quot;&gt;include&lt;/span&gt;:
          - &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;: macos
            &lt;span style=&quot;color:#66d9ef&quot;&gt;os&lt;/span&gt;: macos-latest
          - &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;: linux
            &lt;span style=&quot;color:#66d9ef&quot;&gt;os&lt;/span&gt;: ubuntu&lt;span style=&quot;color:#ae81ff&quot;&gt;-18.04&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;runs-on&lt;/span&gt;: ${{ matrix.os }}
    &lt;span style=&quot;color:#66d9ef&quot;&gt;steps&lt;/span&gt;:
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Checkout
        &lt;span style=&quot;color:#66d9ef&quot;&gt;uses&lt;/span&gt;: actions/checkout@v3
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Set up Go
        &lt;span style=&quot;color:#66d9ef&quot;&gt;uses&lt;/span&gt;: actions/setup-go@v3
        &lt;span style=&quot;color:#66d9ef&quot;&gt;with&lt;/span&gt;:
          &lt;span style=&quot;color:#66d9ef&quot;&gt;go-version&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;1.19&lt;/span&gt;
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Download dependencies
        &lt;span style=&quot;color:#66d9ef&quot;&gt;run&lt;/span&gt;: go mod download
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Build
        &lt;span style=&quot;color:#66d9ef&quot;&gt;run&lt;/span&gt;: go build -v -o snow .
        &lt;span style=&quot;color:#66d9ef&quot;&gt;env&lt;/span&gt;:
          &lt;span style=&quot;color:#66d9ef&quot;&gt;CGO_ENABLED&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;1&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
      注意 &lt;code&gt;runs-on&lt;/code&gt; 使用的 &lt;code&gt;matrix.os&lt;/code&gt; 变量, 它允许我们分别使用 &lt;code&gt;ubuntu-18.04&lt;/code&gt; 和 &lt;code&gt;macos-latest&lt;/code&gt; 两个平台进行编译，这时不用指定 &lt;code&gt;GOOS&lt;/code&gt; 和 &lt;code&gt;GOARCH&lt;/code&gt; 参数
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 执行 &lt;code&gt;git push&lt;/code&gt;, 可以看到执行结果
      
&lt;a href=&quot;https://s.libforest.com/images/2023/03/github-actions-02.png-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/03/github-actions-02.png-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-4&quot;&gt;发布(Release)&lt;/h2&gt;
&lt;p&gt;
   当编译好一个二进制文件后，需要发布到 &lt;code&gt;Github&lt;/code&gt; 的 &lt;code&gt;Release&lt;/code&gt; 页，这时就需要添加新的任务, 目前官方的&lt;a href=&quot;https://github.com/actions/create-release&quot;&gt;actions/create-release&lt;/a&gt;已经无人维护，所以此次选择另外一个&lt;a href=&quot;https://github.com/ncipollo/release-action&quot;&gt;ncipollo/release-action&lt;/a&gt;
&lt;/p&gt;

&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Release

&lt;span style=&quot;color:#66d9ef&quot;&gt;on&lt;/span&gt;:
  &lt;span style=&quot;color:#75715e&quot;&gt;# 只在预发布时才执行&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;release&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;types&lt;/span&gt;: [prereleased]

&lt;span style=&quot;color:#66d9ef&quot;&gt;jobs&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;strategy&lt;/span&gt;:
      &lt;span style=&quot;color:#66d9ef&quot;&gt;matrix&lt;/span&gt;:
        &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;: [macos, linux]
        &lt;span style=&quot;color:#66d9ef&quot;&gt;include&lt;/span&gt;:
          - &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;: macos
            &lt;span style=&quot;color:#66d9ef&quot;&gt;os&lt;/span&gt;: macos-latest
            &lt;span style=&quot;color:#66d9ef&quot;&gt;archive-name&lt;/span&gt;: darwin.tar.gz
          - &lt;span style=&quot;color:#66d9ef&quot;&gt;build&lt;/span&gt;: linux
            &lt;span style=&quot;color:#66d9ef&quot;&gt;os&lt;/span&gt;: ubuntu-latest
            &lt;span style=&quot;color:#66d9ef&quot;&gt;archive-name&lt;/span&gt;: linux.tar.gz

    &lt;span style=&quot;color:#75715e&quot;&gt;# 需要设置写权限才能自动发布&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;permissions&lt;/span&gt;:
      &lt;span style=&quot;color:#66d9ef&quot;&gt;contents&lt;/span&gt;: write

    &lt;span style=&quot;color:#66d9ef&quot;&gt;steps&lt;/span&gt;:
      ...
      &lt;span style=&quot;color:#75715e&quot;&gt;# 把二进制文件打包成压缩文件&lt;/span&gt;
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Prepare Packaging
        &lt;span style=&quot;color:#66d9ef&quot;&gt;run&lt;/span&gt;: tar zcvf snow-${{ matrix.archive-name }}.tar.gz snow LICENSE

      &lt;span style=&quot;color:#75715e&quot;&gt;# 上传附件&lt;/span&gt;
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Upload Artifacts
        &lt;span style=&quot;color:#66d9ef&quot;&gt;uses&lt;/span&gt;: actions/upload-artifact@v3
        &lt;span style=&quot;color:#66d9ef&quot;&gt;with&lt;/span&gt;:
          &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: snow-${{ matrix.archive-name }}.tar.gz
          &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: snow-${{ matrix.archive-name }}.tar.gz

      &lt;span style=&quot;color:#75715e&quot;&gt;# 发布release版本&lt;/span&gt;
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: Release version
        &lt;span style=&quot;color:#66d9ef&quot;&gt;uses&lt;/span&gt;: ncipollo/release-action@v1
        &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt;: github.event_name == &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;release&amp;#39;&lt;/span&gt;
        &lt;span style=&quot;color:#66d9ef&quot;&gt;with&lt;/span&gt;:
          &lt;span style=&quot;color:#66d9ef&quot;&gt;allowUpdates&lt;/span&gt;: &lt;span style=&quot;color:#66d9ef&quot;&gt;true&lt;/span&gt;
          &lt;span style=&quot;color:#66d9ef&quot;&gt;artifacts&lt;/span&gt;: snow-${{ matrix.archive-name }}.tar.gz
          &lt;span style=&quot;color:#66d9ef&quot;&gt;token&lt;/span&gt;: ${{ secrets.GITHUB_TOKEN }}&lt;/pre&gt;

&lt;p&gt;
   当 &lt;code&gt;Github Actions&lt;/code&gt; 执行完成后，就能在 &lt;code&gt;Release&lt;/code&gt; 页看到我们发布的 &lt;code&gt;Package&lt;/code&gt;
   
&lt;a href=&quot;https://s.libforest.com/images/2023/03/github-actions-03.png-show&quot; data-fancybox=&quot;image&quot;&gt;
  &lt;img data-src=&quot;https://s.libforest.com/images/2023/03/github-actions-03.png-thumb&quot; class=&quot;lazyload&quot; /&gt;
&lt;/a&gt;
&lt;/p&gt;

&lt;h2 id=&quot;heading-5&quot;&gt;FAQ&lt;/h2&gt;
&lt;h3 id=&quot;heading-5.1&quot;&gt;version `GLIBC_2.33&amp;#39; not found&lt;/h3&gt;
&lt;p&gt;
    使用 &lt;code&gt;Github Actions&lt;/code&gt; 发布一个新的版本，下载到本地执行时报错
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;./snow: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.33&amp;#39; not found (required by ./snow)
./snow: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34&amp;#39; not found (required by ./snow)
./snow: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.32&amp;#39; not found (required by ./snow)
./snow: /usr/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.29&amp;#39; not found (required by ./snow)&lt;/pre&gt;
&lt;p&gt;
    这是由于使用的 &lt;code&gt;ubuntu&lt;/code&gt; 版本太高导致, 降低版本即可
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;include:
...
&lt;span style=&quot;color:#f92672&quot;&gt;-   os: ubuntu-latest
&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;+   os: ubuntu-18.04
&lt;/span&gt;&lt;/pre&gt;</content>
        <category term="Linux"></category>
    </entry>
    <entry xml:lang="zh">
      <title>Emacs笔记之修复yaml-mode的格式化问题</title>
      <link href="" rel="alternate"></link>
      <published>Tue, 21 Feb 2023 17:18:40 +0000</published>
      <updated>Sun, 26 Feb 2023 01:28:12 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2023/02/Emacs笔记之修复yaml-mode的格式化问题.html" type="text/html"/>
      <id>https://honmaple.me/articles/2023/02/Emacs笔记之修复yaml-mode的格式化问题.html</id>
      <summary type="html">
&lt;table&gt;
&lt;tr&gt;
&lt;th&gt;更新时间&lt;/th&gt;
&lt;th&gt;备注&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2023-02-26&lt;/td&gt;
&lt;td&gt;增加更多判断逻辑, 比如上一行是列表，当前行也是列表，则按正常缩进计算&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;p&gt;
一直以来 &lt;b&gt;yaml-mode&lt;/b&gt; 都有一个问题，在使用 &lt;code&gt;(indent-region (point-min) (point-max))&lt;/code&gt; 时已经格式好的内容总是会得到错误的缩进，比如一个简单的配置
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;test1&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;test2&lt;/span&gt;:
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val1&amp;#34;&lt;/span&gt;
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val2&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;test3&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;test4&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;...&lt;/span&gt;&lt;/pre&gt;</summary>
      <content type="html">
&lt;table&gt;
&lt;tr&gt;
&lt;th&gt;更新时间&lt;/th&gt;
&lt;th&gt;备注&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;2023-02-26&lt;/td&gt;
&lt;td&gt;增加更多判断逻辑, 比如上一行是列表，当前行也是列表，则按正常缩进计算&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;p&gt;
一直以来 &lt;b&gt;yaml-mode&lt;/b&gt; 都有一个问题，在使用 &lt;code&gt;(indent-region (point-min) (point-max))&lt;/code&gt; 时已经格式好的内容总是会得到错误的缩进，比如一个简单的配置
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;test1&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;test2&lt;/span&gt;:
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val1&amp;#34;&lt;/span&gt;
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val2&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;test3&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;test4&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val4&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
在调用 &lt;code&gt;indent-regin&lt;/code&gt; 后就会变成
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;test1&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;test2&lt;/span&gt;:
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val1&amp;#34;&lt;/span&gt;
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val2&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;test3&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;test4&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val4&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
而我又总是手痒，写好的配置文件总是会忍不住 &lt;code&gt;indent-region&lt;/code&gt; 一番，结果本来正确的格式立马变得各种乱七八糟，当初为了解决这个问题，还专门为 &lt;b&gt;yaml-mode&lt;/b&gt; 激活了 &lt;b&gt;lsp-mode&lt;/b&gt;, 并且使用 &lt;code&gt;lsp-format-buffer&lt;/code&gt; 来进行处理。
&lt;/p&gt;

&lt;p&gt;
本来一切都还正常，但最近发现了另外一个问题，如果在 &lt;b&gt;org-mode&lt;/b&gt; 中插入 &lt;b&gt;yaml&lt;/b&gt; 的代码片段，调用 &lt;code&gt;indent-region&lt;/code&gt; 还是还有之前的问题, &lt;b&gt;org-mode&lt;/b&gt; 中又无法直接调用 &lt;code&gt;lsp-format-buffer&lt;/code&gt;, 所以专门研究了一下 &lt;b&gt;yaml-mode&lt;/b&gt;
&lt;/p&gt;

&lt;p&gt;
发现 &lt;b&gt;yaml-mode&lt;/b&gt; 只是定义了 &lt;code&gt;indent-line-function&lt;/code&gt; 变量，没有定义 &lt;code&gt;indent-region-function&lt;/code&gt;, 导致调用 &lt;code&gt;indent-region&lt;/code&gt; 时其实是逐行调用 &lt;code&gt;yaml-indent-line&lt;/code&gt;, 这里面有一个计算当前缩进的 &lt;code&gt;yaml-compute-indentation&lt;/code&gt; 函数，计算方式有些简单粗暴，如果上一行是一个 &lt;b&gt;hash key&lt;/b&gt;, 当前行的缩进就是上一行的缩进加 &lt;code&gt;yaml-indent-offset&lt;/code&gt; 的值, 这里并没有判断当前行是新建行还是已经有相关内容，如果是新建行那么缩进就是对的，如果是已有的内容就是错的，所以我修改了这一部分逻辑，如果是 &lt;b&gt;已有内容并且当前行的缩进小于上一行&lt;/b&gt; 则不进行处理, 比如:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;val2&amp;#34;&lt;/span&gt;
test3:&lt;/pre&gt;
&lt;p&gt;
虽然增加的判断逻辑很简单，但至少在使用 &lt;code&gt;indent-region&lt;/code&gt; 时已经格式好的内容就不会出现混乱的情况了, 也不用专门为 &lt;b&gt;yaml&lt;/b&gt; 文件激活一个 &lt;b&gt;lsp&lt;/b&gt; 进程。
&lt;/p&gt;

&lt;p&gt;
目前处理的方式还是采用 advice + letf 形式，否则需要修改很多内容，有兴趣的同道可以参考一下
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(defun maple/yaml-compute-indentation()
  (let ((ci (&lt;span style=&quot;color:#a6e22e&quot;&gt;current-indentation&lt;/span&gt;))
        (cm (&lt;span style=&quot;color:#a6e22e&quot;&gt;looking-at&lt;/span&gt; yaml-hash-key-re))
        (cl (&lt;span style=&quot;color:#a6e22e&quot;&gt;looking-at&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;^&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;*-&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;+.*$&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)))
    (save-excursion
      (&lt;span style=&quot;color:#a6e22e&quot;&gt;beginning-of-line&lt;/span&gt;)
      (if (&lt;span style=&quot;color:#a6e22e&quot;&gt;looking-at&lt;/span&gt; yaml-document-delimiter-re) &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;
        (&lt;span style=&quot;color:#a6e22e&quot;&gt;forward-line&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;-1&lt;/span&gt;)
        (while (and (&lt;span style=&quot;color:#a6e22e&quot;&gt;looking-at&lt;/span&gt; yaml-blank-line-re)
                    (&lt;span style=&quot;color:#a6e22e&quot;&gt;&amp;gt;&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;point&lt;/span&gt;) (&lt;span style=&quot;color:#a6e22e&quot;&gt;point-min&lt;/span&gt;)))
          (&lt;span style=&quot;color:#a6e22e&quot;&gt;forward-line&lt;/span&gt; &lt;span style=&quot;color:#ae81ff&quot;&gt;-1&lt;/span&gt;))
        (let ((li (&lt;span style=&quot;color:#a6e22e&quot;&gt;current-indentation&lt;/span&gt;))
              (ll (&lt;span style=&quot;color:#a6e22e&quot;&gt;looking-at&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;^&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;*-&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\s&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;+.*$&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)))
          &lt;span style=&quot;color:#75715e&quot;&gt;;; 如果上一行的缩进大于当前行, 上一行是列表，当前行也是是列表 - 正常缩进&lt;/span&gt;
          &lt;span style=&quot;color:#75715e&quot;&gt;;; 如果上一行的缩进大于当前行, 上一行和当前行有一个不是列表 - 原有缩进&lt;/span&gt;
          &lt;span style=&quot;color:#75715e&quot;&gt;;; 如果上一行的缩进等于当前行, 上一行是字典，当前行是列表 - 正常缩进&lt;/span&gt;
          &lt;span style=&quot;color:#75715e&quot;&gt;;; 如果上一行的缩进等于当前行, 上一行是字典，当前行是不是列表 - 原有缩进&lt;/span&gt;
          &lt;span style=&quot;color:#75715e&quot;&gt;;; 如果上一行的缩进小于当前行, 上一行是字典 - 正常缩进&lt;/span&gt;
          &lt;span style=&quot;color:#75715e&quot;&gt;;; 如果上一行的缩进小于当前行, 上一行是列表，当前行也是列表 - 正常缩进&lt;/span&gt;
          &lt;span style=&quot;color:#75715e&quot;&gt;;; 如果上一行的缩进小于当前行, 上一行是列表，当前行是字典 - 错误/正常缩进&lt;/span&gt;
          (if (or (and (&lt;span style=&quot;color:#a6e22e&quot;&gt;&amp;gt;&lt;/span&gt; li ci) (or (not cl) (not ll))) (and (&lt;span style=&quot;color:#a6e22e&quot;&gt;=&lt;/span&gt; li ci) cm (not ll))) ci
            (&lt;span style=&quot;color:#a6e22e&quot;&gt;+&lt;/span&gt; li
               (if (&lt;span style=&quot;color:#a6e22e&quot;&gt;looking-at&lt;/span&gt; yaml-nested-map-re) yaml-indent-offset &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;)
               (if (&lt;span style=&quot;color:#a6e22e&quot;&gt;looking-at&lt;/span&gt; yaml-nested-sequence-re) yaml-indent-offset &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;)
               (if (&lt;span style=&quot;color:#a6e22e&quot;&gt;looking-at&lt;/span&gt; yaml-block-literal-re) yaml-indent-offset &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;))))))))

(defun maple/yaml-indent-region(func &lt;span style=&quot;color:#66d9ef&quot;&gt;&amp;amp;rest&lt;/span&gt; args)
  (if (derived-mode-p &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;yaml-mode&lt;/span&gt;)
      (letf (((&lt;span style=&quot;color:#a6e22e&quot;&gt;symbol-function&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;yaml-compute-indentation&lt;/span&gt;) &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;maple/yaml-compute-indentation&lt;/span&gt;))
        (&lt;span style=&quot;color:#a6e22e&quot;&gt;apply&lt;/span&gt; func args))
    (&lt;span style=&quot;color:#a6e22e&quot;&gt;apply&lt;/span&gt; func args)))

(advice-add &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;indent-region&lt;/span&gt; :around &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;maple/yaml-indent-region&lt;/span&gt;)&lt;/pre&gt;</content>
        <category term="Linux/Emacs"></category>
    </entry>
    <entry xml:lang="zh">
      <title>静态博客中的shortcode实现</title>
      <link href="" rel="alternate"></link>
      <published>Tue, 07 Feb 2023 15:57:51 +0000</published>
      <updated>Sun, 05 Mar 2023 11:28:44 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2023/02/静态博客中的shortcode实现.html" type="text/html"/>
      <id>https://honmaple.me/articles/2023/02/静态博客中的shortcode实现.html</id>
      <summary type="html">
&lt;h2 id=&quot;heading-1&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;
   &lt;b&gt;shortcode&lt;/b&gt;,直译过来就是 &lt;b&gt;短代码&lt;/b&gt;。 使用过 &lt;b&gt;hugo&lt;/b&gt; 的人对此也一定有所了解，&lt;b&gt;shortcode&lt;/b&gt; 允许用户使用部分关键参数就可以在文章内部插入设置好的HTML模版内容，而不用写大段的HTML代码，比如插入指定视频或者音乐,使用 &lt;b&gt;shortcode&lt;/b&gt; 之前需要使用 &lt;b&gt;iframe&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;iframe&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;frameborder&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;no&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;border&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;
        &lt;span style=&quot;color:#a6e22e&quot;&gt;marginwidth&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;marginheight&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0...&lt;/span&gt;&lt;/pre&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;前言&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;实现方式&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1&quot;&gt;Markdown渲染&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2&quot;&gt;查找HTML标签&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.3&quot;&gt;替换HTML&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;结尾&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;
   &lt;b&gt;shortcode&lt;/b&gt;,直译过来就是 &lt;b&gt;短代码&lt;/b&gt;。 使用过 &lt;b&gt;hugo&lt;/b&gt; 的人对此也一定有所了解，&lt;b&gt;shortcode&lt;/b&gt; 允许用户使用部分关键参数就可以在文章内部插入设置好的HTML模版内容，而不用写大段的HTML代码，比如插入指定视频或者音乐,使用 &lt;b&gt;shortcode&lt;/b&gt; 之前需要使用 &lt;b&gt;iframe&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;iframe&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;frameborder&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;no&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;border&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;
        &lt;span style=&quot;color:#a6e22e&quot;&gt;marginwidth&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;marginheight&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;
        &lt;span style=&quot;color:#a6e22e&quot;&gt;width&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;330&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;height&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;86&lt;/span&gt;
        &lt;span style=&quot;color:#a6e22e&quot;&gt;src&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;//music.163.com/outchain/player?type=2&amp;amp;id=xxx&amp;amp;auto=0&amp;amp;height=66&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;iframe&lt;/span&gt;&amp;gt;&lt;/pre&gt;

&lt;p&gt;
   而使用 &lt;b&gt;shortcode&lt;/b&gt; 后就可以只用指定关键的 &lt;b&gt;id&lt;/b&gt; 参数
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{{&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;163music&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;xxx&lt;/span&gt;&amp;gt;}}&lt;/pre&gt;
&lt;p&gt;
   当网易云音乐的分享代码更新后，可以直接更新 &lt;b&gt;shortcode&lt;/b&gt; 代码, 而不是搜索替换每一篇包括该iframe代码的文章, 同时 &lt;b&gt;shortcode&lt;/b&gt; 也可以扩展 &lt;b&gt;Markdown&lt;/b&gt; 的功能，比如文本的居中，居左，居右
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{{&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;align&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;left&lt;/span&gt;&amp;gt;}}
  文本内容
  {{&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;align&lt;/span&gt;&amp;gt;}}&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;实现方式&lt;/h2&gt;
&lt;p&gt;
   而想要在静态博客中实现 &lt;b&gt;shortcode&lt;/b&gt; 功能, 目前有两种方式
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 方式一: 修改 &lt;b&gt;Markdown&lt;/b&gt; 解析器, 在静态生成器解析文章内容时就可以对 &lt;b&gt;shortcode&lt;/b&gt; 进行解析，并将 &lt;b&gt;shortcode&lt;/b&gt; 替换成写好的模版，至少，我看到 &lt;b&gt;hugo&lt;/b&gt; 就是这么实现的
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 方式二: 如果不想修改 &lt;b&gt;Markdown&lt;/b&gt; 解析器，还可以直接修改生成好的 &lt;b&gt;HTML&lt;/b&gt; 内容，这种方式实现原理很简单，&lt;b&gt;Markdown允许插入HTML代码&lt;/b&gt;, 那么我们就可以直接在文章中写一个
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;shortcode&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;_name&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;163music&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;id&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;xxx&amp;#34;&lt;/span&gt; /&amp;gt;&lt;/pre&gt;
&lt;p&gt;
     然后在现有的 &lt;b&gt;Markdown&lt;/b&gt; 解析库解析文章并生成 &lt;b&gt;HTML&lt;/b&gt; 后再次对HTML内容进行解析，目前主流语言都有现成的库很方便地解析HTML内容, 下面以 &lt;b&gt;Go&lt;/b&gt; 为例
&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-2.1&quot;&gt;Markdown渲染&lt;/h3&gt;
&lt;p&gt;
    比如有一篇文章，我想要添加网易云音乐的某首歌到文章内部，当使用现有的Markdown库对内容进行渲染
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;package&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;main&lt;/span&gt;

&lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; (
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/russross/blackfriday/v2&amp;#34;&lt;/span&gt;
)

&lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;main&lt;/span&gt;() {
    &lt;span style=&quot;color:#a6e22e&quot;&gt;content&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;`&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;# Hello World
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;lt;shortcode _name=&amp;#34;163music&amp;#34; id=&amp;#34;xxx&amp;#34; /&amp;gt;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;This is one of my favorite **music**.
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;  &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;`&lt;/span&gt;
    &lt;span style=&quot;color:#a6e22e&quot;&gt;d&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;blackfriday&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Run&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;content&lt;/span&gt;)
    &lt;span style=&quot;color:#a6e22e&quot;&gt;fmt&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Println&lt;/span&gt;(string(&lt;span style=&quot;color:#a6e22e&quot;&gt;d&lt;/span&gt;))
}&lt;/pre&gt;

&lt;p&gt;
    输出结果
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;h1&lt;/span&gt;&amp;gt;Hello World&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;h1&lt;/span&gt;&amp;gt;

&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;p&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;shortcode&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;_name&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;163music&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;id&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;xxx&amp;#34;&lt;/span&gt; /&amp;gt;
  This is one of my favorite &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;strong&lt;/span&gt;&amp;gt;music&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;strong&lt;/span&gt;&amp;gt;.&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/pre&gt;

&lt;h3 id=&quot;heading-2.2&quot;&gt;查找HTML标签&lt;/h3&gt;
&lt;p&gt;
    可以使用 &lt;code&gt;golang.org/x/net/html&lt;/code&gt; 对HTML内容进行解析, 并查找到 &lt;b&gt;shortcode&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;package&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;main&lt;/span&gt;

&lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; (
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;bytes&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/russross/blackfriday/v2&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;golang.org/x/net/html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;text/template&amp;#34;&lt;/span&gt;
)

&lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;main&lt;/span&gt;() {
    &lt;span style=&quot;color:#75715e&quot;&gt;// ...
&lt;/span&gt;&lt;span style=&quot;color:#75715e&quot;&gt;&lt;/span&gt;    &lt;span style=&quot;color:#66d9ef&quot;&gt;var&lt;/span&gt; (
        &lt;span style=&quot;color:#a6e22e&quot;&gt;w&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;bytes&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Buffer&lt;/span&gt;
        &lt;span style=&quot;color:#a6e22e&quot;&gt;z&lt;/span&gt; = &lt;span style=&quot;color:#a6e22e&quot;&gt;html&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;NewTokenizer&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;bytes&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;NewReader&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;d&lt;/span&gt;))
    )
    &lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; {
        &lt;span style=&quot;color:#a6e22e&quot;&gt;next&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;z&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Next&lt;/span&gt;()
        &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;next&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;html&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;ErrorToken&lt;/span&gt; {
            &lt;span style=&quot;color:#66d9ef&quot;&gt;break&lt;/span&gt;
        }

        &lt;span style=&quot;color:#a6e22e&quot;&gt;token&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;z&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Token&lt;/span&gt;()
        &lt;span style=&quot;color:#66d9ef&quot;&gt;switch&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;next&lt;/span&gt; {
        &lt;span style=&quot;color:#66d9ef&quot;&gt;case&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;html&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;StartTagToken&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;html&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;SelfClosingTagToken&lt;/span&gt;:
            &lt;span style=&quot;color:#75715e&quot;&gt;// 找到shortcode标签
&lt;/span&gt;&lt;span style=&quot;color:#75715e&quot;&gt;&lt;/span&gt;            &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;token&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Data&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;shortcode&amp;#34;&lt;/span&gt; {

            }
        }
        &lt;span style=&quot;color:#a6e22e&quot;&gt;w&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WriteString&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;token&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;String&lt;/span&gt;())
    }
    &lt;span style=&quot;color:#a6e22e&quot;&gt;fmt&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Println&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;w&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;String&lt;/span&gt;())
}&lt;/pre&gt;

&lt;h3 id=&quot;heading-2.3&quot;&gt;替换HTML&lt;/h3&gt;
&lt;p&gt;
    首先把需要替换的 &lt;b&gt;iframe&lt;/b&gt; 转换成模版
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;replace&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;`&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;lt;iframe
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;frameborder=&amp;#34;no&amp;#34; border=&amp;#34;0&amp;#34;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;marginwidth=&amp;#34;0&amp;#34; marginheight=&amp;#34;0&amp;#34;
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;width=330 height=86
&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;src=&amp;#34;//music.163.com/outchain/player?type=2&amp;amp;id=&lt;/span&gt;&lt;span style=&quot;color:#75715e&quot;&gt;{{&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;.id&lt;/span&gt; &lt;span style=&quot;color:#75715e&quot;&gt;}}&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;amp;auto=0&amp;amp;height=66&amp;#34;&amp;gt;&amp;lt;/iframe&amp;gt;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;`&lt;/span&gt;

&lt;span style=&quot;color:#a6e22e&quot;&gt;tmpl&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;template&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;New&lt;/span&gt;(&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;).&lt;span style=&quot;color:#a6e22e&quot;&gt;Parse&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;replace&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
    panic(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;)
}&lt;/pre&gt;

&lt;p&gt;
    然后根据标签参数替换原来的HTML
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;// 获取该标签的参数
&lt;/span&gt;&lt;span style=&quot;color:#75715e&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;attrs&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; make(&lt;span style=&quot;color:#66d9ef&quot;&gt;map&lt;/span&gt;[&lt;span style=&quot;color:#66d9ef&quot;&gt;string&lt;/span&gt;]&lt;span style=&quot;color:#66d9ef&quot;&gt;string&lt;/span&gt;)
&lt;span style=&quot;color:#66d9ef&quot;&gt;for&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;_&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;attr&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;range&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;token&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Attr&lt;/span&gt; {
    &lt;span style=&quot;color:#a6e22e&quot;&gt;attrs&lt;/span&gt;[&lt;span style=&quot;color:#a6e22e&quot;&gt;attr&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Key&lt;/span&gt;] = &lt;span style=&quot;color:#a6e22e&quot;&gt;attr&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Val&lt;/span&gt;
}
&lt;span style=&quot;color:#75715e&quot;&gt;// 确认是163music
&lt;/span&gt;&lt;span style=&quot;color:#75715e&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;attrs&lt;/span&gt;[&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;_name&amp;#34;&lt;/span&gt;] &lt;span style=&quot;color:#f92672&quot;&gt;==&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;163music&amp;#34;&lt;/span&gt; {
    &lt;span style=&quot;color:#75715e&quot;&gt;// 获取替换的内容
&lt;/span&gt;&lt;span style=&quot;color:#75715e&quot;&gt;&lt;/span&gt;    &lt;span style=&quot;color:#66d9ef&quot;&gt;var&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;buf&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;bytes&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Buffer&lt;/span&gt;
    &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;:=&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;tmpl&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Execute&lt;/span&gt;(&lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;buf&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;attrs&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;if&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;!=&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; {
        panic(&lt;span style=&quot;color:#a6e22e&quot;&gt;err&lt;/span&gt;)
    }
    &lt;span style=&quot;color:#a6e22e&quot;&gt;w&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;WriteString&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;buf&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;String&lt;/span&gt;())
    &lt;span style=&quot;color:#66d9ef&quot;&gt;continue&lt;/span&gt;
}&lt;/pre&gt;

&lt;p&gt;
    最后的输出结果
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;h1&lt;/span&gt;&amp;gt;Hello World&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;h1&lt;/span&gt;&amp;gt;

&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;p&lt;/span&gt;&amp;gt;&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;iframe&lt;/span&gt;
     &lt;span style=&quot;color:#a6e22e&quot;&gt;frameborder&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;no&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;border&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;
     &lt;span style=&quot;color:#a6e22e&quot;&gt;marginwidth&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;marginheight&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;0&amp;#34;&lt;/span&gt;
     &lt;span style=&quot;color:#a6e22e&quot;&gt;width&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;330&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;height&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;86&lt;/span&gt;
     &lt;span style=&quot;color:#a6e22e&quot;&gt;src&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;//music.163.com/outchain/player?type=2&amp;amp;id=xxx&amp;amp;auto=0&amp;amp;height=66&amp;#34;&lt;/span&gt;&amp;gt;&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;iframe&lt;/span&gt;&amp;gt;
  This is one of my favorite &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;strong&lt;/span&gt;&amp;gt;music&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;strong&lt;/span&gt;&amp;gt;.&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;p&lt;/span&gt;&amp;gt;&lt;/pre&gt;

&lt;h2 id=&quot;heading-3&quot;&gt;结尾&lt;/h2&gt;
&lt;p&gt;
   目前&lt;a href=&quot;https://github.com/honmaple/snow&quot;&gt;snow&lt;/a&gt;的 &lt;b&gt;shortcode&lt;/b&gt; 功能就是根据第二种方式实现的，具体可以参考 &lt;a href=&quot;https://github.com/honmaple/snow/blob/master/builder/hook/shortcode/shortcode.go&quot;&gt;hooks/shortcode/shortcode.go&lt;/a&gt;, 利用此特性甚至还可以实现类似 &lt;b&gt;Hugo&lt;/b&gt; 中的 &lt;b&gt;Markdown Render Hook&lt;/b&gt; 功能,用于自定义 &lt;code&gt;img&lt;/code&gt;, &lt;code&gt;a&lt;/code&gt; 等标签
&lt;/p&gt;</content>
        <category term="Linux"></category>
    </entry>
    <entry xml:lang="zh">
      <title>Snow静态博客生成器</title>
      <link href="" rel="alternate"></link>
      <published>Sun, 16 Oct 2022 18:44:46 +0000</published>
      <updated>Mon, 05 Jun 2023 22:48:26 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2022/10/Snow静态博客生成器.html" type="text/html"/>
      <id>https://honmaple.me/articles/2022/10/Snow静态博客生成器.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
一个&lt;b&gt;简单却可配置&lt;/b&gt;的静态博客生成器。
很早之前(三年前)就想写一个静态博客生成器，但苦于一直没有时间，最近把之前写的重构了一下，让其可以支持更多的定制化配置。
&lt;/p&gt;

&lt;p&gt;
&lt;b&gt;至于为什么要重新写一个&lt;/b&gt;:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 大概是因为想要把之前未完成的轮子补充完整
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 我目前使用的博客系统使用的是 &lt;b&gt;pelican&lt;/b&gt;，一个基于 &lt;b&gt;Python&lt;/b&gt; 的静态博客生成器，目前里面包括了很多我自己写的插件，比如 &lt;code&gt;Emacs org mode&lt;/code&gt; 的支持、文章加密、模版定制等，因为需要大量遍历所有文章，导致生成速度越来越慢，还有一点就是因为使用的是 &lt;b&gt;Python&lt;/b&gt;，每次本地预览时都需要切换到虚拟环境
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 我习惯使用 &lt;b&gt;Emacs + Org&lt;/b&gt;，除了前期的几篇文章，后面都是使用 &lt;b&gt;org...&lt;/b&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/blockquote&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;快速开始&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.1&quot;&gt;开始(Quickstart)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.1.1&quot;&gt;创建新的站点&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.1.2&quot;&gt;编译和预览&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.2&quot;&gt;安装(Installation)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.3&quot;&gt;编译(Build)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.4&quot;&gt;命令行(Cli usage)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.4.1&quot;&gt;init&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.4.2&quot;&gt;build&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.4.3&quot;&gt;server&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.5&quot;&gt;目录结构(Driectory structure)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.6&quot;&gt;配置文件(Configuration)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;内容管理&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1&quot;&gt;Section&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1.1&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1.2&quot;&gt;路径变量(&lt;b&gt;sections.xxx.path&lt;/b&gt;)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1.3&quot;&gt;模版变量(&lt;b&gt;sections.xxx.template&lt;/b&gt;)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2&quot;&gt;页面(Page)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2.1&quot;&gt;元数据&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2.2&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2.3&quot;&gt;路径变量(&lt;b&gt;sections.xxx.page_path&lt;/b&gt;)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2.4&quot;&gt;模版变量(&lt;b&gt;sections.xxx.page_template&lt;/b&gt;)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.3&quot;&gt;分类系统(Taxonomy)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.3.1&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.3.2&quot;&gt;路径变量&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.3.3&quot;&gt;模版变量&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.4&quot;&gt;归档页(Archive)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.5&quot;&gt;分页(Pagination)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.5.1&quot;&gt;路径变量&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.5.2&quot;&gt;模版变量&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.6&quot;&gt;草稿(Draft)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.7&quot;&gt;输出格式(Atom,Rss,JSON)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.7.1&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.7.2&quot;&gt;模版变量&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.8&quot;&gt;静态文件(Static)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.8.1&quot;&gt;主题静态文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.8.2&quot;&gt;指定的静态文件&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.9&quot;&gt;多语言(Multilingual)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;模版(templates)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4&quot;&gt;主题(theme)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.1&quot;&gt;安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.2&quot;&gt;开发&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.2.1&quot;&gt;主题目录结构&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.2.2&quot;&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4.2.3&quot;&gt;&lt;span class=&quot;todo&quot;&gt;TODO&lt;/span&gt;默认配置&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5&quot;&gt;插件(hooks)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5.1&quot;&gt;i18n&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5.2&quot;&gt;encrypt&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5.3&quot;&gt;shortcode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5.4&quot;&gt;assets&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5.5&quot;&gt;sofile&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-6&quot;&gt;本地测试和正式发布&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;
一个&lt;b&gt;简单却可配置&lt;/b&gt;的静态博客生成器。
很早之前(三年前)就想写一个静态博客生成器，但苦于一直没有时间，最近把之前写的重构了一下，让其可以支持更多的定制化配置。
&lt;/p&gt;

&lt;p&gt;
&lt;b&gt;至于为什么要重新写一个&lt;/b&gt;:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 大概是因为想要把之前未完成的轮子补充完整
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 我目前使用的博客系统使用的是 &lt;b&gt;pelican&lt;/b&gt;，一个基于 &lt;b&gt;Python&lt;/b&gt; 的静态博客生成器，目前里面包括了很多我自己写的插件，比如 &lt;code&gt;Emacs org mode&lt;/code&gt; 的支持、文章加密、模版定制等，因为需要大量遍历所有文章，导致生成速度越来越慢，还有一点就是因为使用的是 &lt;b&gt;Python&lt;/b&gt;，每次本地预览时都需要切换到虚拟环境
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 我习惯使用 &lt;b&gt;Emacs + Org&lt;/b&gt;，除了前期的几篇文章，后面都是使用 &lt;b&gt;org mode&lt;/b&gt; 书写，之前是因为 &lt;b&gt;Python&lt;/b&gt; 没有一个好用的 &lt;b&gt;org mode&lt;/b&gt; 解析库，所以专门写了一个 &lt;code&gt;org-python&lt;/code&gt; 用来解析 &lt;b&gt;org mode&lt;/b&gt;；最近我也是完善了另一个我很早之前就写的 &lt;code&gt;org-golang&lt;/code&gt; 解析库(轮子+1)，准备趁次机会利用一下这个库
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 至于为什么不用最近几年流行的 &lt;b&gt;Hugo&lt;/b&gt;, 因为我想要保持和我使用 &lt;b&gt;Pelican&lt;/b&gt; 时一样的功能，比如文章加密，而 &lt;b&gt;hugo&lt;/b&gt; 并不支持插件，想要自定义插件必须复制大段大段的启动函数, 甚至需要修改源代码。同样我想要定制一个相同的模版，而对于使用过其它模版系统如Django，jinja2, 再来使用 &lt;b&gt;Go内置模版&lt;/b&gt; 的人来说, &lt;b&gt;hugo&lt;/b&gt; 的内置模版除了难用就是难用，这也是我此次选用 &lt;b&gt;pongo2&lt;/b&gt; 的原因
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 我的设想是提供插件的接口，并提供一个足够简单的启动函数, 在有用户需要自定义插件时只需要自己创建一个包, 使用三两行代码就能注册自定义插件并重新编译自己的snow
&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;快速开始&lt;/h2&gt;
&lt;h3 id=&quot;heading-1.1&quot;&gt;开始(Quickstart)&lt;/h3&gt;
&lt;h4 id=&quot;heading-1.1.1&quot;&gt;创建新的站点&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;──╼ ./snow init
Welcome to snow 0.1.0.
&amp;gt; Where do you want to create your new web site? [.] mysnow
&amp;gt; What will be the title of this web site? [snow]
&amp;gt; Who will be the author of this web site?
The input is required
&amp;gt; Who will be the author of this web site? honmaple
&amp;gt; What is your URL prefix? (no trailing slash) [http://127.0.0.1:8000]
&amp;gt; Do you want to create first page? [Y/n]&lt;/pre&gt;

&lt;h4 id=&quot;heading-1.1.2&quot;&gt;编译和预览&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ cd mysnow
└──╼ ../snow server -D
DEBU Copying @theme/static/css/main.css to output/static/css/main.css
INFO Done: Static Processed 1 static files in 588.705µs
DEBU Writing output/categories/index.html
DEBU Writing output/authors/index.html
DEBU Writing output/tags/index.html
DEBU Writing output/posts/index.html
DEBU Writing output/authors/snow/index.html
DEBU Writing output/tags/snow/index.html
DEBU Writing output/categories/linux/index.html
DEBU Writing output/tags/linux/index.html
DEBU Writing output/tags/emacs/index.html
DEBU Writing output/categories/linux/emacs/index.html
INFO Done: Page Processed 1 normal pages, 0 hidden pages, 0 section pages in 10.087804ms
INFO Done: Section Processed 1 posts in 10.1831ms
INFO Done: Taxonomy Processed 1 authors, 3 tags, 1 categories in 10.18788ms&lt;/pre&gt;

&lt;h3 id=&quot;heading-1.2&quot;&gt;安装(Installation)&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ git install https://github.com/honmaple/snow&lt;/pre&gt;

&lt;h3 id=&quot;heading-1.3&quot;&gt;编译(Build)&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ git clone https://github.com/honmaple/snow --depth=1
└──╼ cd snow
└──╼ go mod tidy
└──╼ go build .&lt;/pre&gt;

&lt;h3 id=&quot;heading-1.4&quot;&gt;命令行(Cli usage)&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow --help
NAME:
   snow - snow is a static site generator.

USAGE:
   snow [global options] command [command options] [arguments...]

VERSION:
   0.1.0

COMMANDS:
   init     init a new site
   build    build and output
   server   server local files
   help, h  Shows a list of commands or help for one command

GLOBAL OPTIONS:
   --config FILE, -c FILE  load configuration from FILE (default: &amp;#34;config.yaml&amp;#34;)
   --help, -h            show help (default: false)
   --version, -v         print the version (default: false)&lt;/pre&gt;
&lt;h4 id=&quot;heading-1.4.1&quot;&gt;init&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow init
└──╼ ./snow init myblog&lt;/pre&gt;
&lt;p&gt;
     如果不指定 &lt;b&gt;myblog&lt;/b&gt; 目录，默认会在当前目录下生成一个 &lt;b&gt;config.yaml&lt;/b&gt; 文件和一个 &lt;b&gt;content&lt;/b&gt; 目录
&lt;/p&gt;
&lt;h4 id=&quot;heading-1.4.2&quot;&gt;build&lt;/h4&gt;
&lt;p&gt;
     该命令会构建站点内容内写入到 &lt;b&gt;{output_dir}&lt;/b&gt; 目录, 如果该目录已经有文件存在，除非制定 &lt;code&gt;-C&lt;/code&gt; 参数，否则不会自动清理
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 清理输出目录
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow build --clean
└──╼ ./snow build -C&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 显示输出详情
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow build --debug
└──╼ ./snow build -D&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 指定输出目录
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow build --output {output_dir}
└──╼ ./snow build -o {output_dir}&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 指定mode
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow build --mode {mode}
└──╼ ./snow build -m {mode}&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 筛选页面
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow build --filter {build_filter}
└──╼ ./snow build -F {build_filter}&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 显示所有hooks
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow build --hooks&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;heading-1.4.3&quot;&gt;server&lt;/h4&gt;
&lt;p&gt;
     build 支持的命令 server也同样支持, 除此之外，还有
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 指定监听地址
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow server --listen 127.0.0.1:8088
└──╼ ./snow server -l 127.0.0.1:8088&lt;/pre&gt;
&lt;p&gt;
       默认监听地址是 &lt;code&gt;site.url&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 监听文件修改并重新构建
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;└──╼ ./snow server --autoload
└──╼ ./snow server -r&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-1.5&quot;&gt;目录结构(Driectory structure)&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;.
├── config.yaml
├── content
│   └── posts
│       └── first-page.md
├── static
├── layouts
└── themes
│   └── snow
│       └── static
│       └── template&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;config.yaml&lt;/b&gt;:
      使用的配置文件
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;content&lt;/b&gt;:
      包括所有的页面内容, 比如 &lt;code&gt;.md&lt;/code&gt;, &lt;code&gt;.org&lt;/code&gt; 等,如果一个子目录包括 &lt;code&gt;index.{md,org}&lt;/code&gt; 文件，那么这个目录将会成为一个页面，否则每一个子目录都是一个 &lt;b&gt;section&lt;/b&gt;, 同样的，子目录下 &lt;code&gt;_index.{md,org}&lt;/code&gt; 文件也是该 &lt;b&gt;section&lt;/b&gt; 的配置文件
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;static&lt;/b&gt;:
      &lt;code&gt;statics&lt;/code&gt; 指定的静态文件或目录，名称可修改
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;layouts&lt;/b&gt;: 主题模版覆盖目录
      &lt;code&gt;theme.override&lt;/code&gt; 指定的主题覆盖文件，比如有一个主题模版 &lt;code&gt;{theme}/templates/post.html&lt;/code&gt;, 当指定了 &lt;code&gt;override&lt;/code&gt; 目录后就可以在该目录创建一个同样名称为 &lt;code&gt;post.html&lt;/code&gt; 的文件进行覆盖
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;themes&lt;/b&gt;:
      主题目录, 该目录下包括的子目录就是主题名称，可以在 &lt;code&gt;theme.name&lt;/code&gt; 里指定
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-1.6&quot;&gt;配置文件(Configuration)&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;# 站点配置信息&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;site&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;url&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;http://127.0.0.1:8000&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;title&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;snow&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;subtitle&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Snow is a static generator.&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;language&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;zh&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;author&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;honmaple&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#75715e&quot;&gt;# 发布时使用的配置&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;mode.publish&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;site&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;url&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;https://honmaple.me&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;output_dir&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;output&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;content_dir&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;build_filter&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;not draft&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;theme&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;snow&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#75715e&quot;&gt;# 按照主题需要进行配置&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;params.extra&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;menus&lt;/span&gt;:
    - &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;关于&amp;#34;&lt;/span&gt;
      &lt;span style=&quot;color:#66d9ef&quot;&gt;url&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;/pages/about.html&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;h2 id=&quot;heading-2&quot;&gt;内容管理&lt;/h2&gt;
&lt;h3 id=&quot;heading-2.1&quot;&gt;Section&lt;/h3&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;content/
├── pages             // no url, because sections.pages.path is &amp;#34;&amp;#34;
│   └── about         // &amp;lt;- http://127.0.0.1:8000/pages/about.html
│       └── index.org // no url
│   └── contact.org   // &amp;lt;- http://127.0.0.1:8000/pages/contact.html
└── posts             // &amp;lt;- http://127.0.0.1:8000/posts/index.html
    ├── post1.org     // &amp;lt;- http://127.0.0.1:8000/posts/2022/02/post1.html
    └── subposts      // &amp;lt;- http://127.0.0.1:8000/posts/subposts/index.html
        └── post2.org // &amp;lt;- http://127.0.0.1:8000/posts/2023/02/post2.html&lt;/pre&gt;
&lt;h4 id=&quot;heading-2.1.1&quot;&gt;配置&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;sections&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;_default&lt;/span&gt;:
    &lt;span style=&quot;color:#75715e&quot;&gt;# 页面默认排序, 多字段使用逗号分隔&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;orderby&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;date desc&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 自定义某个section下的页面筛选&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;filter&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 页面默认分页, path必须使用{number}变量, 0表示不分页&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;paginate&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;10&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 分页路径&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;paginate_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{name}{number}{extension}&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 分页前筛选pages&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;paginate_filter&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 生成路径, 为空表示禁止生成相关页面&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{section}/index.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 使用的模版&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;section.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 当前section下所有页面生成路径&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;page_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{section}/{slug}/index.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 页面使用的模版&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;page_template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;post.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;formats.atom&lt;/span&gt;:
      &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{section:slug}/atom.xml&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;posts&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;page_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;posts/{date:%Y}/{date:%m}/{slug}.html&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;pages&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;pages/about&lt;/span&gt;:
    &lt;span style=&quot;color:#75715e&quot;&gt;# 自定义pages/about下的页面生成路径，同时继承pages.path不会生成所有页面&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;page_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{slug}/index.html&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
     &lt;b&gt;filter&lt;/b&gt; 格式(下同):
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&amp;#39;emacs&amp;#39; in tags and not draft or weight &amp;gt; 1&lt;/pre&gt;
&lt;p&gt;
     其中 &lt;b&gt;tags&lt;/b&gt;, &lt;b&gt;draft&lt;/b&gt; 等都是page元数据
&lt;/p&gt;

&lt;h4 id=&quot;heading-2.1.2&quot;&gt;路径变量(&lt;b&gt;sections.xxx.path&lt;/b&gt;)&lt;/h4&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;{section}&lt;/td&gt;
&lt;td&gt;section名称&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{section:slug}&lt;/td&gt;
&lt;td&gt;section slug, 中国 -&amp;gt; zhong-guo&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;h4 id=&quot;heading-2.1.3&quot;&gt;模版变量(&lt;b&gt;sections.xxx.template&lt;/b&gt;)&lt;/h4&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;section&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;section.Title&lt;/td&gt;
&lt;td&gt;section标题&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;section.Path&lt;/td&gt;
&lt;td&gt;section相对链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;section.Permalink&lt;/td&gt;
&lt;td&gt;section绝对链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;section.Content&lt;/td&gt;
&lt;td&gt;section内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;section.Pages&lt;/td&gt;
&lt;td&gt;当前section下的页面列表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;section.Children&lt;/td&gt;
&lt;td&gt;子section&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;section.Parent&lt;/td&gt;
&lt;td&gt;父section&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;h3 id=&quot;heading-2.2&quot;&gt;页面(Page)&lt;/h3&gt;
&lt;h4 id=&quot;heading-2.2.1&quot;&gt;元数据&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 markdown
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;---
title: &amp;#34;title&amp;#34;
categories:
  - Snow/Templates
tags:
  - linux
  - snow
---&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 orgmode
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;#+TITLE: title
#+DATE: 2022-02-26 17:14:46
#+CATEGORIES: Snow/Templates
#+PROPERTY: TAGS linux,snow
#+PROPERTY: MODIFIED 2023-02-26 14:35:37&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 html
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;head&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;title&lt;/span&gt;&amp;gt;Project&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;title&lt;/span&gt;&amp;gt;
  &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;meta&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;categories&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;content&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;Snow/Templates&amp;#34;&lt;/span&gt; /&amp;gt;
  &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;meta&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;tags&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;content&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;linux,snow&amp;#34;&lt;/span&gt; /&amp;gt;
  &amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;meta&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;name&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;date&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;content&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;2015-12-22&amp;#34;&lt;/span&gt; /&amp;gt;
&amp;lt;/&lt;span style=&quot;color:#f92672&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;heading-2.2.2&quot;&gt;配置&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;# 页面目录所在, 其中该目录下应该包括一系列子目录，这些子目录的名称对应为 *页面的类型*, 比如 *content/drafts/* 目录下的 页面类型为 *drafts*, 当然也可以直接在 页面文件头添加 =type: drafts=&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;content_dir&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;h4 id=&quot;heading-2.2.3&quot;&gt;路径变量(&lt;b&gt;sections.xxx.page_path&lt;/b&gt;)&lt;/h4&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;{date:%Y}&lt;/td&gt;
&lt;td&gt;创建页面的年份&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{date:%m}&lt;/td&gt;
&lt;td&gt;创建页面的月份&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{date:%d}&lt;/td&gt;
&lt;td&gt;创建页面的日期&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{date:%H}&lt;/td&gt;
&lt;td&gt;创建页面的小时&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{lang}&lt;/td&gt;
&lt;td&gt;页面语言&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{slug}&lt;/td&gt;
&lt;td&gt;页面标题或自定义slug&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{filename}&lt;/td&gt;
&lt;td&gt;文件名称(不带后缀名)&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;h4 id=&quot;heading-2.2.4&quot;&gt;模版变量(&lt;b&gt;sections.xxx.page_template&lt;/b&gt;)&lt;/h4&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;page&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Title&lt;/td&gt;
&lt;td&gt;页面标题&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Lang&lt;/td&gt;
&lt;td&gt;页面语言&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Date&lt;/td&gt;
&lt;td&gt;页面创建时间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Modified&lt;/td&gt;
&lt;td&gt;页面修改时间&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Aliases&lt;/td&gt;
&lt;td&gt;页面其它链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Path&lt;/td&gt;
&lt;td&gt;页面相对链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Permalink&lt;/td&gt;
&lt;td&gt;页面绝对链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Summary&lt;/td&gt;
&lt;td&gt;页面简介&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Content&lt;/td&gt;
&lt;td&gt;页面内容&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Meta.xxx&lt;/td&gt;
&lt;td&gt;自定义的元数据&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Prev&lt;/td&gt;
&lt;td&gt;上一篇&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.Next&lt;/td&gt;
&lt;td&gt;下一篇&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.HasPrev()&lt;/td&gt;
&lt;td&gt;是否有上一篇&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.HasNext()&lt;/td&gt;
&lt;td&gt;是否有下一篇&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.PrevInType&lt;/td&gt;
&lt;td&gt;同一类型上一篇&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.NextInType&lt;/td&gt;
&lt;td&gt;同一类型下一篇&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.HasPrevInType()&lt;/td&gt;
&lt;td&gt;是否有同一类型上一篇&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;page.HasNextInType()&lt;/td&gt;
&lt;td&gt;是否有同一类型下一篇&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;h3 id=&quot;heading-2.3&quot;&gt;分类系统(Taxonomy)&lt;/h3&gt;
&lt;h4 id=&quot;heading-2.3.1&quot;&gt;配置&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;taxonomies&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;_default&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{taxonomy}/index.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# terms排序, 可选name,count&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;orderby&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{taxonomy}/list.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{taxonomy}/{term:slug}/index.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{taxonomy}/single.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 页面列表筛选&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_filter&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 页面列表排序&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_orderby&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;date desc&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 页面列表分页&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_paginate&lt;/span&gt;: &lt;span style=&quot;color:#ae81ff&quot;&gt;0&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_paginate_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_paginate_filter&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;categories&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;authors&lt;/span&gt;:
  tags:&lt;/pre&gt;

&lt;h4 id=&quot;heading-2.3.2&quot;&gt;路径变量&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;taxonomies.xxx.path&lt;/b&gt;
&lt;/p&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;{taxonomy}&lt;/td&gt;
&lt;td&gt;分类系统名称&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;taxonomies.xxx.term_path&lt;/b&gt;
&lt;/p&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;{taxonomy}&lt;/td&gt;
&lt;td&gt;分类系统名称&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{term}&lt;/td&gt;
&lt;td&gt;分类具体名称&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{term:slug}&lt;/td&gt;
&lt;td&gt;分类slug&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;heading-2.3.3&quot;&gt;模版变量&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;taxonomies.xxx.template&lt;/b&gt;
&lt;/p&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;taxonomy&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;taxonomy.Name&lt;/td&gt;
&lt;td&gt;分类系统名称, 如:categories,tags,authors&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;taxonomy.Terms&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;taxonomies.xxx.term_template&lt;/b&gt;
&lt;/p&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;term&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;term.Name&lt;/td&gt;
&lt;td&gt;分类名称&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;term.Path&lt;/td&gt;
&lt;td&gt;相对链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;term.Permalink&lt;/td&gt;
&lt;td&gt;绝对链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;term.List&lt;/td&gt;
&lt;td&gt;页面列表&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;term.Children&lt;/td&gt;
&lt;td&gt;子分类&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-2.4&quot;&gt;归档页(Archive)&lt;/h3&gt;
&lt;p&gt;
    &lt;b&gt;snow&lt;/b&gt; 中的分类系统是基于归档实现的，该功能类似 &lt;b&gt;SQL&lt;/b&gt; 中的 &lt;code&gt;group by&lt;/code&gt;, 所以如果要实现归档页可以有两种方式:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 添加 &lt;code&gt;taxonomies.{key}&lt;/code&gt;, &lt;code&gt;{key}&lt;/code&gt; 可以是页面元数据里的任意字段, 比如 &lt;code&gt;categories&lt;/code&gt;, &lt;code&gt;tags&lt;/code&gt;, 如果需要按照时间归档, 格式为 &lt;code&gt;date:2006/01&lt;/code&gt;, 其中 &lt;code&gt;2006/01&lt;/code&gt; 为Go时间格式，表示按年月归档, 并生成链接 &lt;b&gt;/archives/2022/10/index.html&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;taxonomies&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;date:2006/01&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;archives/index.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;archives.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;archives/{term}/index.html&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;term_template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;period_archives.html&amp;#34;&lt;/span&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 在 &lt;code&gt;{content_dir}&lt;/code&gt; 下添加一个 &lt;code&gt;archives.md&lt;/code&gt; 的文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;path: archives.html
template: archives.html
section: true&lt;/pre&gt;
&lt;p&gt;
       然后在模板 &lt;code&gt;{templates}/archives.html&lt;/code&gt; 使用 &lt;code&gt;pages.GroupBy({key})&lt;/code&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{%- for subterm in pages.GroupBy(&amp;#34;date:2006-01&amp;#34;).OrderBy(&amp;#34;name desc&amp;#34;) %}
  {%- set date = subterm.Name | split:&amp;#34;-&amp;#34; %}
  {%- set year = date[0] %}
  {%- set month = date[1] %}
   ...
{%- endfor %}&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;heading-2.5&quot;&gt;分页(Pagination)&lt;/h3&gt;
&lt;h4 id=&quot;heading-2.5.1&quot;&gt;路径变量&lt;/h4&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;{name}&lt;/td&gt;
&lt;td&gt;路径名称&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{extension}&lt;/td&gt;
&lt;td&gt;路径扩展&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{number}&lt;/td&gt;
&lt;td&gt;页码, 第一页为空&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;{number:one}&lt;/td&gt;
&lt;td&gt;页码, 第一页为&amp;#34;1&amp;#34;&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 示例一:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;section/index.html&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;paginate_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{name}{number}{extension}&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 第一页: &lt;code&gt;section/index.html&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 第二页: &lt;code&gt;section/index2.html&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 第三页: &lt;code&gt;section/index3.html&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 示例二:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;section/index.html&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;paginate_path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;page/{number:one}{extension}&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 第一页: &lt;code&gt;section/page/1.html&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 第二页: &lt;code&gt;section/page/2.html&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 第三页: &lt;code&gt;section/page/3.html&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;heading-2.5.2&quot;&gt;模版变量&lt;/h4&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;paginator&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.URL&lt;/td&gt;
&lt;td&gt;分页链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.PageNum&lt;/td&gt;
&lt;td&gt;当前页&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.Total&lt;/td&gt;
&lt;td&gt;总页数&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.HasPrev()&lt;/td&gt;
&lt;td&gt;是否有上一页&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.Prev&lt;/td&gt;
&lt;td&gt;上一页&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.Prev.URL&lt;/td&gt;
&lt;td&gt;上一页链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.HasNext()&lt;/td&gt;
&lt;td&gt;是否有下一页&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.Next&lt;/td&gt;
&lt;td&gt;下一页&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.Next.URL&lt;/td&gt;
&lt;td&gt;下一页链接&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.All&lt;/td&gt;
&lt;td&gt;所有页&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;paginator.List&lt;/td&gt;
&lt;td&gt;当前分页下的页面列表&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;h3 id=&quot;heading-2.6&quot;&gt;草稿(Draft)&lt;/h3&gt;
&lt;p&gt;
    使用者可以自定义草稿标志，但推荐使用两种形式:
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 添加元数据 &lt;code&gt;draft: true&lt;/code&gt;, 构建时增加筛选条件
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;草稿&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;snow build --filter &amp;#39;draft = true&amp;#39;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;非草稿&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;snow build -F &amp;#39;not draft&amp;#39;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 创建一个单独的 &lt;code&gt;drafts&lt;/code&gt; 目录存放草稿
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;草稿&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;snow build -F &amp;#39;type = &amp;#34;drafts&amp;#34;&amp;#39;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;b&gt;非草稿&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;snow build -F &amp;#39;type != &amp;#34;drafts&amp;#34;&amp;#39;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;
    注: 默认筛选条件可以写入配置 &lt;code&gt;build_filter&lt;/code&gt;
&lt;/p&gt;
&lt;h3 id=&quot;heading-2.7&quot;&gt;输出格式(Atom,Rss,JSON)&lt;/h3&gt;
&lt;p&gt;
    可以生成 &lt;b&gt;rss&lt;/b&gt; ，&lt;b&gt;atom&lt;/b&gt; 或者其它任意格式(需要自定义模版)
&lt;/p&gt;
&lt;h4 id=&quot;heading-2.7.1&quot;&gt;配置&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;# 设置rss格式的默认值&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;formats.rss&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;_internal/rss.xml&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;formats.atom&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;_internal/atom.xml&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;sections&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;_default&lt;/span&gt;:
    &lt;span style=&quot;color:#75715e&quot;&gt;# rss生成路径, 模版将会使用默认模版&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;formats.rss.path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{section:slug}/index.xml&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 为空时禁止生成&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;formats.atom.path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;taxonomies&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;tags&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;formats.atom&lt;/span&gt;:
      &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;tags/{term:slug}/index.xml&amp;#34;&lt;/span&gt;
      &lt;span style=&quot;color:#75715e&quot;&gt;# 自定义模版&lt;/span&gt;
      &lt;span style=&quot;color:#66d9ef&quot;&gt;template&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;custom.atom.xml&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;h4 id=&quot;heading-2.7.2&quot;&gt;模版变量&lt;/h4&gt;
&lt;table&gt;

&lt;tr&gt;
&lt;th&gt;变量&lt;/th&gt;
&lt;th&gt;描述&lt;/th&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;section&lt;/td&gt;
&lt;td&gt;仅生成section 有效&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;term&lt;/td&gt;
&lt;td&gt;仅生成taxonomy term 有效&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pages&lt;/td&gt;
&lt;td&gt;页面列表&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;h3 id=&quot;heading-2.8&quot;&gt;静态文件(Static)&lt;/h3&gt;
&lt;p&gt;
    静态文件分 &lt;b&gt;主题静态文件&lt;/b&gt; 和 &lt;b&gt;配置指定的静态文件&lt;/b&gt;
&lt;/p&gt;

&lt;h4 id=&quot;heading-2.8.1&quot;&gt;主题静态文件&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;├── themes
│   └── snow
│       └── static
│           └── main.css&lt;/pre&gt;
&lt;p&gt;
     主题目录下的所有文件默认会复制到 &lt;b&gt;output&lt;/b&gt; 目录, 除非设置 &lt;code&gt;statics.@theme/static.path&lt;/code&gt; 为空
&lt;/p&gt;

&lt;h4 id=&quot;heading-2.8.2&quot;&gt;指定的静态文件&lt;/h4&gt;
&lt;p&gt;
     该文件需要在配置指定
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;statics&lt;/span&gt;:
  &lt;span style=&quot;color:#75715e&quot;&gt;# 根目录下static目录下的文件将会拷贝到{output_dir}/static&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;static&lt;/span&gt;:
    &lt;span style=&quot;color:#75715e&quot;&gt;# 拷贝的路径, 为空时表示不写入, 如果以&amp;#34;/&amp;#34;结尾, 表示拷贝到该目录&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# static  -&amp;gt; {output_dir}/static&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# static/ -&amp;gt; {output_dir}/static/static&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 指定扩展，不配置将会使用目录下的所有文件&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;exts&lt;/span&gt;:
      - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;.js&amp;#34;&lt;/span&gt;
      - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;.css&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#75715e&quot;&gt;# 如果指定的静态文件是一个目录，可以设置忽略文件, 比如忽略static目录下的images子目录&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;ignore_files&lt;/span&gt;:
      - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;^images/&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#75715e&quot;&gt;# 以@theme/开头表示主题目录, 以@theme/_internal/开头表示内置的主题目录&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;@theme/static&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;static&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;@theme/_internal/static&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;static&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#75715e&quot;&gt;# 同样可以指定任意静态文件或目录&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;content/pages/css&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;static/css&amp;#34;&lt;/span&gt;&lt;/pre&gt;

&lt;h3 id=&quot;heading-2.9&quot;&gt;多语言(Multilingual)&lt;/h3&gt;
&lt;p&gt;
    需要配置 &lt;code&gt;languages&lt;/code&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;languages.en&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;translations&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;i18n/en.yaml&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;languages.fr&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;translations&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;i18n/fr.yaml&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
    页面格式:
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;code&gt;{title}.en.md&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;code&gt;{title}.fr.md&lt;/code&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;
    或者可以在文件头指定 &lt;code&gt;lang: en&lt;/code&gt;
&lt;/p&gt;

&lt;h2 id=&quot;heading-3&quot;&gt;模版(templates)&lt;/h2&gt;
&lt;p&gt;
   &lt;a href=&quot;https://github.com/flosch/pongo2&quot;&gt;https://github.com/flosch/pongo2&lt;/a&gt;
&lt;/p&gt;
&lt;h2 id=&quot;heading-4&quot;&gt;主题(theme)&lt;/h2&gt;
&lt;h3 id=&quot;heading-4.1&quot;&gt;安装&lt;/h3&gt;
&lt;h3 id=&quot;heading-4.2&quot;&gt;开发&lt;/h3&gt;
&lt;h4 id=&quot;heading-4.2.1&quot;&gt;主题目录结构&lt;/h4&gt;
&lt;p&gt;
     其中 &lt;b&gt;templates&lt;/b&gt; 和 &lt;b&gt;static&lt;/b&gt; 名称不可修改
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;simple/
├── templates
│   ├── post.html
│   ├── index.html
│   ├── archives.html
├── static
│   ├── main.css&lt;/pre&gt;
&lt;h4 id=&quot;heading-4.2.2&quot;&gt;配置&lt;/h4&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;theme&lt;/span&gt;:
  &lt;span style=&quot;color:#75715e&quot;&gt;# 主题名称, 未设置将使用默认主题&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;name&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;test-theme&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#75715e&quot;&gt;# 主题模版覆盖, 增加同名的文件到 *override* 配置的目录, snow将会优先使用该文件&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;override&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;layouts&amp;#34;&lt;/span&gt;&lt;/pre&gt;

&lt;h4 id=&quot;heading-4.2.3&quot;&gt;&lt;span class=&quot;todo&quot;&gt;TODO&lt;/span&gt;默认配置&lt;/h4&gt;

&lt;h2 id=&quot;heading-5&quot;&gt;插件(hooks)&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;hooks&lt;/span&gt;:
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;i18n&amp;#34;&lt;/span&gt;
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;assets&amp;#34;&lt;/span&gt;
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;encrypt&amp;#34;&lt;/span&gt;
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;shortcode&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;h3 id=&quot;heading-5.1&quot;&gt;i18n&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 模版
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{% i18n &amp;#34;tags&amp;#34; %}
{% T &amp;#34;tags %d&amp;#34; 12 %}
{{ i18n(&amp;#34;authors&amp;#34;) }}
{{ T(&amp;#34;authors&amp;#34;) }}
{{ _(&amp;#34;authors %f&amp;#34;, 3.14) }}&lt;/pre&gt;
&lt;p&gt;
       甚至可以直接使用变量
       {{ _(term.Name) }}
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 翻译文件
       默认会加载主题下 &lt;b&gt;i18n&lt;/b&gt; 目录下的文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;i18n
├── en.yaml
└── zh.yaml&lt;/pre&gt;
&lt;p&gt;
       文件内容
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;---
- &lt;span style=&quot;color:#66d9ef&quot;&gt;id&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;authors&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;tr&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;作者&amp;#34;&lt;/span&gt;
- &lt;span style=&quot;color:#66d9ef&quot;&gt;id&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;tags&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;tr&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;标签&amp;#34;&lt;/span&gt;&lt;/pre&gt;

&lt;p&gt;
       也可以自定义文件位置或翻译内容覆盖主题原有的翻译
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;languages.en&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;translations&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;i18n/en.yaml&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;languages.zh&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;translations&lt;/span&gt;:
    - &lt;span style=&quot;color:#66d9ef&quot;&gt;id&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;authors&amp;#34;&lt;/span&gt;
      &lt;span style=&quot;color:#66d9ef&quot;&gt;tr&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;作者&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;heading-5.2&quot;&gt;encrypt&lt;/h3&gt;
&lt;p&gt;
     内容加密, 需要一个密码
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{{ page.Content | encrypt:&amp;#34;123456&amp;#34; }}&lt;/pre&gt;

&lt;h3 id=&quot;heading-5.3&quot;&gt;shortcode&lt;/h3&gt;
&lt;p&gt;
     用于快速插入已有模版, 示例:
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&amp;lt;shortcode _name=&amp;#34;encrypt&amp;#34; password=&amp;#34;1234567&amp;#34;&amp;gt;
hello *markdown*
&amp;lt;/shortcode&amp;gt;

&amp;lt;shortcode _name=&amp;#34;gist&amp;#34; author=&amp;#34;spf13&amp;#34; id=&amp;#34;7896402&amp;#34; /&amp;gt;&lt;/pre&gt;

&lt;p&gt;
     可以自定义 &lt;b&gt;shortcode&lt;/b&gt; 到主题的 &lt;code&gt;templates/shortcodes&lt;/code&gt; 目录下, 目前内置 &lt;b&gt;gist&lt;/b&gt;, &lt;b&gt;encrypt&lt;/b&gt;
&lt;/p&gt;
&lt;h3 id=&quot;heading-5.4&quot;&gt;assets&lt;/h3&gt;
&lt;p&gt;
     静态文件处理
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;params.assets&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;css&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;files&lt;/span&gt;:
      - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;@theme/static/scss/main.scss&amp;#34;&lt;/span&gt;
      - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;@theme/static/scss/entry.scss&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;filters&lt;/span&gt;:
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;libscss&lt;/span&gt;:
          &lt;span style=&quot;color:#66d9ef&quot;&gt;path&lt;/span&gt;: [&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;@theme/static/scss/&amp;#34;&lt;/span&gt;]
      - &lt;span style=&quot;color:#66d9ef&quot;&gt;cssmin&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;output&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;static/lib.min.css&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{% assets files=&amp;#34;css/style.scss&amp;#34; filters=&amp;#34;libsass,cssmin&amp;#34; output=&amp;#34;css/style.min.css&amp;#34; %}
&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;link&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;rel&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;stylesheet&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;href&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{{ config.site.url }}/{{ asset_url }}&amp;#34;&lt;/span&gt;&amp;gt;
{% endassets %}

{% assets css %}
&amp;lt;&lt;span style=&quot;color:#f92672&quot;&gt;link&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;rel&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;stylesheet&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;href&lt;/span&gt;&lt;span style=&quot;color:#f92672&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;{{ config.site.url }}/{{ asset_url }}&amp;#34;&lt;/span&gt;&amp;gt;
{% endassets %}&lt;/pre&gt;
&lt;h3 id=&quot;heading-5.5&quot;&gt;sofile&lt;/h3&gt;
&lt;p&gt;
    &lt;b&gt;sofile&lt;/b&gt; 允许使用Go的 &lt;code&gt;Plugin&lt;/code&gt; 系统支持自定义插件
&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 创建一个 &lt;code&gt;sofile.go&lt;/code&gt; 的文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#f92672&quot;&gt;package&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;main&lt;/span&gt;

&lt;span style=&quot;color:#f92672&quot;&gt;import&lt;/span&gt; (
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;

    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/honmaple/snow/builder/hook&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/honmaple/snow/builder/page&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/honmaple/snow/builder/theme&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;github.com/honmaple/snow/config&amp;#34;&lt;/span&gt;
)

&lt;span style=&quot;color:#66d9ef&quot;&gt;type&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;testHook&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;struct&lt;/span&gt; {
    &lt;span style=&quot;color:#a6e22e&quot;&gt;hook&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;BaseHook&lt;/span&gt;
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;testHook&lt;/span&gt;) &lt;span style=&quot;color:#a6e22e&quot;&gt;Name&lt;/span&gt;() &lt;span style=&quot;color:#66d9ef&quot;&gt;string&lt;/span&gt; {
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;testHook&lt;/span&gt;) &lt;span style=&quot;color:#a6e22e&quot;&gt;AfterPageParse&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;page&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;page&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Page&lt;/span&gt;) &lt;span style=&quot;color:#f92672&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;page&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Page&lt;/span&gt; {
    &lt;span style=&quot;color:#a6e22e&quot;&gt;fmt&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Println&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;page&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Title&lt;/span&gt;)
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;page&lt;/span&gt;
}

&lt;span style=&quot;color:#66d9ef&quot;&gt;func&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;NewHook&lt;/span&gt;(&lt;span style=&quot;color:#a6e22e&quot;&gt;conf&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;config&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Config&lt;/span&gt;, &lt;span style=&quot;color:#a6e22e&quot;&gt;theme&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;theme&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Theme&lt;/span&gt;) &lt;span style=&quot;color:#a6e22e&quot;&gt;hook&lt;/span&gt;.&lt;span style=&quot;color:#a6e22e&quot;&gt;Hook&lt;/span&gt; {
    &lt;span style=&quot;color:#66d9ef&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color:#a6e22e&quot;&gt;testHook&lt;/span&gt;{}
}&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 编译为so文件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;go build -buildmode=plugin sofile.go&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 注册插件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;hooks&lt;/span&gt;:
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;sofile&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#66d9ef&quot;&gt;params.sofiles&lt;/span&gt;:
  - &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;sofile.so&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-6&quot;&gt;本地测试和正式发布&lt;/h2&gt;
&lt;p&gt;
   snow 提供了 &lt;b&gt;mode&lt;/b&gt; 配置用于区分本地测试和正式发布
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#66d9ef&quot;&gt;site&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;url&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;http://127.0.0.1:8000&amp;#34;&lt;/span&gt;
  &lt;span style=&quot;color:#66d9ef&quot;&gt;output_dir&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;output&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;mode.publish&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;site&lt;/span&gt;:
    &lt;span style=&quot;color:#66d9ef&quot;&gt;url&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;https://example.com&amp;#34;&lt;/span&gt;
    &lt;span style=&quot;color:#66d9ef&quot;&gt;output_dir&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;xxx&amp;#34;&lt;/span&gt;

&lt;span style=&quot;color:#66d9ef&quot;&gt;mode.develop&lt;/span&gt;:
  &lt;span style=&quot;color:#66d9ef&quot;&gt;include&lt;/span&gt;: &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;develop.yaml&amp;#34;&lt;/span&gt;&lt;/pre&gt;
&lt;p&gt;
   只要在构建时使用 &lt;code&gt;snow build --mode publish&lt;/code&gt; 即可覆盖本地默认配置
&lt;/p&gt;</content>
        <category term="Linux"></category>
    </entry>
    <entry xml:lang="zh">
      <title>Emacs笔记之minibuffer默认输入</title>
      <link href="" rel="alternate"></link>
      <published>Thu, 25 Nov 2021 22:14:00 +0000</published>
      <updated>Fri, 24 Feb 2023 08:12:33 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2021/11/Emacs笔记之minibuffer默认输入.html" type="text/html"/>
      <id>https://honmaple.me/articles/2021/11/Emacs笔记之minibuffer默认输入.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
在使用 &lt;b&gt;evil-ex&lt;/b&gt;，也就是冒号+命令时，有一个非常有趣的功能，输入冒号后，&lt;b&gt;minibuffer&lt;/b&gt; 会显示上一次执行的命令，比如 &lt;code&gt;:wq&lt;/code&gt;, 确认可以直接执行这个命令，但是输入任意字符，就会把原先的 &lt;code&gt;wq&lt;/code&gt; 直接覆盖，接收新的命令输入
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
我觉得这是一个非常有趣且有用的功能，像 &lt;code&gt;read-string&lt;/code&gt; 函数，如果我想要一个默认的输入，可以直接使用
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(let ((input (&lt;span style=&quot;color:#a6e22e&quot;&gt;read-string&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;prompt: &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;默认内容&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)))
  (&lt;span style=&quot;color:#a6e22e&quot;&gt;message&lt;/span&gt; input))&lt;/pre&gt;
&lt;p&gt;
但我想覆盖这个默认...&lt;/p&gt;</summary>
      <content type="html">
&lt;blockquote&gt;
&lt;p&gt;
在使用 &lt;b&gt;evil-ex&lt;/b&gt;，也就是冒号+命令时，有一个非常有趣的功能，输入冒号后，&lt;b&gt;minibuffer&lt;/b&gt; 会显示上一次执行的命令，比如 &lt;code&gt;:wq&lt;/code&gt;, 确认可以直接执行这个命令，但是输入任意字符，就会把原先的 &lt;code&gt;wq&lt;/code&gt; 直接覆盖，接收新的命令输入
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
我觉得这是一个非常有趣且有用的功能，像 &lt;code&gt;read-string&lt;/code&gt; 函数，如果我想要一个默认的输入，可以直接使用
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(let ((input (&lt;span style=&quot;color:#a6e22e&quot;&gt;read-string&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;prompt: &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;默认内容&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)))
  (&lt;span style=&quot;color:#a6e22e&quot;&gt;message&lt;/span&gt; input))&lt;/pre&gt;
&lt;p&gt;
但我想覆盖这个默认, 则需要先把 &lt;code&gt;默认内容&lt;/code&gt; 删除，再输入我想要的字符, 如果不想先删除默认再输入，还可以使用
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(let ((input (&lt;span style=&quot;color:#a6e22e&quot;&gt;read-string&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;prompt: &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;默认内容&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)))
  (&lt;span style=&quot;color:#a6e22e&quot;&gt;message&lt;/span&gt; input))&lt;/pre&gt;
&lt;p&gt;
但是这样的话我无法看到默认的内容，当然，也许可以把默认内容追加到 &lt;code&gt;prompt&lt;/code&gt; 里，我认为这样不太好看，不是吗
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(let* ((default &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;默认内容&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
       (input (&lt;span style=&quot;color:#a6e22e&quot;&gt;read-string&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;format&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;prompt (default %s): &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; default) &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; default)))
  (&lt;span style=&quot;color:#a6e22e&quot;&gt;message&lt;/span&gt; input))&lt;/pre&gt;

&lt;p&gt;
&lt;code&gt;evil-ex&lt;/code&gt; 提示我一个新的解决方式, 通过查看 &lt;code&gt;evil-ex&lt;/code&gt; 源码，可以发现它是使用 &lt;code&gt;minibuffer-with-setup-hook&lt;/code&gt; 和 &lt;code&gt;after-change-functions&lt;/code&gt; 在&lt;b&gt;minibuffer&lt;/b&gt;里插入新内容时先清理默认内容, 再插入新内容, 我简化了相关代码
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(let ((input (minibuffer-with-setup-hook &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;maple-input-setup&lt;/span&gt;
               (&lt;span style=&quot;color:#a6e22e&quot;&gt;read-string&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;prompt: &lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;propertize&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;默认内容&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;face&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;shadow&lt;/span&gt;)))))
  (&lt;span style=&quot;color:#a6e22e&quot;&gt;message&lt;/span&gt; input))

(defun maple-input-setup()
  (add-hook &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;after-change-functions&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;maple-input-update&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;t&lt;/span&gt;))

(defun maple-input-update(&lt;span style=&quot;color:#66d9ef&quot;&gt;&amp;amp;optional&lt;/span&gt; beg end len &lt;span style=&quot;color:#a6e22e&quot;&gt;string&lt;/span&gt;)
  (let ((&lt;span style=&quot;color:#a6e22e&quot;&gt;string&lt;/span&gt; (&lt;span style=&quot;color:#a6e22e&quot;&gt;buffer-substring-no-properties&lt;/span&gt; beg end)))
    (delete-minibuffer-contents)
    (&lt;span style=&quot;color:#a6e22e&quot;&gt;insert&lt;/span&gt; &lt;span style=&quot;color:#a6e22e&quot;&gt;string&lt;/span&gt;)
    (remove-hook &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;after-change-functions&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;maple-input-update&lt;/span&gt; &lt;span style=&quot;color:#66d9ef&quot;&gt;t&lt;/span&gt;)))&lt;/pre&gt;

&lt;p&gt;
OK, 就这样
&lt;/p&gt;</content>
        <category term="Linux/Emacs"></category>
    </entry>
    <entry xml:lang="zh">
      <title>Emacs自动插入更新文件头——maple-header</title>
      <link href="" rel="alternate"></link>
      <published>Wed, 06 Oct 2021 14:57:51 +0000</published>
      <updated>Thu, 06 Apr 2023 13:11:13 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2021/10/Emacs自动插入更新文件头——maple-header.html" type="text/html"/>
      <id>https://honmaple.me/articles/2021/10/Emacs自动插入更新文件头——maple-header.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
一个简单的插件，可以在文件创建时自动插入文件头，或者文件更新时自动更新文件头信息，虽然已经用了好几年，这次把相关代码提取并精简一下做成了插件 &lt;a href=&quot;https://github.com/honmaple/emacs-maple-header&quot;&gt;maple-header&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;heading-1&quot;&gt;安装&lt;/h1&gt;
&lt;h2 id=&quot;heading-1.1&quot;&gt;使用quelpa&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(use-package maple-header
  :quelpa (:fetcher github :repo &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;honmaple/emacs-maple-header&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
  :hook (after-init &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; maple-header-mode))&lt;/pre&gt;
&lt;h2 id=&quot;heading-1.2&quot;&gt;克隆到本地&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;git clone https://github.com/honmaple...&lt;/pre&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;安装&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.1&quot;&gt;使用quelpa&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1.2&quot;&gt;克隆到本地&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;配置&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1&quot;&gt;基础配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2&quot;&gt;自定义模版&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.3&quot;&gt;自定义更新&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;相关文章&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;
一个简单的插件，可以在文件创建时自动插入文件头，或者文件更新时自动更新文件头信息，虽然已经用了好几年，这次把相关代码提取并精简一下做成了插件 &lt;a href=&quot;https://github.com/honmaple/emacs-maple-header&quot;&gt;maple-header&lt;/a&gt;
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;heading-1&quot;&gt;安装&lt;/h1&gt;
&lt;h2 id=&quot;heading-1.1&quot;&gt;使用quelpa&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(use-package maple-header
  :quelpa (:fetcher github :repo &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;honmaple/emacs-maple-header&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;)
  :hook (after-init &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; maple-header-mode))&lt;/pre&gt;
&lt;h2 id=&quot;heading-1.2&quot;&gt;克隆到本地&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;git clone https://github.com/honmaple/emacs-maple-header --depth=1 ~/.emacs/site-lisp/maple-header&lt;/pre&gt;

&lt;h1 id=&quot;heading-2&quot;&gt;配置&lt;/h1&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(use-package maple-header
  :ensure &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
  :hook (after-init &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; maple-header-mode))&lt;/pre&gt;
&lt;h2 id=&quot;heading-2.1&quot;&gt;基础配置&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;&lt;span style=&quot;color:#75715e&quot;&gt;;; 更新文件头时搜索的文件函数, 9代表只会搜索前9行&lt;/span&gt;
(setq maple-header:lines &lt;span style=&quot;color:#ae81ff&quot;&gt;9&lt;/span&gt;)
&lt;span style=&quot;color:#75715e&quot;&gt;;; 创建新文件时是否自动插入文件头信息&lt;/span&gt;
(setq maple-header:auto-insert &lt;span style=&quot;color:#66d9ef&quot;&gt;t&lt;/span&gt;)
&lt;span style=&quot;color:#75715e&quot;&gt;;; 更新文件时是否自动更新文件头信息&lt;/span&gt;
(setq maple-header:auto-update &lt;span style=&quot;color:#66d9ef&quot;&gt;t&lt;/span&gt;)&lt;/pre&gt;
&lt;h2 id=&quot;heading-2.2&quot;&gt;自定义模版&lt;/h2&gt;
&lt;p&gt;
   比如我要自定义&lt;b&gt;Python&lt;/b&gt;文件的文件头
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(add-to-list &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;maple-header:auto-insert-alist&lt;/span&gt;
             &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#39;&lt;/span&gt;((python-mode &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;Python program&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;) &lt;span style=&quot;color:#66d9ef&quot;&gt;nil&lt;/span&gt;
               &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;#!/usr/bin/env python&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;
               &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\n&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;))&lt;/pre&gt;
&lt;h2 id=&quot;heading-2.3&quot;&gt;自定义更新&lt;/h2&gt;
&lt;p&gt;
   目前内置了 &lt;b&gt;filename, email, modify&lt;/b&gt; 三个字段, 可以通过调用 &lt;b&gt;maple-header:update-xxx&lt;/b&gt; 手动更新指定的字段, 如果需要增加新的或者覆盖原字段,可以使用
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(add-to-list &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#39;maple-header:auto-update-alist&lt;/span&gt; &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#39;&lt;/span&gt;(author &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; custom-update-author))

(defun custom-update-author(&lt;span style=&quot;color:#66d9ef&quot;&gt;&amp;amp;optional&lt;/span&gt; current-line)
  (interactive)
  (maple-header:update-action
   &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;.*&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\\&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;(Author:&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\\&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\\&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;(.*&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;\\&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;&lt;/span&gt;
   &lt;span style=&quot;color:#a6e22e&quot;&gt;user-full-name&lt;/span&gt; current-line))&lt;/pre&gt;
&lt;p&gt;
   使用 &lt;b&gt;maple-header:update&lt;/b&gt; 会更新所有字段(包括：&lt;b&gt;filename，email，modify，author&lt;/b&gt;), 如果只需要更新部分，需要修改为
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;(setq maple-header:auto-update-alist
      &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#39;&lt;/span&gt;((filename &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; maple-header:update-filename)
        (modify &lt;span style=&quot;color:#f92672&quot;&gt;.&lt;/span&gt; maple-header:update-modify)))&lt;/pre&gt;

&lt;h1 id=&quot;heading-3&quot;&gt;相关文章&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://honmaple.me/articles/2018/01/emacs自动添加文件头.html&quot;&gt;emacs自动添加文件头&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://honmaple.me/articles/2018/01/emacs自动更新文件头.html&quot;&gt;emacs自动更新文件头&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
        <category term="Linux/Emacs"></category>
    </entry>
    <entry xml:lang="zh">
      <title>Docker笔记之registry清理</title>
      <link href="" rel="alternate"></link>
      <published>Mon, 23 Aug 2021 17:14:46 +0000</published>
      <updated>Thu, 02 Sep 2021 00:58:43 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2021/08/Docker笔记之registry清理.html" type="text/html"/>
      <id>https://honmaple.me/articles/2021/08/Docker笔记之registry清理.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
尝试了几种方式, 算是找到了一个比较方便的清理docker registry的方式
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;heading-1&quot;&gt;前言&lt;/h1&gt;
&lt;p&gt;
  两年前分给了 &lt;b&gt;docker registry&lt;/b&gt; 1T的磁盘，虽然有预感磁盘空间会被用完, 没想过能够坚持这么久。
  而且期间一直想把 &lt;b&gt;registry&lt;/b&gt; 迁移到 &lt;b&gt;harbor&lt;/b&gt;，也能对不同账户的权限进行分配和限制，但几百G的磁盘占用也不好迁移，所以一直被耽搁(迁移方式都准备好了 &lt;a href=&quot;https://blog.k8s.li/docker-registry-to-harbor.html&quot;&gt;https://blog.k8s.li/docker-registry-to-harbor.html&lt;/a&gt;)
&lt;/p&gt;

&lt;h1 id=&quot;heading-2&quot;&gt;清理&lt;/h1&gt;
&lt;h2 id=&quot;heading-2.1&quot;&gt;列出所有镜像&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;registry garbage-collect --dry-run /etc/docker...&lt;/pre&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;前言&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;清理&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.1&quot;&gt;列出所有镜像&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.2&quot;&gt;找出分层(push次数)最多的几个镜像&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2.3&quot;&gt;删除某个镜像的untagged的数据&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;参考资料&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;
尝试了几种方式, 算是找到了一个比较方便的清理docker registry的方式
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;heading-1&quot;&gt;前言&lt;/h1&gt;
&lt;p&gt;
  两年前分给了 &lt;b&gt;docker registry&lt;/b&gt; 1T的磁盘，虽然有预感磁盘空间会被用完, 没想过能够坚持这么久。
  而且期间一直想把 &lt;b&gt;registry&lt;/b&gt; 迁移到 &lt;b&gt;harbor&lt;/b&gt;，也能对不同账户的权限进行分配和限制，但几百G的磁盘占用也不好迁移，所以一直被耽搁(迁移方式都准备好了 &lt;a href=&quot;https://blog.k8s.li/docker-registry-to-harbor.html&quot;&gt;https://blog.k8s.li/docker-registry-to-harbor.html&lt;/a&gt;)
&lt;/p&gt;

&lt;h1 id=&quot;heading-2&quot;&gt;清理&lt;/h1&gt;
&lt;h2 id=&quot;heading-2.1&quot;&gt;列出所有镜像&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;registry garbage-collect --dry-run /etc/docker/registry/config.yml &amp;gt;&amp;gt; res.txt&lt;/pre&gt;

&lt;h2 id=&quot;heading-2.2&quot;&gt;找出分层(push次数)最多的几个镜像&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;cat res.txt | awk -F : &amp;#39;{print $1}&amp;#39; | sort | uniq -c | sort -rn -k1 | head -10
  25871 image1
  25649 image2
  16815 image3
  ...&lt;/pre&gt;

&lt;h2 id=&quot;heading-2.3&quot;&gt;删除某个镜像的untagged的数据&lt;/h2&gt;
&lt;p&gt;
   注意 &lt;code&gt;-u&lt;/code&gt; 参数, 仅删除 &lt;b&gt;untagger&lt;/b&gt; 的数据
&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;
 dry-run
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;REGISTRY_DATA_DIR=/var/lib/registry/docker/registry/v2 python delete_docker_registry_image.py --image image1 -u --dry-run&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 实际删除(&lt;b&gt;需要先暂停registry&lt;/b&gt;)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;REGISTRY_DATA_DIR=/var/lib/registry/docker/registry/v2 python delete_docker_registry_image.py --image image1 -u&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 查看磁盘占用(&lt;b&gt;恢复registry&lt;/b&gt;)
&lt;/p&gt;

&lt;p&gt;
      发现磁盘占用的大头还是这些 &lt;b&gt;untagged&lt;/b&gt; 的数据， 仅仅处理了几个分层数量最多的镜像，一下子多了几百G的空间
&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h1 id=&quot;heading-3&quot;&gt;参考资料&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://zhuanlan.zhihu.com/p/48009377&quot;&gt;https://zhuanlan.zhihu.com/p/48009377&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 &lt;a href=&quot;https://github.com/burnettk/delete-docker-registry-image&quot;&gt;https://github.com/burnettk/delete-docker-registry-image&lt;/a&gt;
&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;</content>
        <category term="Linux"></category>
    </entry>
</feed>