<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh">
  <title>紅楓吟 - Linux</title>
    <subtitle>风落花语风落天，花落风雨花落田.</subtitle>
  <link href="https://honmaple.me/categories/linux/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="https://honmaple.me"/>
  <generator uri="https://github.com/honmaple/snow">Snow</generator>
    <updated>Wed, 11 Feb 2026 22:34:17 +0000</updated>
  <id>https://honmaple.me</id>
    <entry xml:lang="zh">
      <title>ubuntu24.04环境配置</title>
      <link href="https://honmaple.me/articles/2026/01/ubuntu-note.html" rel="alternate"></link>
      <published>Fri, 02 Jan 2026 18:51:48 +0000</published>
      <updated>Wed, 11 Feb 2026 22:34:17 +0000</updated>
      <author>
        <name>honmaple</name>
      </author>
      <link rel="alternate" href="https://honmaple.me/articles/2026/01/ubuntu-note.html" type="text/html"/>
      <id>https://honmaple.me/articles/2026/01/ubuntu-note.html</id>
      <summary type="html">
&lt;blockquote&gt;
&lt;p&gt;
最近我在腾讯云的服务器快过期了，但是续费又太贵，所以趁着活动又买了一台3年的轻量云。这台服务器上也没有什么服务，主要还是因为有一个已经备案的域名需要保一下，否则备案掉了之后再次备案太过麻烦。
&lt;/p&gt;

&lt;p&gt;
我之前的服务器还在用着 &lt;b&gt;ubuntu18.04 LTS&lt;/b&gt;，此次迁移准备升级一下系统到 &lt;b&gt;ubuntu24.04 LTS&lt;/b&gt;，故此记录
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
注意: 以下命令以 &lt;code&gt;#&lt;/code&gt; 开头则使用的是root账户，以 &lt;code&gt;$&lt;/code&gt; 开头则为普通账户
&lt;/p&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;修改主机名称&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;# hostnamectl set-hostname [名称]&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;创建新用户&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 删除已存在的用户
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;# deluser --remove-home ubuntu
# deluser --remove-home lighthouse...&lt;/pre&gt;&lt;/li&gt;&lt;/ul&gt;</summary>
      <content type="html">&lt;div id=&quot;table-of-contents&quot;&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id=&quot;text-table-of-contents&quot;&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#heading-1&quot;&gt;修改主机名称&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-2&quot;&gt;创建新用户&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-3&quot;&gt;ssh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-4&quot;&gt;unattended-upgrades&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-5&quot;&gt;snap&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-6&quot;&gt;docker&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-7&quot;&gt;其它软件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-8&quot;&gt;连接数限制&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#heading-9&quot;&gt;卸载腾讯云组件&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;
最近我在腾讯云的服务器快过期了，但是续费又太贵，所以趁着活动又买了一台3年的轻量云。这台服务器上也没有什么服务，主要还是因为有一个已经备案的域名需要保一下，否则备案掉了之后再次备案太过麻烦。
&lt;/p&gt;

&lt;p&gt;
我之前的服务器还在用着 &lt;b&gt;ubuntu18.04 LTS&lt;/b&gt;，此次迁移准备升级一下系统到 &lt;b&gt;ubuntu24.04 LTS&lt;/b&gt;，故此记录
&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;
注意: 以下命令以 &lt;code&gt;#&lt;/code&gt; 开头则使用的是root账户，以 &lt;code&gt;$&lt;/code&gt; 开头则为普通账户
&lt;/p&gt;

&lt;h2 id=&quot;heading-1&quot;&gt;修改主机名称&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;# hostnamectl set-hostname [名称]&lt;/pre&gt;

&lt;h2 id=&quot;heading-2&quot;&gt;创建新用户&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 删除已存在的用户
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;# deluser --remove-home ubuntu
# deluser --remove-home lighthouse&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 添加新用户
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;# adduser myuser&lt;/pre&gt;
&lt;p&gt;
     用户信息比如全名、房间号等，这些可以直接按 &lt;code&gt;Enter&lt;/code&gt; 跳过
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 添加sudo权限
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;# usermod -aG sudo myuser&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 添加公钥
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;# su - 用户名
$ mkdir ~/.ssh
$ chmod 700 ~/.ssh
$ vi ~/.ssh/authorized_keys
$ chmod 600 ~/.ssh/authorized_keys&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-3&quot;&gt;ssh&lt;/h2&gt;
&lt;p&gt;
   修改配置 &lt;code&gt;/etc/ssh/sshd_config&lt;/code&gt;
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 修改端口
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;Port 22&lt;/pre&gt;
&lt;p&gt;
     取消注释并修改为想要的端口，然后在腾讯云控制台防火墙添加放行策略
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 禁用root登陆
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;PermitRootLogin no&lt;/pre&gt;
&lt;p&gt;
     请在添加完成&lt;b&gt;普通用户&lt;/b&gt;后再操作
&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 重启服务
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo systemctl restart ssh&lt;/pre&gt;

&lt;p&gt;
     如果修改 &lt;code&gt;sshd_config&lt;/code&gt; 不生效
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo systemctl stop ssh.socket
$ sudo systemctl disable ssh.socket
$ sudo systemctl restart ssh&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-4&quot;&gt;unattended-upgrades&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 停止服务
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo systemctl stop unattended-upgrades
$ sudo systemctl disable unattended-upgrades&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 卸载
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo apt remove --purge unattended-upgrades&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-5&quot;&gt;snap&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 停止服务
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo systemctl stop snapd.service
$ sudo systemctl disable snapd.service
$ sudo systemctl mask snapd.service&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 查看已安装软件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ snap list&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 卸载安装软件(把使用 &lt;b&gt;snap&lt;/b&gt; 安装的软件依次卸载)
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo snap remove --purge [软件名称]&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 卸载 &lt;b&gt;snap&lt;/b&gt;
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo apt autoremove --purge snapd&lt;/pre&gt;
&lt;p&gt;
     清理目录
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo rm -rf /var/cache/snapd
$ sudo rm -rf /var/snap
$ sudo rm -rf /var/lib/snapd&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 阻止 &lt;b&gt;snapd&lt;/b&gt; 被自动重新安装
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo cat &amp;lt;&amp;lt;EOF | sudo tee /etc/apt/preferences.d/nosnap.pref
Package: snapd
Pin: release a=*
Pin-Priority: -10
EOF&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-6&quot;&gt;docker&lt;/h2&gt;
&lt;p&gt;
   官方文档: &lt;a href=&quot;https://docs.docker.com/engine/install/ubuntu/&quot;&gt;https://docs.docker.com/engine/install/ubuntu/&lt;/a&gt;
&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;
 设置apt仓库
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo apt update
$ sudo apt install ca-certificates curl
$ sudo install -m 0755 -d /etc/apt/keyrings
$ sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
$ sudo chmod a+r /etc/apt/keyrings/docker.asc
$ sudo tee /etc/apt/sources.list.d/docker.sources &amp;lt;&amp;lt;EOF
Types: deb
URIs: https://download.docker.com/linux/ubuntu
Suites: $(. /etc/os-release &amp;amp;&amp;amp; echo &amp;#34;${UBUNTU_CODENAME:-$VERSION_CODENAME}&amp;#34;)
Components: stable
Signed-By: /etc/apt/keyrings/docker.asc
EOF
$ sudo apt update&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 安装
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 普通用户权限
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo usermod -aG docker [用户名]&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;
 镜像
     由于官方仓库无法连接，修改 &lt;code&gt;/etc/docker/daemon.json&lt;/code&gt; 添加下面配置
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;{
    &lt;span style=&quot;color:#f92672&quot;&gt;&amp;#34;registry-mirrors&amp;#34;&lt;/span&gt;: [
        &lt;span style=&quot;color:#e6db74&quot;&gt;&amp;#34;https://mirror.ccs.tencentyun.com&amp;#34;&lt;/span&gt;
    ]
}&lt;/pre&gt;
&lt;p&gt;
     然后重启docker即可
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo systemctl restart docker&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;heading-7&quot;&gt;其它软件&lt;/h2&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo apt install tree&lt;/pre&gt;

&lt;h2 id=&quot;heading-8&quot;&gt;连接数限制&lt;/h2&gt;
&lt;p&gt;
   编辑文件 &lt;code&gt;/etc/security/limits.conf&lt;/code&gt;，在文件末尾添加以下内容：
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;* soft nofile 65535
* hard nofile 65535
* soft nproc 20480
* hard nproc 20480&lt;/pre&gt;
&lt;p&gt;
   注：&lt;b&gt;nofile&lt;/b&gt; 是文件打开数，&lt;b&gt;nproc&lt;/b&gt; 是最大进程数。&lt;code&gt;*&lt;/code&gt; 代表除 &lt;b&gt;root&lt;/b&gt; 外的所有用户，如果需要添加 &lt;b&gt;root&lt;/b&gt;，则增加
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;root soft nofile 65535
root hard nofile 65535&lt;/pre&gt;

&lt;h2 id=&quot;heading-9&quot;&gt;卸载腾讯云组件&lt;/h2&gt;
&lt;p&gt;
   卸载腾讯云内置的组件
&lt;/p&gt;
&lt;pre style=&quot;color:#f8f8f2;background-color:#272822&quot;&gt;$ sudo /usr/local/qcloud/monitor/barad/admin/uninstall.sh
$ sudo /usr/local/qcloud/stargate/admin/uninstall.sh
$ sudo /usr/local/qcloud/YunJing/uninst.sh&lt;/pre&gt;</content>
        <category term="Linux"></category>
    </entry>
</feed>