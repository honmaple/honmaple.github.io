<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>emacs笔记 · 紅楓吟</title>
    <link rel="canonical" href="https://honmaple.me/articles/2017/04/emacs笔记.html" />
      <link href="https://s.libforest.com/static/css/lib.min.css" rel="stylesheet">
        <link href="https://honmaple.me/static/lib/css/style.min.css" rel="stylesheet">
      <script src="https://honmaple.me/static/lib/js/before.min.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-YNGNDGB8F8"></script>
  <script>
     window.dataLayer = window.dataLayer || [];
       function gtag(){dataLayer.push(arguments);}
       gtag('js', new Date());
       gtag('config', 'G-YNGNDGB8F8');
  </script>

</head>
  <body>
    <div class="scrollbar"></div>

    <div class="wrapper"><nav class="entry-navbar">
  <div class="entry-navbar-top">
    <a href="https://honmaple.me">
      <img class="entry-navbar-logo" src="https://s.libforest.com/images/header/header-logo.png" alt="楓">
    </a>
      <p class="entry-navbar-text">—— 风落花语风落天，花落风雨花落田.</p>
    <button class="entry-navbar-collapse" data-target=".entry-navbar-bottom" data-toggle="collapse">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" /></svg>
    </button>
  </div>
  <div class="entry-navbar-bottom">
    <ul class="entry-navbar-menu">
          <li class="entry-dropdown">
            <a href="https://honmaple.me/categories/tech/index.html">技术分享</a>
            <ul class="entry-dropdown-content">
                <li><a href="https://honmaple.me/categories/tech/coding/index.html">代码世界</a></li>
                <li><a href="https://honmaple.me/categories/tech/geek/index.html">极客安全</a></li>
                <li><a href="https://honmaple.me/categories/tech/linux/index.html">字符艺术</a></li>
            </ul>
          </li>
          <li class="entry-dropdown">
            <a href="https://honmaple.me/categories/life/index.html">生活随笔</a>
            <ul class="entry-dropdown-content">
                <li><a href="https://honmaple.me/categories/life/love/index.html">你不懂我</a></li>
                <li><a href="https://honmaple.me/categories/life/recall/index.html">我不怪你</a></li>
            </ul>
          </li>
          <li><a href="https://honmaple.me/pages/memos.html">闲言碎语</a></li>
          <li class="entry-dropdown">
            <a href="https://honmaple.me/archives/index.html">文章归档</a>
            <ul class="entry-dropdown-content">
                <li><a href="https://honmaple.me/tags/index.html">标签</a></li>
                <li><a href="https://honmaple.me/categories/index.html">分类</a></li>
                <li><a href="https://honmaple.me/authors/index.html">作者</a></li>
            </ul>
          </li>
          <li><a href="https://honmaple.me/pages/about.html">关于</a></li>
    </ul>
    <form class="entry-navbar-form" action="https://honmaple.me/search.html">
      <input name="q" type="text" onfocus="this.placeholder='搜索'" onblur="this.placeholder=''" />
      <i class="fa fa-search"></i>
    </form>
  </div>
</nav>

  <article class="entry-article">
    <div class="entry-article-header">
    <h1 class="entry-article-title">
      <a href="https://honmaple.me/articles/2017/04/emacs笔记.html" rel="bookmark" title="Permalink to emacs笔记">emacs笔记</a>
    </h1>
      <div class="entry-article-info">
        <span title="Updated at 2023-02-24">
          <i class="fa fa-calendar-o"></i>
          2017年04月21日 周五
        </span>
          <span>|</span>
          <span>
            <i class="fa fa-folder-o"></i>
            分类
              <a href="https://honmaple.me/categories/tech/linux/emacs/index.html">Emacs</a>
          </span>
          <span>|</span>
          <span>
            <i class="fa fa-bookmark-o"></i>
            标签
              <a href="https://honmaple.me/tags/linux/index.html">linux</a>
              <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
          </span>
      </div>
  </div>
    <hr class="entry-article-hr" />
    <div class="entry-article-content">
      <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents"><ul>
<li><a href="#heading-1">Linux</a></li>
<li><a href="#heading-2">Evil</a>
<ul>
<li><a href="#heading-2.1">粘贴替换的时候会复制替换的文本</a></li>
<li><a href="#heading-2.2">自动搜索已选中的字符</a></li>
<li><a href="#heading-2.3">evil-mc不忽略大小写</a></li>
</ul></li>
<li><a href="#heading-3">Font</a>
<ul>
<li><a href="#heading-3.1">设置中英文字体</a></li>
</ul></li>
<li><a href="#heading-4">Ivy</a>
<ul>
<li><a href="#heading-4.1">指定目录或文件进行搜索</a></li>
<li><a href="#heading-4.2">查找当前目录以及子目录的某个文件</a></li>
<li><a href="#heading-4.3">当选中单词时，swiper使用已选单词进行搜索</a></li>
</ul></li>
<li><a href="#heading-5">File</a>
<ul>
<li><a href="#heading-5.1">获取文件或目录的basename</a></li>
</ul></li>
<li><a href="#heading-6">Elisp</a>
<ul>
<li><a href="#heading-6.1">golang自动增加注释</a></li>
<li><a href="#heading-6.2">增加到hook但仅调用一次</a></li>
<li><a href="#heading-6.3">迭代并获取列表索引</a></li>
<li><a href="#heading-6.4">深拷贝function</a></li>
<li><a href="#heading-6.5">获取文件行数</a></li>
</ul></li>
</ul></div></div>

<h1 id="heading-1">Linux</h1>
<p>
  将<b>emacs gui</b>进程放置到后台
</p>
<pre style="color:#f8f8f2;background-color:#272822">EMACS<span style="color:#f92672">=</span>/usr/bin/emacs
GUI<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
ARGS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>
ARRAY<span style="color:#f92672">=</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;-nw&#34;</span> <span style="color:#e6db74">&#34;--no-window-system&#34;</span> <span style="color:#e6db74">&#34;--batch&#34;</span> <span style="color:#e6db74">&#34;--help&#34;</span><span style="color:#f92672">)</span>

<span style="color:#66d9ef">for</span> arg in $ARGS; <span style="color:#66d9ef">do</span>
    <span style="color:#66d9ef">for</span> keyword in <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>ARRAY[@]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>;<span style="color:#66d9ef">do</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $keyword <span style="color:#f92672">=</span> $arg <span style="color:#f92672">]</span>;<span style="color:#66d9ef">then</span>
            GUI<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
            break
        <span style="color:#66d9ef">fi</span>
    <span style="color:#66d9ef">done</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $GUI -eq <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
        break
    <span style="color:#66d9ef">fi</span>
<span style="color:#66d9ef">done</span>

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> $GUI -eq <span style="color:#ae81ff">1</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    $EMACS $ARGS
<span style="color:#66d9ef">else</span>
    $EMACS $ARGS &amp;&gt; /dev/null &amp;
    <span style="color:#75715e"># nohup $EMACS $ARGS &amp;&gt; /dev/null &amp; disown</span>
<span style="color:#66d9ef">fi</span></pre>

<h1 id="heading-2">Evil</h1>
<h2 id="heading-2.1">粘贴替换的时候会复制替换的文本</h2>
<pre style="color:#f8f8f2;background-color:#272822">(defun evil-paste-after-from-0 ()
  (interactive)
  (<span style="color:#66d9ef">let</span> ((evil-this-register ?0))
    (call-interactively <span style="color:#e6db74">&#39;evil-paste-after</span>)))

(define-key evil-visual-state-map <span style="color:#e6db74">&#34;p&#34;</span> <span style="color:#e6db74">&#39;evil-paste-after-from-0</span>)</pre>
<h2 id="heading-2.2">自动搜索已选中的字符</h2>
<p>
   经常使用 evil 中的 <code>/</code> 进行搜索, 但有时候想要搜索已有的字符, 在 <b>evil-visual-state</b> 下选中某个字符,按 <code>/</code> 时自动把选中的字符填入待搜索项中
</p>
<pre style="color:#f8f8f2;background-color:#272822">(use-package isearch
  :ensure <span style="color:#66d9ef">nil</span>
  :init
  (defun maple/evil-search-paste()
    (when (region-active-p)
      (isearch-yank-string
       (save-excursion
         (<span style="color:#a6e22e">buffer-substring-no-properties</span>
          (<span style="color:#a6e22e">region-beginning</span>) (<span style="color:#a6e22e">1+</span> (<span style="color:#a6e22e">region-end</span>)))))
      (deactivate-mark)))
  :hook (isearch-mode <span style="color:#f92672">.</span> maple/evil-search-paste)
  :bind (:map isearch-mode-map
              ([remap isearch-delete-char] <span style="color:#f92672">.</span> isearch-del-char)))</pre>
<h2 id="heading-2.3">evil-mc不忽略大小写</h2>
<p>
   <b>evil-mc</b> 默认会通过<code>evil-ex-search</code>进行搜索，可以通过设置<code>(setq evil-ex-search-case &#39;sensitive)</code>来不忽略大小写, 但我只想在使用<b>evil-mc</b>时不忽略，其他时间忽略
</p>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#75715e">;; ignore case in evil-mc</span>
(add-hook <span style="color:#e6db74">&#39;evil-mc-before-cursors-created</span> (lambda() (<span style="color:#66d9ef">setq</span> evil-ex-search-case <span style="color:#e6db74">&#39;sensitive</span>)))
(add-hook <span style="color:#e6db74">&#39;evil-mc-after-cursors-deleted</span> (lambda() (<span style="color:#66d9ef">setq</span> evil-ex-search-case <span style="color:#e6db74">&#39;smart</span>)))</pre>

<h1 id="heading-3">Font</h1>
<h2 id="heading-3.1">设置中英文字体</h2>
<pre style="color:#f8f8f2;background-color:#272822"><span style="color:#75715e">;; 中英文表格对齐</span>
(defvar emacs-english-font <span style="color:#e6db74">&#34;DejaVu Sans Mono&#34;</span>
  <span style="color:#e6db74">&#34;The font name of English.&#34;</span>)
(defvar emacs-cjk-font <span style="color:#e6db74">&#34;WenQuanYi Micro Hei Mono&#34;</span>
  <span style="color:#e6db74">&#34;The font name for CJK.&#34;</span>)
(defvar emacs-font-size-pair <span style="color:#f92672">&#39;</span>(<span style="color:#ae81ff">15</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">18</span>)
  <span style="color:#e6db74">&#34;Default font size pair for (english . chinese)&#34;</span>)

(defvar emacs-font-size-pair-list
  <span style="color:#f92672">&#39;</span>(( <span style="color:#ae81ff">5</span> <span style="color:#f92672">.</span>  <span style="color:#ae81ff">6</span>) (<span style="color:#ae81ff">10</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">12</span>)
    (<span style="color:#ae81ff">13</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">16</span>) (<span style="color:#ae81ff">15</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">18</span>) (<span style="color:#ae81ff">17</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">20</span>)
    (<span style="color:#ae81ff">19</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">22</span>) (<span style="color:#ae81ff">20</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">24</span>) (<span style="color:#ae81ff">21</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">26</span>)
    (<span style="color:#ae81ff">24</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">28</span>) (<span style="color:#ae81ff">26</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">32</span>) (<span style="color:#ae81ff">28</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">34</span>)
    (<span style="color:#ae81ff">30</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">36</span>) (<span style="color:#ae81ff">34</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">40</span>) (<span style="color:#ae81ff">36</span> <span style="color:#f92672">.</span> <span style="color:#ae81ff">44</span>))
  <span style="color:#e6db74">&#34;This list is used to store matching (englis . chinese) font-size.&#34;</span>)
(defun font-exist-p (fontname)
  <span style="color:#e6db74">&#34;Test if this font is exist or not.&#34;</span>
  (<span style="color:#66d9ef">if</span> (or (<span style="color:#a6e22e">not</span> fontname) (<span style="color:#a6e22e">string=</span> fontname <span style="color:#e6db74">&#34;&#34;</span>))
      <span style="color:#66d9ef">nil</span>
    (<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">not</span> (x-list-fonts fontname)) <span style="color:#66d9ef">nil</span> <span style="color:#66d9ef">t</span>)))

(defun maple/set-font (english chinese size-pair)
  <span style="color:#e6db74">&#34;Setup emacs English and Chinese font on x window-system.&#34;</span>
  (<span style="color:#66d9ef">if</span> (font-exist-p english)
      (set-frame-font (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;%s:pixelsize=%d&#34;</span> english (<span style="color:#a6e22e">car</span> size-pair)) <span style="color:#66d9ef">t</span>))

  (<span style="color:#66d9ef">if</span> (font-exist-p chinese)
      (dolist (charset <span style="color:#f92672">&#39;</span>(kana han <span style="color:#a6e22e">symbol</span> cjk-misc bopomofo))
        (set-fontset-font (frame-parameter <span style="color:#66d9ef">nil</span> <span style="color:#e6db74">&#39;font</span>) charset
                          (font-spec <span style="color:#e6db74">:family</span> chinese <span style="color:#e6db74">:size</span> (<span style="color:#a6e22e">cdr</span> size-pair))))))
<span style="color:#75715e">;; (add-hook &#39;ctbl:table-mode-hook</span>
<span style="color:#75715e">;;           (maple/set-font emacs-english-font emacs-cjk-font emacs-font-size-pair))</span></pre>
<h1 id="heading-4">Ivy</h1>
<h2 id="heading-4.1">指定目录或文件进行搜索</h2>
<pre style="color:#f8f8f2;background-color:#272822">(defun maple/counsel-ag-file()
  (interactive)
  (counsel-ag <span style="color:#66d9ef">nil</span> (read-file-name <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Search in file(s): </span><span style="color:#e6db74">&#34;</span>)))</pre>

<h2 id="heading-4.2">查找当前目录以及子目录的某个文件</h2>
<pre style="color:#f8f8f2;background-color:#272822">(defun maple/counsel-find-file()
  (interactive)
  (ivy-read <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Find file: </span><span style="color:#e6db74">&#34;</span>
            (<span style="color:#a6e22e">mapcar</span> <span style="color:#e6db74">&#39;file-relative-name</span>
                    (directory-files-recursively default-directory <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>))
            :matcher <span style="color:#a6e22e">#&#39;</span>counsel--find-file-matcher
            :action <span style="color:#a6e22e">#&#39;</span>counsel-find-file-action
            :preselect (counsel--preselect-file)
            :require-match <span style="color:#e6db74">&#39;confirm-after-completion</span>
            :history <span style="color:#e6db74">&#39;file-name-history</span>
            :keymap counsel-find-file-map
            :caller <span style="color:#e6db74">&#39;counsel-find-file</span>))</pre>

<h2 id="heading-4.3">当选中单词时，swiper使用已选单词进行搜索</h2>
<pre style="color:#f8f8f2;background-color:#272822">(defun maple/ivy-search-at-point (func)
  (let* ((region (region-active-p))
         (<span style="color:#a6e22e">string</span> (if (not region) <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>
                   (<span style="color:#a6e22e">buffer-substring-no-properties</span>
                    (<span style="color:#a6e22e">region-beginning</span>) (<span style="color:#a6e22e">region-end</span>))))
         (ivy-initial-inputs-alist
          (<span style="color:#a6e22e">list</span> (<span style="color:#a6e22e">cons</span> func <span style="color:#a6e22e">string</span>))))
    (when region (deactivate-mark))
    (<span style="color:#a6e22e">funcall</span> func)))</pre>

<pre style="color:#f8f8f2;background-color:#272822">(defun maple/swiper()
  (interactive)
  (maple/ivy-search-at-point <span style="color:#e6db74">&#39;swiper</span>))</pre>
<h1 id="heading-5">File</h1>
<h2 id="heading-5.1">获取文件或目录的basename</h2>
<pre style="color:#f8f8f2;background-color:#272822">(defun maple/basename (fname)
  (if (or (<span style="color:#a6e22e">file-directory-p</span> fname)
          (<span style="color:#a6e22e">string-match</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">/$</span><span style="color:#e6db74">&#34;</span> fname))
      (let ((dirname (<span style="color:#a6e22e">directory-file-name</span> fname)))
        (<span style="color:#a6e22e">file-name-nondirectory</span> dirname))
    (<span style="color:#a6e22e">file-name-nondirectory</span> fname)))</pre>
<h1 id="heading-6">Elisp</h1>
<h2 id="heading-6.1">golang自动增加注释</h2>
<p>
   因为<b>flycheck</b>使用了<code>golint</code>, <b>flycheck</b>总是显示代码没有注释的警告
</p>
<pre style="color:#f8f8f2;background-color:#272822">exported method Raw should have comment or be unexported (go-golint)</pre>
<p>
   也没找到什么方法来禁止它, 作为强迫症受不了，总不能一个一个去注释, 所以写了一个函数来自动注释整个文件的所有未注释函数:
</p>

<pre style="color:#f8f8f2;background-color:#272822">(defun maple/go-auto-comment()
  (interactive)
  (unless (featurep <span style="color:#e6db74">&#39;imenu</span>)
    (require <span style="color:#e6db74">&#39;imenu</span> <span style="color:#66d9ef">nil</span> <span style="color:#66d9ef">t</span>))
  (let* ((imenu-auto-rescan <span style="color:#66d9ef">t</span>)
         (imenu-auto-rescan-maxout (if current-prefix-arg
                                       (<span style="color:#a6e22e">buffer-size</span>)
                                     imenu-auto-rescan-maxout))
         (items (imenu--make-index-alist <span style="color:#66d9ef">t</span>))
         (items (<span style="color:#a6e22e">delete</span> (<span style="color:#a6e22e">assoc</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">*Rescan*</span><span style="color:#e6db74">&#34;</span> items) items)))
    (cl-mapcan
     (lambda(item)
       (cl-mapcan
        (if (string= (<span style="color:#a6e22e">car</span> item) <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">func</span><span style="color:#e6db74">&#34;</span>)
            <span style="color:#e6db74">&#39;maple/go-func-comment</span>
          <span style="color:#e6db74">&#39;maple/go-type-comment</span>)
        (<span style="color:#a6e22e">cdr</span> item)))
     items)))

(defun maple/go-add-comment(func <span style="color:#a6e22e">point</span>)
  (save-excursion
    (<span style="color:#a6e22e">goto-char</span> <span style="color:#a6e22e">point</span>)
    (<span style="color:#a6e22e">forward-line</span> <span style="color:#ae81ff">-1</span>)
    (when (not (<span style="color:#a6e22e">looking-at</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">// </span><span style="color:#e6db74">&#34;</span> func)))
      (<span style="color:#a6e22e">end-of-line</span>) (newline-and-indent)
      (<span style="color:#a6e22e">insert</span> (<span style="color:#a6e22e">concat</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">// </span><span style="color:#e6db74">&#34;</span> func <span style="color:#e6db74">&#34;</span><span style="color:#e6db74"> ..</span><span style="color:#e6db74">&#34;</span>)))))

(defun maple/go-func-comment(f)
  (let ((func (<span style="color:#a6e22e">car</span> f)))
    (if (and (string-prefix-p <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">(</span><span style="color:#e6db74">&#34;</span> func)
             (<span style="color:#a6e22e">string-match</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[)] </span><span style="color:#e6db74">\\</span><span style="color:#e6db74">(.*</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">)[(]</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">(.*</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">)[)]</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">(.*</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">)$</span><span style="color:#e6db74">&#34;</span> func))
        (maple/go-add-comment (match-string <span style="color:#ae81ff">1</span> func) (<span style="color:#a6e22e">cdr</span> f))
      (if (<span style="color:#a6e22e">string-match</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">(.*</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">)[(]</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">(.*</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">)[)]</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">(.*</span><span style="color:#e6db74">\\</span><span style="color:#e6db74">)$</span><span style="color:#e6db74">&#34;</span> func)
          (maple/go-add-comment (match-string <span style="color:#ae81ff">1</span> func) (<span style="color:#a6e22e">cdr</span> f))
        (maple/go-add-comment (<span style="color:#a6e22e">car</span> f) (<span style="color:#a6e22e">cdr</span> f))))))

(defun maple/go-type-comment(f)
  (maple/go-add-comment (<span style="color:#a6e22e">car</span> f) (<span style="color:#a6e22e">cdr</span> f)))</pre>

<p>
   相关配置将持续更新: <a href="https://github.com/honmaple/dotfiles/blob/master/emacs.d/lisp/init-go.el">init-go.el</a>
</p>

<h2 id="heading-6.2">增加到hook但仅调用一次</h2>
<pre style="color:#f8f8f2;background-color:#272822">(defmacro maple/add-hook-once (hook f <span style="color:#66d9ef">&amp;optional</span> <span style="color:#a6e22e">append</span> local)
  <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Like </span><span style="color:#e6db74">`</span><span style="color:#e6db74">add-hook</span><span style="color:#e6db74">`</span><span style="color:#e6db74">, remove after call with HOOK F &amp;OPTIONAL APPEND LOCAL.</span><span style="color:#e6db74">&#34;</span>
  (let ((func (<span style="color:#a6e22e">intern</span> (<span style="color:#a6e22e">format</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">maple/run-once-%s</span><span style="color:#e6db74">&#34;</span>
                              (<span style="color:#a6e22e">symbol-name</span> f)))))
    <span style="color:#f92672">`</span>(progn
       (defun <span style="color:#f92672">,</span>func ()
         (remove-hook <span style="color:#e6db74">&#39;,hook</span> <span style="color:#e6db74">&#39;,func</span> <span style="color:#f92672">,</span>local)
         (<span style="color:#a6e22e">funcall</span> <span style="color:#e6db74">&#39;,f</span>))
       (add-hook <span style="color:#e6db74">&#39;,hook</span> <span style="color:#e6db74">&#39;,func</span> <span style="color:#f92672">,</span><span style="color:#a6e22e">append</span> <span style="color:#f92672">,</span>local))))</pre>
<h2 id="heading-6.3">迭代并获取列表索引</h2>
<pre style="color:#f8f8f2;background-color:#272822">(defmacro maple/dolist (spec <span style="color:#66d9ef">&amp;rest</span> body)
  <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Like dolist but get INDEX, SPEC &amp;REST BODY.</span><span style="color:#e6db74">&#34;</span>
  (declare (indent <span style="color:#ae81ff">1</span>) (debug ((<span style="color:#a6e22e">symbolp</span> form <span style="color:#66d9ef">&amp;optional</span> form) body)))
  <span style="color:#f92672">`</span>(let ((num <span style="color:#ae81ff">0</span>))
     (dolist <span style="color:#f92672">,</span>(<span style="color:#a6e22e">cdr</span> spec)
       (let ((<span style="color:#f92672">,</span>(<span style="color:#a6e22e">car</span> spec) num))
         <span style="color:#f92672">,@</span>body
         (setq num (<span style="color:#a6e22e">+</span> num <span style="color:#ae81ff">1</span>))))))</pre>
<p>
   这样就可以使用
</p>
<pre style="color:#f8f8f2;background-color:#272822">(maple/dolist (index item <span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">aaa</span><span style="color:#e6db74">&#34;</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">bbb</span><span style="color:#e6db74">&#34;</span>))
              (<span style="color:#a6e22e">print</span> index))</pre>
<h2 id="heading-6.4">深拷贝function</h2>
<p>
   <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Function-Cells.html">https://www.gnu.org/software/emacs/manual/html_node/elisp/Function-Cells.html</a>
</p>
<pre style="color:#f8f8f2;background-color:#272822">(<span style="color:#a6e22e">fset</span> <span style="color:#e6db74">&#39;maple/put-text-property</span> (<span style="color:#a6e22e">symbol-function</span> <span style="color:#e6db74">&#39;put-text-property</span>))</pre>

<h2 id="heading-6.5">获取文件行数</h2>
<ul>
<li>
<p>
 <a href="https://emacs.stackexchange.com/questions/26721/display-max-line-in-bottom-line-nox-aka-mode-line/26724#26724">https://emacs.stackexchange.com/questions/26721/display-max-line-in-bottom-line-nox-aka-mode-line/26724#26724</a>
</p></li>
<li>
<p>
 <a href="https://emacs.stackexchange.com/questions/3821/a-faster-method-to-obtain-line-number-at-pos-in-large-buffers">https://emacs.stackexchange.com/questions/3821/a-faster-method-to-obtain-line-number-at-pos-in-large-buffers</a>
</p></li>
</ul>
    </div>
    <div class="entry-copyright">
        <div>
          <span><i class="fa fa-user-o"></i>作者:</span>
            <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
        </div>
    <div>
      <span><i class="fa fa-link"></i>链接:</span>
      <a href="https://honmaple.me/articles/2017/04/emacs笔记.html">https://honmaple.me/articles/2017/04/emacs笔记.html</a>
    </div>
    <div>
      <span><i class="fa fa-copyright"></i>版权:</span>
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">
        <img src="https://s.libforest.com/images/pic/license.png" alt="CC BY-NC-SA 4.0" />
        知识共享署名-非商业性使用-相同方式共享4.0国际许可协议
      </a>
    </div>
  </div>
  <div class="entry-honor">
    <button data-target=".entry-honor-content" data-toggle="collapse" aria-expanded="false">赞</button>
    <div class="entry-honor-content collapse">
      <div class="entry-honor-wechat">
        <img class="lazyload" data-src="https://s.libforest.com/images/pic/wechat.png" alt="wechat" />
      </div>
      <div class="entry-honor-alipay">
        <img class="lazyload" data-src="https://s.libforest.com/images/pic/alipay.png" alt="alipay" />
      </div>
    </div>
  </div>
    <hr class="entry-article-hr" />
    <ul class="entry-pager">
      <li class="prev">
        <a href="https://honmaple.me/articles/2017/05/晒晒我的Linux及桌面.html" title="Previous article: 晒晒我的Linux及桌面">
          <i class="fa fa-chevron-left"></i>
          晒晒我的Linux及桌面
        </a>
      </li>
      <li class="next">
        <a href="https://honmaple.me/articles/2017/04/emacs实现智能注释.html" title="Next article: emacs实现智能注释">
          emacs实现智能注释
          <i class="fa fa-chevron-right"></i>
        </a>
      </li>
  </ul>
    
    <div class="entry-comment">
      <div class="entry-btn">
        <a>加载评论</a>
      </div>
      <div id="comment_thread" issue-term="emacs笔记"></div>
    </div>
  </article><div class="footer">
  <ul class="footer-left">
    <li class="hidden-xs">© 2015-2026 honmaple</li>
    <li class="hidden-xs">·</li>
    <li>
        <a href="https://github.com/honmaple">Github</a>
          <span> | </span>
        <a href="https://honmaple.me/pages/contact.html">联系</a>
          <span> | </span>
        <a href="https://honmaple.me/pages/about.html">关于</a>
    </li>
  </ul>
  <ul class="footer-right">
    <li><a class="entry-switch-theme" title="切换主题" onclick="switchTheme()"><i class="fa fa-moon-o"></i></a></li>
      <li><a href="https://honmaple.me/pages/music.html" title="音乐"><i class="fa fa-music"></i></a></li>
      <li><a href="https://honmaple.me/pages/travel.html" title="旅行"><i class="fa fa-camera"></i></a></li>
      <li class="hidden-xs"><a href="https://honmaple.me/atom.xml" title="Feed"><i class="fa fa-feed"></i></a></li>
  </ul>
</div>
<div class="back-to-top on">
  <i class="fa fa-hand-o-up" title="back to top"></i>
</div>

    </div>
      <script src="https://s.libforest.com/static/js/lib.min.js"></script>
        <script src="https://honmaple.me/static/lib/js/script.min.js"></script>
  </body>
</html>
