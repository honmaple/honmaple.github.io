<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>honmaple's blog - jquery</title>
    <script src="https://cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../theme/css/main.css" type="text/css" />
    <!-- <link rel="stylesheet" href="./theme/css/main-black.css" type="text/css" /> -->
  </head>
  <body>
    <div class="particles-js" id="particles-js"></div>
    <div class="wrap">
      <div class="main">
        <div class="col-md-offset-2 col-md-8" style="padding:0;">
          <div class="col-md-offset-1 col-md-10" style="padding:0;">
            <nav class="navbar navbar-default">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-header" aria-expanded="false">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="../..">honmaple's blog</a>
                <p class="navbar-text">———— 爱情诚可贵，自由价更高.</p>
              </div>
              <div class="collapse navbar-collapse" id="nav-header">
                <ul class="nav navbar-nav">
                  <li><a href="http://honmaple.org">home</a></li>
                  <li class="dropdown">
                    <a href="../../category/life/index.html" >Life</a>
                    <ul class="dropdown-menu">
                      <li><a href="../../category/coding/index.html">coding</a></li>
                      <li><a href="../../category/love/index.html">love</a></li>
                      <li><a href="../../category/recall/index.html">recall</a></li>
                    </ul>
                  </li>
                  <li ><a href="../../category/linux/index.html">Linux</a></li>
                  <li ><a href="../../category/python/index.html">Python</a></li>
                  <li ><a href="../../category/security/index.html">Security</a></li>
                  <li class="dropdown">
                    <a href="../../archives.html">Archives</a>
                    <ul class="dropdown-menu">
                      <li><a href="../../tags.html">Tags</a></li>
                      <li><a href="../../categories.html">Categories</a></li>
                      <li><a href="../../authors.html">Authors</a></li>
                    </ul>
                  </li>
                </ul>
                <form onsubmit="return dispatch()" class="navbar-form navbar-right" style="margin-top:10px;">
                  <div class="form-group has-feedback">
                    <input class="form-control input-sm" id="search" name="search" placeholder="搜索" type="text" value="">
                    <i class="fa fa-search form-control-feedback"></i>
                  </div>
                </form>
              </div>
            </nav>
          </div>
        </div>
        <div class="col-md-offset-2 col-md-8" style="padding:0;">
          <div class="col-md-offset-1 col-md-10" style="padding:0;">
            <article>
                <h1 class="entry-title"><a href="../../articles/2016/02/flask使用ajax.html" rel="bookmark" title="Permalink to flask使用ajax">flask使用ajax</a></h1>
                <div class="entry-content">
<header class="entry-info">
  <span class="entry-info-date" title="2016-02-02T00:00:00+08:00">
    <i class="fa fa-calendar-o"></i>
    二 02 二月 2016
  </span>
  <span class="entry-info-sep">|</span>
  <span class="entry-info-author">
    <i class="fa fa-user-o"></i>
    By <a href="../../author/honmaple.html">honmaple</a>
  </span>
  <span class="entry-info-sep">|</span>
  <span class="entry-info-category">
    <i class="fa fa-folder-o"></i>
    In <a href="../../category/python/index.html">python</a>
  </span>
  <span class="entry-info-sep">|</span>
  <span class="entry-info-tag">
    <i class="fa fa-bookmark-o"></i>
    tags:
    <a href="../../tag/flask/index.html">flask</a>
    <a href="../../tag/ajax/index.html">ajax</a>
    <a href="../../tag/jquery/index.html">jquery</a>
  </span>
</header>                    <hr class="entry-hr" />
                    <h3>简单使用ajax</h3>
<p><a href="http://www.w3school.com.cn/jquery/jquery_ref_ajax.asp">参考文档</a>  </p>
<div class="highlight"><pre><span></span><span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">text/javascript</span><span class="nt">&gt;</span>
$(document).ready(function(){
    $(&#39;button#ajax&#39;).click(function() {
        $.ajax ({
            type : &quot;POST&quot;,
            url : &quot;<span class="cp">{{</span> <span class="nv">url_for</span><span class="o">(</span><span class="s1">&#39;index.login&#39;</span><span class="o">)</span> <span class="cp">}}</span>&quot;,
            data:JSON.stringify({
                name: $(&#39;input[name=&quot;name&quot;]&#39;).val(),
                passwd: $(&#39;input[name=&quot;passwd&quot;]&#39;).val()
            }),
            contentType: &#39;application/json;charset=UTF-8&#39;,
            success: function(result) {
                if (result.judge == true)
                {
                    window.location = &#39;/&#39;;
                }
                else 
                {
                    $(&quot;#showerror&quot;).show();
                    $(&quot;#error&quot;).text(result.error);
                }
            }
        });
    });
});
<span class="nt">&lt;/script&gt;</span>
</pre></div>


<h3>ajax使用CSRF</h3>
<p><a href="http://flask-wtf.readthedocs.org/en/latest/csrf.html">参考文档</a>  </p>
<h4>首先注册CSRF</h4>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask_wtf.csrf</span> <span class="kn">import</span> <span class="n">CsrfProtect</span>
<span class="n">csrf</span> <span class="o">=</span> <span class="n">CsrfProtect</span><span class="p">()</span>
<span class="n">csrf</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</pre></div>


<h4>在模板中使用</h4>
<div class="highlight"><pre><span></span><span class="x">var csrftoken = &quot;</span><span class="cp">{{</span> <span class="nv">csrf_token</span><span class="o">()</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">    $.ajaxSetup({</span>
<span class="x">        beforeSend: function(xhr, settings) {</span>
<span class="x">            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) &amp;&amp; !this.crossDomain) {</span>
<span class="x">                xhr.setRequestHeader(&quot;X-CSRFToken&quot;, csrftoken)</span>
<span class="x">            }</span>
<span class="x">        }</span>
<span class="x">    });</span>
</pre></div>
<p>There are <a href="../../articles/2016/02/flask使用ajax.html#disqus_thread">comments</a>.</p>                </div>
            </article>
                <ul class="entry-list">
            <li><article>
                <h1 class="entry-title"><a href="../../articles/2016/02/使用jquery实现markdown预览.html" rel="bookmark" title="Permalink to 使用jquery实现markdown预览">使用jquery实现markdown预览</a></h1>
                <div class="entry-content">
<header class="entry-info">
  <span class="entry-info-date" title="2016-02-02T00:00:00+08:00">
    <i class="fa fa-calendar-o"></i>
    二 02 二月 2016
  </span>
  <span class="entry-info-sep">|</span>
  <span class="entry-info-author">
    <i class="fa fa-user-o"></i>
    By <a href="../../author/honmaple.html">honmaple</a>
  </span>
  <span class="entry-info-sep">|</span>
  <span class="entry-info-category">
    <i class="fa fa-folder-o"></i>
    In <a href="../../category/linux/index.html">linux</a>
  </span>
  <span class="entry-info-sep">|</span>
  <span class="entry-info-tag">
    <i class="fa fa-bookmark-o"></i>
    tags:
    <a href="../../tag/jquery/index.html">jquery</a>
    <a href="../../tag/markdown/index.html">markdown</a>
  </span>
</header>                <hr class="entry-hr" />
                <blockquote>
<p>虽然算不上是实时预览<br>
实时预览功能等有时间在把它加上</p>
</blockquote>
<p>还是把实时预览加上，不过实时预览可能会对网站有所影响，读者看着加上</p>
<h4>前端</h4>
<div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
<span class="kd">function</span> <span class="nx">previewTopicContent</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s2">&quot;{{ url_for(&#39;blog.preview&#39;) }}&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">content</span>: <span class="kt">$</span><span class="p">(</span><span class="s2">&quot;#content&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#showPreview&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
    <span class="p">});</span>
   <span class="cm">/*setTimeout(&#39;previewTopicContent()&#39;,300);*/</span>
<span class="p">};</span>
<span class="o">&lt;</span><span class="err">/script&gt;</span>
</pre></div>


<p>或者  </p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">previewTopicContent</span><span class="p">(){</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;{{ url_for(&#39;blog.preview&#39;) }}&quot;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">content</span>: <span class="kt">$</span><span class="p">(</span><span class="s2">&quot;#content&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#showPreview&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span>
</pre></div>


<h4>服务端</h4>
<div class="highlight"><pre><span></span><span class="nd">@site.route</span><span class="p">(</span><span class="s1">&#39;/pages/preview …</span></pre></div>
                  <div class="text-center">
                    <a class="btn entry-read-more" href="../../articles/2016/02/使用jquery实现markdown预览.html">阅读全文 »</a>
                  </div>
<p>There are <a href="../../articles/2016/02/使用jquery实现markdown预览.html#disqus_thread">comments</a>.</p>                </div>
            </article></li>
  <ul class="entry-pagination">
      <li class="active"><a href="../../tag/jquery/index.html">1</a></li>
  </ul>
                </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-offset-2 col-md-8" style="padding:0;">
      <div class="col-md-offset-1 col-md-10" style="padding:0;">
        <div class="footer">
          <div class="col-md-8 entry-blogroll">
            <h2>blogroll</h2>
            <ul class="list-inline list-unstyled">
              <li><a href="http://getpelican.com/">Pelican</a></li>
              <li><a href="http://python.org/">Python.org</a></li>
              <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
              <li><a href="https://honmaple.com">个人博客</a></li>
            </ul>
            <ul class="list-inline list-unstyled copyright">
              <li>Copyright © 2017 honmaple</li>
              <li>
                <a href="../../pages/about.html">About</a>
                <span> | </span>
                <a href="https://github.com/honmaple" target="_blank">GitHub</a>
                <span> | </span>
                <a href="../../pages/contact.html">Contact</a>
              </li>
            </ul>
          </div>
          <div class="col-md-offset-1 col-md-3 entry-social">
            <h2>social</h2>
            <ul class="list-unstyled">
              <li><a href="http://honmaple.org/feeds/all.rss.xml">Atom Feed</a></li>
              <li><a href="https://github.com/honmaple">GitHub</a></li>
              <li><a href="https://twitter.com/xiyang87">Twitter</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
    <script type="text/javascript" src="../../theme/js/particles.js"></script>
    <script type="text/javascript">
     /* window.onload= function(){
      *     var oDiv = document.getElementById("nav-header"),
      *         H = 0,
      *         Y = oDiv
      *     while (Y) {H += Y.offsetTop; Y = Y.offsetParent}
      *     window.onscroll = function()
      *     {
      *         var s = document.body.scrollTop || document.documentElement.scrollTop
      *         if(s>H) {
      *             oDiv.style = "position:fixed;top:0;z-index:999;background-color:#fff;"
      *         } else {
      *             oDiv.style = ""
      *         }
      *     }
      * }*/
    </script>
  </body>
</html>