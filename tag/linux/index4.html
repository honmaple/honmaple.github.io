<!DOCTYPE html>
<html lang="en">
  <head>
    <title>honmaple's blog - linux</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../theme/css/main.css" type="text/css" />
  </head>
  <body id="index" class="home">
    <div id="particles-js"></div>
    <div class="wrap">
      <div class="main">
        <header id="banner" class="body">
          <h1><a href="../..">honmaple's blog </a></h1>
          <nav><ul>
              <li><a href="http://honmaple.org">主页</a></li>
                <li ><a href="../../category/linux/index.html">Linux</a></li>
                <li ><a href="../../category/python/index.html">Python</a></li>
                <li ><a href="../../category/security/index.html">Security</a></li>
                <li class="dropdown">
                  <a href="../../category/sheng-huo-sui-bi/index.html" >生活随笔</a>
                  <dl>
                      <dd><a href="../../category/hui-yi/index.html">回忆</a></dd>
                  </dl>
                </li>
            <li class="dropdown">
              <a href="../../archives.html">Archives</a>
              <dl>
                <dd><a href="../../tags.html">Tags</a></dd>
                <dd><a href="../../categories.html">Categories</a></dd>
                <dd><a href="../../authors.html">Authors</a></dd>
              </dl>
            </li>
            <li style="float:right;margin-right:15px;">
              <form onsubmit="return dispatch()" class="search has-feedback">
                <input type="text" id="search" name="search"/>
                <i class="form-control-feedback"></i>
              </form>
            </li>
          </ul></nav>
        </header><!-- /#banner -->
        
        

 
          <section id="content" class="body">
            <ol id="posts-list" class="hfeed" start="8">
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2016/02/arch更新遇到的问题.html" rel="bookmark" title="Permalink to arch更新遇到的问题">arch更新遇到的问题</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2016-02-21T00:00:00+08:00">
    日 21 二月 2016
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">Linux</a>. </p>
<p>tags: <a href="../../tag/arch/index.html">arch</a><a href="../../tag/linux/index.html">linux</a></p></footer><!-- /.post-info -->            <p>：confuse: signature from "Thorsten Töpper <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#116;&#115;&#117;&#116;&#97;&#110;&#101;&#64;&#102;&#114;&#101;&#101;&#116;&#104;&#111;&#117;&#103;&#104;&#116;&#115;&#46;&#100;&#101;">&#97;&#116;&#115;&#117;&#116;&#97;&#110;&#101;&#64;&#102;&#114;&#101;&#101;&#116;&#104;&#111;&#117;&#103;&#104;&#116;&#115;&#46;&#100;&#101;</a>" is unknown trust</p>
<p>解决:</p>
<div class="highlight"><pre><span></span>$ sudo pacman-key --refresh-keys
</pre></div>


<p>arch错误：无法准备事务处理 (无法满足依赖关系) :: package-query: 要求 pacman&lt;4.3</p>
<p>解决:</p>
<div class="highlight"><pre><span></span>$ sudo pacman -R package-query yaourt
</pre></div>


<p>更新python2-pip出现问题</p>
<div class="highlight"><pre><span></span>$ sudo pacman -Syu
错误：无法提交处理 <span class="o">(</span>有冲突的文件<span class="o">)</span>
python2-pip: 文件系统中已存在 /usr/lib/python2.7/site-packages/pip/_vendor/requests/packages/urllib3/contrib/socks.py 
python2-pip: 文件系统中已存在 /usr/lib/python2.7/site-packages/pip/_vendor/requests/packages/urllib3/contrib …</pre></div>
            <a class="readmore" href="../../articles/2016/02/arch更新遇到的问题.html">read more</a>
<p>There are <a href="../../articles/2016/02/arch更新遇到的问题.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
        

 
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2016/01/redis记录用户操作.html" rel="bookmark" title="Permalink to redis记录用户操作">redis记录用户操作</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2016-01-10T00:00:00+08:00">
    日 10 一月 2016
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">linux</a>. </p>
<p>tags: <a href="../../tag/redis/index.html">redis</a><a href="../../tag/linux/index.html">linux</a></p></footer><!-- /.post-info -->            <p>必须得记下来，否则等那天看到又要浪费时间了,主要记录访问时间这里</p>
<div class="highlight"><pre><span></span>    &#39;&#39;&#39;记录访问的时间&#39;&#39;&#39;
    now_time = int(time()) #首先得到当前时间戳 
    &#39;&#39;&#39;查询上次访问的时间和最近访问的时间&#39;&#39;&#39;
    query_last_time = redis_data.zscore(visited_users,&#39;last_time&#39;)
    query_now_time = redis_data.zscore(visited_users,&#39;time&#39;)
    &#39;&#39;&#39;判断查询是否为空,一般是第一次访问还未记录的IP&#39;&#39;&#39;
    if query_last_time is None:
        query_last_time = now_time
        pipe.zadd(visited_users,query_last_time,&#39;last_time&#39;)
    if query_now_time is None:
        query_now_time = now_time
    &#39;&#39;&#39;将当前时间与last_time进行对比,十分钟之内不记录&#39;&#39;&#39;
    if now_time - query_last_time &gt;= 600:
        &#39;&#39;&#39;这里类似交换更新数据,把query_now_time变成last_time,把now_time更新&#39;&#39;&#39;
        pipe.zadd(visited_users,query_now_time,&#39;last_time&#39;)
        pipe.zadd(visited_users,now_time,&#39;time&#39;)
    else:
        pipe.zadd(visited_users,now_time,&#39;time&#39;)
</pre></div>
            <a class="readmore" href="../../articles/2016/01/redis记录用户操作.html">read more</a>
<p>There are <a href="../../articles/2016/01/redis记录用户操作.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
        

 
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2016/01/flask应用部署——安装环境.html" rel="bookmark" title="Permalink to flask应用部署——安装环境">flask应用部署——安装环境</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2016-01-06T00:00:00+08:00">
    三 06 一月 2016
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">linux</a>. </p>
<p>tags: <a href="../../tag/flask/index.html">flask</a><a href="../../tag/nginx/index.html">nginx</a><a href="../../tag/python3/index.html">python3</a><a href="../../tag/linux/index.html">linux</a></p></footer><!-- /.post-info -->            <p>虽然以前安装过但是没有记录，这次重新安装，趁机记录下来，省得满世界地找  </p>
<blockquote>
<p>环境: centos7  </p>
</blockquote>
<h3>安装nginx</h3>
<p><a href="https://www.nginx.com/resources/wiki/start/topics/tutorials/install/">参考资料</a><br>
使用<code>yum list nginx</code>会发现nginx是1.6的版本,但现在nginx已经到了1.9，虽然不必那么新，
但是过旧的版本说不定会出现安全问题  </p>
<div class="highlight"><pre><span></span># vim /etc/yum.repos.d/nginx.repo
</pre></div>


<p>输入  </p>
<div class="highlight"><pre><span></span><span class="k">[nginx]</span>
<span class="na">name</span><span class="o">=</span><span class="s">nginx repo</span>
<span class="na">baseurl</span><span class="o">=</span><span class="s">http://nginx.org/packages/centos/$releasever/$basearch/</span>
<span class="na">gpgcheck</span><span class="o">=</span><span class="s">0</span>
<span class="na">enabled</span><span class="o">=</span><span class="s">1</span>
</pre></div>


<p>然后</p>
<div class="highlight"><pre><span></span># yum list nginx  #你会发现nginx已经是1.8的版本
# yum install nginx
# systemctl start nginx #启动nginx
</pre></div>


<h3>安装python3</h3>
<p>centos7默认安装了python2.7的版本，但我习惯用python3,但是centos无法通过yum install python3安装,
只好自己编译了  </p>
<h4>安装必要的文件 …</h4>
            <a class="readmore" href="../../articles/2016/01/flask应用部署——安装环境.html">read more</a>
<p>There are <a href="../../articles/2016/01/flask应用部署——安装环境.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
        

 
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2016/01/supervisor使用.html" rel="bookmark" title="Permalink to supervisor使用">supervisor使用</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2016-01-06T00:00:00+08:00">
    三 06 一月 2016
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">linux</a>. </p>
<p>tags: <a href="../../tag/supervisor/index.html">supervisor</a><a href="../../tag/web/index.html">web</a><a href="../../tag/linux/index.html">linux</a></p></footer><!-- /.post-info -->            <blockquote>
<p>supervisor安装请参考<a href="https://honmaple.com/blog/pages/31">flask应用部署——安装环境</a></p>
</blockquote>
<h4>生成配置文件</h4>
<div class="highlight"><pre><span></span># cd /etc
# mkdir -p supervisord/conf.d
# echo_supervisord_conf &gt; /etc/supervisord/supervisord.conf
</pre></div>


<h4>修改supervisord.conf</h4>
<div class="highlight"><pre><span></span># vim supervisord.conf # G直接跳到最后一行
</pre></div>


<p>取消下面注释并修改</p>
<div class="highlight"><pre><span></span><span class="k">[include]</span>
<span class="na">files</span> <span class="o">=</span> <span class="s">/etc/supervisord/conf.d/*.ini</span>
</pre></div>


<p>ok，现在可以在/etc/supervisord/conf.d/目录下创建配置文件了  </p>
<div class="highlight"><pre><span></span># vim honmaple.com.ini
</pre></div>


<p>输入以下内容  </p>
<div class="highlight"><pre><span></span># 进程的名字
[program:website]
# 命令
command=/home/www/honmaple.com/venv/bin/gunicorn run:app -c /home/www/honmaple.com/gunicorn.conf
# 网站目录 …</pre></div>
            <a class="readmore" href="../../articles/2016/01/supervisor使用.html">read more</a>
<p>There are <a href="../../articles/2016/01/supervisor使用.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
        

 
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2015/12/如何备份postgresql数据库.html" rel="bookmark" title="Permalink to 如何备份postgresql数据库">如何备份postgresql数据库</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2015-12-26T00:00:00+08:00">
    六 26 十二月 2015
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">linux</a>. </p>
<p>tags: <a href="../../tag/postgresql/index.html">postgresql</a><a href="../../tag/sql/index.html">sql</a><a href="../../tag/linux/index.html">linux</a></p></footer><!-- /.post-info -->            <p>对于网站来说数据无疑是最重要的，而养成备份数据的习惯更加重要，
忽然想到一句经典台词  </p>
<blockquote>
<p>曾经有一份数据摆在我的面前，<br>
可我没有备份，<br>
直到数据丢失后才后悔莫及,<br>
人世间最痛苦的事莫过于此，<br>
如果上天能给我一次再来一次的机会，<br>
我会对那份数据说五个字：我要备份你，<br>
如果非要在这份备份上加一个期限，我希望是每天！</p>
</blockquote>
<p>进入主题,这只是对数据进行简单的备份</p>
<h3>怎么备份数据</h3>
<p>shell脚本</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">backup_time</span><span class="o">=</span><span class="sb">`</span>date +%Y%m%d<span class="sb">`</span>
pg_dump articledb &gt; /home/xxx/backup/article_<span class="nv">$backup_time</span>.sql
<span class="c1"># articledb是要备份的数据库名称</span>
<span class="nb">echo</span> <span class="s2">&quot;backup finished&quot;</span>
</pre></div>
</td></tr></table>

<p>保存为backup_db.sh<br>
<strong>注意</strong><br>
xxx是数据库用户,并且是super权限<br>
可以这样  </p>
<div class="highlight"><pre><span></span>$ sudo -i -u postgres
$ <span class="o">[</span>sudo<span class="o">]</span> xxx 的密码:
postgres~ $ createuser xxx --interactive 
<span class="c1"># 创建数据库用户,我的是archlinux,不同系统可能有所不同</span>
</pre></div>


<h3>定时备份数据</h3>
<div class="highlight"><pre><span></span>crontab -e …</pre></div>
            <a class="readmore" href="../../articles/2015/12/如何备份postgresql数据库.html">read more</a>
<p>There are <a href="../../articles/2015/12/如何备份postgresql数据库.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
        

 
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2015/12/centos搭建shadowsocks服务端.html" rel="bookmark" title="Permalink to centos搭建shadowsocks服务端">centos搭建shadowsocks服务端</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2015-12-22T00:00:00+08:00">
    二 22 十二月 2015
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">linux</a>. </p>
<p>tags: <a href="../../tag/linux/index.html">linux</a><a href="../../tag/centos/index.html">centos</a><a href="../../tag/shadowsocks/index.html">shadowsocks</a></p></footer><!-- /.post-info -->            <p>刚搭建好，记录下来，用的是centos</p>
            <a class="readmore" href="../../articles/2015/12/centos搭建shadowsocks服务端.html">read more</a>
<p>There are <a href="../../articles/2015/12/centos搭建shadowsocks服务端.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
        

 
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2015/12/fedora22成功安装bumblebee-nvidia.html" rel="bookmark" title="Permalink to fedora22成功安装bumblebee-nvidia">fedora22成功安装bumblebee-nvidia</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2015-12-22T00:00:00+08:00">
    二 22 十二月 2015
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">linux</a>. </p>
<p>tags: <a href="../../tag/linux/index.html">linux</a><a href="../../tag/fedora/index.html">fedora</a><a href="../../tag/nvidia/index.html">nvidia</a></p></footer><!-- /.post-info -->            <p>参考fedora安装<a href="http://fedoraproject.org/wiki/Bumblebee#Description">bumblebee官方wiki</a> <br />写在前面：安装前最好更新系统，安装内核头文件等，如果有多余旧内核先删除 <br />安装驱动最好进入字符界面操作</p>
<p>有一些错误，现更正</p>
<h3>将selinux设置为disabled</h3>
<div class="highlight"><pre><span></span># vim /etc/sysconfig/selinux
</pre></div>


<h3>安装及必要的依赖</h3>
<div class="highlight"><pre><span></span># dnf install -y libbsd-devel libbsd glibc-devel libX11-devel help2man autoconf git tar glib2 glib2-devel kernel-devel kernel-headers automake gcc gtk2-devel 
# dnf install VirtualGL 
# dnf install VirtualGL.i686  # 即使是在64位操作系统上，这个也是必装的
# dnf -y install http://install.linux.ncsu.edu/pub/yum/itecs/public/bumblebee/fedora22/noarch/bumblebee-release-1.2-1.noarch.rpm 
# dnf -y install …</pre></div>
            <a class="readmore" href="../../articles/2015/12/fedora22成功安装bumblebee-nvidia.html">read more</a>
<p>There are <a href="../../articles/2015/12/fedora22成功安装bumblebee-nvidia.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
        

 
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2015/12/fedora安装后设置.html" rel="bookmark" title="Permalink to fedora安装后设置">fedora安装后设置</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2015-12-22T00:00:00+08:00">
    二 22 十二月 2015
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">linux</a>. </p>
<p>tags: <a href="../../tag/linux/index.html">linux</a><a href="../../tag/fedora/index.html">fedora</a></p></footer><!-- /.post-info -->            <p>记录一下，省得每次重装都要找（绝大多数转自网络)<br /><br />fedora22 发布后 dnf 代替了 yum</p>
<h2>1.增加sudo用户组</h2>
<div class="highlight"><pre><span></span>$ su
</pre></div>


<p>转到root用户，输入密码  </p>
<div class="highlight"><pre><span></span># visudo
</pre></div>


<p>在root ALL=(ALL) ALL下增加一行  </p>
<div class="highlight"><pre><span></span>yourname ALL=(ALL) ALL
</pre></div>


<p>如果不想每次输入密码更改为  </p>
<div class="highlight"><pre><span></span>yourname ALL=(ALL) NOPASSWD:ALL

:wq #保存退出  
exit #回到一般用户
</pre></div>


<h2>2.备份的主题，图标,字体拷贝到home目录</h2>
<div class="highlight"><pre><span></span>$ cp -r files ~/.theme 
$ cp -r files ~/.icons
$ cp -r files ~/.fonts
$ sudo chmod -R <span class="m">755</span> files
</pre></div>


<p>## 3. 启用RPM Fusion仓库</p>
<div class="highlight"><pre><span></span>$ sudo rpm -Uhv http://download1.rpmfusion.org/nonfree …</pre></div>
            <a class="readmore" href="../../articles/2015/12/fedora安装后设置.html">read more</a>
<p>There are <a href="../../articles/2015/12/fedora安装后设置.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
        

 
        <li><article class="hentry">    
          <header>
            <h1><a href="../../articles/2015/12/git学习.html" rel="bookmark" title="Permalink to git学习">git学习</a></h1>
          </header>
          
          <div class="entry-content">
<footer class="post-info">
  <abbr class="published" title="2015-12-22T00:00:00+08:00">
    二 22 十二月 2015
  </abbr>

    <address class="vcard author">
      By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
    </address>
  <p>In <a href="../../category/linux/index.html">linux</a>. </p>
<p>tags: <a href="../../tag/linux/index.html">linux</a><a href="../../tag/git/index.html">git</a></p></footer><!-- /.post-info -->            <p>参考资料
<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000">廖雪峰Git教程</a><br>
记忆一下主要内容：</p>
<h3>安装git</h3>
<div class="highlight"><pre><span></span>$ sudo dnf install git
</pre></div>


<h3>安装后配置</h3>
<div class="highlight"><pre><span></span>$ git config --global user.name <span class="s2">&quot;Your Name&quot;</span>
$ git config --global user.email <span class="s2">&quot;email@example.com&quot;</span>
</pre></div>


<h3>创建版本库</h3>
<div class="highlight"><pre><span></span>$ mkdir git
$ <span class="nb">cd</span> git
$ mkdir <span class="s2">&quot;目录名&quot;</span>
$ <span class="nb">cd</span> <span class="s2">&quot;目录名&quot;</span>
$ git init <span class="c1">#将该目录变成可用于git管理的仓库</span>
</pre></div>


<h3>git操作指令</h3>
<div class="highlight"><pre><span></span>$ git add filename <span class="c1">#将文件添加到仓库</span>
$ git commit -m <span class="s2">&quot;注释内容&quot;</span>  <span class="c1">#将文件提交到仓库，-m后面是本次提交的内容说明</span>
$ git add file1.txt
$ git add file2.txt file3.txt
$ git commit -m <span class="s2">&quot;add 3 files.&quot;</span> <span class="c1">#git …</span></pre></div>
            <a class="readmore" href="../../articles/2015/12/git学习.html">read more</a>
<p>There are <a href="../../articles/2015/12/git学习.html#disqus_thread">comments</a>.</p>          </div><!-- /.entry-content -->
        </article></li>
<p class="paginator">
            <a href="../../tag/linux/index3.html">&laquo;</a>
    Page 4 / 5
        <a href="../../tag/linux/index5.html">&raquo;</a>
</p>
            </ol><!-- /#posts-list -->
          </section><!-- /#content -->
      </div>
    </div>
    <div class="footer">
      <section id="extras">
          <div class="blogroll">
            <h2>blogroll</h2>
            <ul>
                <li><a href="http://getpelican.com/">Pelican</a></li>
                <li><a href="http://python.org/">Python.org</a></li>
                <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                <li><a href="https://honmaple.com">个人博客</a></li>
            </ul>
          </div><!-- /.blogroll -->
          <div class="social">
            <h2>social</h2>
            <ul>
                <li><a href="http://honmaple.org/feeds/all.rss.xml">Atom Feed</a></li>
                <li><a href="https://github.com/honmaple">GitHub</a></li>
                <li><a href="https://twitter.com/xiyang87">Twitter</a></li>
            </ul>
          </div><!-- /.social -->
      </section><!-- /#extras -->
    </div>

<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-88401692-2', 'auto');
 ga('send', 'pageview');

</script>
<script type="text/javascript">
    var disqus_shortname = 'honmaple';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
    <script src="https://cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
    <script type="text/javascript" src="../../theme/js/particles.js"></script>
  </body>
</html>