<!DOCTYPE html>
<html lang="en">
<head>
        <title>HonMaple's Blog - awesome</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../../theme/css/main.css" type="text/css" />
        <link rel="stylesheet" href="../../theme/css/pygments/monokai.css" type="text/css" />
   

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../../css/ie.css"/>
                <script src="../../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
<a href="http://github.com/honmaple/honmaple.github.io">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="../..">HonMaple's Blog </a></h1>
                <nav><ul>
                <li> <a href="../..">主页</a></li>
                    <li ><a href="../../category/blog-category.html">blog-category</a></li>
                    <li ><a href="../../category/linux.html">Linux</a></li>
                    <li ><a href="../../category/python.html">Python</a></li>
                    <li ><a href="../../category/sheng-huo-sui-bi.html">生活随笔</a></li>
                <li> <a href="../../archives/">Archives</a></li>
                    <li><a href="../../pages/about">About</a></li>
                </ul></nav>
        </header><!-- /#banner -->
        
        

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../../articles/2016/04/flaskshi-xian-fen-ye.html">flask实现分页</a></h1> 
<footer class="post-info">
        <abbr class="published" title="2016-04-14T00:00:00+02:00">
                四 14 四月 2016
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
        </address>
<p>In <a href="../../category/python.html">Python</a>. </p>
<p>tags: <a href="../../tag/thats/">thats</a><a href="../../tag/awesome/">awesome</a></p></footer><!-- /.post-info --><div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id8">1 数据库实现分页</a><ul>
<li><a class="reference internal" href="#offset" id="id9">1.1 offset</a></li>
<li><a class="reference internal" href="#limit" id="id10">1.2 limit</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2" id="id11">2 前端实现分页</a><ul>
<li><a class="reference internal" href="#id3" id="id12">2.1 需求设计</a></li>
<li><a class="reference internal" href="#id4" id="id13">2.2 简单的上一页，下一页</a><ul>
<li><a class="reference internal" href="#id5" id="id14">2.2.1 下一页,上一页</a></li>
<li><a class="reference internal" href="#id6" id="id15">2.2.2 首页没有上一页，尾页没有下一页</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7" id="id16">2.3 显示各个页码的分页</a></li>
</ul>
</li>
</ul>
</div>
<ul class="simple">
<li></li>
</ul>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id8">1 数据库实现分页</a></h2>
<div class="section" id="offset">
<h3><a class="toc-backref" href="#id9">1.1 offset</a></h3>
<p>使用offset可以实现数据库分页功能</p>
<div class="highlight"><pre><span></span><span class="n">questions</span> <span class="o">=</span> <span class="n">Questions</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="c1"># 从num开始</span>
</pre></div>
</div>
<div class="section" id="limit">
<h3><a class="toc-backref" href="#id10">1.2 limit</a></h3>
<p>使用limit实现限制每页的文章数量</p>
<div class="highlight"><pre><span></span><span class="n">questions</span> <span class="o">=</span> <span class="n">Questions</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="c1">#每页显示6篇文章</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2><a class="toc-backref" href="#id11">2 前端实现分页</a></h2>
<div class="section" id="id3">
<h3><a class="toc-backref" href="#id12">2.1 需求设计</a></h3>
<p>是使用上一页，下一页，用表单进行跳转,还是使用数字显示</p>
<p>获得文章数量 <strong>pages</strong>,和当前页码 <strong>number</strong></p>
</div>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id13">2.2 简单的上一页，下一页</a></h3>
<p><em>因为我的设计不是这个，所以简单说一下</em></p>
<div class="section" id="id5">
<h4><a class="toc-backref" href="#id14">2.2.1 下一页,上一页</a></h4>
<p><strong>jinja2</strong> 代码</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;blog.index&#39;,number=number + 1)}}&quot;</span><span class="p">&gt;</span>下一页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;blog.index&#39;,number=number - 1)}}&quot;</span><span class="p">&gt;</span>下一页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<div class="section" id="id6">
<h4><a class="toc-backref" href="#id15">2.2.2 首页没有上一页，尾页没有下一页</a></h4>
<div class="highlight"><pre><span></span>{% if number == pages %}
no next page
{% else %}
 <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;blog.index&#39;,number=number + 1)}}&quot;</span><span class="p">&gt;</span>下一页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
{% endif %}
{% if number == 1 %}
no previous page
{% else %}
 <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(&#39;blog.index&#39;,number=number - 1)}}&quot;</span><span class="p">&gt;</span>上一页<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
{% endif %}
</pre></div>
</div>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id16">2.3 显示各个页码的分页</a></h3>
<p>搞了一下午,终于搞定了</p>
<div class="highlight"><pre><span></span>{% macro page(url,number=1,pages=1,kw=None) -%}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;text-align:center;margin-top:-15px&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pagination&quot;</span><span class="p">&gt;</span>
        {%- if number == 1 %}
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Previous&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {%- else -%}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
            {% if not kw %}
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(url,number=number-1) }}&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Previous&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% else %}
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(url,number=number-1,**kw) }}&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Previous&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span><span class="ni">&amp;laquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% endif -%}
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {% endif -%}

        {% if pages <span class="p">&lt;</span> <span class="nt">7</span> <span class="err">%}</span>
        <span class="err">{%</span> <span class="na">for</span> <span class="na">page</span> <span class="na">in</span> <span class="na">range</span><span class="err">(</span><span class="na">1</span><span class="err">,</span><span class="na">pages</span> <span class="err">+</span> <span class="na">1</span><span class="err">)</span> <span class="err">%}</span>
        <span class="err">{{</span> <span class="na">page_url</span><span class="err">(</span><span class="na">url</span><span class="err">,</span><span class="na">page</span><span class="err">,</span><span class="na">number</span><span class="err">,</span><span class="na">kw</span><span class="err">)</span> <span class="err">}}</span>
        <span class="err">{%</span> <span class="na">endfor</span> <span class="err">%}</span>
        <span class="err">{%</span> <span class="na">else</span> <span class="err">%}</span>
        <span class="err">{%</span> <span class="na">if</span> <span class="na">number</span> <span class="err">&lt;=</span> <span class="na">4</span> <span class="err">%}</span>
        <span class="err">{%</span> <span class="na">for</span> <span class="na">page</span> <span class="na">in</span> <span class="na">range</span><span class="err">(</span><span class="na">1</span><span class="err">,</span><span class="na">6</span><span class="err">)</span> <span class="err">%}</span>
        <span class="err">{{</span> <span class="na">page_url</span><span class="err">(</span><span class="na">url</span><span class="err">,</span><span class="na">page</span><span class="err">,</span><span class="na">number</span><span class="err">,</span><span class="na">kw</span><span class="err">)</span> <span class="err">}}</span>
        <span class="err">{%</span> <span class="na">endfor</span> <span class="err">%}</span>

        <span class="err">{%</span><span class="na">-</span> <span class="na">if</span> <span class="na">number</span> <span class="err">&lt;=</span> <span class="na">pages</span> <span class="na">-</span> <span class="na">2</span> <span class="err">%}</span>
        <span class="err">&lt;</span><span class="na">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span><span class="p">&gt;</span>···<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {%- endif -%}

        {{ page_url(url,pages,number,kw) }}
        {% else %}
        {{ page_url(url,1,number,kw) }}
        {{ page_url(url,2,number,kw) }}
        {{ page_dot_start(number)}}

        {% if number &gt;= pages - 3 %}
        {% for page in range(number-2,pages + 1) %}
        {{ page_url(url,page,number,kw) }}
        {% endfor %}
        {% else %}
        {% for page in range(number-2,number + 3) %}
        {{ page_url(url,page,number,kw) }}
        {% endfor %}
        {{ page_dot_end(pages,number) }}
        {{ page_url(url,pages,number,kw) }}
        {% endif  %}

        {% endif  %}
        {% endif  %}


        {%- if number == pages %}
        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Next&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {%- else -%}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>
            {% if not kw %}
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(url,number=number+1) }}&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Next&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% else %}
            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(url,number=number+1,**kw) }}&quot;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&quot;Next&quot;</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">span</span> <span class="na">aria-hidden</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="p">&gt;</span><span class="ni">&amp;raquo;</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
            {% endif -%}
        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {% endif -%}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endmacro %}

{% macro page_url(url,page,number,kw) -%}
{%- if page == number %}
<span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;active&quot;</span><span class="p">&gt;</span>{{ page_kw(url,page,kw)}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
{%- else -%}
<span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ page_kw(url,page,kw)}}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
{%- endif -%}
{% endmacro %}

{% macro page_dot_end(pages,number) -%}
{%- if number <span class="err">&lt;</span>= pages - 4 %}
<span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span><span class="p">&gt;</span>···<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
{%- endif -%}
{% endmacro %}

{% macro page_dot_start(number) -%}
{%- if number &gt; 5 %}
<span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;disabled&quot;</span><span class="p">&gt;&lt;</span><span class="nt">a</span><span class="p">&gt;</span>···<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
{%- endif -%}
{% endmacro %}

{% macro page_kw(url,page,kw) -%}
{% if not kw %}
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(url,number=page) }}&quot;</span><span class="p">&gt;</span>{{ page }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
{% else %}
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ url_for(url,number=page,**kw) }}&quot;</span><span class="p">&gt;</span>{{ page }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
{%- endif -%}
{% endmacro %}
</pre></div>
</div>
</div>
<p>There are <a href="../../articles/2016/04/flaskshi-xian-fen-ye.html#disqus_thread">comments</a>.</p>                </article>
<p class="paginator">
    Page 1 / 1
</p>
            </aside><!-- /#featured -->
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="https://honmaple.com">个人博客</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            
                            <li><a href="https://github.com/honmaple">GitHub</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">

        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'honmaple';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>