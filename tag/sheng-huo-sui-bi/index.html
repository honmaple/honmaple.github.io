<!DOCTYPE html>
<html lang="en">
    <head>
        <title>HonMaple's Blog - 生活随笔</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../../theme/css/main.css" type="text/css" />
    </head>
    <body id="index" class="home">
<a href="http://github.com/honmaple/honmaple.github.io">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="../../theme/css/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
            <h1><a href="../..">HonMaple's Blog </a></h1>
            <nav><ul>
                <li><a href="http://honmaple.org">主页</a></li>
                <li ><a href="../../categories/linux/index.html">Linux</a></li>
                <li ><a href="../../categories/python/index.html">Python</a></li>
                <li ><a href="../../categories/security/index.html">Security</a></li>
                <li ><a href="../../categories/sheng-huo-sui-bi/index.html">生活随笔</a></li>
                <li><a href="../../archives/">Archives</a></li>
            </ul></nav>
        </header><!-- /#banner -->
        
        

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../../articles/2016/12/我的毕业设计--数据库设计之站内信.html">我的毕业设计--数据库设计之站内信</a></h1> 
<footer class="post-info">
        <abbr class="published" title="2016-12-28T00:00:00+08:00">
                三 28 十二月 2016
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
        </address>
<p>In <a href="../../categories/sheng-huo-sui-bi/index.html">生活随笔</a>. </p>
<p>tags: <a href="../../tag/sheng-huo-sui-bi/">生活随笔</a><a href="../../tag/bi-ye-she-ji/">毕业设计</a></p></footer><!-- /.post-info --><div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline7">1. 站内信设计</a>
<ul>
<li><a href="#orgheadline3">1.1. 逻辑实现</a>
<ul>
<li><a href="#orgheadline1">1.1.1. 点对点(私信)</a></li>
<li><a href="#orgheadline2">1.1.2. 点对面(系统消息)</a></li>
</ul>
</li>
<li><a href="#orgheadline6">1.2. 数据库设计</a>
<ul>
<li><a href="#orgheadline4">1.2.1. 信息表(关联)</a></li>
<li><a href="#orgheadline5">1.2.2. 信息内容表</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<h1>站内信设计<a id="orgheadline7"></a></h1>
<h2>逻辑实现<a id="orgheadline3"></a></h2>
<h3>点对点(私信)<a id="orgheadline1"></a></h3>
<ul>
<li>发送方
    sender</li>
<li>接收方
    receiver</li>
<li>状态
    status</li>
<li>信息内容
    message</li>
<li>信息分类
    message_type</li>
<li>
<p>发送时间
    created_at</p>
<p>点对点发送消息比较简单,每次发送为单表时插入 <strong>sender</strong>, <strong>receiver</strong>, <strong>message</strong>, <strong>created_at</strong></p>
<blockquote>
<p>(伪代码)
-   获取未读信息</p>
</blockquote>
<div class="highlight"><pre><span></span>select message from message where reveiver_id == &#39;user.id&#39; and status = &#39;unread&#39;;
</pre></div>


<ul>
<li>
<p>获取系统未读信息</p>
<p>select message from message where reveiver_id == 'user.id' and status = 'unread' and message_type = 'sys'
-   获取已读信息</p>
<p>status = 'read'</p>
</li>
</ul>
</li>
</ul>
<h3>点对面(系统消息)<a id="orgheadline2"></a></h3>
<p>点对面实现不能像<strong>点对点</strong>一样为每一个用户创建一条数据(如果数以十万百万计)  </p>
<p>具体实现看这里 <a href="http://www.cnblogs.com/grenet/archive/2010/04/09/1708008.html"><a href="http://www.cnblogs.com/grenet/archive/2010/04/09/1708008.html">http://www.cnblogs.com/grenet/archive/2010/04/09/1708008.html</a></a></p>
<blockquote>
<p>简单讲一下我理解的逻辑(伪代码):</p>
</blockquote>
<ul>
<li>
<p>发送私信(点对点)</p>
<div class="highlight"><pre><span></span># 先保存消息主体内容
message_text = MessageText(
    sender = sender,
    message = message,
    message_type = message_type(私信)
)
# 保存接受方，并关联消息主体
message = Message(
    message_text_id = message_text.id,
    receiver = receiver,
    status = &#39;unread&#39;
)
</pre></div>


<ul>
<li>获取未读信息<div class="highlight"><pre><span></span>messages = Message.query.filter_by(receiver = current_user,status = &#39;unread&#39;)
</pre></div>


</li>
</ul>
</li>
<li>
<p>系统消息</p>
<div class="highlight"><pre><span></span># 只保存消息主体内容
message_text = MessageText(
    sender = sender,
    message = message,
    message_type = message_type(系统消息)
)
</pre></div>


<ul>
<li>
<p>获取未读信息
    判断 <strong>message</strong> 表中 <strong>message_text_id</strong> 是否存在于 <strong>message_text_id__list</strong> (receiver = current_user)</p>
<p><del>不存在</del>,标记为<strong>系统未读</strong>  </p>
<p>存在,判断是否未读
    -   获取具体未读信息</p>
<p>如上<del>不存在</del>时</p>
<div class="highlight"><pre><span></span># 保存消息
message = Message(receiver = current_user,
                  status = &#39;read&#39;,
                  message_text_id = message_text.id)
</pre></div>


<p><strong>存在</strong>时,</p>
<div class="highlight"><pre><span></span>message.status = &#39;read&#39;
</pre></div>


</li>
</ul>
</li>
</ul>
<h2>数据库设计<a id="orgheadline6"></a></h2>
<h3>信息表(关联)<a id="orgheadline4"></a></h3>
<div class="highlight"><pre><span></span><span class="n">tablename</span><span class="o">:</span> <span class="n">message</span>
</pre></div>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="table table-bordered table-hover">

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">字段名</th>
<th scope="col" class="org-left">字段类型</th>
<th scope="col" class="org-left">字段描述</th>
<th scope="col" class="org-left">是否为空</th>
<th scope="col" class="org-left">是否unique</th>
<th scope="col" class="org-left">默认值</th>
</tr>
</thead>

<tbody>
<tr>
<td class="org-left">receiver_id</td>
<td class="org-left">integer</td>
<td class="org-left">接收方外键ID</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">&#xa0;</td>
</tr>


<tr>
<td class="org-left">receiver</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">接收方</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">&#xa0;</td>
</tr>


<tr>
<td class="org-left">message_text_id</td>
<td class="org-left">integer</td>
<td class="org-left">站内信主体内容外键ID</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">&#xa0;</td>
</tr>


<tr>
<td class="org-left">message_text</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">站内信主体内容</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">&#xa0;</td>
</tr>


<tr>
<td class="org-left">status</td>
<td class="org-left">string</td>
<td class="org-left">站内信状态</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">0(未读)</td>
</tr>
</tbody>
</table>

<h3>信息内容表<a id="orgheadline5"></a></h3>
<div class="highlight"><pre><span></span><span class="n">tablename</span><span class="o">:</span> <span class="n">message_text</span>
</pre></div>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides" class="table table-bordered table-hover">

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">字段名</th>
<th scope="col" class="org-left">字段类型</th>
<th scope="col" class="org-left">字段描述</th>
<th scope="col" class="org-left">是否为空</th>
<th scope="col" class="org-left">是否unique</th>
<th scope="col" class="org-left">默认值</th>
</tr>
</thead>

<tbody>
<tr>
<td class="org-left">title</td>
<td class="org-left">string(128)</td>
<td class="org-left">站内信标题</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">&#xa0;</td>
</tr>


<tr>
<td class="org-left">content</td>
<td class="org-left">text(1024)</td>
<td class="org-left">站内信内容</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">&#xa0;</td>
</tr>


<tr>
<td class="org-left">message_type</td>
<td class="org-left">string</td>
<td class="org-left">站内信类别</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">2(系统信息)</td>
</tr>


<tr>
<td class="org-left">sender_id</td>
<td class="org-left">integer</td>
<td class="org-left">发送方外键ID</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">&#xa0;</td>
</tr>


<tr>
<td class="org-left">sender</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">发送方</td>
<td class="org-left">False</td>
<td class="org-left">False</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table><p>There are <a href="../../articles/2016/12/我的毕业设计--数据库设计之站内信.html#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">
        

 
            <li><article class="hentry">    
                <header>
                        <h1><a href="../../articles/2016/10/世界这么大，我想去看看.html" rel="bookmark" title="Permalink to 世界这么大，我想去看看">世界这么大，我想去看看</a></h1>
                </header>
                
                <div class="entry-content" style="color:#666;">
<footer class="post-info">
        <abbr class="published" title="2016-10-29T00:00:00+08:00">
                六 29 十月 2016
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
        </address>
<p>In <a href="../../categories/sheng-huo-sui-bi/index.html">生活随笔</a>. </p>
<p>tags: <a href="../../tag/sheng-huo-sui-bi/">生活随笔</a><a href="../../tag/liu-lang/">流浪</a></p></footer><!-- /.post-info -->                <p>:世界那么大，我想去看看···</p>
<p>:我得养家······</p>
                <a class="readmore" href="../../articles/2016/10/世界这么大，我想去看看.html">read more</a>
<p>There are <a href="../../articles/2016/10/世界这么大，我想去看看.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
        

 
            <li><article class="hentry">    
                <header>
                        <h1><a href="../../articles/2016/10/世界总是充满杯具.html" rel="bookmark" title="Permalink to 世界总是充满杯具">世界总是充满杯具</a></h1>
                </header>
                
                <div class="entry-content" style="color:#666;">
<footer class="post-info">
        <abbr class="published" title="2016-10-17T00:00:00+08:00">
                一 17 十月 2016
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="../../author/honmaple.html">honmaple</a>
        </address>
<p>In <a href="../../categories/sheng-huo-sui-bi/index.html">生活随笔</a>. </p>
<p>tags: <a href="../../tag/sheng-huo-sui-bi/">生活随笔</a></p></footer><!-- /.post-info -->                <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. 独自旅行的杯子</a></li>
<li><a href
                <a class="readmore" href="../../articles/2016/10/世界总是充满杯具.html">read more</a>
<p>There are <a href="../../articles/2016/10/世界总是充满杯具.html#disqus_thread">comments</a>.</p>                </div><!-- /.entry-content -->
            </article></li>
<p class="paginator">
    Page 1 / 1
</p>
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
            <div class="blogroll">
                <h2>blogroll</h2>
                <ul>
                    <li><a href="http://getpelican.com/">Pelican</a></li>
                    <li><a href="http://python.org/">Python.org</a></li>
                    <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                    <li><a href="https://honmaple.com">个人博客</a></li>
                </ul>
            </div><!-- /.blogroll -->
            <div class="social">
                <h2>social</h2>
                <ul>
                    <li><a href="http://honmaple.org/feeds/all.rss.xml">Atom Feed</a></li>
                    <li><a href="https://github.com/honmaple">GitHub</a></li>
                    <li><a href="https://twitter.com/xiyang87">Twitter</a></li>
                </ul>
            </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">

        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'honmaple';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
    </body>
</html>