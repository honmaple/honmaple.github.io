<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>emacs · 紅楓吟</title>
      <link href="https://s.libforest.com/static/css/lib.min.css" rel="stylesheet">
        <link href="https://honmaple.me/static/lib/css/style.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="particles-js" id="particles-js"></div>
    <div class="scrollbar"></div>
    <div class="wrap">
      <div class="main">
<nav class="navbar navbar-default">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-header" aria-expanded="false">
      <span class="sr-only"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="https://honmaple.me">
      <img class="navbar-logo" src="https://s.libforest.com/images/header/header-logo.png" alt="楓">
    </a>
      <p class="navbar-text">—— 风落花语风落天，花落风雨花落田.</p>
  </div>
  <div class="collapse navbar-collapse" id="nav-header">
    <ul class="nav navbar-nav">
          <li class="dropdown">
            <a href="https://honmaple.me/categories/life/index.html" >代码人生</a>
            <ul class="dropdown-menu">
                <li><a href="https://honmaple.me/categories/coding/index.html">分享世界</a></li>
                <li><a href="https://honmaple.me/categories/love/index.html">你不懂我</a></li>
                <li><a href="https://honmaple.me/categories/recall/index.html">我不怪你</a></li>
            </ul>
          </li>
          <li ><a href="https://honmaple.me/categories/linux/index.html">字符艺术</a></li>
          <li ><a href="https://honmaple.me/categories/python/index.html">人生苦短</a></li>
          <li ><a href="https://honmaple.me/categories/security/index.html">极客安全</a></li>
      <li class="dropdown">
        <a href="https://honmaple.me/archives/index.html">文章归档</a>
        <ul class="dropdown-menu">
          <li><a href="https://honmaple.me/tags/index.html">标签</a></li>
          <li><a href="https://honmaple.me/categories/index.html">分类</a></li>
          <li><a href="https://honmaple.me/authors/index.html">作者</a></li>
        </ul>
      </li>
      <li><a href="https://honmaple.me/pages/about.html">关于</a></li>
    </ul>
    <form action="https://honmaple.me/search.html" class="navbar-form navbar-right" style="margin-top:10px;">
      <div class="form-group has-feedback">
        <input class="form-control input-sm" id="search" name="q" type="text" onfocus="this.placeholder='搜索'" onblur="this.placeholder=''">
        <i class="fa fa-search form-control-feedback"></i>
      </div>
    </form>
  </div>
</nav>        <article>
          <div class="entry-header">
            <h1 class="entry-title">
              <a href="https://honmaple.me/articles/2023/02/Emacs笔记之修复yaml-mode的格式化问题.html" rel="bookmark" title="Permalink to Emacs笔记之修复yaml-mode的格式化问题">Emacs笔记之修复yaml-mode的格式化问题</a>
            </h1>
<header class="entry-info">
  <span title="Updated at 2023-02-21">
    <i class="fa fa-calendar-o"></i>
    二 21 二月 2023
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            
<p>
一直以来 <b>yaml-mode</b> 都有一个问题，在使用 <code>(indent-region (point-min) (point-max))</code> 时已经格式好的内容总是会得到错误的缩进，比如一个简单的配置
</p>
<div class="highlight"><pre><span></span><span class="nt">test1</span><span class="p">:</span> <span class="s">&quot;val&quot;</span>
<span class="nt">test2</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;val1&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;val2&quot;</span>
<span class="nt">test3</span><span class="p">:</span>
  <span class="nt">test4</span><span class="p">:</span> <span class="s">&quot;val4&quot;</span>
</pre></div>

<p>
在调用 <code>indent-regin</code> 后就会变成
</p>
<div class="highlight"><pre><span></span><span class="nt">test1</span><span class="p">:</span> <span class="s">&quot;val&quot;</span>
<span class="nt">test2</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;val1&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;val2&quot;</span>
  <span class="nt">test3</span><span class="p">:</span>
    <span class="nt">test4</span><span class="p">:</span> <span class="s">&quot;val4&quot;</span>
</pre></div>

<p>
而我又总是手痒，写好的配置文件总是会忍不住 <code>indent-region</code> 一番，结果本来正确的格式立马变得各种乱七八糟，当初为了解决这个问题，还专门为 <b>yaml-mode</b> 激活了 <b>lsp-mode</b>, 并且使用 <code>lsp-format-buffer</code> 来进行处理。
</p>
<p>
本来一切都还正常，但最近发现了另外一个问题，如果在 <b>org-mode</b> 中插入 <b>yaml</b> 的代码片段，调用 <code>indent-region</code> 还是还有之前的问题, <b>org-mode</b> 中又无法直接调用 <code>lsp-format-buffer</code>, 所以专门研究了一下 <b>yaml-mode</b>
</p>
<p>
发现 <b>yaml-mode</b> 只是定义了 <code>indent-line-function</code> 变量，没有定义 <code>indent-region-function</code>, 导致调用 <code>indent-region</code> 时其实是逐行调用 <code>yaml-indent-line</code>, 这里面有一个计算当前缩进的 <code>yaml-compute-indentation</code> 函数，计算方式有些简单粗暴，如果上一行是一个 <b>hash key</b>, 当前行的缩进就是上一行的缩进加 <code>yaml-indent-offset</code> 的值, 这里并没有判断当前行是新建行还是已经有相关内容，如果是新建行那么缩进就是对的，如果是已有的内容就是错的，所以我修改了这一部分逻辑，如果是 <b>已有内容并且当前行的缩进小于上一行</b> 则不进行处理, 比如:
</p>
<div class="highlight"><pre><span></span>  <span class="p p-Indicator">-</span> <span class="s">&quot;val2&quot;</span>
<span class="nt">test3</span><span class="p">:</span>
</pre></div>

<p>
虽然增加的判断逻辑很简单，但至少在使用 <code>indent-region</code> 时已经格式好的内容就不会出现混乱的情况了, 也不用专门为 <b>yaml</b> 文件激活一个 <b>lsp</b> 进程。
</p>
<p>
目前处理的方式还是采用 advice + letf 形式，否则需要修改很多内容，有兴趣的同道可以参考一下
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">maple/yaml-compute-indentation</span><span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">ci</span> <span class="p">(</span><span class="nf">current-indentation</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">im</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-hash-key-re</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">save-excursion</span>
      <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-document-delimiter-re</span><span class="p">)</span> <span class="mi">0</span>
        <span class="p">(</span><span class="nf">forward-line</span> <span class="mi">-1</span><span class="p">)</span>
        <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-blank-line-re</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">forward-line</span> <span class="mi">-1</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">li</span> <span class="p">(</span><span class="nf">current-indentation</span><span class="p">)))</span>
          <span class="c1">;; 如果上一行是hash key, 当前行不是, 或者当前行的缩进大于上一行</span>
          <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="nv">li</span> <span class="nv">ci</span><span class="p">)</span> <span class="p">(</span><span class="k">and</span> <span class="nv">im</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">li</span> <span class="nv">ci</span><span class="p">)))</span> <span class="nv">ci</span>
            <span class="p">(</span><span class="nf">+</span> <span class="nv">li</span>
               <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-nested-map-re</span><span class="p">)</span> <span class="nv">yaml-indent-offset</span> <span class="mi">0</span><span class="p">)</span>
               <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-nested-sequence-re</span><span class="p">)</span> <span class="nv">yaml-indent-offset</span> <span class="mi">0</span><span class="p">)</span>
               <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-block-literal-re</span><span class="p">)</span> <span class="nv">yaml-indent-offset</span> <span class="mi">0</span><span class="p">))))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">maple/yaml-indent-region</span><span class="p">(</span><span class="nv">func</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">&#39;yaml-mode</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">letf</span> <span class="p">(((</span><span class="nf">symbol-function</span> <span class="ss">&#39;yaml-compute-indentation</span><span class="p">)</span> <span class="ss">&#39;maple/yaml-compute-indentation</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">apply</span> <span class="nv">func</span> <span class="nv">args</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">apply</span> <span class="nv">func</span> <span class="nv">args</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;indent-region</span> <span class="nb">:around</span> <span class="ss">&#39;maple/yaml-indent-region</span><span class="p">)</span>
</pre></div>

          </div>
        </article>
          <ul class="entry-list">
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2021/11/Emacs笔记之minibuffer默认输入.html" rel="bookmark" title="Permalink to Emacs笔记之minibuffer默认输入">Emacs笔记之minibuffer默认输入</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-09-20">
    <i class="fa fa-calendar-o"></i>
    四 25 十一月 2021
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            
<blockquote>
<p>
在使用 <b>evil-ex</b>，也就是冒号+命令时，有一个非常有趣的功能，输入冒号后，<b>minibuffer</b> 会显示上一次执行的命令，比如 <code>:wq</code>, 确认可以直接执行这个命令，但是输入任意字符，就会把原先的 <code>wq</code> 直接覆盖，接收新的命令输入
</p>
</blockquote>
<p>
我觉得这是一个非常有趣且有用的功能，像 <code>read-string</code> 函数，如果我想要一个默认的输入，可以直接使用
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">input</span> <span class="p">(</span><span class="nf">read-string</span> <span class="s">&quot;prompt: &quot;</span> <span class="s">&quot;默认内容&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">message</span> <span class="nv">input</span><span class="p">))</span>
</pre></div>

<p>
但我想覆盖这个默认, 则需要先把 <code>默认内容</code> 删除，再输入我想要的字符, 如果不想先删除默认再输入，还可以使用
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">input</span> <span class="p">(</span><span class="nf">read-string</span> <span class="s">&quot;prompt: &quot;</span> <span class="no">nil</span> <span class="no">nil</span> <span class="s">&quot;默认内容&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">message</span> <span class="nv">input</span><span class="p">))</span>
</pre></div>

<p>
但是这样的话我无法看到默认的内容，当然，也许可以把默认内容追加到 <code>prompt …</code></p>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2021/11/Emacs笔记之minibuffer默认输入.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2021/10/Emacs自动插入更新文件头——maple-header.html" rel="bookmark" title="Permalink to Emacs自动插入更新文件头——maple-header">Emacs自动插入更新文件头——maple-header</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-10-17">
    <i class="fa fa-calendar-o"></i>
    三 06 十月 2021
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-8085f41d2c">安装</a>
<ul>
<li><a href="#org-d8f4527311">使用quelpa</a></li>
<li><a href="#org-a86cf2061d">克隆到本地</a></li>
</ul>
</li>
<li><a href="#org-5d1c3526da">配置</a>
<ul>
<li><a href="#org-e4322d0f54">基础配置</a></li>
<li><a href="#org-ee3b4315ed">自定义模版</a></li>
<li><a href="#org-7046b6f520">自定义更新</a></li>
</ul>
</li>
<li><a href="#org-4b9374f887">相关文章</a></li>
</ul>
</div></div>
<blockquote>
<p>
一个简单的插件，可以在文件创建时自动插入文件头，或者文件更新时自动更新文件头信息，虽然已经用了好几年，这次把相关代码提取并精简一下做成了插件 <a href="https://github.com/honmaple/emacs-maple-header">maple-header</a>
</p>
</blockquote>
<h2 id="org-8085f41d2c">安装</h2><h3 id="org-d8f4527311">使用quelpa</h3><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">use-package</span> <span class="nv">maple-header</span>
  <span class="nb">:quelpa</span> <span class="p">(</span><span class="nb">:fetcher</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&quot;honmaple/emacs-maple-header&quot;</span><span class="p">)</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">after-init</span> <span class="o">.</span> <span class="nv">maple-header-mode</span><span class="p">))</span>
</pre></div>

<h3 id="org-a86cf2061d">克隆到本地</h3><div class="highlight"><pre><span></span>git clone https://github.com/honmaple/emacs-maple-header --depth=1 ~/.emacs/site-lisp/maple-header
</pre></div>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">use-package</span> <span class="nv">maple-header</span>
  <span class="nb">:ensure</span> <span class="no">nil</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">after-init …</span></pre></div>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2021/10/Emacs自动插入更新文件头——maple-header.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2019/11/Emacs快速创建侧边栏——maple-explorer.html" rel="bookmark" title="Permalink to Emacs快速创建侧边栏——maple-explorer">Emacs快速创建侧边栏——maple-explorer</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-09-01">
    <i class="fa fa-calendar-o"></i>
    六 09 十一月 2019
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            
<p>
闲着没事又造了一个轮子，:smile:
</p>
<blockquote>
<p>
<b>maple-explorer</b> 是一个用于快速创建类似neotree文件浏览，或者类似maple-imenu的变量函数浏览的侧边栏的插件，让每个人都能写一个属于自己的侧边栏
</p>
<p>
<a href="https://github.com/honmaple/emacs-maple-explorer">emacs-maple-explorer</a>
</p>
</blockquote>
<ul>
<li>
<p>
快速创建一个侧边栏: 只需要定义一个<code>maple-explorer-NAME-list</code>的函数，并且返回一个列表
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nf">list</span>
 <span class="nb">:name</span> <span class="nv">name</span>
 <span class="nb">:value</span> <span class="nv">value</span>
 <span class="nb">:face</span> <span class="nv">face</span>
 <span class="nb">:click</span> <span class="nv">click</span>
 <span class="nb">:status</span> <span class="ss">&#39;close</span> <span class="c1">;; or &#39;open</span>
 <span class="nb">:children</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">child1</span> <span class="nv">child2</span> <span class="o">...</span><span class="p">))</span>
</pre></div>

<p>
  其中child1，child2格式与父列表格式一致，child1中也可以嵌套下一组children，比如我定义一个名为aaa的list的函数:
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">maple-explorer-aaa-list</span><span class="p">(</span><span class="kp">&amp;optional</span> <span class="nv">isroot</span><span class="p">)</span>
  <span class="s">&quot;Get recentf file list ISROOT mean first call.&quot;</span>
  <span class="p">(</span><span class="nf">list</span>
   <span class="nb">:name</span> <span class="s">&quot;aaa&quot;</span>
   <span class="nb">:value</span> <span class="s">&quot;aaa …</span></pre></div></li></ul>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2019/11/Emacs快速创建侧边栏——maple-explorer.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2019/09/Emacs下一键执行代码(可输入)——maple-run.html" rel="bookmark" title="Permalink to Emacs下一键执行代码(可输入)——maple-run">Emacs下一键执行代码(可输入)——maple-run</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-09-01">
    <i class="fa fa-calendar-o"></i>
    二 17 九月 2019
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            
<p>
之前一直使用<b>quickrun</b>来执行一些代码片段，但<b>quickrun</b>有一个问题就是无法输入，比如python代码
</p>
<div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;aaaaa: &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>

<p>
需要建立一个<b>qrinput</b>的文件，太过麻烦，所以我平时测试一些需要输入的python代码时会使用
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">maple/run-python</span> <span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">python-shell-get-process</span><span class="p">)</span> <span class="p">(</span><span class="nf">call-interactively</span> <span class="ss">&#39;run-python</span><span class="p">))</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">use-region-p</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">python-shell-send-region</span> <span class="p">(</span><span class="nf">region-beginning</span><span class="p">)</span> <span class="p">(</span><span class="nf">region-end</span><span class="p">)</span> <span class="no">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">python-shell-send-buffer</span> <span class="no">t</span><span class="p">)))</span>
</pre></div>

<p>
但退出<b>python shell</b>又需要手动输入<code>exit()</code>，我是一个怕麻烦的人，所以写了一个可供输入的 <a href="https://github.com/honmaple/emacs-maple-run">emacs-maple-run</a>
来一键执行当前buffer的代码(后面发现quickrun其实也可以通过<b>quickrun-shell</b>来提供实时输入，不过使用的是eshell)
</p>
<p>
目前只加了python,go,lua …</p>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2019/09/Emacs下一键执行代码(可输入)——maple-run.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2019/07/Emacs环境隔离之——maple-env.html" rel="bookmark" title="Permalink to Emacs环境隔离之——maple-env">Emacs环境隔离之——maple-env</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-09-01">
    <i class="fa fa-calendar-o"></i>
    一 15 七月 2019
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            
<p>
在使用Emacs时，会有很多依赖，比如:
</p>
<ul>
<li>
<p>
Python依赖于<code>flake8</code>，<code>isort</code>，<code>python-language-server</code>等
</p>
</li>
<li>
<p>
Golang依赖于<code>golang.org/x/tools/cmd/gopls</code>，<code>github.com/haya14busa/gopkgs/cmd/gopkgs</code>等
</p>
</li>
</ul>
<p>
想要安装这些依赖，必须手动进行安装，<b>use-package</b>用户可使用<b>ensure-system-package</b>，但非常不幸的是，这些依赖很大程度上会污染我的电脑环境，毕竟像<code>python-language-server</code>，<code>flake8</code>这类的package，我除了在Emacs里会用到，平时根本用不到（除非同时使用Emacs和其它编辑器或IDE）
</p>
<p>
所以，我写了一个<b>maple-env</b>用来实现Emacs依赖环境隔离，使用方式:
</p>
<ul>
<li>
<p>
安装
</p>
<div class="highlight"><pre><span></span>git clone https://github.com/honmaple/emacs-maple-env …</pre></div></li></ul>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2019/07/Emacs环境隔离之——maple-env.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2019/07/elisp生成渐变XPM图片.html" rel="bookmark" title="Permalink to elisp生成渐变XPM图片">elisp生成渐变XPM图片</a></h1>
<header class="entry-info">
  <span title="Updated at 2019-07-12">
    <i class="fa fa-calendar-o"></i>
    五 12 七月 2019
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
        <a href="https://honmaple.me/tags/elisp/index.html">elisp</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-c354d0ed7c">渐变颜色</a></li>
<li><a href="#org-261f6d2b0b">生成XPM图片</a></li>
<li><a href="#org-8c98efb633">效果显示</a></li>
</ul>
</div></div>
<blockquote>
<p>
无意中看到 <a href="https://github.com/dbordak/telephone-line">telephone-line</a>有一种渐变颜色的效果，看起来很棒，但<b>telephone-line</b>的源码有些难懂，所以自己动手实现类似的效果
</p>
</blockquote>
<h3 id="org-c354d0ed7c">渐变颜色</h3><p>
   渐变颜色的实现可使用<code>color-gradient</code>
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nv">color-gradient</span>
 <span class="o">&#39;</span><span class="p">(</span><span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span><span class="p">)</span>
 <span class="p">(</span><span class="nv">color-name-to-rgb</span> <span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

<p>
   实现原理是对红(R)、绿(G)、蓝(B)三个颜色通道分别取 <b>n + 2</b> 个过渡值，<b>n</b> 为中间颜色过渡状态，所以对于<code>red</code>、<code>#000</code>、<code>#a0a0a0</code>等颜色需要转化为RGB色彩模式
</p>
<h3 id="org-261f6d2b0b">生成XPM图片</h3><p>
   XPM图片格式参考 <a href="https://en.wikipedia.org/wiki/X_PixMap">https://en.wikipedia.org/wiki/X_PixMap …</a></p>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2019/07/elisp生成渐变XPM图片.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2019/05/关于ivy的使用技巧.html" rel="bookmark" title="Permalink to 关于ivy的使用技巧">关于ivy的使用技巧</a></h1>
<header class="entry-info">
  <span title="Updated at 2021-04-14">
    <i class="fa fa-calendar-o"></i>
    二 14 五月 2019
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-9c33758f8a">ivy中的tab</a></li>
<li><a href="#org-d874b32c29">ivy中的C-h</a></li>
<li><a href="#org-b0ce61450a">ivy-occur批量操作</a>
<ul>
<li><a href="#org-8e5c170ffd">自动打开wgrep-mode</a></li>
<li><a href="#org-fc4b298934">批量修改文件名</a></li>
</ul>
</li>
<li><a href="#org-a09c565927">counsel-find-file</a>
<ul>
<li><a href="#org-25030a9f72">重命名</a></li>
<li><a href="#org-92f88f164e">自动创建不存在的目录</a></li>
</ul>
</li>
<li><a href="#org-38cf79a4d8">ivy自动使用选中的内容</a></li>
<li><a href="#org-a666681327">搜索某个目录</a></li>
<li><a href="#org-056736c9dc">ivy的显示避免出现在视线外</a></li>
<li><a href="#org-31881c9b20">counsel-ag指定文件后缀</a></li>
</ul>
</div></div>
<blockquote>
<p>
ivy默认的配置已经足够了，但还是可以通过一些技巧来提升使用体验
</p>
</blockquote>
<h2 id="org-9c33758f8a">ivy中的tab</h2><p>
  ivy提供了好几个有关补全的命令，分别是<b>ivy-done</b>, <b>ivy-partial-or-done</b>, <b>ivy-immediate-done</b>, <b>ivy-dispatching-done</b>, 但不幸，想要获得高效的补全，我不得不记住这n多个命令，这常常使效率变得更低，
  所以，我自定义了一个 <b>maple/ivy-done</b>, 仅使用 <code>tab</code> 这一个按键就可以获得以上所有的体验
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">maple/ivy-done</span><span class="p">()</span>
  <span class="p">(</span><span class="k">interactive</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">dir</span> <span class="nv">ivy--directory</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">ivy-partial-or-done</span><span class="p">)</span>
    <span class="p">(</span><span class="nb">when</span> <span class="p">(</span><span class="nf">string=</span> <span class="nv">dir</span> <span class="nv">ivy--directory</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">ivy-insert-current</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">when …</span></pre></div>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2019/05/关于ivy的使用技巧.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2019/01/关于自动关闭开启echo area的设想.html" rel="bookmark" title="Permalink to 关于自动关闭开启echo area的设想">关于自动关闭开启echo area的设想</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-09-01">
    <i class="fa fa-calendar-o"></i>
    二 15 一月 2019
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            
<blockquote>
<p>
相关问题: <a href="https://stackoverflow.com/questions/5079466/hide-emacs-echo-area-during-inactivity">当echo area不活跃时如何自动关闭</a>
</p>
</blockquote>
<p>
之前看了<b>manateelazycat</b>的<b>awesome-tray</b>,觉得可以采用同样的方式来“关闭”echo area, 原理就是复制 mode-line 的样式 <code>(format-mode-line mode-line-format)</code> , 插入到 minibuffer 中, 当没有信息显示即 <b>echo area</b> 不活跃时就关闭 <b>mode-line</b>, 有信息显示时就重新打开 <b>mode-line</b>, 并清空 minibuffer 里的内容
</p>
<p>
我尝试实现上述内容, 可见 <a href="https://github.com/honmaple/emacs-maple-echo-area">https://github.com/honmaple/emacs-maple-echo-area</a> 最终效果
</p>
<p>
<a href="https://s.libforest.com/images/2019/01/emacs-maple-echoarea.png" data-fancybox="image"><img data-src="https://s.libforest.com/images/2019/01/emacs-maple-echoarea.png" class="lazyload" /></a>
</p>
<p>
虽然大体上是可以的, 但由于 <b>truncate-lines</b> 的存在, 末尾会出现一个 <b>$</b> 字符，我没找到怎么关闭它，还有就是在一些特殊 buffer， 比如 magit buffer …</p>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2019/01/关于自动关闭开启echo area的设想.html">阅读全文 »</a>
          </div>
        </article></li>
          <li>  <ul class="entry-pagination">
         <li class="active"><a href="https://honmaple.me/tags/emacs/index.html">1</a></li>
         <li ><a href="https://honmaple.me/tags/emacs/index2.html">2</a></li>
         <li ><a href="https://honmaple.me/tags/emacs/index3.html">3</a></li>
      <li class="next"><a href="https://honmaple.me/tags/emacs/index2.html">&raquo;</a></li>
  </ul>
</li>
          </ul>
      </div>
    </div>
<div class="entry-footer">
  <ul class="entry-footer-left">
    <li class="hidden-xs">© 2015-2023 honmaple</li>
    <li class="hidden-xs">·</li>
    <li>
          <a href="https://honmaple.me/pages/friends.html">友链</a>
          <span> | </span>
          <a href="https://honmaple.me/pages/contact.html">联系</a>
          <span> | </span>
          <a href="https://honmaple.me/pages/project.html">项目</a>
          <span> | </span>
          <a href="https://honmaple.me/pages/timeline.html">时间轴</a>
    </li>
  </ul>
  <ul class="entry-footer-right">
    <li><a class="entry-switch-theme" title="Moon"><i class="fa fa-moon-o"></i></a></li>
      <li ><a href="https://honmaple.me/pages/music.html" title="Music"><i class="fa fa-music"></i></a></li>
      <li class="hidden-xs"><a href="https://honmaple.me/atom.xml" title="Feed"><i class="fa fa-feed"></i></a></li>
      <li ><a href="https://github.com/honmaple" title="GitHub"><i class="fa fa-github"></i></a></li>
      <li ><a href="https://honmaple.me/pages/travel.html" title="Camera"><i class="fa fa-camera"></i></a></li>
      <li ><a href="https://honmaple.me/pages/contact.html" title="Envelope"><i class="fa fa-envelope"></i></a></li>
  </ul>
</div>    <div class="back-to-top back-to-top-on">
      <i class="fa fa-hand-o-up" title="back to top"></i>
    </div>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-88401692-2"></script>
  <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   gtag('config', 'UA-88401692-2');
  </script>
      <script src="https://s.libforest.com/static/js/lib.min.js"></script>
        <script src="https://honmaple.me/static/lib/js/script.min.js"></script>
      <script src="https://s.libforest.com/static/js/instantclick.min.js" data-no-instant></script>
      <script data-no-instant>
       InstantClick.on('change', function() {
           if (typeof ga !== 'undefined') {
               ga('send', 'pageview', location.pathname + location.search);
           }
       });
       InstantClick.init(60);
      </script>
  </body>
</html>