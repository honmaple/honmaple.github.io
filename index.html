<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>紅楓吟 · 风落花语风落天，花落风雨花落田.</title>
      <link href="https://s.libforest.com/static/css/lib.min.css" rel="stylesheet">
        <link href="https://honmaple.me/static/lib/css/style.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="particles-js" id="particles-js"></div>
    <div class="scrollbar"></div>
  <div class="entry-cover">
    <div class="entry-cover-left">
      <img src="https://s.libforest.com/images/header/header.png">
      <h3>紅楓吟</h3>
      <cite>风落花语风落天，花落风雨花落田.</cite>
      <ul class="entry-cover-menu">
        <li><a id="entry-cover"><i class="fa fa-home" title="BLOG"></i></a></li>
          <li><a href="https://github.com/honmaple" title="GitHub"><i class="fa fa-github"></i></a></li>
          <li><a href="https://honmaple.me/pages/travel.html" title="Globe"><i class="fa fa-globe"></i></a></li>
          <li><a href="https://honmaple.me/atom.xml" title="Feed"><i class="fa fa-feed"></i></a></li>
          <li><a href="https://honmaple.me/en/index.html"><i class="fa fa-language" title="English"></i></a></li>
      </ul>
    </div>
    <div class="entry-cover-right">
      <h3>夜雨行</h3>
      <p>佚名</p>
      <div>
        <p>雨中漫步行 夜深無人听</p>
        <p>悄然歸故裡 卧龍不知情</p>
      </div>
    </div>
  </div>
    <div class="wrap">
      <div class="main">
<nav class="navbar navbar-default">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#nav-header" aria-expanded="false">
      <span class="sr-only"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="https://honmaple.me">
      <img class="navbar-logo" src="https://s.libforest.com/images/header/header-logo.png" alt="楓">
    </a>
      <p class="navbar-text">—— 风落花语风落天，花落风雨花落田.</p>
  </div>
  <div class="collapse navbar-collapse" id="nav-header">
    <ul class="nav navbar-nav">
          <li class="dropdown">
            <a href="https://honmaple.me/categories/life/index.html" >代码人生</a>
            <ul class="dropdown-menu">
                <li><a href="https://honmaple.me/categories/coding/index.html">分享世界</a></li>
                <li><a href="https://honmaple.me/categories/love/index.html">你不懂我</a></li>
                <li><a href="https://honmaple.me/categories/recall/index.html">我不怪你</a></li>
            </ul>
          </li>
          <li ><a href="https://honmaple.me/categories/linux/index.html">字符艺术</a></li>
          <li ><a href="https://honmaple.me/categories/python/index.html">人生苦短</a></li>
          <li ><a href="https://honmaple.me/categories/security/index.html">极客安全</a></li>
      <li class="dropdown">
        <a href="https://honmaple.me/archives/index.html">文章归档</a>
        <ul class="dropdown-menu">
          <li><a href="https://honmaple.me/tags/index.html">标签</a></li>
          <li><a href="https://honmaple.me/categories/index.html">分类</a></li>
          <li><a href="https://honmaple.me/authors/index.html">作者</a></li>
        </ul>
      </li>
      <li><a href="https://honmaple.me/pages/about.html">关于</a></li>
    </ul>
    <form action="https://honmaple.me/search.html" class="navbar-form navbar-right" style="margin-top:10px;">
      <div class="form-group has-feedback">
        <input class="form-control input-sm" id="search" name="q" type="text" onfocus="this.placeholder='搜索'" onblur="this.placeholder=''">
        <i class="fa fa-search form-control-feedback"></i>
      </div>
    </form>
  </div>
</nav>        <article>
          <div class="entry-header">
            <h1 class="entry-title">
              <a href="https://honmaple.me/articles/2023/02/Emacs笔记之修复yaml-mode的格式化问题.html" rel="bookmark" title="Permalink to Emacs笔记之修复yaml-mode的格式化问题">Emacs笔记之修复yaml-mode的格式化问题</a>
            </h1>
<header class="entry-info">
  <span title="Updated at 2023-02-21">
    <i class="fa fa-calendar-o"></i>
    二 21 二月 2023
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            
<p>
一直以来 <b>yaml-mode</b> 都有一个问题，在使用 <code>(indent-region (point-min) (point-max))</code> 时已经格式好的内容总是会得到错误的缩进，比如一个简单的配置
</p>
<div class="highlight"><pre><span></span><span class="nt">test1</span><span class="p">:</span> <span class="s">&quot;val&quot;</span>
<span class="nt">test2</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;val1&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;val2&quot;</span>
<span class="nt">test3</span><span class="p">:</span>
  <span class="nt">test4</span><span class="p">:</span> <span class="s">&quot;val4&quot;</span>
</pre></div>

<p>
在调用 <code>indent-regin</code> 后就会变成
</p>
<div class="highlight"><pre><span></span><span class="nt">test1</span><span class="p">:</span> <span class="s">&quot;val&quot;</span>
<span class="nt">test2</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;val1&quot;</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;val2&quot;</span>
  <span class="nt">test3</span><span class="p">:</span>
    <span class="nt">test4</span><span class="p">:</span> <span class="s">&quot;val4&quot;</span>
</pre></div>

<p>
而我又总是手痒，写好的配置文件总是会忍不住 <code>indent-region</code> 一番，结果本来正确的格式立马变得各种乱七八糟，当初为了解决这个问题，还专门为 <b>yaml-mode</b> 激活了 <b>lsp-mode</b>, 并且使用 <code>lsp-format-buffer</code> 来进行处理。
</p>
<p>
本来一切都还正常，但最近发现了另外一个问题，如果在 <b>org-mode</b> 中插入 <b>yaml</b> 的代码片段，调用 <code>indent-region</code> 还是还有之前的问题, <b>org-mode</b> 中又无法直接调用 <code>lsp-format-buffer</code>, 所以专门研究了一下 <b>yaml-mode</b>
</p>
<p>
发现 <b>yaml-mode</b> 只是定义了 <code>indent-line-function</code> 变量，没有定义 <code>indent-region-function</code>, 导致调用 <code>indent-region</code> 时其实是逐行调用 <code>yaml-indent-line</code>, 这里面有一个计算当前缩进的 <code>yaml-compute-indentation</code> 函数，计算方式有些简单粗暴，如果上一行是一个 <b>hash key</b>, 当前行的缩进就是上一行的缩进加 <code>yaml-indent-offset</code> 的值, 这里并没有判断当前行是新建行还是已经有相关内容，如果是新建行那么缩进就是对的，如果是已有的内容就是错的，所以我修改了这一部分逻辑，如果是 <b>已有内容并且当前行的缩进小于上一行</b> 则不进行处理, 比如:
</p>
<div class="highlight"><pre><span></span>  <span class="p p-Indicator">-</span> <span class="s">&quot;val2&quot;</span>
<span class="nt">test3</span><span class="p">:</span>
</pre></div>

<p>
虽然增加的判断逻辑很简单，但至少在使用 <code>indent-region</code> 时已经格式好的内容就不会出现混乱的情况了, 也不用专门为 <b>yaml</b> 文件激活一个 <b>lsp</b> 进程。
</p>
<p>
目前处理的方式还是采用 advice + letf 形式，否则需要修改很多内容，有兴趣的同道可以参考一下
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">defun</span> <span class="nv">maple/yaml-compute-indentation</span><span class="p">()</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">ci</span> <span class="p">(</span><span class="nf">current-indentation</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">im</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-hash-key-re</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">save-excursion</span>
      <span class="p">(</span><span class="nf">beginning-of-line</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-document-delimiter-re</span><span class="p">)</span> <span class="mi">0</span>
        <span class="p">(</span><span class="nf">forward-line</span> <span class="mi">-1</span><span class="p">)</span>
        <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-blank-line-re</span><span class="p">)</span>
                    <span class="p">(</span><span class="nf">&gt;</span> <span class="p">(</span><span class="nf">point</span><span class="p">)</span> <span class="p">(</span><span class="nf">point-min</span><span class="p">)))</span>
          <span class="p">(</span><span class="nf">forward-line</span> <span class="mi">-1</span><span class="p">))</span>
        <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">li</span> <span class="p">(</span><span class="nf">current-indentation</span><span class="p">)))</span>
          <span class="c1">;; 如果上一行是hash key, 当前行不是, 或者当前行的缩进大于上一行</span>
          <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nf">&gt;</span> <span class="nv">li</span> <span class="nv">ci</span><span class="p">)</span> <span class="p">(</span><span class="k">and</span> <span class="nv">im</span> <span class="p">(</span><span class="nf">=</span> <span class="nv">li</span> <span class="nv">ci</span><span class="p">)))</span> <span class="nv">ci</span>
            <span class="p">(</span><span class="nf">+</span> <span class="nv">li</span>
               <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-nested-map-re</span><span class="p">)</span> <span class="nv">yaml-indent-offset</span> <span class="mi">0</span><span class="p">)</span>
               <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-nested-sequence-re</span><span class="p">)</span> <span class="nv">yaml-indent-offset</span> <span class="mi">0</span><span class="p">)</span>
               <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">looking-at</span> <span class="nv">yaml-block-literal-re</span><span class="p">)</span> <span class="nv">yaml-indent-offset</span> <span class="mi">0</span><span class="p">))))))))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">maple/yaml-indent-region</span><span class="p">(</span><span class="nv">func</span> <span class="kp">&amp;rest</span> <span class="nv">args</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">derived-mode-p</span> <span class="ss">&#39;yaml-mode</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">letf</span> <span class="p">(((</span><span class="nf">symbol-function</span> <span class="ss">&#39;yaml-compute-indentation</span><span class="p">)</span> <span class="ss">&#39;maple/yaml-compute-indentation</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">apply</span> <span class="nv">func</span> <span class="nv">args</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">apply</span> <span class="nv">func</span> <span class="nv">args</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">advice-add</span> <span class="ss">&#39;indent-region</span> <span class="nb">:around</span> <span class="ss">&#39;maple/yaml-indent-region</span><span class="p">)</span>
</pre></div>

          </div>
        </article>
          <ul class="entry-list">
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2022/11/MacOS适配2K显示器.html" rel="bookmark" title="Permalink to MacOS适配2K显示器">MacOS适配2K显示器</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-11-24">
    <i class="fa fa-calendar-o"></i>
    四 24 十一月 2022
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/life/index.html">Life</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/life/index.html">life</a>
        <a href="https://honmaple.me/tags/macos/index.html">macos</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-8085f41d2c">安装</a></li>
<li><a href="#org-5d1c3526da">配置</a></li>
</ul>
</div></div>
<blockquote>
<p>
最近购买了一个2K显示器，到手后才发现macos默认对2K分辨率支持不足，导致字体很小，无法像windows对字体进行缩放，尤其是终端字体，简直不忍直视。网上一搜才知道，这已经是陈年问题，网上也有很多解决办法，本次采用 <b>BetterDisplay</b> 开启 <b>HiDPI</b>， 不用关闭 <b>SIP</b>
</p>
</blockquote>
<h3 id="org-8085f41d2c">安装</h3><p>
   安装可以直接从 <a href="https://github.com/waydabber/BetterDisplay">BetterDisplay</a>下载，手动安装，不过我推荐使用 <b>brew</b> 安装，这样对于软件的管理也更方便
</p>
<div class="highlight"><pre><span></span><span class="err">──╼</span> <span class="n">brew</span> <span class="n">info</span> <span class="n">BetterDisplay</span>
<span class="o">==&gt;</span> <span class="n">betterdisplay</span><span class="p">:</span> <span class="mf">1.3</span><span class="o">.</span><span class="mi">4</span> <span class="p">(</span><span class="n">auto_updates</span><span class="p">)</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">betterdisplay</span><span class="o">.</span><span class="n">pro</span><span class="o">/</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">Caskroom</span><span class="o">/</span><span class="n">betterdisplay</span><span class="o">/</span><span class="mf">1.3</span><span class="o">.</span><span class="mi">4</span> <span class="p">(</span><span class="mi">127</span><span class="n">B …</span></pre></div>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2022/11/MacOS适配2K显示器.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2022/11/人生中的第一台组装电脑.html" rel="bookmark" title="Permalink to 人生中的第一台组装电脑">人生中的第一台组装电脑</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-12-12">
    <i class="fa fa-calendar-o"></i>
    五 04 十一月 2022
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/life/index.html">Life</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/life/index.html">life</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-7805a8cd72">配件选购</a>
<ul>
<li><a href="#org-a386f1b6bd">CPU和主板</a></li>
<li><a href="#org-bf158e85f4">显卡</a></li>
<li><a href="#org-eec2f1d8b9">显示器</a></li>
<li><a href="#org-5201752998">机箱和散热</a></li>
</ul>
</li>
<li><a href="#org-c50619f9ee">装机</a>
<ul>
<li><a href="#org-ca15f948c4">硬件组装</a></li>
<li><a href="#org-77d50c546f">BIOS设置</a></li>
<li><a href="#org-47975a7949">系统安装</a></li>
<li><a href="#org-0a37d69cde">一次点亮</a></li>
</ul>
</li>
</ul>
</div></div>
<p>
前两天双11，终于是给自己配了人生中的第一台台式电脑，从毕业后就一直想要一台属于自己的机器(游戏机)，犹记得人生中的第一台电脑还是上大学时买的，虽然只是3000多，720m的显卡，但它陪伴了我6年多时间，曾经使用它学习编程，娱乐，算是我的导师和娱乐伙伴，后来毕业后才购买了一台macbook pro，一直陪伴我至今。
</p>
<h2 id="org-7805a8cd72">配件选购</h2><table>
<tr>
<th>配件</th>
<th>型号</th>
<th>价格</th>
</tr>
<tr>
<td>CPU</td>
<td>12600KF</td>
<td>1535.65</td>
</tr>
<tr>
<td>主板</td>
<td>微星B660M迫击炮WIFI</td>
<td>/</td>
</tr>
<tr>
<td>显卡</td>
<td>七彩虹3070 ULTRA W</td>
<td>4490.7(+主板)</td>
</tr>
<tr>
<td>电源</td>
<td>海韵GX750</td>
<td>627.7</td>
</tr>
<tr>
<td>机箱 …</td></tr></table>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2022/11/人生中的第一台组装电脑.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2022/10/Snow静态博客生成器.html" rel="bookmark" title="Permalink to Snow静态博客生成器">Snow静态博客生成器</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-11-02">
    <i class="fa fa-calendar-o"></i>
    日 16 十月 2022
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/snow/index.html">snow</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-061d509520">Snow</a>
<ul>
<li><a href="#org-b4126dd347">快速开始</a>
<ul>
<li><a href="#org-5d70453384">创建新的站点</a></li>
<li><a href="#org-8c035e9154">创建新的文章</a></li>
<li><a href="#org-011bcf6117">编译和预览</a></li>
</ul>
</li>
<li><a href="#org-1f14404d88">配置说明</a>
<ul>
<li><a href="#org-7657e5f093">文章列表</a></li>
<li><a href="#org-8f9fcd9880">静态文件</a></li>
<li><a href="#org-3d9bbd19cc">主题</a></li>
<li><a href="#org-4c162d3988">动态页</a>
<ul>
<li><a href="#org-ef66c90dbd">详情页</a></li>
<li><a href="#org-5e1e7daa56">列表页</a></li>
<li><a href="#org-37a7d1272c">归档页</a></li>
</ul>
</li>
<li><a href="#org-bcfffa44ea">本地测试和正式发布</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div>
<h2 id="org-061d509520">Snow</h2><blockquote>
<p>
  一个<b>简单却可配置</b>的静态博客生成器。
 很早之前(三年前)就想写一个静态博客生成器，但苦于一直没有时间，最近把之前写的重构了一下，让其可以支持更多的定制化配置。
</p>
</blockquote>
<p>
  <b>至于为什么要重新写一个</b>:
</p>
<ol>
<li>
<p>
 大概是因为想要把之前未完成的轮子补充完整
</p>
</li>
<li>
<p>
 我目前使用的博客系统使用的是 <b>pelican</b>，一个基于 <b>Python</b> 的静态博客生成器，目前里面包括了很多我自己写的插件，比如 <code>Emacs org mode</code> 的支持、文章加密、模版定制等，因为需要大量遍历所有文章，导致生成速度越来越慢，还有一点就是因为使用的是 <b>Python</b>，每次本地预览时都需要切换到虚拟环境
</p>
</li>
<li>
<p>
 我习惯使用 <b>Emacs …</b></p></li></ol>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2022/10/Snow静态博客生成器.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2021/11/Emacs笔记之minibuffer默认输入.html" rel="bookmark" title="Permalink to Emacs笔记之minibuffer默认输入">Emacs笔记之minibuffer默认输入</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-09-20">
    <i class="fa fa-calendar-o"></i>
    四 25 十一月 2021
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            
<blockquote>
<p>
在使用 <b>evil-ex</b>，也就是冒号+命令时，有一个非常有趣的功能，输入冒号后，<b>minibuffer</b> 会显示上一次执行的命令，比如 <code>:wq</code>, 确认可以直接执行这个命令，但是输入任意字符，就会把原先的 <code>wq</code> 直接覆盖，接收新的命令输入
</p>
</blockquote>
<p>
我觉得这是一个非常有趣且有用的功能，像 <code>read-string</code> 函数，如果我想要一个默认的输入，可以直接使用
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">input</span> <span class="p">(</span><span class="nf">read-string</span> <span class="s">&quot;prompt: &quot;</span> <span class="s">&quot;默认内容&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">message</span> <span class="nv">input</span><span class="p">))</span>
</pre></div>

<p>
但我想覆盖这个默认, 则需要先把 <code>默认内容</code> 删除，再输入我想要的字符, 如果不想先删除默认再输入，还可以使用
</p>
<div class="highlight"><pre><span></span><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">input</span> <span class="p">(</span><span class="nf">read-string</span> <span class="s">&quot;prompt: &quot;</span> <span class="no">nil</span> <span class="no">nil</span> <span class="s">&quot;默认内容&quot;</span><span class="p">)))</span>
  <span class="p">(</span><span class="nf">message</span> <span class="nv">input</span><span class="p">))</span>
</pre></div>

<p>
但是这样的话我无法看到默认的内容，当然，也许可以把默认内容追加到 <code>prompt …</code></p>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2021/11/Emacs笔记之minibuffer默认输入.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2021/10/Emacs自动插入更新文件头——maple-header.html" rel="bookmark" title="Permalink to Emacs自动插入更新文件头——maple-header">Emacs自动插入更新文件头——maple-header</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-10-17">
    <i class="fa fa-calendar-o"></i>
    三 06 十月 2021
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/emacs/index.html">emacs</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-8085f41d2c">安装</a>
<ul>
<li><a href="#org-d8f4527311">使用quelpa</a></li>
<li><a href="#org-a86cf2061d">克隆到本地</a></li>
</ul>
</li>
<li><a href="#org-5d1c3526da">配置</a>
<ul>
<li><a href="#org-e4322d0f54">基础配置</a></li>
<li><a href="#org-ee3b4315ed">自定义模版</a></li>
<li><a href="#org-7046b6f520">自定义更新</a></li>
</ul>
</li>
<li><a href="#org-4b9374f887">相关文章</a></li>
</ul>
</div></div>
<blockquote>
<p>
一个简单的插件，可以在文件创建时自动插入文件头，或者文件更新时自动更新文件头信息，虽然已经用了好几年，这次把相关代码提取并精简一下做成了插件 <a href="https://github.com/honmaple/emacs-maple-header">maple-header</a>
</p>
</blockquote>
<h2 id="org-8085f41d2c">安装</h2><h3 id="org-d8f4527311">使用quelpa</h3><div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">use-package</span> <span class="nv">maple-header</span>
  <span class="nb">:quelpa</span> <span class="p">(</span><span class="nb">:fetcher</span> <span class="nv">github</span> <span class="nb">:repo</span> <span class="s">&quot;honmaple/emacs-maple-header&quot;</span><span class="p">)</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">after-init</span> <span class="o">.</span> <span class="nv">maple-header-mode</span><span class="p">))</span>
</pre></div>

<h3 id="org-a86cf2061d">克隆到本地</h3><div class="highlight"><pre><span></span>git clone https://github.com/honmaple/emacs-maple-header --depth=1 ~/.emacs/site-lisp/maple-header
</pre></div>

<div class="highlight"><pre><span></span><span class="p">(</span><span class="nb">use-package</span> <span class="nv">maple-header</span>
  <span class="nb">:ensure</span> <span class="no">nil</span>
  <span class="nb">:hook</span> <span class="p">(</span><span class="nv">after-init …</span></pre></div>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2021/10/Emacs自动插入更新文件头——maple-header.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2021/08/Docker笔记之registry清理.html" rel="bookmark" title="Permalink to Docker笔记之registry清理">Docker笔记之registry清理</a></h1>
<header class="entry-info">
  <span title="Updated at 2021-09-02">
    <i class="fa fa-calendar-o"></i>
    一 23 八月 2021
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/docker/index.html">docker</a>
        <a href="https://honmaple.me/tags/registry/index.html">registry</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-b92701c913">前言</a></li>
<li><a href="#org-4e20ec6419">清理</a>
<ul>
<li><a href="#org-ccd330ca3c">列出所有镜像</a></li>
<li><a href="#org-d48c64abaa">找出分层(push次数)最多的几个镜像</a></li>
<li><a href="#org-1d12df6e7c">删除某个镜像的untagged的数据</a></li>
</ul>
</li>
<li><a href="#org-a2035894d2">参考资料</a></li>
</ul>
</div></div>
<blockquote>
<p>
尝试了几种方式, 算是找到了一个比较方便的清理docker registry的方式
</p>
</blockquote>
<h2 id="org-b92701c913">前言</h2><p>
  两年前分给了 <b>docker registry</b> 1T的磁盘，虽然有预感磁盘空间会被用完, 没想过能够坚持这么久。
  而且期间一直想把 <b>registry</b> 迁移到 <b>harbor</b>，也能对不同账户的权限进行分配和限制，但几百G的磁盘占用也不好迁移，所以一直被耽搁(迁移方式都准备好了 <a href="https://blog.k8s.li/docker-registry-to-harbor.html">https://blog.k8s.li/docker-registry-to-harbor.html</a>
</p>
<h2 id="org-4e20ec6419">清理</h2><h3 id="org-ccd330ca3c">列出所有镜像</h3><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="n">garbage</span><span class="o">-</span><span class="n">collect</span> <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">registry</span><span class="o">/</span><span class="n">config</span><span class="p">.</span><span class="n">yml</span> <span class="o">&gt;&gt;</span> <span class="n">res</span><span class="p">.</span><span class="n">txt …</span></pre></div>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2021/08/Docker笔记之registry清理.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2021/07/K8S笔记之ingress增加验证.html" rel="bookmark" title="Permalink to K8S笔记之ingress增加验证">K8S笔记之ingress增加验证</a></h1>
<header class="entry-info">
  <span title="Updated at 2021-09-02">
    <i class="fa fa-calendar-o"></i>
    二 13 七月 2021
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/linux/index.html">linux</a>
        <a href="https://honmaple.me/tags/k8s/index.html">k8s</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-38da7bf107">创建账户密码</a></li>
<li><a href="#org-054894a711">修改ingress</a></li>
<li><a href="#org-df18498bbc">Authorization请求头传递到后端server</a></li>
<li><a href="#org-a2035894d2">参考资料</a></li>
</ul>
</div></div>
<h3 id="org-38da7bf107">创建账户密码</h3><ul>
<li>
<p>
生成密码
</p>
<div class="highlight"><pre><span></span><span class="nv">PASSWORD</span><span class="o">=</span><span class="k">$(</span>base64 &lt; /dev/urandom <span class="p">|</span> head -c8<span class="k">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$PASSWORD</span><span class="s2">&quot;</span>
</pre></div>

</li>
<li>
<p>
生成hash值
</p>
<div class="highlight"><pre><span></span>docker run --rm --entrypoint htpasswd httpd:2 -Bbn username password &gt;&gt; auth
</pre></div>

</li>
</ul>
<h3 id="org-054894a711">修改ingress</h3><div class="highlight"><pre><span></span>nginx.ingress.kubernetes.io/auth-realm=&#39;Authentication Required &#39;
nginx.ingress.kubernetes.io/auth-type=basic
nginx.ingress.kubernetes.io/auth-secret=basic-auth …</pre></div>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2021/07/K8S笔记之ingress增加验证.html">阅读全文 »</a>
          </div>
        </article></li>
        <li><article>
          <div class="entry-header">
            <h1 class="entry-title"><a href="https://honmaple.me/articles/2021/06/flutter笔记之初体验.html" rel="bookmark" title="Permalink to flutter笔记之初体验">flutter笔记之初体验</a></h1>
<header class="entry-info">
  <span title="Updated at 2022-10-10">
    <i class="fa fa-calendar-o"></i>
    六 05 六月 2021
  </span>
    <span class="entry-info-sep hidden-xs">|</span>
    <span class="hidden-xs">
      <i class="fa fa-user-o"></i>
      By <a href="https://honmaple.me/authors/honmaple/index.html">honmaple</a>
    </span>
  <span class="entry-info-sep">|</span>
  <span>
    <i class="fa fa-folder-o"></i>
    In <a href="https://honmaple.me/categories/linux/index.html">Linux</a>
  </span>
    <span class="entry-info-sep">|</span>
    <span>
      <i class="fa fa-bookmark-o"></i>
      0f
        <a href="https://honmaple.me/tags/flutter/index.html">flutter</a>
        <a href="https://honmaple.me/tags/android/index.html">android</a>
    </span>

</header>          </div>
          <hr class="entry-hr" />
          <div class="entry-content entry-summary">
            <div id="table-of-contents"><h2>Table of Contents</h2><div id="text-table-of-contents">
<ul>
<li><a href="#org-8085f41d2c">安装</a>
<ul>
<li><a href="#org-671c4019ba">安装flutter</a></li>
<li><a href="#org-771fc45363">安装java</a></li>
<li><a href="#org-280148651e">安装android sdk</a></li>
</ul>
</li>
<li><a href="#org-c9ca88e509">初体验</a>
<ul>
<li><a href="#org-d39a86f9e3">创建一个新的项目</a></li>
<li><a href="#org-ed75b1a649">配置android模拟器</a></li>
<li><a href="#org-35682d5162">启动flutter项目</a></li>
</ul>
</li>
<li><a href="#org-45cbc8568d">升级Flutter版本</a>
<ul>
<li><a href="#org-6c2c154b9a">升级步骤</a></li>
<li><a href="#org-a6b5e561ba">FAQ</a></li>
</ul>
</li>
<li><a href="#org-a6b5e561ba">FAQ</a>
<ul>
<li><a href="#org-a7850a05b9">启动项目报 <code>Operation timed out</code></a></li>
<li><a href="#org-39149ffb53">Unable to locate Android SDK</a></li>
</ul>
</li>
<li><a href="#org-7862e4530c">参考文档</a></li>
</ul>
</div></div>
<h3 id="org-8085f41d2c">安装</h3><h4 id="org-671c4019ba">安装flutter</h4><ul>
<li>
<p>
首先下载flutter包, 解压到 <code>~/repo</code> 目录,并配置 <code>~/.bashrc</code>
</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HOME</span>/repo/flutter/bin
</pre></div>

</li>
<li>
<p>
<code>source ~/.bashrc</code>使其生效
</p>
<blockquote>
<p>
      注意：首次运行flutter，macos可能会提示无法打开dart，需要到 <code>系统偏好 …</code></p></blockquote></li></ul>
          </div>
          <div class="text-center">
            <a class="btn entry-read-more" href="https://honmaple.me/articles/2021/06/flutter笔记之初体验.html">阅读全文 »</a>
          </div>
        </article></li>
          <li>  <ul class="entry-pagination">
         <li class="active"><a href="https://honmaple.me/index.html">1</a></li>
         <li ><a href="https://honmaple.me/index2.html">2</a></li>
         <li ><a href="https://honmaple.me/index3.html">3</a></li>
         <li>......</li>
         <li ><a href="https://honmaple.me/index20.html">20</a></li>
         <li ><a href="https://honmaple.me/index21.html">21</a></li>
         <li ><a href="https://honmaple.me/index22.html">22</a></li>
      <li class="next"><a href="https://honmaple.me/index2.html">&raquo;</a></li>
  </ul>
</li>
          </ul>
      </div>
    </div>
<div class="entry-footer">
  <ul class="entry-footer-left">
    <li class="hidden-xs">© 2015-2023 honmaple</li>
    <li class="hidden-xs">·</li>
    <li>
          <a href="https://honmaple.me/pages/friends.html">友链</a>
          <span> | </span>
          <a href="https://honmaple.me/pages/contact.html">联系</a>
          <span> | </span>
          <a href="https://honmaple.me/pages/project.html">项目</a>
          <span> | </span>
          <a href="https://honmaple.me/pages/timeline.html">时间轴</a>
    </li>
  </ul>
  <ul class="entry-footer-right">
    <li><a class="entry-switch-theme" title="Moon"><i class="fa fa-moon-o"></i></a></li>
      <li ><a href="https://honmaple.me/pages/music.html" title="Music"><i class="fa fa-music"></i></a></li>
      <li class="hidden-xs"><a href="https://honmaple.me/atom.xml" title="Feed"><i class="fa fa-feed"></i></a></li>
      <li ><a href="https://github.com/honmaple" title="GitHub"><i class="fa fa-github"></i></a></li>
      <li ><a href="https://honmaple.me/pages/travel.html" title="Camera"><i class="fa fa-camera"></i></a></li>
      <li ><a href="https://honmaple.me/pages/contact.html" title="Envelope"><i class="fa fa-envelope"></i></a></li>
  </ul>
</div>    <div class="back-to-top back-to-top-on">
      <i class="fa fa-hand-o-up" title="back to top"></i>
    </div>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-88401692-2"></script>
  <script>
   window.dataLayer = window.dataLayer || [];
   function gtag(){dataLayer.push(arguments);}
   gtag('js', new Date());
   gtag('config', 'UA-88401692-2');
  </script>
      <script src="https://s.libforest.com/static/js/lib.min.js"></script>
        <script src="https://honmaple.me/static/lib/js/script.min.js"></script>
      <script src="https://s.libforest.com/static/js/instantclick.min.js" data-no-instant></script>
      <script data-no-instant>
       InstantClick.on('change', function() {
           if (typeof ga !== 'undefined') {
               ga('send', 'pageview', location.pathname + location.search);
           }
       });
       InstantClick.init(60);
      </script>
  </body>
</html>