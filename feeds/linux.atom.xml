<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>honmaple's blog - Linux</title><link href="https://honmaple.me/" rel="alternate"></link><link href="http://127.0.0.1:8000/feeds/linux.atom.xml" rel="self"></link><id>https://honmaple.me/</id><updated>2019-06-08T15:40:42+08:00</updated><subtitle>风落花语风落天，花落风雨花落田.</subtitle><entry><title>关于ivy的使用技巧</title><link href="https://honmaple.me/articles/2019/05/%E5%85%B3%E4%BA%8Eivy%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7.html" rel="alternate"></link><published>2019-05-14T02:32:02+08:00</published><updated>2019-05-27T16:10:32+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2019-05-14:/articles/2019/05/关于ivy的使用技巧.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-3adaf767ed"&gt;ivy中的tab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-02cb96c0de"&gt;ivy中的C-h&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-3528d8c79e"&gt;ivy-occur批量操作&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-b52fad50bf"&gt;自动打开wgrep-mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-2e8b987865"&gt;批量修改文件名&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-92aa2d024e"&gt;counsel-find-file&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-1cd80fd7a8"&gt;重命名&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-278502a2b7"&gt;自动创建不存在的目录&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-c0d738df1a"&gt;ivy自动使用选中的内容&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-f982e2b254"&gt;搜索某个目录&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-16e38e01b5"&gt;ivy的显示避免出现在视线外&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;ivy默认的配置已经足够了，但还是可以通过一些技巧来提升使用体验&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id="org-3adaf767ed"&gt;ivy中的tab&lt;/h2&gt;
&lt;p&gt;ivy提供了好几个有关补全的命令，分别是&lt;b&gt;ivy-done&lt;/b&gt;, &lt;b&gt;ivy-partial-or-done&lt;/b&gt;, &lt;b&gt;ivy-immediate-done&lt;/b&gt;, &lt;b&gt;ivy-dispatching-done&lt;/b&gt;, 但不幸，想要获得高效的补全，我不得不记住这n多个命令，这常常使效率变得更低，
所以，我自定义了一个 &lt;b&gt;maple/ivy-done&lt;/b&gt;, 仅使用 &lt;code&gt;tab&lt;/code&gt; 这一个按键就可以获得以上所有的体验&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-done&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="nv"&gt;ivy--directory&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-partial-or-done&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;string=&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="nv"&gt;ivy--directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-insert-current&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;and …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-3adaf767ed"&gt;ivy中的tab&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-02cb96c0de"&gt;ivy中的C-h&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-3528d8c79e"&gt;ivy-occur批量操作&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-b52fad50bf"&gt;自动打开wgrep-mode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-2e8b987865"&gt;批量修改文件名&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-92aa2d024e"&gt;counsel-find-file&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-1cd80fd7a8"&gt;重命名&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-278502a2b7"&gt;自动创建不存在的目录&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-c0d738df1a"&gt;ivy自动使用选中的内容&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-f982e2b254"&gt;搜索某个目录&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-16e38e01b5"&gt;ivy的显示避免出现在视线外&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;ivy默认的配置已经足够了，但还是可以通过一些技巧来提升使用体验&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id="org-3adaf767ed"&gt;ivy中的tab&lt;/h2&gt;
&lt;p&gt;ivy提供了好几个有关补全的命令，分别是&lt;b&gt;ivy-done&lt;/b&gt;, &lt;b&gt;ivy-partial-or-done&lt;/b&gt;, &lt;b&gt;ivy-immediate-done&lt;/b&gt;, &lt;b&gt;ivy-dispatching-done&lt;/b&gt;, 但不幸，想要获得高效的补全，我不得不记住这n多个命令，这常常使效率变得更低，
所以，我自定义了一个 &lt;b&gt;maple/ivy-done&lt;/b&gt;, 仅使用 &lt;code&gt;tab&lt;/code&gt; 这一个按键就可以获得以上所有的体验&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-done&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="nv"&gt;ivy--directory&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-partial-or-done&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;string=&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="nv"&gt;ivy--directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-insert-current&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;and&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;eq&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-state-collection&lt;/span&gt; &lt;span class="nv"&gt;ivy-last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nf"&gt;#&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;read-file-name-internal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                 &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-expand-file-if-directory&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-state-current&lt;/span&gt; &lt;span class="nv"&gt;ivy-last&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy--cd&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;this-command&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;ivy-cd&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;预设场景一
&lt;p&gt;dirs目录下有&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;init-a.el
init-b.el
init-c.el
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;等多个文件, 我需要把&lt;b&gt;init-c.el&lt;/b&gt;重命名为&lt;b&gt;init-c.el.bak&lt;/b&gt;, 默认的ivy会怎么做呢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;输入 &lt;b&gt;init c&lt;/b&gt; 进行查找&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;C-M-j&lt;/code&gt; &lt;b&gt;(ivy-immediate-done)&lt;/b&gt; 插入当前选中项&lt;/li&gt;
&lt;li&gt;修改
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;而使用 &lt;b&gt;maple/ivy-done&lt;/b&gt; 后呢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;输入 &lt;b&gt;init c&lt;/b&gt; 进行查找&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;tab&lt;/code&gt; 插入当前选中项&lt;/li&gt;
&lt;li&gt;修改
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;预设场景二
&lt;p&gt;有一个n级子目录，需要切换到第n个子目录下, 默认的ivy会怎么做呢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;tab&lt;/code&gt; 选中&lt;/li&gt;
&lt;li&gt;再次使用 &lt;code&gt;tab&lt;/code&gt; 切换目录
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;而使用 &lt;b&gt;maple/ivy-done&lt;/b&gt; 后呢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;使用 &lt;code&gt;tab&lt;/code&gt; 选中并切换目录
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="org-02cb96c0de"&gt;ivy中的C-h&lt;/h2&gt;
&lt;p&gt;由于我是邪恶的 &lt;b&gt;evil&lt;/b&gt; 用户, 所以我正常情况会使用 &lt;code&gt;C-j&lt;/code&gt;, &lt;code&gt;C-k&lt;/code&gt;来选择待选项，同样的，我希望能够使用 &lt;code&gt;C-h&lt;/code&gt; 来进行某些操作,比如在&lt;b&gt;counsel-ag&lt;/b&gt;中使用&lt;code&gt;C-h&lt;/code&gt;代替&lt;code&gt;backspace&lt;/code&gt;删除输入的字符，而在&lt;b&gt;counsel-find-file&lt;/b&gt;中使用&lt;code&gt;C-h&lt;/code&gt;切换到上一级目录&lt;/p&gt;

&lt;p&gt;ivy默认提供了 &lt;b&gt;counsel-up-directory&lt;/b&gt; 命令可以切换到上级目录, 我希望能更进一步，当有插入的字符时, 调用&lt;code&gt;C-h&lt;/code&gt;能够直接清除插入的字符,再次调用才切换到上一级目录&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-c-h&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;eq&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-state-collection&lt;/span&gt; &lt;span class="nv"&gt;ivy-last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nf"&gt;#&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;read-file-name-internal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;string-equal&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy--input&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
          &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;counsel-up-directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;delete-minibuffer-contents&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-backward-delete-char&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-3528d8c79e"&gt;ivy-occur批量操作&lt;/h2&gt;
&lt;h3 id="org-b52fad50bf"&gt;自动打开wgrep-mode&lt;/h3&gt;
&lt;p&gt;ivy默认调用&lt;b&gt;ivy-occur&lt;/b&gt;后, 还需要调用&lt;b&gt;ivy-wgrep-change-to-wgrep-mode&lt;/b&gt;才能进行批量修改&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;;; ivy-occur custom&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-edit&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;Edit the current search results in a buffer using wgrep.&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;run-with-idle-timer&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;ivy-wgrep-change-to-wgrep-mode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-occur&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="org-2e8b987865"&gt;批量修改文件名&lt;/h3&gt;
&lt;p&gt;预设场景: 当某个项目下有许多使用 &lt;b&gt;aaa.py&lt;/b&gt;的文件,我需要把 &lt;b&gt;aaa.py&lt;/b&gt; 全部修改为 &lt;b&gt;bbb.py&lt;/b&gt;, 也许某个 &lt;b&gt;aaa.py&lt;/b&gt; 需要修改成 &lt;b&gt;ccc.py&lt;/b&gt;，我在使用 &lt;b&gt;projectile-find-file&lt;/b&gt; 搜索完全部的 &lt;b&gt;aaa.py&lt;/b&gt; 后，打开ivy默认的&lt;b&gt;ivy-occur&lt;/b&gt;并不能对文件进行修改(提示&lt;code&gt;Text read only&lt;/code&gt;), 所以我采用 &lt;b&gt;find-name-dired&lt;/b&gt; 来批量修改文件名(目前还有些问题)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-dired-occur&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;find-name-dired&lt;/span&gt;
   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;or&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;projectile-project-root&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;default-directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;concat&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy--input&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-exit-with-action&lt;/span&gt;
   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;lambda&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;_&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;pop-to-buffer&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;get-buffer&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;*Find*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;dired-hide-details-mode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;wdired-change-to-wdired-mode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;bound-and-true-p&lt;/span&gt; &lt;span class="nv"&gt;evil-local-mode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;evil-normal-state&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-92aa2d024e"&gt;counsel-find-file&lt;/h2&gt;
&lt;h3 id="org-1cd80fd7a8"&gt;重命名&lt;/h3&gt;
&lt;p&gt;预设场景: 有一个dirs目录, 我需要在同级目录下创建一个 &lt;b&gt;dirs-aa.el&lt;/b&gt; 的文件, 默认的ivy会怎么做呢&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;切换到 dirs 目录的上级目录&lt;/li&gt;
&lt;li&gt;使用 &lt;b&gt;ivy-immediate-done&lt;/b&gt; 插入目录名&lt;/li&gt;
&lt;li&gt;新建文件
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;但还有一种方式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;切换到 dirs 目录&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;backspace&lt;/code&gt; 键删除目录末尾的 =/=&lt;/li&gt;
&lt;li&gt;新建文件
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;不幸的是，ivy中 &lt;code&gt;backspace&lt;/code&gt; 的按键绑定了 &lt;b&gt;ivy-backward-delete-char&lt;/b&gt;, 在 &lt;b&gt;counsel-find-file&lt;/b&gt; 中使用 ivy会直接返回上级目录, 所以需要对 &lt;b&gt;ivy-backward-delete-char&lt;/b&gt; 作简单的修改&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-backward-delete-char&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="nv"&gt;ivy--directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;p&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;and&lt;/span&gt; &lt;span class="nv"&gt;ivy--directory&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;minibuffer-prompt-end&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;point&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-backward-delete-char&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="nv"&gt;p&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;insert&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;file-name-nondirectory&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;directory-file-name&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt;&lt;span class="p"&gt;))))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="org-278502a2b7"&gt;自动创建不存在的目录&lt;/h3&gt;
&lt;p&gt;不仅用于ivy, 其它文件操作命令也需要&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-make-directory-maybe&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;Create parent directory if not exists while visiting file.&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;file-name-directory&lt;/span&gt; &lt;span class="nf"&gt;buffer-file-name&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;unless&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;file-exists-p&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;y-or-n-p&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;format&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Directory %s does not exist,do you want you create it? &amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
          &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;make-directory&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;keyboard-quit&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;add-to-list&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;find-file-not-found-functions&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;maple/ivy-make-directory-maybe&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="nf"&gt;#&amp;#39;eq&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-c0d738df1a"&gt;ivy自动使用选中的内容&lt;/h2&gt;
&lt;p&gt;在使用 &lt;b&gt;counsel-ag&lt;/b&gt; 或者 &lt;b&gt;swiper&lt;/b&gt;, 我需要快速搜索选中的关键词，然而，ivy默认并不支持这么做，ivy需要打开&lt;b&gt;counsel-ag&lt;/b&gt;后使用 &lt;code&gt;M-n&lt;/code&gt; 插入选中的关键词，当然，也许是作者认为这样的方式很方便，但我并不认同，我为何需要重复一次操作呢，为何还需要记住 &lt;code&gt;M-n&lt;/code&gt; 这样的按键呢？&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/region-string&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;Get region string.&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;not&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;use-region-p&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let*&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;beg&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;region-beginning&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
           &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;end&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;region-end&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
           &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;eol&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;save-excursion&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;goto-char&lt;/span&gt; &lt;span class="nv"&gt;beg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;line-end-position&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;deactivate-mark&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;buffer-substring-no-properties&lt;/span&gt; &lt;span class="nv"&gt;beg&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;min&lt;/span&gt; &lt;span class="nv"&gt;end&lt;/span&gt; &lt;span class="nv"&gt;eol&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;

&lt;span class="c1"&gt;;; custom counsel-ag&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/counsel-ag&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;-counsel-ag&lt;/span&gt; &lt;span class="kp"&gt;&amp;amp;optional&lt;/span&gt; &lt;span class="nv"&gt;initial-input&lt;/span&gt; &lt;span class="nv"&gt;initial-directory&lt;/span&gt; &lt;span class="nv"&gt;extra-ag-args&lt;/span&gt; &lt;span class="nv"&gt;ag-prompt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;funcall&lt;/span&gt; &lt;span class="nv"&gt;-counsel-ag&lt;/span&gt;
           &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;or&lt;/span&gt; &lt;span class="nv"&gt;initial-input&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple/region-string&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
           &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;or&lt;/span&gt; &lt;span class="nv"&gt;initial-directory&lt;/span&gt; &lt;span class="nv"&gt;default-directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
           &lt;span class="nv"&gt;extra-ag-args&lt;/span&gt;
           &lt;span class="nv"&gt;ag-prompt&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;advice-add&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;counsel-ag&lt;/span&gt; &lt;span class="nb"&gt;:around&lt;/span&gt; &lt;span class="nf"&gt;#&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;maple/counsel-ag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样，调用 &lt;b&gt;counsel-ag&lt;/b&gt; 时，如何已经有选中的关键词，就会直接调用该关键词进行查找，避免重复操作, 同样的对于&lt;b&gt;swiper&lt;/b&gt; 也可以使用另一种方式&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-search-at-point&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;func&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;ivy-initial-inputs-alist&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;list&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;cons&lt;/span&gt; &lt;span class="nv"&gt;func&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple/region-string&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;funcall&lt;/span&gt; &lt;span class="nv"&gt;func&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/swiper&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple/ivy-search-at-point&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;swiper&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;



&lt;h2 id="org-f982e2b254"&gt;搜索某个目录&lt;/h2&gt;
&lt;p&gt;&lt;b&gt;counsel-ag&lt;/b&gt;默认搜索当前目录，想要搜索某个目录，需要切换到该目录下调用&lt;b&gt;counsel-ag&lt;/b&gt;，无疑的，这非常不方便，所以，我希望可以选择某个目录进行搜索&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/counsel-ag-directory&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;counsel-ag&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;read-directory-name&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Search in directory: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-16e38e01b5"&gt;ivy的显示避免出现在视线外&lt;/h2&gt;
&lt;p&gt;详见 &lt;a href="https://honmaple.me/articles/2018/06/自定义helm式的ivy.html"&gt;自定义helm式的ivy.html&lt;/a&gt; 中的&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;b&gt;吐嘈六: minibuffer&lt;/b&gt;&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="linux"></category><category term="emacs"></category></entry><entry><title>emacs窗口管理</title><link href="https://honmaple.me/articles/2019/01/emacs%E7%AA%97%E5%8F%A3%E7%AE%A1%E7%90%86.html" rel="alternate"></link><published>2019-01-11T17:07:01+08:00</published><updated>2019-05-04T17:43:16+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2019-01-11:/articles/2019/01/emacs窗口管理.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-35ff770597"&gt;基础设置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-d0def72492"&gt;使用shackle管理窗口&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-df6bd1959b"&gt;窗口黄金分割zoom&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-63d185ebb3"&gt;window-numbering显示当前窗口号&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/honmaple/dotfiles/tree/master/emacs.d/lisp/init-window.el"&gt;init-window.el&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id="org-35ff770597"&gt;基础设置&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;;; 设置默认为左右分屏&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;split-width-threshold&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;evil-leader/set-key&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;ws&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;split-window-below&lt;/span&gt;  &lt;span class="c1"&gt;;; 上下分屏&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;wv&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;split-window-right&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;;; 左右分屏&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-d0def72492"&gt;使用shackle管理窗口&lt;/h2&gt;
&lt;p&gt;当设置了 &lt;code&gt;(setq split-width-threshold 1)&lt;/code&gt; 后所有的窗口都会变成左右分屏，所以需要 &lt;b&gt;shackle&lt;/b&gt; 或 &lt;b&gt;popwin&lt;/b&gt; package对窗口进行管理, 对一些特殊的窗口或 &lt;b&gt;buffer&lt;/b&gt; 比如 &lt;code&gt;*Help*&lt;/code&gt; 和 &lt;code&gt;flycheck error list&lt;/code&gt; 需要设置为显示在下方，并且默认选中&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;shackle-rules&lt;/span&gt;
      &lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;*Help*&amp;quot;&lt;/span&gt; &lt;span class="nb"&gt;:select&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt; &lt;span class="nb"&gt;:align …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-35ff770597"&gt;基础设置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-d0def72492"&gt;使用shackle管理窗口&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-df6bd1959b"&gt;窗口黄金分割zoom&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-63d185ebb3"&gt;window-numbering显示当前窗口号&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/honmaple/dotfiles/tree/master/emacs.d/lisp/init-window.el"&gt;init-window.el&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id="org-35ff770597"&gt;基础设置&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;;; 设置默认为左右分屏&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;split-width-threshold&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;evil-leader/set-key&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;ws&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;split-window-below&lt;/span&gt;  &lt;span class="c1"&gt;;; 上下分屏&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;wv&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;split-window-right&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;;; 左右分屏&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-d0def72492"&gt;使用shackle管理窗口&lt;/h2&gt;
&lt;p&gt;当设置了 &lt;code&gt;(setq split-width-threshold 1)&lt;/code&gt; 后所有的窗口都会变成左右分屏，所以需要 &lt;b&gt;shackle&lt;/b&gt; 或 &lt;b&gt;popwin&lt;/b&gt; package对窗口进行管理, 对一些特殊的窗口或 &lt;b&gt;buffer&lt;/b&gt; 比如 &lt;code&gt;*Help*&lt;/code&gt; 和 &lt;code&gt;flycheck error list&lt;/code&gt; 需要设置为显示在下方，并且默认选中&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;shackle-rules&lt;/span&gt;
      &lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;*Help*&amp;quot;&lt;/span&gt; &lt;span class="nb"&gt;:select&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt; &lt;span class="nb"&gt;:align&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;below&lt;/span&gt; &lt;span class="nb"&gt;:autoclose&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;flycheck-error-list-mode&lt;/span&gt; &lt;span class="nb"&gt;:select&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt; &lt;span class="nb"&gt;:align&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;below&lt;/span&gt; &lt;span class="nb"&gt;:autoclose&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;设置默认的参数&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;shackle-default-size&lt;/span&gt; &lt;span class="mf"&gt;0.3&lt;/span&gt;
      &lt;span class="nv"&gt;shackle-default-alignment&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;below&lt;/span&gt;
      &lt;span class="nv"&gt;shackle-default-rule&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-df6bd1959b"&gt;窗口黄金分割zoom&lt;/h2&gt;
&lt;p&gt;窗口黄金分割是一个非常有用的效果，当选中某个buffer时，这个buffer的window会自动按比例放大，这样就不用手动对窗口进行调整, 之前一直使用 &lt;b&gt;golden-ratio&lt;/b&gt; 这个package, 但看github上最近一次提交已经是两年前，加上使用需要定义很多的 &lt;code&gt;golden-ratio-extra-commands&lt;/code&gt;, 所以切换到了 &lt;b&gt;zoom&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;zoom&lt;/b&gt; 这个 package也有一些问题，比如我定义了&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;zoom-size&lt;/span&gt; &lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;0.618&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="mf"&gt;0.618&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="nv"&gt;zoom-ignored-major-modes&lt;/span&gt; &lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;term-mode&lt;/span&gt; &lt;span class="nv"&gt;flycheck-error-list-mode&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但使用 &lt;code&gt;flycheck-list-errors&lt;/code&gt; 时还是会自动缩放窗口大小，后来翻看源码时发现新建 &lt;b&gt;window&lt;/b&gt; 是都会调用 &lt;code&gt;balance-windows&lt;/code&gt; ,所以我稍微修改了一下&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/balance-windows&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;func&lt;/span&gt; &lt;span class="kp"&gt;&amp;amp;optional&lt;/span&gt; &lt;span class="nv"&gt;window-or-frame&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;unless&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;zoom--window-ignored-p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;funcall&lt;/span&gt; &lt;span class="nv"&gt;func&lt;/span&gt; &lt;span class="nv"&gt;window-or-frame&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;advice-add&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;balance-windows&lt;/span&gt; &lt;span class="nb"&gt;:around&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;maple/balance-windows&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;这样在调用 &lt;code&gt;flycheck-list-errors&lt;/code&gt; 就不会再自动缩放窗口大小了&lt;/p&gt;

&lt;p&gt;另外有一些命令需要临时关闭 &lt;b&gt;zoom-mode&lt;/b&gt; ,所以有添加了一个 &lt;b&gt;marco&lt;/b&gt; 临时关闭 &lt;b&gt;zoom-mode&lt;/b&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defmacro&lt;/span&gt; &lt;span class="nv"&gt;with-zoom-disable&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;declare&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;indent&lt;/span&gt; &lt;span class="nb"&gt;defun&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;zoom-mode-p&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;featurep&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;zoom&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;zoom-mode&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="nv"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="nv"&gt;zoom-mode-p&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;zoom-mode&lt;/span&gt; &lt;span class="mi"&gt;-1&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;res&lt;/span&gt; &lt;span class="o"&gt;`,@&lt;/span&gt;&lt;span class="nv"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="nv"&gt;zoom-mode-p&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;zoom-mode&lt;/span&gt; &lt;span class="nv"&gt;zoom-mode-p&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="nv"&gt;res&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;比如:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;with-zoom-disable&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple-imenu&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-63d185ebb3"&gt;window-numbering显示当前窗口号&lt;/h2&gt;
&lt;p&gt;为了更方便的在窗口间进行跳转，避免重复使用 &lt;code&gt;evil-window-down&lt;/code&gt;, &lt;code&gt;evil-window-right&lt;/code&gt;等命令&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;use-package&lt;/span&gt; &lt;span class="nv"&gt;window-numbering&lt;/span&gt;
  &lt;span class="nb"&gt;:hook&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple-theme&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nv"&gt;window-numbering-mode&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;maple-theme-hook&lt;/b&gt;: 加载 &lt;b&gt;theme&lt;/b&gt; 后执行hook&lt;/p&gt;

&lt;p&gt;然后设置(这里只设置到5,因为我大概不会开10个窗口的)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;evil-leader/set-key&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;w0&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;select-window-0&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;w1&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;select-window-1&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;w2&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;select-window-2&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;w3&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;select-window-3&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;w4&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;select-window-4&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;w5&amp;quot;&lt;/span&gt;  &lt;span class="ss"&gt;&amp;#39;select-window-5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;这样就可以使用&lt;code&gt;leader + w + {window number}&lt;/code&gt;或者 &lt;code&gt;alt + {window number}&lt;/code&gt;跳转&lt;/p&gt;

&lt;p&gt;另外&lt;b&gt;window-number&lt;/b&gt;的显示需要&lt;b&gt;mode-line&lt;/b&gt;的支持，比如在&lt;a href="https://github.com/honmaple/emacs-maple-modeline"&gt;maple-modeline&lt;/a&gt;里可以这样定义&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple-modeline-define&lt;/span&gt; &lt;span class="nv"&gt;window-number&lt;/span&gt;
  &lt;span class="nb"&gt;:if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;bound-and-true-p&lt;/span&gt; &lt;span class="nv"&gt;window-numbering-mode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nb"&gt;:format&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;color&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;face-attribute&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;cursor&lt;/span&gt; &lt;span class="nb"&gt;:background&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple-modeline--add-text-property&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple-modeline--unicode-number&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;int-to-string&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;window-numbering-get-number&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
     &lt;span class="ss"&gt;&amp;#39;face&lt;/span&gt; &lt;span class="o"&gt;`&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;:foreground&lt;/span&gt; &lt;span class="o"&gt;,&lt;/span&gt;&lt;span class="nv"&gt;color&lt;/span&gt; &lt;span class="nb"&gt;:distant-foreground&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;white&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content><category term="emacs"></category><category term="linux"></category></entry><entry><title>web-mode自定义fold函数以适应indent-region</title><link href="https://honmaple.me/articles/2018/11/web-mode%E8%87%AA%E5%AE%9A%E4%B9%89fold%E5%87%BD%E6%95%B0%E4%BB%A5%E9%80%82%E5%BA%94indent-region.html" rel="alternate"></link><published>2018-11-24T23:35:14+08:00</published><updated>2018-11-25T12:48:34+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2018-11-24:/articles/2018/11/web-mode自定义fold函数以适应indent-region.html</id><summary type="html">

&lt;p&gt;&lt;code&gt;web-mode&lt;/code&gt;有一个内置的&lt;code&gt;web-mode-fold-or-unfold&lt;/code&gt;函数，但这个函数有一个问题，当存在&lt;b&gt;fold&lt;/b&gt;时，使用&lt;code&gt;indent-region&lt;/code&gt;会得到错误的缩进，想要得到正确的缩进，必须先 &lt;code&gt;unfold&lt;/code&gt;, 比如&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;div&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
  &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;div class=&amp;quot;col-xs-3 col-sm-3&amp;quot; id=&amp;quot;sidebar&amp;quot; role=&amp;quot;navigation&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
        &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">

&lt;p&gt;&lt;code&gt;web-mode&lt;/code&gt;有一个内置的&lt;code&gt;web-mode-fold-or-unfold&lt;/code&gt;函数，但这个函数有一个问题，当存在&lt;b&gt;fold&lt;/b&gt;时，使用&lt;code&gt;indent-region&lt;/code&gt;会得到错误的缩进，想要得到正确的缩进，必须先 &lt;code&gt;unfold&lt;/code&gt;, 比如&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;div&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
  &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;div class=&amp;quot;col-xs-3 col-sm-3&amp;quot; id=&amp;quot;sidebar&amp;quot; role=&amp;quot;navigation&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
        &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
        &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
  &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/div&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/div&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;a href=&amp;quot;&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;as&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/a&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;当把&lt;b&gt;div#sidebar&lt;/b&gt;使用&lt;code&gt;web-mode-fold-or-unfold&lt;/code&gt;折叠起来, 然后使用&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/indent-buffer&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;Format buffer with `indent-region`.&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;save-excursion&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;indent-region&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;point-min&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;point-max&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;展开后就会变成&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;!-- sidebar --&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;div&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
  &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;div class=&amp;quot;col-xs-3 col-sm-3&amp;quot; id=&amp;quot;sidebar&amp;quot; role=&amp;quot;navigation&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt; &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/span&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
    &lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/div&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/div&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;button class=&amp;quot;btn btn-primary&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;Submit&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/button&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;br /&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;a href=&amp;quot;&amp;quot;&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;as&lt;span class="ni"&gt;&amp;amp;lt;&lt;/span&gt;/a&lt;span class="ni"&gt;&amp;amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这与期望的效果不符(不知道是不是只有我碰到，还是这可能是一个&lt;b&gt;bug&lt;/b&gt;),  我去看了一下&lt;code&gt;web-mode-fold-or-unfold&lt;/code&gt;的实现, 它使用的是&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;put-text-property&lt;/span&gt; &lt;span class="nv"&gt;beg-inside&lt;/span&gt; &lt;span class="nv"&gt;end-inside&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;invisible&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;来隐藏折叠部分， &lt;b&gt;我不太清楚为什么使用put-text-property会使indent-region缩进有问题，有知道的可以告知一下&lt;/b&gt;，但我平时在其他项目中都是使用 &lt;code&gt;hs-toggle-hiding&lt;/code&gt; 来折叠代码， &lt;code&gt;hs-toggle-hiding&lt;/code&gt;能很好的与&lt;code&gt;indent-region&lt;/code&gt;配合&lt;/p&gt;

&lt;p&gt;由于&lt;code&gt;web-mode-fold-or-unfold&lt;/code&gt;这个函数太长，不想占用我自己的配置， 所以魔改了一下&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;fset&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;maple/put-text-property&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;symbol-function&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;put-text-property&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/web-mode-put-text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;p&lt;/span&gt; &lt;span class="nv"&gt;q&lt;/span&gt; &lt;span class="nv"&gt;prop&lt;/span&gt; &lt;span class="nv"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;and&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;eq&lt;/span&gt; &lt;span class="nv"&gt;prop&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;invisible&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nv"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;hs-make-overlay&lt;/span&gt; &lt;span class="nv"&gt;p&lt;/span&gt; &lt;span class="nv"&gt;q&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;code&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple/put-text-property&lt;/span&gt; &lt;span class="nv"&gt;p&lt;/span&gt; &lt;span class="nv"&gt;q&lt;/span&gt; &lt;span class="nv"&gt;prop&lt;/span&gt; &lt;span class="nv"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/web-mode-fold-or-unfold&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;cl-letf&lt;/span&gt; &lt;span class="p"&gt;(((&lt;/span&gt;&lt;span class="nf"&gt;symbol-function&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;put-text-property&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;maple/web-mode-put-text&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;web-mode-fold-or-unfold&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;把&lt;code&gt;put-text-property&lt;/code&gt;临时修改成&lt;code&gt;hs-make-overlay&lt;/code&gt;,这样&lt;b&gt;web-mode&lt;/b&gt;折叠后就能正确地使用&lt;code&gt;maple/indent-buffer&lt;/code&gt;了&lt;/p&gt;

&lt;p&gt;来源:&lt;a href="https://github.com/honmaple/dotfiles/blob/master/emacs.d/lisp/init-web.el"&gt;honmaple's init-web.el&lt;/a&gt;&lt;/p&gt;</content><category term="linux"></category><category term="emacs"></category><category term="elisp"></category></entry><entry><title>maple-imenu——类似tagbar的emacs插件</title><link href="https://honmaple.me/articles/2018/10/maple-imenu%E2%80%94%E2%80%94%E7%B1%BB%E4%BC%BCtagbar%E7%9A%84emacs%E6%8F%92%E4%BB%B6.html" rel="alternate"></link><published>2018-10-18T22:27:05+08:00</published><updated>2018-10-19T11:13:06+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2018-10-18:/articles/2018/10/maple-imenu——类似tagbar的emacs插件.html</id><summary type="html">
&lt;p&gt;这几天参考&lt;code&gt;imenu-list&lt;/code&gt;重写了一个类似 vim 中&lt;code&gt;tagbar&lt;/code&gt;的插件 &lt;a href="https://github.com/honmaple/dotfiles/blob/master/emacs.d/site-lisp/maple/maple-imenu.el"&gt;maple-imenu&lt;/a&gt;,  其实之前我一直在使用另一个类似的插件—— &lt;b&gt;imenu-list&lt;/b&gt;, 虽然&lt;b&gt;imenu-list&lt;/b&gt;已经足够使用了, 但它和&lt;b&gt;golden-ratio&lt;/b&gt;搭配起来很难受， &lt;b&gt;golden-ratio&lt;/b&gt; 我是常开的, 但&lt;b&gt;imenu-list&lt;/b&gt;也会偶尔使用(浏览及讲解代码必备，否则查找某个函数和变量时很难受的)&lt;/p&gt;

&lt;p&gt;原本我想要自定义一下&lt;b&gt;imenu-list&lt;/b&gt;，但看了源码之后, 发现很多地方都不符合我的需求， 而且需要改动的地方越来越多，最后不如自己重写&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;如何使用
&lt;p&gt;下载&lt;a href="https://github.com/honmaple/dotfiles/blob/master/emacs.d/site-lisp/maple/maple-imenu.el"&gt;文件&lt;/a&gt;复制到 &lt;code&gt;$HOME/.emacs.d/site-lisp/maple-imenu&lt;/code&gt; 目录, 然后&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;use-package&lt;/span&gt; &lt;span class="nv"&gt;maple-imenu&lt;/span&gt;
  &lt;span class="nb"&gt;:load-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;site-lisp/maple-imenu&amp;quot;&lt;/span&gt;
  &lt;span class="nb"&gt;:commands&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple-imenu&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nb"&gt;:config&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;with-eval-after-load …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">
&lt;p&gt;这几天参考&lt;code&gt;imenu-list&lt;/code&gt;重写了一个类似 vim 中&lt;code&gt;tagbar&lt;/code&gt;的插件 &lt;a href="https://github.com/honmaple/dotfiles/blob/master/emacs.d/site-lisp/maple/maple-imenu.el"&gt;maple-imenu&lt;/a&gt;,  其实之前我一直在使用另一个类似的插件—— &lt;b&gt;imenu-list&lt;/b&gt;, 虽然&lt;b&gt;imenu-list&lt;/b&gt;已经足够使用了, 但它和&lt;b&gt;golden-ratio&lt;/b&gt;搭配起来很难受， &lt;b&gt;golden-ratio&lt;/b&gt; 我是常开的, 但&lt;b&gt;imenu-list&lt;/b&gt;也会偶尔使用(浏览及讲解代码必备，否则查找某个函数和变量时很难受的)&lt;/p&gt;

&lt;p&gt;原本我想要自定义一下&lt;b&gt;imenu-list&lt;/b&gt;，但看了源码之后, 发现很多地方都不符合我的需求， 而且需要改动的地方越来越多，最后不如自己重写&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;如何使用
&lt;p&gt;下载&lt;a href="https://github.com/honmaple/dotfiles/blob/master/emacs.d/site-lisp/maple/maple-imenu.el"&gt;文件&lt;/a&gt;复制到 &lt;code&gt;$HOME/.emacs.d/site-lisp/maple-imenu&lt;/code&gt; 目录, 然后&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;use-package&lt;/span&gt; &lt;span class="nv"&gt;maple-imenu&lt;/span&gt;
  &lt;span class="nb"&gt;:load-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;site-lisp/maple-imenu&amp;quot;&lt;/span&gt;
  &lt;span class="nb"&gt;:commands&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple-imenu&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="nb"&gt;:config&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;with-eval-after-load&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;evil&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;evil-make-overriding-map&lt;/span&gt; &lt;span class="nv"&gt;maple-imenu-mode-map&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;normal&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;M-x&lt;/span&gt; &lt;span class="nv"&gt;maple-imenu&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="row"&gt;
  &lt;div class="col-md-6"&gt;
    &lt;a href="https://static.honmaple.com/images/2018/10/maple-imenu-1.png?type=show" data-fancybox="image"&gt;&lt;img data-src="https://static.honmaple.com/images/2018/10/maple-imenu-1.png?type=thumb" class="lazyload" /&gt;&lt;/a&gt;
  &lt;/div&gt;
  &lt;div class="col-md-6"&gt;
   &lt;a href="https://static.honmaple.com/images/2018/10/maple-imenu-2.png?type=show" data-fancybox="image"&gt;&lt;img data-src="https://static.honmaple.com/images/2018/10/maple-imenu-2.png?type=thumb" class="lazyload" /&gt;&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;相关变量
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;maple-imenu-buffer&lt;/code&gt;
&lt;p&gt;maple-imenu buffer name, default &lt;code&gt;*maple-imenu*&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maple-imenu-displayed-buffer&lt;/code&gt;
&lt;p&gt;displayed buffer name, default &lt;code&gt;nil&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maple-imenu-overlays&lt;/code&gt;
&lt;p&gt;save overlay info, toggle open or close entry&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maple-imenu-width&lt;/code&gt;
&lt;p&gt;maple-imenu window size, default &lt;code&gt;25&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maple-imenu-padding&lt;/code&gt;
&lt;p&gt;maple-imenu prefix padding, default &lt;code&gt;2&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maple-imenu-position&lt;/code&gt;
&lt;p&gt;maple-imenu window display position, default &lt;code&gt;'right&lt;/code&gt;, or &lt;code&gt;'left&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maple-imenu-arrow&lt;/code&gt;
&lt;p&gt;open or close arrow, default &lt;code&gt;("▾" . "▸")&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;maple-imenu-auto-update&lt;/code&gt;
&lt;p&gt;auto update when &lt;code&gt;t&lt;/code&gt;, after save every time&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;相比较&lt;b&gt;imenu-list&lt;/b&gt;
&lt;p&gt;➊ 代码和逻辑我认为与 imenu-list 比起来更加通俗易懂&lt;/p&gt;

&lt;p&gt;➋ window fixed, 至少与&lt;b&gt;golden-ratio&lt;/b&gt;搭配不那么难受&lt;/p&gt;

&lt;p&gt;➌ 更多我可以控制和自定义的地方&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content><category term="linux"></category><category term="emacs"></category></entry><entry><title>使用maple-note管理笔记</title><link href="https://honmaple.me/articles/2018/10/%E4%BD%BF%E7%94%A8maple-note%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0.html" rel="alternate"></link><published>2018-10-18T21:59:33+08:00</published><updated>2019-06-08T15:40:07+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2018-10-18:/articles/2018/10/使用maple-note管理笔记.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-6a07a7a6a8"&gt;前言&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-d7d7ce790b"&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-31e3310765"&gt;快捷键&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;更新于&lt;code&gt;2019.04&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;b&gt;blog-mode&lt;/b&gt; 更新为 &lt;b&gt;maple-note&lt;/b&gt;&lt;/li&gt;
&lt;li&gt;新建 &lt;b&gt;Git&lt;/b&gt; 仓库 &lt;a href="https://github.com/honmaple/emacs-maple-note"&gt;emacs-maple-note&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/honmaple/emacs-maple-note"&gt;emacs-maple-note&lt;/a&gt; &lt;del&gt;&lt;a href="https://github.com/honmaple/dotfiles/tree/master/emacs.d/site-lisp/blog-mode"&gt;blog-mode&lt;/a&gt;&lt;/del&gt;, 一个基于&lt;code&gt;tabulated-list&lt;/code&gt;的emacs笔记管理插件&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id="org-6a07a7a6a8"&gt;前言&lt;/h3&gt;
&lt;p&gt;很早之前我一直在使用&lt;code&gt;blog-admin&lt;/code&gt;作为博客笔记的管理工具, 虽然没有用社区维护的 &lt;a href="https://github.com/CodeFalling/blog-admin"&gt;CodeFalling/blog-admin&lt;/a&gt;, 而是用我自己修改的&lt;a href="https://github.com/honmaple/dotfiles/tree/master/emacs.d/site-lisp/blog-admin"&gt;honmaple/blog-admin&lt;/a&gt;, 毕竟我使用的&lt;b&gt;pelican&lt;/b&gt;, 是一个很小众的静态博客生成工具, 为了适应&lt;b&gt;pelican&lt;/b&gt;, 也为了适应自己平时的使用, 所以自己修改了一个版本&lt;/p&gt;

&lt;p&gt;但最近一是闲来没事，二是&lt;b&gt;blog-admin&lt;/b&gt;使用的是&lt;b&gt;ctable&lt;/b&gt;，中英文对齐上有些问题(虽然早就解决了), 三是觉得&lt;b&gt;blog-admin&lt;/b&gt;有很多我不需要的代码, 而且看到那一长串的配置 …&lt;/p&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-6a07a7a6a8"&gt;前言&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-d7d7ce790b"&gt;配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-31e3310765"&gt;快捷键&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;更新于&lt;code&gt;2019.04&lt;/code&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;b&gt;blog-mode&lt;/b&gt; 更新为 &lt;b&gt;maple-note&lt;/b&gt;&lt;/li&gt;
&lt;li&gt;新建 &lt;b&gt;Git&lt;/b&gt; 仓库 &lt;a href="https://github.com/honmaple/emacs-maple-note"&gt;emacs-maple-note&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/honmaple/emacs-maple-note"&gt;emacs-maple-note&lt;/a&gt; &lt;del&gt;&lt;a href="https://github.com/honmaple/dotfiles/tree/master/emacs.d/site-lisp/blog-mode"&gt;blog-mode&lt;/a&gt;&lt;/del&gt;, 一个基于&lt;code&gt;tabulated-list&lt;/code&gt;的emacs笔记管理插件&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id="org-6a07a7a6a8"&gt;前言&lt;/h3&gt;
&lt;p&gt;很早之前我一直在使用&lt;code&gt;blog-admin&lt;/code&gt;作为博客笔记的管理工具, 虽然没有用社区维护的 &lt;a href="https://github.com/CodeFalling/blog-admin"&gt;CodeFalling/blog-admin&lt;/a&gt;, 而是用我自己修改的&lt;a href="https://github.com/honmaple/dotfiles/tree/master/emacs.d/site-lisp/blog-admin"&gt;honmaple/blog-admin&lt;/a&gt;, 毕竟我使用的&lt;b&gt;pelican&lt;/b&gt;, 是一个很小众的静态博客生成工具, 为了适应&lt;b&gt;pelican&lt;/b&gt;, 也为了适应自己平时的使用, 所以自己修改了一个版本&lt;/p&gt;

&lt;p&gt;但最近一是闲来没事，二是&lt;b&gt;blog-admin&lt;/b&gt;使用的是&lt;b&gt;ctable&lt;/b&gt;，中英文对齐上有些问题(虽然早就解决了), 三是觉得&lt;b&gt;blog-admin&lt;/b&gt;有很多我不需要的代码, 而且看到那一长串的配置。。。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;blog-admin-backend-type&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;pelican&lt;/span&gt;
      &lt;span class="nv"&gt;blog-admin-backend-new-post-in-drafts&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt; &lt;span class="c1"&gt;;; create new post in drafts by default&lt;/span&gt;
      &lt;span class="nv"&gt;blog-admin-backend-new-post-with-same-name-dir&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="c1"&gt;;; create same-name directory with new post&lt;/span&gt;
      &lt;span class="nv"&gt;blog-admin-backend-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;~/git/pelican&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;blog-admin-backend-pelican-config-file&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;pelicanconf.py&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;blog-admin-backend-pelican-posts-dir&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/org&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;blog-admin-backend-pelican-org-mode-dir&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/org&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;blog-admin-backend-pelican-markdown-dir&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/markdown&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;blog-admin-backend-pelican-drafts-dir&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/draft&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;add-hook&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;blog-admin-backend-after-new-post-hook&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;find-file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;maple/add-hook&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;blog-admin-mode-hook&lt;/span&gt;
  &lt;span class="nb"&gt;:if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;display-graphic-p&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="c1"&gt;;; (set-face-attribute &amp;#39;variable-pitch nil :font &amp;quot;-Sony-Sony Fixed-normal-normal-normal-*-16-*-*-*-c-80-iso10646-1&amp;quot;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;set-face-attribute&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;variable-pitch&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt; &lt;span class="nb"&gt;:font&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Inconsolata 12&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;buffer-face-mode&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;查找资料后锁定了&lt;b&gt;tabulated-list&lt;/b&gt;, 毕竟默认的emacs包管理器使用的就是&lt;b&gt;tabulated-list&lt;/b&gt;, 最终参考&lt;code&gt;package.el.gz&lt;/code&gt;, 自己写了一个 &lt;code&gt;maple-note&lt;/code&gt; &lt;del&gt;blog-mode&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href="https://static.honmaple.com/images/2018/10/blog-mode.png?type=show" data-fancybox="image"&gt;&lt;img data-src="https://static.honmaple.com/images/2018/10/blog-mode.png?type=thumb" class="lazyload" /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h3 id="org-d7d7ce790b"&gt;配置&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;use-package&lt;/span&gt; &lt;span class="nv"&gt;maple-note&lt;/span&gt;
  &lt;span class="nb"&gt;:ensure&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt;
  &lt;span class="nb"&gt;:commands&lt;/span&gt; &lt;span class="nv"&gt;maple-note&lt;/span&gt;
  &lt;span class="nb"&gt;:config&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;maple-note-root-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;~/git/pelican&amp;quot;&lt;/span&gt;
        &lt;span class="nv"&gt;maple-note-draft-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/draft&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;maple-note-alist&lt;/span&gt;
        &lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;markdown&amp;quot;&lt;/span&gt;
           &lt;span class="nb"&gt;:path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/markdown&amp;quot;&lt;/span&gt;
           &lt;span class="nb"&gt;:read&lt;/span&gt; &lt;span class="nv"&gt;maple-note--read-md&lt;/span&gt;
           &lt;span class="nb"&gt;:template&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Title: %s&lt;/span&gt;
&lt;span class="s"&gt;                      Author: honmaple&lt;/span&gt;
&lt;span class="s"&gt;                      Date: %s&lt;/span&gt;
&lt;span class="s"&gt;                      Modified: %s&lt;/span&gt;
&lt;span class="s"&gt;                      Category:&lt;/span&gt;
&lt;span class="s"&gt;                      Tags:&lt;/span&gt;
&lt;span class="s"&gt;                      Slug: %s&lt;/span&gt;
&lt;span class="s"&gt;                      Summary: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
          &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;org-mode&amp;quot;&lt;/span&gt;
           &lt;span class="nb"&gt;:path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/org&amp;quot;&lt;/span&gt;
           &lt;span class="nb"&gt;:read&lt;/span&gt; &lt;span class="nv"&gt;maple-note--read-org&lt;/span&gt;
           &lt;span class="nb"&gt;:template&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;#+TITLE: %s&lt;/span&gt;
&lt;span class="s"&gt;                      #+AUTHOR: honmaple&lt;/span&gt;
&lt;span class="s"&gt;                      #+DATE: %s&lt;/span&gt;
&lt;span class="s"&gt;                      #+CATEGORY:&lt;/span&gt;
&lt;span class="s"&gt;                      #+PROPERTY: MODIFIED %s&lt;/span&gt;
&lt;span class="s"&gt;                      #+PROPERTY: TAGS&lt;/span&gt;
&lt;span class="s"&gt;                      #+PROPERTY: SLUG %s&lt;/span&gt;
&lt;span class="s"&gt;                      #+PROPERTY: SUMMARY &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;

&lt;span class="c1"&gt;;; 弃用&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;use-package&lt;/span&gt; &lt;span class="nv"&gt;blog-mode&lt;/span&gt;
  &lt;span class="nb"&gt;:load-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;site-lisp/blog-mode&amp;quot;&lt;/span&gt;
  &lt;span class="nb"&gt;:commands&lt;/span&gt; &lt;span class="nv"&gt;blog-start&lt;/span&gt;
  &lt;span class="nb"&gt;:config&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;blog-root-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;~/git/pelican&amp;quot;&lt;/span&gt;   &lt;span class="c1"&gt;;; 文章根目录&lt;/span&gt;
        &lt;span class="nv"&gt;blog-org-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/org&amp;quot;&lt;/span&gt;      &lt;span class="c1"&gt;;; org文件保存目录&lt;/span&gt;
        &lt;span class="nv"&gt;blog-md-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/markdown&amp;quot;&lt;/span&gt;  &lt;span class="c1"&gt;;; markdown文件保存目录&lt;/span&gt;
        &lt;span class="nv"&gt;blog-draft-path&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;content/draft&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="c1"&gt;;; 草稿文件保存目录&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="org-31e3310765"&gt;快捷键&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;w&lt;/code&gt; 新建文章
&lt;p&gt;新建文章以&lt;code&gt;.org&lt;/code&gt;或=.md=结尾, 默认会保存在&lt;code&gt;maple-note-draft-path&lt;/code&gt; &lt;del&gt;blog-draft-path&lt;/del&gt;目录下&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;r&lt;/code&gt; 刷新列表&lt;/li&gt;
&lt;li&gt;&lt;code&gt;s&lt;/code&gt; 发布与未发布切换
&lt;p&gt;这个其实是目录的切换, 未发布的放到&lt;code&gt;maple-note-draft-path&lt;/code&gt; &lt;del&gt;blog-draft-path&lt;/del&gt;目录下, &lt;del&gt;已发布的&lt;b&gt;org&lt;/b&gt;文件放到&lt;code&gt;blog-org-path&lt;/code&gt;目录, &lt;b&gt;markdown&lt;/b&gt;文件放到&lt;code&gt;blog-md-path&lt;/code&gt;目录&lt;/del&gt; ,已发布的&lt;b&gt;org&lt;/b&gt;文件放到 &lt;code&gt;maple-note-alist&lt;/code&gt; 中预定义的 &lt;code&gt;path&lt;/code&gt; 路径里, &lt;b&gt;markdown&lt;/b&gt;文件同理&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;D&lt;/code&gt; 删除当前文章&lt;/li&gt;
&lt;li&gt;&lt;code&gt;f&lt;/code&gt; 筛选文章
&lt;p&gt;筛选&lt;b&gt;title&lt;/b&gt;和*category*&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;RET&lt;/code&gt; (鼠标左键)
&lt;ul&gt;
&lt;li&gt;点击&lt;b&gt;title&lt;/b&gt;: 打开文件&lt;/li&gt;
&lt;li&gt;点击&lt;b&gt;publish&lt;/b&gt;: 发布与未发布切换&lt;/li&gt;
&lt;li&gt;点击&lt;b&gt;category&lt;/b&gt;: 筛选当前分类
&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="linux"></category><category term="emacs"></category></entry><entry><title>elasticsearch笔记</title><link href="https://honmaple.me/articles/2018/09/elasticsearch%E7%AC%94%E8%AE%B0.html" rel="alternate"></link><published>2018-09-19T14:42:46+08:00</published><updated>2019-03-21T17:42:44+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2018-09-19:/articles/2018/09/elasticsearch笔记.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-916e8b4bc5"&gt;elasticsearch&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-087db63ab1"&gt;安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-903d37c77f"&gt;优化&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-385c272e35"&gt;重启&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-a777262164"&gt;踩坑&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-80d4015f1f"&gt;kibana&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-087db63ab1"&gt;安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-903d37c77f"&gt;优化&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-a777262164"&gt;踩坑&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;h2 id="org-916e8b4bc5"&gt;elasticsearch&lt;/h2&gt;
&lt;h3 id="org-087db63ab1"&gt;安装&lt;/h3&gt;

&lt;h3 id="org-903d37c77f"&gt;优化&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;关闭swap
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;swapoff -a
&lt;span class="c1"&gt;# 注释 /etc/fstab swap&lt;/span&gt;
sysctl -p
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;unlimit调整
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sysctl -w vm.max_map_count&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;262144&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;vm.max_map_count=262144&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;gt&lt;span class="p"&gt;;&amp;amp;&lt;/span&gt;gt&lt;span class="p"&gt;;&lt;/span&gt; /etc/sysctl.conf
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;使用ssd&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="org-385c272e35"&gt;重启&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -X PUT &lt;span class="s2"&gt;&amp;quot;localhost:9200/_cluster/settings&amp;quot;&lt;/span&gt; -H …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-916e8b4bc5"&gt;elasticsearch&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-087db63ab1"&gt;安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-903d37c77f"&gt;优化&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-385c272e35"&gt;重启&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-a777262164"&gt;踩坑&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-80d4015f1f"&gt;kibana&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-087db63ab1"&gt;安装&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-903d37c77f"&gt;优化&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-a777262164"&gt;踩坑&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;h2 id="org-916e8b4bc5"&gt;elasticsearch&lt;/h2&gt;
&lt;h3 id="org-087db63ab1"&gt;安装&lt;/h3&gt;

&lt;h3 id="org-903d37c77f"&gt;优化&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;关闭swap
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;swapoff -a
&lt;span class="c1"&gt;# 注释 /etc/fstab swap&lt;/span&gt;
sysctl -p
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;unlimit调整
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sysctl -w vm.max_map_count&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;262144&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;vm.max_map_count=262144&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;gt&lt;span class="p"&gt;;&amp;amp;&lt;/span&gt;gt&lt;span class="p"&gt;;&lt;/span&gt; /etc/sysctl.conf
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;使用ssd&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="org-385c272e35"&gt;重启&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -X PUT &lt;span class="s2"&gt;&amp;quot;localhost:9200/_cluster/settings&amp;quot;&lt;/span&gt; -H &lt;span class="s1"&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; -d&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;{&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;quot;persistent&amp;quot;: {&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;quot;cluster.routing.allocation.enable&amp;quot;: &amp;quot;none&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;  }&lt;/span&gt;
&lt;span class="s1"&gt;}&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
curl -X POST &lt;span class="s2"&gt;&amp;quot;localhost:9200/_flush/synced&amp;quot;&lt;/span&gt;
supervisorctl restart elasticsearch
curl -X GET &lt;span class="s2"&gt;&amp;quot;localhost:9200/_cat/health&amp;quot;&lt;/span&gt;
curl -X PUT &lt;span class="s2"&gt;&amp;quot;localhost:9200/_cluster/settings&amp;quot;&lt;/span&gt; -H &lt;span class="s1"&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; -d&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;{&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;quot;persistent&amp;quot;: {&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;quot;cluster.routing.allocation.enable&amp;quot;: null&lt;/span&gt;
&lt;span class="s1"&gt;  }&lt;/span&gt;
&lt;span class="s1"&gt;}&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id="org-a777262164"&gt;踩坑&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;滚动重启
&lt;p&gt;重启前&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -XPUT http://192.168.67.14:9200/_cluster/settings -d &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;quot;transient&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;cluster.routing.allocation.enable&amp;quot; : &amp;quot;none&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;    }&lt;/span&gt;
&lt;span class="s1"&gt;}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;重启后&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -XPUT http://192.168.67.14:9200/_cluster/settings -d &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;quot;transient&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;cluster.routing.allocation.enable&amp;quot; : &amp;quot;all&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;    }&lt;/span&gt;
&lt;span class="s1"&gt;}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;修改index.number_of_shards&lt;/li&gt;
&lt;li&gt;磁盘损坏
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -XPOST &lt;span class="s1"&gt;&amp;#39;http://192.168.60.32:9200/_cluster/reroute&amp;#39;&lt;/span&gt; -d &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;commands&amp;quot; : [ {&lt;/span&gt;
&lt;span class="s1"&gt;              &amp;quot;allocate&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;                  &amp;quot;index&amp;quot; : &amp;quot;.marvel-2018.10.10&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;                  &amp;quot;shard&amp;quot; : 0,&lt;/span&gt;
&lt;span class="s1"&gt;                  &amp;quot;node&amp;quot; : &amp;quot;1.7.5-192.168.67.14&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;                  &amp;quot;allow_primary&amp;quot; : true&lt;/span&gt;
&lt;span class="s1"&gt;              }&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        ]&lt;/span&gt;
&lt;span class="s1"&gt;    }&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;unassigned shards
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl http://127.0.0.1:9200/_cat/shards?v &lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;gt&lt;span class="p"&gt;;&amp;amp;&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; grep UNASSIGNED
&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl http://127.0.0.1:9200/_nodes/process?pretty
&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -XPOST &lt;span class="s1"&gt;&amp;#39;http://192.168.60.32:9200/_cluster/reroute&amp;#39;&lt;/span&gt; -d &lt;span class="s1"&gt;&amp;#39;{&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;commands&amp;quot; : [ {&lt;/span&gt;
&lt;span class="s1"&gt;                &amp;quot;allocate&amp;quot; : {&lt;/span&gt;
&lt;span class="s1"&gt;                    &amp;quot;index&amp;quot; : &amp;quot;logstash-xxx-up-2019.01.29&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;                    &amp;quot;shard&amp;quot; : 9,&lt;/span&gt;
&lt;span class="s1"&gt;                    &amp;quot;node&amp;quot; : &amp;quot;kzI0751OSJBcx_wmLQ&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;                    &amp;quot;allow_primary&amp;quot; : true&lt;/span&gt;
&lt;span class="s1"&gt;                }&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        ]&lt;/span&gt;
&lt;span class="s1"&gt;    }&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;修改@timestamp类型
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -XPUT &lt;span class="s2"&gt;&amp;quot;http://127.0.0.1:9200/_template/uplog&amp;quot;&lt;/span&gt; -H &lt;span class="s1"&gt;&amp;#39;Content-Type: application/json&amp;#39;&lt;/span&gt; -H &lt;span class="s1"&gt;&amp;#39;Host: elasticsearch.morgans&amp;#39;&lt;/span&gt; -d&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;{&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;quot;index_patterns&amp;quot;: [&amp;quot;uplog-*&amp;quot;],&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;quot;settings&amp;quot;: {&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;quot;index.number_of_replicas&amp;quot;: 0&lt;/span&gt;
&lt;span class="s1"&gt;  },&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;quot;mappings&amp;quot;: {&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;quot;_default_&amp;quot;: {&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;quot;properties&amp;quot;: {&lt;/span&gt;
&lt;span class="s1"&gt;            &amp;quot;@timestamp&amp;quot;: {&lt;/span&gt;
&lt;span class="s1"&gt;                &amp;quot;type&amp;quot;: &amp;quot;date&amp;quot;,&lt;/span&gt;
&lt;span class="s1"&gt;                &amp;quot;doc_values&amp;quot;: true&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        }&lt;/span&gt;
&lt;span class="s1"&gt;    }&lt;/span&gt;
&lt;span class="s1"&gt;  }&lt;/span&gt;
&lt;span class="s1"&gt;}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="org-80d4015f1f"&gt;kibana&lt;/h2&gt;
&lt;h3 id="org-087db63ab1"&gt;安装&lt;/h3&gt;

&lt;h3 id="org-903d37c77f"&gt;优化&lt;/h3&gt;

&lt;h3 id="org-a777262164"&gt;踩坑&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;保存时kibana报错 &lt;code&gt;Visualization Editor: blocked by: [FORBIDDEN/12/index read-only&lt;/code&gt;
&lt;p&gt;参考 &lt;a href="https://github.com/elastic/kibana/issues/13685"&gt;https://github.com/elastic/kibana/issues/13685&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -XPUT -H &lt;span class="s2"&gt;&amp;quot;Content-Type: application/json&amp;quot;&lt;/span&gt; http://127.0.0.1:9200/.kibana/_settings -d &lt;span class="s1"&gt;&amp;#39;{&amp;quot;index.blocks.read_only_allow_delete&amp;quot;: null}&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;Timelion每次查询得到的数据不一样
&lt;p&gt;参考 &lt;a href="https://github.com/elastic/kibana/issues/23428"&gt;https://github.com/elastic/kibana/issues/23428&lt;/a&gt; 和 &lt;a href="https://discuss.elastic.co/t/timelion-gives-different-result-when-it-auto-refreshes/155182"&gt;https://discuss.elastic.co/t/timelion-gives-different-result-when-it-auto-refreshes/155182&lt;/a&gt;
修改&lt;b&gt;kibana.yml&lt;/b&gt;配置&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;elasticsearch&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;shardTimeout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;30000&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ul&gt;</content><category term="linux"></category><category term="elasticsearch"></category><category term="devops"></category></entry><entry><title>ansible笔记</title><link href="https://honmaple.me/articles/2018/09/ansible%E7%AC%94%E8%AE%B0.html" rel="alternate"></link><published>2018-09-04T10:53:51+08:00</published><updated>2018-10-24T19:29:35+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2018-09-04:/articles/2018/09/ansible笔记.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-123227efb3"&gt;ansible动态解析inventory&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-062833af29"&gt;ansible自定义模块传递list变量会变成字符串&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;h2 id="org-123227efb3"&gt;ansible动态解析inventory&lt;/h2&gt;
&lt;p&gt;&lt;b&gt;ansible&lt;/b&gt;调用inventory模块时总会调用一个文件或脚本来进行处理, 但我想要动态的解析inventory, 即直接传入一个字符串而不是文件, 直接调用ansible的接口来进行解析（不同格式的inventory也可以手动解析，比如yaml格式可以使用pyyaml解析，不过直接使用ansible接口会更方便一些）&lt;/p&gt;

&lt;p&gt;但问题是&lt;b&gt;ansible&lt;/b&gt;没有直接可供调用的接口, 不过可以直接查看ansible源码，找到相应的解析函数，封装一下即可&lt;/p&gt;

&lt;p&gt;查找源码, 根据 &lt;code&gt;InventoryManager&lt;/code&gt; 传递的&lt;b&gt;source&lt;/b&gt;变量找到&lt;code&gt;parse_sources&lt;/code&gt;这个函数&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;InventoryManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parse_sources&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39; iterate over inventory sources and parse each one to populate it&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;

        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_setup_inventory_plugins …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-123227efb3"&gt;ansible动态解析inventory&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-062833af29"&gt;ansible自定义模块传递list变量会变成字符串&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;h2 id="org-123227efb3"&gt;ansible动态解析inventory&lt;/h2&gt;
&lt;p&gt;&lt;b&gt;ansible&lt;/b&gt;调用inventory模块时总会调用一个文件或脚本来进行处理, 但我想要动态的解析inventory, 即直接传入一个字符串而不是文件, 直接调用ansible的接口来进行解析（不同格式的inventory也可以手动解析，比如yaml格式可以使用pyyaml解析，不过直接使用ansible接口会更方便一些）&lt;/p&gt;

&lt;p&gt;但问题是&lt;b&gt;ansible&lt;/b&gt;没有直接可供调用的接口, 不过可以直接查看ansible源码，找到相应的解析函数，封装一下即可&lt;/p&gt;

&lt;p&gt;查找源码, 根据 &lt;code&gt;InventoryManager&lt;/code&gt; 传递的&lt;b&gt;source&lt;/b&gt;变量找到&lt;code&gt;parse_sources&lt;/code&gt;这个函数&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;InventoryManager&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;parse_sources&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cache&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39; iterate over inventory sources and parse each one to populate it&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;

        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_setup_inventory_plugins&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;然后再根据&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_setup_inventory_plugins&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;#39;&amp;#39;&amp;#39; sets up loaded inventory plugins for usage &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;

    &lt;span class="n"&gt;inventory_loader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;PluginLoader&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;InventoryModule&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;ansible.plugins.inventory&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;C&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;DEFAULT_INVENTORY_PLUGIN_PATH&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;inventory_plugins&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;找到对应的解析&lt;b&gt;plugin&lt;/b&gt;, 我使用的是&lt;b&gt;ini&lt;/b&gt;格式的inventory, 所以自定义一下&lt;code&gt;ansible.plugins.inventory.ini.InventoryModule&lt;/code&gt;这个模块即可&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ansible.plugins.inventory.ini&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;InventoryModule&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ansible.inventory.data&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;InventoryData&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ansible.parsing.dataloader&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;DataLoader&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ansible.module_utils._text&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;to_text&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ansible.template&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Templar&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;InventoryCustomModule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;InventoryModule&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mine_parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;b_data&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loader&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DataLoader&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inventory&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;InventoryData&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;templar&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Templar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;loader&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loader&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;to_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;b_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;errors&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;surrogate_or_strict&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;UnicodeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
            &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;b_data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;splitlines&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
                &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;b_COMMENT_MARKERS&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;to_text&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;errors&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;surrogate_or_strict&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;&lt;b&gt;如何使用&lt;/b&gt;:
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="s1"&gt;[MY-HOST]&lt;/span&gt;
&lt;span class="s1"&gt;MY_HOST-1 ansible_ssh_host=127.0.0.1&lt;/span&gt;
&lt;span class="s1"&gt;MY_HOST-2 ansible_ssh_host=127.0.0.2&lt;/span&gt;
&lt;span class="s1"&gt;MY_HOST-3 ansible_ssh_host=127.0.0.3&lt;/span&gt;
&lt;span class="s1"&gt;MY_HOST-4 ansible_ssh_host=127.0.0.4&lt;/span&gt;

&lt;span class="s1"&gt;[MY-HOST:vars]&lt;/span&gt;
&lt;span class="s1"&gt;vip=127.0.0.10&lt;/span&gt;
&lt;span class="s1"&gt;ppp=test&lt;/span&gt;

&lt;span class="s1"&gt;[MY-HOST1]&lt;/span&gt;
&lt;span class="s1"&gt;MY_HOST1-1 ansible_ssh_host=127.0.0.11&lt;/span&gt;
&lt;span class="s1"&gt;MY_HOST1-2 ansible_ssh_host=127.0.0.12&lt;/span&gt;

&lt;span class="s1"&gt;[MY-HOST:children]&lt;/span&gt;
&lt;span class="s1"&gt;MY-HOST1&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;InventoryCustomModule&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mine_parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;group&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inventory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;groups&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;items&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;child_groups&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hosts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;vars&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;结果&lt;/b&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ungrouped&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;all&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ungrouped&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MY&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="k"&gt;HOST&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;MY-HOST1&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;vip&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.10&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ppp&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MY_HOST&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ansible_ssh_host&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_file&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_dir&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MY_HOST&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ansible_ssh_host&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.2&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_file&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_dir&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MY_HOST&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ansible_ssh_host&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.3&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_file&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_dir&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MY_HOST&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ansible_ssh_host&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.4&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_file&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_dir&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MY&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;HOST1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;[]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MY_HOST1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ansible_ssh_host&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.11&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_file&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_dir&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MY_HOST1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ansible_ssh_host&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;u&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;127.0.0.12&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_file&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;inventory_dir&amp;#39;&lt;/span&gt;&lt;span class="err"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;None&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可以看出已经没什么大的问题了, 但有一个点, &lt;b&gt;all&lt;/b&gt;组下的groups列表只有&lt;code&gt;ungrouped&lt;/code&gt;, 正常情况下&lt;code&gt;MY-HOST&lt;/code&gt;组也应该继承&lt;code&gt;all&lt;/code&gt;组, &lt;del&gt;可能是还需要一些其他的操作吧&lt;/del&gt;，继续翻源码，找到了&lt;code&gt;InventoryData&lt;/code&gt;的=reconcile_inventory=方法, 修改一下即可&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;InventoryCustomModule&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mine_parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;inventory&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reconcile_inventory&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="org-062833af29"&gt;ansible自定义模块传递list变量会变成字符串&lt;/h2&gt;
&lt;p&gt;我自定义了一个模块，需要传入一个&lt;b&gt;list&lt;/b&gt;变量&lt;code&gt;group_names&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;ansible.module_utils.basic&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;AnsibleModule&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;AnsibleModule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;argument_spec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_names&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;required&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;
        &lt;span class="p"&gt;}))&lt;/span&gt;

    &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;group_names&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;msg&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;group_names&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;))}&lt;/span&gt;
    &lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;fail_json&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;changed&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;__main__&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;但发现传入的变量最后变成的&lt;code&gt;str type&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;FAILED&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt; &lt;span class="o"&gt;=&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;gt&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;changed&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;&amp;quot;failed&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;&amp;quot;msg&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="ss"&gt;&amp;quot;group_names&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;&amp;quot;[&amp;#39;test&amp;#39;]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ss"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="ss"&gt;&amp;quot;&amp;amp;lt;type &amp;#39;str&amp;#39;&amp;amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="err"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;最后查找资料后才知道, 传递的变量需要增加&lt;code&gt;type&lt;/code&gt;参数, 否则都是&lt;b&gt;str&lt;/b&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;AnsibleModule&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;argument_spec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;group_names&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;required&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="s2"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;list&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;}))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


</content><category term="linux"></category><category term="python"></category><category term="ansible"></category><category term="devops"></category></entry><entry><title>如何保持一个干净的系统</title><link href="https://honmaple.me/articles/2018/07/%E5%A6%82%E4%BD%95%E4%BF%9D%E6%8C%81%E4%B8%80%E4%B8%AA%E5%B9%B2%E5%87%80%E7%9A%84%E7%B3%BB%E7%BB%9F.html" rel="alternate"></link><published>2018-07-11T10:42:19+08:00</published><updated>2019-05-26T18:21:03+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2018-07-11:/articles/2018/07/如何保持一个干净的系统.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-4235227b51"&gt;python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-771e417b9d"&gt;golang&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-b8bd907ab8"&gt;lua&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-b6e13ad53d"&gt;javascript&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;由于工作需要经常会使用多种语言, 比如 python, golang, lua, javascript等, 各种语言都有自己的包管理器，像python的包管理器&lt;b&gt;pip&lt;/b&gt;, lua的包管理器&lt;b&gt;luarocks&lt;/b&gt;。。。&lt;/p&gt;

&lt;p&gt;每个包管理器安装package的方式，位置都不相同，对于一个有洁癖的人来说,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt; &lt;span class="o"&gt;~/&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;al&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;后各种各样的&lt;code&gt;.something&lt;/code&gt;简直是场灾难, 所以保持一个干净的系统是非常必要的, 比如把相关语言的package都放到一个目录(我选择放到&lt;code&gt;$HOME/repo/{language}&lt;/code&gt;)下&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;请不要使用root用户，或者sudo来安装非必要的软件包&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id="org-4235227b51"&gt;python&lt;/h3&gt;
&lt;p&gt;我的&lt;b&gt;python&lt;/b&gt;环境是&lt;code&gt;pip+virtualenv+virtualenvwrapper&lt;/code&gt;, &lt;b&gt;pip&lt;/b&gt;可以有多种使用方式:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;b&gt;sudo&lt;/b&gt;
&lt;p&gt;&lt;b&gt;sudo&lt;/b&gt;安装的package放到&lt;code&gt;/usr/lib64 …&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-4235227b51"&gt;python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-771e417b9d"&gt;golang&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-b8bd907ab8"&gt;lua&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-b6e13ad53d"&gt;javascript&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;由于工作需要经常会使用多种语言, 比如 python, golang, lua, javascript等, 各种语言都有自己的包管理器，像python的包管理器&lt;b&gt;pip&lt;/b&gt;, lua的包管理器&lt;b&gt;luarocks&lt;/b&gt;。。。&lt;/p&gt;

&lt;p&gt;每个包管理器安装package的方式，位置都不相同，对于一个有洁癖的人来说,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;ls&lt;/span&gt; &lt;span class="o"&gt;~/&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;al&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;后各种各样的&lt;code&gt;.something&lt;/code&gt;简直是场灾难, 所以保持一个干净的系统是非常必要的, 比如把相关语言的package都放到一个目录(我选择放到&lt;code&gt;$HOME/repo/{language}&lt;/code&gt;)下&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;请不要使用root用户，或者sudo来安装非必要的软件包&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id="org-4235227b51"&gt;python&lt;/h3&gt;
&lt;p&gt;我的&lt;b&gt;python&lt;/b&gt;环境是&lt;code&gt;pip+virtualenv+virtualenvwrapper&lt;/code&gt;, &lt;b&gt;pip&lt;/b&gt;可以有多种使用方式:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;b&gt;sudo&lt;/b&gt;
&lt;p&gt;&lt;b&gt;sudo&lt;/b&gt;安装的package放到&lt;code&gt;/usr/lib64/python-{verison}&lt;/code&gt;目录下, 这可能会与系统的包管理器所安装的python package冲突, 比如&lt;b&gt;docker&lt;/b&gt;可以使用&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;pacman&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;S&lt;/span&gt; &lt;span class="n"&gt;docker&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;也可以使用&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;sudo&lt;/span&gt; &lt;span class="n"&gt;pip&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="n"&gt;docker&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;但更新系统包时可能有冲突导致无法更新&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;b&gt;--user&lt;/b&gt;(-U)
&lt;p&gt;使用本地安装，不需要&lt;b&gt;sudo&lt;/b&gt;权限, 安装的package会放到&lt;code&gt;$HOME/.local&lt;/code&gt;目录下&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;b&gt;virtualenv&lt;/b&gt;
&lt;p&gt;python的各种依赖包环境分离靠的就是&lt;b&gt;virtualenv&lt;/b&gt;, 它会把安装的&lt;b&gt;package&lt;/b&gt;放到&lt;code&gt;$WORKON_HOME&lt;/code&gt;这个环境变量下, 我平时也主要使用这个，但一些常用的package, 像http,docker-compose,pelican等, 我不想在使用时还得&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;workon&lt;/span&gt; &lt;span class="err"&gt;{&lt;/span&gt;&lt;span class="n"&gt;virtualenv&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然后才能使用, 太麻烦&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最有效的方法是搭配&lt;code&gt;--user&lt;/code&gt;和=virtualenv=&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;设置&lt;code&gt;--user&lt;/code&gt;的安装目录
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PYTHONUSERBASE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/python
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;virtualenv&lt;/code&gt;的安装目录
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;WORKON_HOME&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/python/virtualenv
&lt;span class="nb"&gt;source&lt;/span&gt; &lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/python/bin/virtualenvwrapper.sh
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;PATH&lt;/code&gt;变量
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/python/bin
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;然后无论是&lt;code&gt;pip install package --user&lt;/code&gt;还是&lt;b&gt;mkvirtualenv&lt;/b&gt;后&lt;code&gt;pip install package&lt;/code&gt;, 所安装的package都会放到&lt;code&gt;$HOME/repo/python&lt;/code&gt;目录下&lt;/p&gt;

&lt;h3 id="org-771e417b9d"&gt;golang&lt;/h3&gt;
&lt;p&gt;与python同理&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;设置&lt;code&gt;GOPATH&lt;/code&gt;变量
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;GOPATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/golang
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;PATH&lt;/code&gt;变量
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/python/bin:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/golang/bin
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="org-b8bd907ab8"&gt;lua&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;设置&lt;b&gt;luarocks&lt;/b&gt;安装默认参数
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;alias&lt;/span&gt; &lt;span class="nv"&gt;luarocks&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;luarocks --tree=$HOME/repo/lua&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;LUA_PATH&lt;/code&gt;与=LUA_CPATH=变量
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LUA_PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;&lt;span class="s2"&gt;/repo/lua/share/lua/5.3/?.lua;&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;&lt;span class="s2"&gt;/repo/lua/share/lua/5.3/?/init.lua;&lt;/span&gt;&lt;span class="nv"&gt;$LUA_PATH&lt;/span&gt;&lt;span class="s2"&gt;;&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;LUA_CPATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;&lt;span class="s2"&gt;/repo/lua/lib/lua/5.3/?.so;&lt;/span&gt;&lt;span class="nv"&gt;$LUA_CPATH&lt;/span&gt;&lt;span class="s2"&gt;;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;PATH&lt;/code&gt;变量
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/python/bin:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/golang/bin:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/lua/bin
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="org-b6e13ad53d"&gt;javascript&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;修改&lt;code&gt;npmrc&lt;/code&gt;配置
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;npm config &lt;span class="nb"&gt;set&lt;/span&gt; prefix &lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/npm
npm config &lt;span class="nb"&gt;set&lt;/span&gt; cache &lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/npm
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;NODE_PATH&lt;/code&gt;变量
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;NODE_PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;&lt;span class="s2"&gt;/repo/npm/lib/node_modules:&lt;/span&gt;&lt;span class="nv"&gt;$NODE_PATH&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;设置&lt;code&gt;PATH&lt;/code&gt;变量
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;PATH&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$PATH&lt;/span&gt;:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/python/bin:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/golang/bin:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/lua/bin:&lt;span class="nv"&gt;$HOME&lt;/span&gt;/repo/npm/bin
&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;测试
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;npm install -g js-beautify &lt;span class="c1"&gt;# 将会安装到$HOME/repo/npm目录&lt;/span&gt;
npm install js-beautify &lt;span class="c1"&gt;# 将会安装到当前目录下&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;最后, 把相关代码放到&lt;code&gt;$HOME/.bashrc&lt;/code&gt;中, 就可以享受一个相对干净的系统了&lt;/p&gt;</content><category term="linux"></category><category term="archlinux"></category></entry><entry><title>自定义helm式的ivy</title><link href="https://honmaple.me/articles/2018/06/%E8%87%AA%E5%AE%9A%E4%B9%89helm%E5%BC%8F%E7%9A%84ivy.html" rel="alternate"></link><published>2018-06-14T15:46:18+08:00</published><updated>2019-06-08T15:40:42+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2018-06-14:/articles/2018/06/自定义helm式的ivy.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-21d68aa29e"&gt;吐嘈一: counsel-find-file&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-5aa95e9d78"&gt;吐嘈二: tab 键&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-0e23b5a4d3"&gt;吐嘈三: 记忆多个按键&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-dd15de4ee4"&gt;吐嘈四: 模糊搜索&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-518e6efed6"&gt;吐嘈五: 候选词按使用频率排序&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-dfc06263d9"&gt;吐嘈六: minibuffer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-76afacce1d"&gt;吐嘈七: dired 中复制或重命名文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-f859000df2"&gt;吐嘈八: sudo edit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-d0462e6edd"&gt;吐嘈九: counsel-ag 默认不会使用已选的单词&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-2029839d84"&gt;总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;blockquote&gt;
&lt;p&gt;在 &lt;b&gt;n&lt;/b&gt; 个月前, 我曾写过 &lt;a href="https://honmaple.me/articles/2018/01/helm与ivy简单对比.html"&gt;helm与ivy简单对比&lt;/a&gt;, 并吐嘈了&lt;code&gt;ivy&lt;/code&gt;细节打磨不够，以至于我切换到&lt;code&gt;ivy&lt;/code&gt;不到几天后,
又回到了&lt;code&gt;helm&lt;/code&gt;的拥抱, 但在&lt;b&gt;n&lt;/b&gt;个月后，本着&lt;b&gt;生命不止，折腾不息&lt;/b&gt;的精神, “狠狠地”的折腾了一把 …&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-21d68aa29e"&gt;吐嘈一: counsel-find-file&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-5aa95e9d78"&gt;吐嘈二: tab 键&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-0e23b5a4d3"&gt;吐嘈三: 记忆多个按键&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-dd15de4ee4"&gt;吐嘈四: 模糊搜索&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-518e6efed6"&gt;吐嘈五: 候选词按使用频率排序&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-dfc06263d9"&gt;吐嘈六: minibuffer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-76afacce1d"&gt;吐嘈七: dired 中复制或重命名文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-f859000df2"&gt;吐嘈八: sudo edit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-d0462e6edd"&gt;吐嘈九: counsel-ag 默认不会使用已选的单词&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-2029839d84"&gt;总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;blockquote&gt;
&lt;p&gt;在 &lt;b&gt;n&lt;/b&gt; 个月前, 我曾写过 &lt;a href="https://honmaple.me/articles/2018/01/helm与ivy简单对比.html"&gt;helm与ivy简单对比&lt;/a&gt;, 并吐嘈了&lt;code&gt;ivy&lt;/code&gt;细节打磨不够，以至于我切换到&lt;code&gt;ivy&lt;/code&gt;不到几天后,
又回到了&lt;code&gt;helm&lt;/code&gt;的拥抱, 但在&lt;b&gt;n&lt;/b&gt;个月后，本着&lt;b&gt;生命不止，折腾不息&lt;/b&gt;的精神, “狠狠地”的折腾了一把&lt;code&gt;ivy&lt;/code&gt;, 让&lt;code&gt;ivy&lt;/code&gt;也能像&lt;code&gt;helm&lt;/code&gt;一样“如丝般润滑”，适应我平时的操作&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id="org-21d68aa29e"&gt;吐嘈一: counsel-find-file&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;我在&lt;b&gt;dired&lt;/b&gt;中移动文件, 即使已经设置了&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;:map&lt;/span&gt; &lt;span class="nv"&gt;counsel-find-file-map&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C-h&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nv"&gt;counsel-up-directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;但&lt;code&gt;C-h&lt;/code&gt;返回上级目录还是无效&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;无意中从&lt;b&gt;spacemacs&lt;/b&gt;中找到了解决办法(我电脑上常备 spacemacs 的配置，当看到 spacemacs 有什么更新都会切换过去尝试一番, 遇到适合自己的配置会"参考"一下, 哈), spacemacs 并没有遇到上述问题，在经过查找后，发现有这个一行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;define-key&lt;/span&gt; &lt;span class="nv"&gt;ivy-minibuffer-map&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;kbd&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;C-h&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;kbd&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;DEL&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;转换成我自己的配置就是&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;:map&lt;/span&gt; &lt;span class="nv"&gt;ivy-minibuffer-map&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;C-h&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;backspace&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-5aa95e9d78"&gt;吐嘈二: tab 键&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;b&gt;tab&lt;/b&gt; 键我只想要&lt;b&gt;complete&lt;/b&gt;， 而不是&lt;b&gt;complete and done&lt;/b&gt;, 虽然&lt;code&gt;ivy&lt;/code&gt;提供了另外的选项&lt;code&gt;ivy-partial-or-done&lt;/code&gt;,但不是我想要的效果,尤其是把&lt;b&gt;aaa.py&lt;/b&gt;重命名为&lt;b&gt;aaa.py.bak&lt;/b&gt;时&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;关于这一条，真的是“狠狠”地折腾了一把, 最终以&lt;b&gt;胜利&lt;/b&gt;告终&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-done&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;interactive&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="nv"&gt;ivy--directory&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-partial-or-done&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;string=&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="nv"&gt;ivy--directory&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-insert-current&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;and&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;eq&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-state-collection&lt;/span&gt; &lt;span class="nv"&gt;ivy-last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="nf"&gt;#&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;read-file-name-internal&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                 &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-expand-file-if-directory&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy-state-current&lt;/span&gt; &lt;span class="nv"&gt;ivy-last&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy--cd&lt;/span&gt; &lt;span class="nv"&gt;dir&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;this-command&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;ivy-cd&lt;/span&gt;&lt;span class="p"&gt;)))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;主要思路就是插入当前选中项, 如果是&lt;code&gt;read-file-name-internal&lt;/code&gt;(文件操作), 并且选中项是一个目录，则列出这个目录的文件，避免选中&lt;b&gt;tab&lt;/b&gt;两次才能列出文件, 这样一来，第一次&lt;b&gt;tab&lt;/b&gt;就是&lt;b&gt;complete&lt;/b&gt;, 第二次&lt;b&gt;tab&lt;/b&gt;才是&lt;b&gt;done&lt;/b&gt;, 最终效果超出预期(V 字手)&lt;/p&gt;

&lt;h2 id="org-0e23b5a4d3"&gt;吐嘈三: 记忆多个按键&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;ivy 有这样一个问题,它不会像 helm 一样在第一行显示用户输入的字符，在 ivy 的很多 issue 中都有人提了这个问题，如果当前目录下有名为&lt;b&gt;aaa&lt;/b&gt;的目录,这是我想要创建一个&lt;b&gt;aaa.py&lt;/b&gt;的文件，ivy 会列出 aaa 这个目录，那是我该怎么创建 aaa.py 文件。方法是一个新的命令&lt;code&gt;ivy-immediate-done&lt;/code&gt;,而不是&lt;code&gt;ivy-alt-done&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;现在的&lt;b&gt;ivy&lt;/b&gt;已经支持可选择用户输入&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;ivy-use-selectable-prompt&lt;/span&gt; &lt;span class="no"&gt;t&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-dd15de4ee4"&gt;吐嘈四: 模糊搜索&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;在 helm 中我可以很容易的使用模糊搜索，ivy 中也一样，只要简单的设置&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;ivy-re-builders-alist&lt;/span&gt;
      &lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="no"&gt;t&lt;/span&gt; &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nv"&gt;ivy--regex-fuzzy&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;但 ivy 中有这样一个问题，空格键不能在模糊匹配中使用，/汗，作为从 helm 转入 ivy 的人，经常会不经意间在输入时按下空格键，然后，What? ivy 中搜索变成空了&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;其实我想要混合使用空格与非空格, 但最终还是没能找到解决办法, 因为我已经适应的使用空格分隔, 所以暂时使用&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;ivy-re-builders-alist&lt;/span&gt;
&lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="no"&gt;t&lt;/span&gt;   &lt;span class="o"&gt;.&lt;/span&gt; &lt;span class="nv"&gt;ivy--regex-ignore-order&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-518e6efed6"&gt;吐嘈五: 候选词按使用频率排序&lt;/h2&gt;
&lt;p&gt;这个。。。&lt;/p&gt;

&lt;h2 id="org-dfc06263d9"&gt;吐嘈六: minibuffer&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;helm 从当前 buffer 中弹出 helm-buffer 是多么明智的选择，视野不会移动到当前 buffer 以外的地方，尤其是在屏幕较大的时候, 而 ivy 使用 minibuffer 总是从屏幕左下方弹出&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;经过多次试验， 最终也找到的解决办法&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;;; custom ivy display function&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;defvar&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-format-padding&lt;/span&gt; &lt;span class="no"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-read-around&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;-ivy-read&lt;/span&gt; &lt;span class="kp"&gt;&amp;amp;rest&lt;/span&gt; &lt;span class="nv"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;Advice ivy-read `-IVY-READ` `ARGS`.&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let&lt;/span&gt; &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nv"&gt;maple/ivy-format-padding&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;make-string&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;window-left-column&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="sc"&gt;?\s&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;setcar&lt;/span&gt; &lt;span class="nv"&gt;args&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;concat&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-format-padding&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;car&lt;/span&gt; &lt;span class="nv"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;apply&lt;/span&gt; &lt;span class="nv"&gt;-ivy-read&lt;/span&gt; &lt;span class="nv"&gt;args&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-format-function&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;cands&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;Transform CANDS into a string for minibuffer.&amp;quot;&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy--format-function-generic&lt;/span&gt;
   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;lambda&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;concat&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-format-padding&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;ivy--add-face&lt;/span&gt; &lt;span class="nv"&gt;str&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;ivy-current-match&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
   &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;lambda&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;concat&lt;/span&gt; &lt;span class="nv"&gt;maple/ivy-format-padding&lt;/span&gt; &lt;span class="nv"&gt;str&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
   &lt;span class="nv"&gt;cands&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;advice-add&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;ivy-read&lt;/span&gt; &lt;span class="nb"&gt;:around&lt;/span&gt; &lt;span class="nf"&gt;#&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;maple/ivy-read-around&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;ivy-count-format&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
      &lt;span class="nv"&gt;ivy-format-function&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;maple/ivy-format-function&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;主要思路就是在各个&lt;b&gt;collections&lt;/b&gt;前添加空格, 空格宽度为 &lt;code&gt;(window-left-column)&lt;/code&gt;, &lt;code&gt;window-left-column&lt;/code&gt; 按照 help 文档来说就是&lt;b&gt;Return left column of window WINDOW&lt;/b&gt;, 与屏幕左边缘的距离; 然后自定义 &lt;code&gt;ivy-format-function&lt;/code&gt;,即可, 需要注意的一点, 不仅&lt;b&gt;collections&lt;/b&gt;前需要添加空格, &lt;b&gt;prompt&lt;/b&gt;前也需要添加空格&lt;/p&gt;

&lt;p&gt;最终效果
&lt;a href="https://static.honmaple.com/images/2018/06/ivy-minibuffer.png?type=show" data-fancybox="image"&gt;&lt;img data-src="https://static.honmaple.com/images/2018/06/ivy-minibuffer.png?type=thumb" class="lazyload" /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id="org-76afacce1d"&gt;吐嘈七: dired 中复制或重命名文件&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;我之前想要复制或重命名一个文件，只要进入&lt;b&gt;dired&lt;/b&gt;中按&lt;code&gt;C&lt;/code&gt;或=R=，然后选择目标就行，但不知道为什么，使用 ivy 时复制重命名总是报错，不成功&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;经过测试, 现在的&lt;b&gt;ivy&lt;/b&gt;表现正常&lt;/p&gt;

&lt;h2 id="org-f859000df2"&gt;吐嘈八: sudo edit&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;使用&lt;b&gt;ivy&lt;/b&gt;时, &lt;code&gt;sudo edit&lt;/code&gt; 不成功&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;目前已正常&lt;/p&gt;

&lt;h2 id="org-d0462e6edd"&gt;吐嘈九: counsel-ag 默认不会使用已选的单词&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;b&gt;counsel-ag&lt;/b&gt;, 默认不会使用已选的单词, 想要查找已选单词, 需要在激活&lt;code&gt;counsel-ag&lt;/code&gt;后使用&lt;code&gt;M-n&lt;/code&gt;, 很麻烦，不像&lt;b&gt;helm&lt;/b&gt;默认就可以选择&lt;b&gt;region&lt;/b&gt;里的单词, 另外&lt;code&gt;counsel-ag&lt;/code&gt;默认会使用含&lt;b&gt;.git&lt;/b&gt;目录的目录作为根目录进行查找, 这与&lt;code&gt;counsel-projectile-ag&lt;/code&gt;功能上有些冲突了&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;解决办法很简单, &lt;code&gt;defadvice counsel-ag&lt;/code&gt; 即可&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;defun&lt;/span&gt; &lt;span class="nv"&gt;maple/counsel-ag&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;-counsel-ag&lt;/span&gt; &lt;span class="kp"&gt;&amp;amp;optional&lt;/span&gt; &lt;span class="nv"&gt;initial-input&lt;/span&gt; &lt;span class="nv"&gt;initial-directory&lt;/span&gt; &lt;span class="nv"&gt;extra-ag-args&lt;/span&gt; &lt;span class="nv"&gt;ag-prompt&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;and&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;not&lt;/span&gt; &lt;span class="nv"&gt;initial-input&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;region-active-p&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;initial-input&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;buffer-substring-no-properties&lt;/span&gt;
                         &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;region-beginning&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;region-end&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;unless&lt;/span&gt; &lt;span class="nv"&gt;initial-directory&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;setq&lt;/span&gt; &lt;span class="nv"&gt;initial-directory&lt;/span&gt; &lt;span class="nv"&gt;default-directory&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;funcall&lt;/span&gt; &lt;span class="nv"&gt;-counsel-ag&lt;/span&gt; &lt;span class="nv"&gt;initial-input&lt;/span&gt; &lt;span class="nv"&gt;initial-directory&lt;/span&gt; &lt;span class="nv"&gt;extra-ag-args&lt;/span&gt; &lt;span class="nv"&gt;ag-prompt&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;advice-add&lt;/span&gt; &lt;span class="ss"&gt;&amp;#39;counsel-ag&lt;/span&gt; &lt;span class="nb"&gt;:around&lt;/span&gt; &lt;span class="nf"&gt;#&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;maple/counsel-ag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="org-2029839d84"&gt;总结&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;说一说为什么想要折腾&lt;b&gt;ivy&lt;/b&gt;:
&lt;ol&gt;
&lt;li&gt;在使用&lt;b&gt;helm&lt;/b&gt;时, 首次打开会很慢(我在打开 emacs 后,习惯使用&lt;code&gt;helm-recentf&lt;/code&gt;打开最近文件, 但不知道为什么，第一次会非常慢)；另外, 打开 emacs 后， 必须先使用&lt;code&gt;helm-recentf&lt;/code&gt;才能激活&lt;b&gt;helm&lt;/b&gt;, 如果使用其它&lt;b&gt;helm&lt;/b&gt;命令, 比如&lt;code&gt;helm-M-x&lt;/code&gt;或者&lt;code&gt;helm-projectile&lt;/code&gt;只会使用默认的&lt;b&gt;ido&lt;/b&gt;， 并不能激活&lt;b&gt;helm&lt;/b&gt;
&lt;/li&gt;
&lt;li&gt;&lt;b&gt;helm&lt;/b&gt;真的为用户做出太多选择， 想要自定义非常难, 即使成功也不是从源头解决，而是用了取巧的办法
&lt;/li&gt;
&lt;li&gt;速度，不知道是不是我的感觉错误，最新版本的&lt;b&gt;helm&lt;/b&gt;速度慢了很多
&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;li&gt;还得吐嘈&lt;b&gt;ivy&lt;/b&gt;:
&lt;p&gt;&lt;b&gt;ivy&lt;/b&gt; 细节上果然打磨不够, 不过经过调(折)教(腾), 大致上和我之前使用&lt;b&gt;helm&lt;/b&gt;的习惯一样了&lt;/p&gt;

&lt;p&gt;最终吐嘈点: &lt;b&gt;ivy-occur&lt;/b&gt;, &lt;code&gt;ivy-occur&lt;/code&gt; 使用了&lt;b&gt;wgrep&lt;/b&gt;作为多文件编辑, 但说实话, 我觉得很难用, 和&lt;b&gt;helm-ag&lt;/b&gt;自己实现的&lt;b&gt;helm-ag-edit&lt;/b&gt;比起来更是难受, 一会就要切换一下&lt;code&gt;ivy-wgrep-change-to-wgrep-mode&lt;/code&gt;, 不切用不了, 这个等有时间再折腾吧!&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ok,就这样&lt;/p&gt;

</content><category term="linux"></category><category term="emacs"></category></entry><entry><title>git笔记</title><link href="https://honmaple.me/articles/2018/03/git%E7%AC%94%E8%AE%B0.html" rel="alternate"></link><published>2018-03-01T16:25:38+08:00</published><updated>2019-03-07T01:50:02+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2018-03-01:/articles/2018/03/git笔记.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-759da78116"&gt;git修改提交作者和邮箱&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-d0a021b265"&gt;合并多个commit历史&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-0496bba071"&gt;git删除远程分支已经被删除的本地分支&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-c441660138"&gt;合并pull request&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;h2 id="org-759da78116"&gt;git修改提交作者和邮箱&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;提交前
&lt;p&gt;如果代码未提交,则可以&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git config  user.name &lt;span class="s2"&gt;&amp;quot;Author Name&amp;quot;&lt;/span&gt;
git config  user.email &lt;span class="s2"&gt;&amp;quot;Author Email&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;提交后
&lt;p&gt;如果代码已经提交,或者已经push到remote(只能修改最近一次提交)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git commit --amend --author&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;NewAuthor &amp;amp;lt;NewEmail@address.com&amp;amp;gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改全部&lt;b&gt;commit&lt;/b&gt;,需要使用脚本 &lt;a href="https://help.github.com/articles/changing-author-info/"&gt;参考github官方&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

git filter-branch --env-filter &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;OLD_EMAIL=&amp;quot;your-old-email …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-759da78116"&gt;git修改提交作者和邮箱&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-d0a021b265"&gt;合并多个commit历史&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-0496bba071"&gt;git删除远程分支已经被删除的本地分支&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-c441660138"&gt;合并pull request&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;h2 id="org-759da78116"&gt;git修改提交作者和邮箱&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;提交前
&lt;p&gt;如果代码未提交,则可以&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git config  user.name &lt;span class="s2"&gt;&amp;quot;Author Name&amp;quot;&lt;/span&gt;
git config  user.email &lt;span class="s2"&gt;&amp;quot;Author Email&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;提交后
&lt;p&gt;如果代码已经提交,或者已经push到remote(只能修改最近一次提交)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git commit --amend --author&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;NewAuthor &amp;amp;lt;NewEmail@address.com&amp;amp;gt;&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;修改全部&lt;b&gt;commit&lt;/b&gt;,需要使用脚本 &lt;a href="https://help.github.com/articles/changing-author-info/"&gt;参考github官方&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;

git filter-branch --env-filter &lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="s1"&gt;OLD_EMAIL=&amp;quot;your-old-email@example.com&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;CORRECT_NAME=&amp;quot;Your Correct Name&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;CORRECT_EMAIL=&amp;quot;your-correct-email@example.com&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;if [ &amp;quot;$GIT_COMMITTER_EMAIL&amp;quot; = &amp;quot;$OLD_EMAIL&amp;quot; ]&lt;/span&gt;
&lt;span class="s1"&gt;then&lt;/span&gt;
&lt;span class="s1"&gt;    export GIT_COMMITTER_NAME=&amp;quot;$CORRECT_NAME&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;    export GIT_COMMITTER_EMAIL=&amp;quot;$CORRECT_EMAIL&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;fi&lt;/span&gt;
&lt;span class="s1"&gt;if [ &amp;quot;$GIT_AUTHOR_EMAIL&amp;quot; = &amp;quot;$OLD_EMAIL&amp;quot; ]&lt;/span&gt;
&lt;span class="s1"&gt;then&lt;/span&gt;
&lt;span class="s1"&gt;    export GIT_AUTHOR_NAME=&amp;quot;$CORRECT_NAME&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;    export GIT_AUTHOR_EMAIL=&amp;quot;$CORRECT_EMAIL&amp;quot;&lt;/span&gt;
&lt;span class="s1"&gt;fi&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt; --tag-name-filter cat -- --branches --tags
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;在&lt;b&gt;.git&lt;/b&gt;同级目录下运行&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt; &lt;span class="n"&gt;git&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sh&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;然后使用&lt;code&gt;--force&lt;/code&gt; push到远程&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="org-d0a021b265"&gt;合并多个commit历史&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git rebase -i commit_id
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;使用 &lt;b&gt;magit&lt;/b&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;magit&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;
&lt;span class="n"&gt;ll&lt;/span&gt;
&lt;span class="o"&gt;#&lt;/span&gt; &lt;span class="k"&gt;move&lt;/span&gt; &lt;span class="k"&gt;to&lt;/span&gt; &lt;span class="k"&gt;commit&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;
&lt;span class="n"&gt;r&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ii&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id="org-0496bba071"&gt;git删除远程分支已经被删除的本地分支&lt;/h2&gt;
&lt;p&gt;也不知道为什么， google了很久也没找到答案，明明题目已经清楚的问&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如何删除远程分支已经被删除的本地分支?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;可下面一群人在答&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如何删除本地分支已经被删除的远程分支?&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;b&gt;瞎答&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;最后还是只能靠自己&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# 先清理远程分支, 即删除本地分支已经被删除的远程分支&lt;/span&gt;
git fetch -p
&lt;span class="c1"&gt;# 找到存在的远程分支&lt;/span&gt;
git branch -r &lt;span class="p"&gt;|&lt;/span&gt; grep -v HEAD &lt;span class="p"&gt;|&lt;/span&gt; awk -F &lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{print $2}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;&amp;amp;&lt;/span&gt;gt&lt;span class="p"&gt;;&lt;/span&gt; /tmp/test.txt
&lt;span class="c1"&gt;# 清理本地分支&lt;/span&gt;
git branch -a &lt;span class="p"&gt;|&lt;/span&gt; grep -v &lt;span class="s1"&gt;&amp;#39;\*&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;  egrep -v -f /tmp/test.txt &lt;span class="p"&gt;|&lt;/span&gt; xargs git branch -d
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;注意: &lt;b&gt;不要使用&lt;/b&gt; &lt;code&gt;xargs git branch -D&lt;/code&gt;&lt;/p&gt;

&lt;h2 id="org-c441660138"&gt;合并pull request&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git fetch origin pull/3/head:pr
git checkou pr
&lt;/pre&gt;&lt;/div&gt;
</content><category term="linux"></category><category term="git"></category></entry></feed>