<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>HonMaple's Blog</title><link>http://honmaple.org/</link><description></description><lastBuildDate>Wed, 15 Jun 2016 00:00:00 +0800</lastBuildDate><item><title>flask时间格式化</title><link>http://honmaple.org/articles/2016/06/flask%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F%E5%8C%96.html</link><description>&lt;p&gt;后端通过filter注册&lt;/p&gt;
&lt;p&gt;[参考资料]&lt;/p&gt;
&lt;p&gt;在前端显示为该问题 "几分钟前发表或几天前发表"&lt;/p&gt;
&lt;p&gt;后端通过filter注册&lt;/p&gt;
&lt;p&gt;&lt;a href="http://flask.pocoo.org/snippets/33/"&gt;参考资料&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;设计需求&lt;a id="orgheadline1"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;如果问题发表超过 &lt;strong&gt;10天&lt;/strong&gt; ,则显示为 &lt;em&gt;%Y-%m-%d %H:%M&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果小于 &lt;strong&gt;10天&lt;/strong&gt; ，但是大于 &lt;strong&gt;1天&lt;/strong&gt; ，则显示为 &lt;em&gt;n天前&lt;/em&gt; 发表&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果小于 &lt;strong&gt;1天&lt;/strong&gt; ，但是大于 &lt;strong&gt;1小时&lt;/strong&gt; ，则显示为 &lt;em&gt;n小时前&lt;/em&gt; 发表&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果小于 &lt;strong&gt;1小时&lt;/strong&gt; ，但是大于 &lt;strong&gt;90秒&lt;/strong&gt; ，则显示为 &lt;em&gt;n分钟前&lt;/em&gt; 发表&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如果小于 &lt;strong&gt;90秒&lt;/strong&gt; ，则显示为 &lt;em&gt;刚刚&lt;/em&gt; 发表&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;具体实现&lt;a id="orgheadline2"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;通过 &lt;code&gt;diff.days&lt;/code&gt; 和 &lt;code&gt;diff.seconds&lt;/code&gt; 实现&lt;/p&gt;
&lt;p&gt;比如，大于10天&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;if diff.days &amp;gt; 10:
    return dt.strftime(&amp;#39;%Y-%m-%d %H:%M&amp;#39;)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;大于90秒,小于1小时&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;if diff.seconds &amp;lt;= 3600 and diff.seconds &amp;gt; 90:
    periods = ((diff.seconds / 60, &amp;quot;minute&amp;quot;, &amp;quot;minutes&amp;quot;), )
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;具体代码&lt;a id="orgheadline3"&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;def timesince(dt, default=&amp;quot;just now&amp;quot;):
    now = datetime.now()
    diff = now - dt
    if diff.days &amp;gt; 10:
        return dt.strftime(&amp;#39;%Y-%m-%d %H:%M&amp;#39;)
    if diff.days &amp;lt;= 10 and diff.days &amp;gt; 0:
        periods = ((diff.days, &amp;quot;day&amp;quot;, &amp;quot;days&amp;quot;), )
    if diff.days &amp;lt;= 0 and diff.seconds &amp;gt; 3600:
        periods = ((diff.seconds / 3600, &amp;quot;hour&amp;quot;, &amp;quot;hours&amp;quot;), )
    if diff.seconds &amp;lt;= 3600 and diff.seconds &amp;gt; 90:
        periods = ((diff.seconds / 60, &amp;quot;minute&amp;quot;, &amp;quot;minutes&amp;quot;), )
    if diff.seconds &amp;lt;= 90:
        return default

    for period, singular, plural in periods:

        if period:
            return &amp;quot;%d %s ago&amp;quot; % (period, singular if period == 1 else
                                    plural)

    return default
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ok,之后就可以&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;app.jinja_env.filters[&amp;#39;timesince&amp;#39;] = timesince
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;来实现几分钟前发表的功能了&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">2016-06-15 23:46:00</dc:creator><pubDate>Wed, 15 Jun 2016 00:00:00 +0800</pubDate><guid isPermaLink="false">tag:honmaple.org,2016-06-15:articles/2016/06/flask时间格式化.html</guid><category>python</category><category>flask</category><category>datetime</category></item></channel></rss>