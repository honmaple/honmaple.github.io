<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>HonMaple's Blog</title><link>http://honmaple.org/</link><description></description><lastBuildDate>Sat, 05 Mar 2016 00:00:00 +0800</lastBuildDate><item><title>关于sqlalchemy的desc</title><link>http://honmaple.org/articles/2016/03/%E5%85%B3%E4%BA%8Esqlalchemy%E7%9A%84desc.html</link><description>&lt;h3&gt;简单使用&lt;/h3&gt;
&lt;p&gt;questions = Questions.query.o&lt;/p&gt;
&lt;p&gt;也就是降序排序&lt;/p&gt;
&lt;h3&gt;简单使用&lt;/h3&gt;
&lt;p&gt;questions = Questions.query.order_by(Questions.time.desc()).all()&lt;/p&gt;
&lt;h3&gt;设置默认排序&lt;/h3&gt;
&lt;p&gt;如果几乎所有的questions都是按照时间降序排序,总不能每一条语句都加上&lt;code&gt;order_by(Questions.time.desc())&lt;/code&gt;&lt;br /&gt;
所以设置默认排序是有效的&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="n"&gt;Questions&lt;/span&gt;(&lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;Model&lt;/span&gt;):
    &lt;span class="n"&gt;__tablename__&lt;/span&gt; = &lt;span class="s"&gt;&amp;#39;questions&amp;#39;&lt;/span&gt;
    &lt;span class="n"&gt;id&lt;/span&gt; = &lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;Column&lt;/span&gt;(&lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;Integer&lt;/span&gt;, &lt;span class="n"&gt;primary_key&lt;/span&gt;=&lt;span class="nb"&gt;True&lt;/span&gt;)
    &lt;span class="n"&gt;title&lt;/span&gt; = &lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;Column&lt;/span&gt;(&lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;String&lt;/span&gt;(&lt;span class="mi"&gt;50&lt;/span&gt;), &lt;span class="n"&gt;nullable&lt;/span&gt;=&lt;span class="nb"&gt;False&lt;/span&gt;)
    &lt;span class="n"&gt;content&lt;/span&gt; = &lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;Column&lt;/span&gt;(&lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;Text&lt;/span&gt;, &lt;span class="n"&gt;nullable&lt;/span&gt;=&lt;span class="nb"&gt;False&lt;/span&gt;)
    &lt;span class="nb"&gt;time&lt;/span&gt; = &lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;Column&lt;/span&gt;(&lt;span class="n"&gt;db&lt;/span&gt;.&lt;span class="n"&gt;DateTime&lt;/span&gt;, &lt;span class="n"&gt;nullable&lt;/span&gt;=&lt;span class="nb"&gt;False&lt;/span&gt;)

    &lt;span class="n"&gt;__mapper_args__&lt;/span&gt; = {
        &lt;span class="s"&gt;&amp;quot;order_by&amp;quot;&lt;/span&gt;: &lt;span class="nb"&gt;time&lt;/span&gt;.&lt;span class="n"&gt;desc&lt;/span&gt;()
    }
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;如代码所示,使用&lt;code&gt;__mapper_args__&lt;/code&gt;就可，&lt;code&gt;__mapper_args__&lt;/code&gt;可以做很多事,具体看&lt;a href="http://docs.sqlalchemy.org/en/latest/orm/mapping_api.html"&gt;这里&lt;/a&gt;&lt;br /&gt;
设置默认排序下面的做法是&lt;strong&gt;错误&lt;/strong&gt;的  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    __mapper_args__ = {
        &amp;quot;order_by&amp;quot;: &amp;#39;Questions.time.desc()&amp;#39;
    }
    # 或者
    __mapper_args__ = {
        &amp;quot;order_by&amp;quot;: &amp;#39;Questions.time desc&amp;#39;
    }
    # 或者
    __mapper_args__ = {
        &amp;quot;order_by&amp;quot;: &amp;#39;desc(Questions.time)&amp;#39;
    }
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;多对多默认排序&lt;/h3&gt;
&lt;p&gt;比如这样  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;question = Questions.query.filter_by(id=1).first()
for reply in question.replies:
    print(reply.content)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;又如何设置回复是按照回复时间排序的&lt;br /&gt;
总不能这样  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;for reply in sorted(question.replies):
# 这会报错的
TypeError: unorderable types: Replies() &amp;lt; Replies()
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;怎么设置  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;replies = db.relationship(&amp;#39;Questions&amp;#39;,
                          backref=db.backref(&amp;#39;replies&amp;#39;,
                                             lazy=&amp;#39;dynamic&amp;#39;,
                                             order_by=&amp;#39;Replies.time&amp;#39;)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ok，暂时这样&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">2016-03-05 17:02:36.545788</dc:creator><pubDate>Sat, 05 Mar 2016 00:00:00 +0800</pubDate><guid isPermaLink="false">tag:honmaple.org,2016-03-05:articles/2016/03/关于sqlalchemy的desc.html</guid><category>flask</category><category>sqlalchemy</category></item></channel></rss>