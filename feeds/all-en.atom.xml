<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>honmaple's blog</title><link href="http://honmaple.me/" rel="alternate"></link><link href="http://honmaple.me/feeds/all-en.atom.xml" rel="self"></link><id>http://honmaple.me/</id><updated>2017-11-19T21:39:43+08:00</updated><entry><title>使用tornado实时输出日志</title><link href="http://honmaple.me/articles/2017/11/%E4%BD%BF%E7%94%A8tornado%E5%AE%9E%E6%97%B6%E8%BE%93%E5%87%BA%E6%97%A5%E5%BF%97.html" rel="alternate"></link><published>2017-11-19T21:39:43+08:00</published><updated>2017-11-19T21:39:43+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-11-19:/articles/2017/11/使用tornado实时输出日志.html</id><summary type="html">

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;tornado&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;tornado.web&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Application&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;tornado.web&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;RequestHandler&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;tornado.websocket&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;WebSocketHandler&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;

&lt;span class="n"&gt;template&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;lt;head&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;title&amp;gt;Document&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;meta name=&amp;quot;viewport&amp;quot; content=&amp;quot;width=device-width, initial-scale=1&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;script src=&amp;quot;https://cdn.bootcss.com/jquery …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;tornado&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;tornado.web&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Application&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;tornado.web&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;RequestHandler&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;tornado.websocket&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;WebSocketHandler&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;os&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;

&lt;span class="n"&gt;template&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&amp;lt;!doctype html&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;lt;head&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;title&amp;gt;Document&amp;lt;/title&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;meta name=&amp;quot;viewport&amp;quot; content=&amp;quot;width=device-width, initial-scale=1&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;script src=&amp;quot;https://cdn.bootcss.com/jquery/2.1.4/jquery.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;script src=&amp;quot;https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;script type=&amp;quot;text/javascript&amp;quot; charset=&amp;quot;utf-8&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;     $(function() {&lt;/span&gt;
&lt;span class="s1"&gt;         if (typeof String.prototype.startsWith != &amp;#39;function&amp;#39;) {&lt;/span&gt;
&lt;span class="s1"&gt;             String.prototype.startsWith = function (prefix){&lt;/span&gt;
&lt;span class="s1"&gt;                 return this.slice(0, prefix.length) === prefix;&lt;/span&gt;
&lt;span class="s1"&gt;             };&lt;/span&gt;
&lt;span class="s1"&gt;         }&lt;/span&gt;
&lt;span class="s1"&gt;         var output = $(&amp;quot;#stdout-output&amp;quot;).html();&lt;/span&gt;
&lt;span class="s1"&gt;         function addToOutput(msg) {&lt;/span&gt;
&lt;span class="s1"&gt;             /* output = $(&amp;quot;#output&amp;quot;).html() + &amp;#39;&amp;lt;br/&amp;gt;&amp;#39; + msg;*/&lt;/span&gt;
&lt;span class="s1"&gt;             if (msg.startsWith(&amp;#39;stderr:&amp;#39;)) {&lt;/span&gt;
&lt;span class="s1"&gt;                 if (!$(&amp;#39;a[href=&amp;quot;#stderr&amp;quot;]&amp;#39;).hasClass(&amp;quot;alarm-report&amp;quot;) &amp;amp;&amp;amp; $(&amp;#39;ul[role=&amp;quot;tablist&amp;quot;] li.active a&amp;#39;).attr(&amp;#39;href&amp;#39;) != &amp;#39;#stderr&amp;#39;) {&lt;/span&gt;
&lt;span class="s1"&gt;                     $(&amp;#39;a[href=&amp;quot;#stderr&amp;quot;]&amp;#39;).addClass(&amp;quot;alarm-report&amp;quot;)&lt;/span&gt;
&lt;span class="s1"&gt;                 }&lt;/span&gt;
&lt;span class="s1"&gt;                 output = $(&amp;quot;#stderr-output&amp;quot;).html() + msg.replace(/^stderr:/,&amp;#39;&amp;#39;);&lt;/span&gt;
&lt;span class="s1"&gt;                 $(&amp;quot;#stderr-output&amp;quot;).html(output);&lt;/span&gt;
&lt;span class="s1"&gt;                 $(&amp;#39;#stderr-output&amp;#39;).scrollTop($(&amp;#39;#stderr-output&amp;#39;)[0].scrollHeight);&lt;/span&gt;
&lt;span class="s1"&gt;             }else {&lt;/span&gt;
&lt;span class="s1"&gt;                 if (!$(&amp;#39;a[href=&amp;quot;#stdout&amp;quot;]&amp;#39;).hasClass(&amp;quot;alarm-report&amp;quot;) &amp;amp;&amp;amp; $(&amp;#39;ul[role=&amp;quot;tablist&amp;quot;] li.active a&amp;#39;).attr(&amp;#39;href&amp;#39;) != &amp;#39;#stdout&amp;#39;) {&lt;/span&gt;
&lt;span class="s1"&gt;                     $(&amp;#39;a[href=&amp;quot;#stdout&amp;quot;]&amp;#39;).addClass(&amp;quot;alarm-report&amp;quot;)&lt;/span&gt;
&lt;span class="s1"&gt;                 }&lt;/span&gt;
&lt;span class="s1"&gt;                 output = $(&amp;quot;#stdout-output&amp;quot;).html() + msg.replace(/^stdout:/,&amp;#39;&amp;#39;);&lt;/span&gt;
&lt;span class="s1"&gt;                 $(&amp;quot;#stdout-output&amp;quot;).html(output);&lt;/span&gt;
&lt;span class="s1"&gt;                 $(&amp;#39;#stdout-output&amp;#39;).scrollTop($(&amp;#39;#stdout-output&amp;#39;)[0].scrollHeight);&lt;/span&gt;
&lt;span class="s1"&gt;             }&lt;/span&gt;
&lt;span class="s1"&gt;         }&lt;/span&gt;
&lt;span class="s1"&gt;         $(&amp;#39;a#clear&amp;#39;).click(function() {&lt;/span&gt;
&lt;span class="s1"&gt;             var active_tab = $(&amp;#39;ul[role=&amp;quot;tablist&amp;quot;] li.active a&amp;#39;).attr(&amp;#39;href&amp;#39;);&lt;/span&gt;
&lt;span class="s1"&gt;             $(active_tab + &amp;#39;-output&amp;#39;).html(&amp;#39;&amp;#39;);&lt;/span&gt;
&lt;span class="s1"&gt;         })&lt;/span&gt;
&lt;span class="s1"&gt;         $(&amp;#39;a#load&amp;#39;).click(function() {&lt;/span&gt;
&lt;span class="s1"&gt;             var active_tab = $(&amp;#39;ul[role=&amp;quot;tablist&amp;quot;] li.active a&amp;#39;).attr(&amp;#39;href&amp;#39;);&lt;/span&gt;
&lt;span class="s1"&gt;             ws.send(JSON.stringify({room:&amp;#39;load&amp;#39;,msg:active_tab.replace(/^#/,&amp;#39;&amp;#39;)}));&lt;/span&gt;
&lt;span class="s1"&gt;         })&lt;/span&gt;
&lt;span class="s1"&gt;        $(&amp;#39;a[data-toggle=&amp;quot;tab&amp;quot;]&amp;#39;).on(&amp;#39;shown.bs.tab&amp;#39;, function (e) {&lt;/span&gt;
&lt;span class="s1"&gt;            if ($(e.target).hasClass(&amp;quot;alarm-report&amp;quot;)) {&lt;/span&gt;
&lt;span class="s1"&gt;                $(e.target).removeClass(&amp;quot;alarm-report&amp;quot;)&lt;/span&gt;
&lt;span class="s1"&gt;            }&lt;/span&gt;
&lt;span class="s1"&gt;        })&lt;/span&gt;
&lt;span class="s1"&gt;         if (&amp;quot;MozWebSocket&amp;quot; in window) {&lt;/span&gt;
&lt;span class="s1"&gt;             WebSocket = MozWebSocket;&lt;/span&gt;
&lt;span class="s1"&gt;         }&lt;/span&gt;
&lt;span class="s1"&gt;         if (WebSocket) {&lt;/span&gt;
&lt;span class="s1"&gt;             var ws = new WebSocket(&amp;quot;ws://&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;/show&amp;quot;);&lt;/span&gt;
&lt;span class="s1"&gt;             ws.onopen = function() {};&lt;/span&gt;
&lt;span class="s1"&gt;             ws.onmessage = function (evt) {&lt;/span&gt;
&lt;span class="s1"&gt;                 addToOutput(evt.data);&lt;/span&gt;
&lt;span class="s1"&gt;             };&lt;/span&gt;
&lt;span class="s1"&gt;             ws.onclose = function() {};&lt;/span&gt;
&lt;span class="s1"&gt;         } else {&lt;/span&gt;
&lt;span class="s1"&gt;             alert(&amp;quot;WebSocket not supported&amp;quot;);&lt;/span&gt;
&lt;span class="s1"&gt;         }&lt;/span&gt;
&lt;span class="s1"&gt;     })&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;style type=&amp;quot;text/css&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;     .input-group {&lt;/span&gt;
&lt;span class="s1"&gt;         margin-bottom: 5px;&lt;/span&gt;
&lt;span class="s1"&gt;     }&lt;/span&gt;
&lt;span class="s1"&gt;     .input-group-addon {&lt;/span&gt;
&lt;span class="s1"&gt;         background-color:#337ab7;&lt;/span&gt;
&lt;span class="s1"&gt;         color:#fff;&lt;/span&gt;
&lt;span class="s1"&gt;         border-color:#337ab7;&lt;/span&gt;
&lt;span class="s1"&gt;     }&lt;/span&gt;
&lt;span class="s1"&gt;     li[aria-selected=&amp;quot;true&amp;quot;] {&lt;/span&gt;
&lt;span class="s1"&gt;         display:none;&lt;/span&gt;
&lt;span class="s1"&gt;     }&lt;/span&gt;
&lt;span class="s1"&gt;     li[role=&amp;quot;presentation&amp;quot;] a{&lt;/span&gt;
&lt;span class="s1"&gt;         border-bottom-left-radius:0;&lt;/span&gt;
&lt;span class="s1"&gt;         border-bottom-right-radius:0;&lt;/span&gt;
&lt;span class="s1"&gt;     }&lt;/span&gt;
&lt;span class="s1"&gt;     .well {&lt;/span&gt;
&lt;span class="s1"&gt;         color:#eee;&lt;/span&gt;
&lt;span class="s1"&gt;         border-top:0;&lt;/span&gt;
&lt;span class="s1"&gt;         border-top-left-radius:0;&lt;/span&gt;
&lt;span class="s1"&gt;         border-top-right-radius:0;&lt;/span&gt;
&lt;span class="s1"&gt;     }&lt;/span&gt;
&lt;span class="s1"&gt;     #stdout-output,#stderr-output {&lt;/span&gt;
&lt;span class="s1"&gt;         background-color:#333;&lt;/span&gt;
&lt;span class="s1"&gt;         height:600px;&lt;/span&gt;
&lt;span class="s1"&gt;         overflow-y:auto;&lt;/span&gt;
&lt;span class="s1"&gt;         padding:10px;&lt;/span&gt;
&lt;span class="s1"&gt;     }&lt;/span&gt;
&lt;span class="s1"&gt;     .alarm-report {&lt;/span&gt;
&lt;span class="s1"&gt;         border:2px solid #333;&lt;/span&gt;
&lt;span class="s1"&gt;         border-bottom:none;&lt;/span&gt;
&lt;span class="s1"&gt;         animation: flash 1s linear infinite;&lt;/span&gt;
&lt;span class="s1"&gt;     }&lt;/span&gt;

&lt;span class="s1"&gt;     @keyframes flash{&lt;/span&gt;
&lt;span class="s1"&gt;         from {&lt;/span&gt;
&lt;span class="s1"&gt;             border-color: #333;&lt;/span&gt;
&lt;span class="s1"&gt;         }&lt;/span&gt;
&lt;span class="s1"&gt;         to {&lt;/span&gt;
&lt;span class="s1"&gt;             border-color: red;&lt;/span&gt;
&lt;span class="s1"&gt;         }&lt;/span&gt;
&lt;span class="s1"&gt;     }&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;/style&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;lt;/head&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;lt;body&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;div class=&amp;quot;row&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;lt;div class=&amp;quot;col-md-offset-2 col-md-8&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;lt;!-- Nav tabs --&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;lt;ul class=&amp;quot;nav nav-pills nav-justified&amp;quot; role=&amp;quot;tablist&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;li role=&amp;quot;presentation&amp;quot; class=&amp;quot;active&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;            &amp;lt;a href=&amp;quot;#stdout&amp;quot; aria-controls=&amp;quot;stdout&amp;quot; role=&amp;quot;tab&amp;quot; data-toggle=&amp;quot;tab&amp;quot;&amp;gt;标准输出&amp;lt;/a&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;li role=&amp;quot;presentation&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;            &amp;lt;a href=&amp;quot;#stderr&amp;quot; aria-controls=&amp;quot;stderr&amp;quot; role=&amp;quot;tab&amp;quot; data-toggle=&amp;quot;tab&amp;quot;&amp;gt;错误输出&amp;lt;/a&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;li role=&amp;quot;presentation&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;            &amp;lt;a href=&amp;quot;javascript:void(0);&amp;quot; id=&amp;quot;load&amp;quot;&amp;gt;载入历史&amp;lt;/a&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;li role=&amp;quot;presentation&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;            &amp;lt;a href=&amp;quot;javascript:void(0);&amp;quot; id=&amp;quot;clear&amp;quot;&amp;gt;清空&amp;lt;/a&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;/li&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;lt;/ul&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;lt;!-- Tab panes --&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;lt;div class=&amp;quot;tab-content&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;div role=&amp;quot;tabpanel&amp;quot; class=&amp;quot;tab-pane active&amp;quot; id=&amp;quot;stdout&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;            &amp;lt;pre contentEditable=&amp;quot;false&amp;quot; class=&amp;quot;well&amp;quot; id=&amp;quot;stdout-output&amp;quot;&amp;gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;div role=&amp;quot;tabpanel&amp;quot; class=&amp;quot;tab-pane&amp;quot; id=&amp;quot;stderr&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;            &amp;lt;pre contentEditable=&amp;quot;false&amp;quot; class=&amp;quot;well&amp;quot; id=&amp;quot;stderr-output&amp;quot;&amp;gt;&amp;lt;/pre&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;          &amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;        &amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;      &amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;    &amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;  &amp;lt;/body&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;create_app&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;handlers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;AnsibleHandler&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/show&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;CommandHandler&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
    &lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Application&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;handlers&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;handlers&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;cookie_secret&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;asdadasdadasdasdasda&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;app&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;cd&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;newPath&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;newPath&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;expanduser&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;newPath&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__enter__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savedPath&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getcwd&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;chdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;newPath&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__exit__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;etype&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;traceback&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;chdir&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;savedPath&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;AnsibleHandler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;RequestHandler&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;template&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;CommandHandler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;WebSocketHandler&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;WebSocket opened&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;LISTENERS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;on_message&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;message&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;loads&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="c1"&gt;# self.write_message(u&amp;quot;You said: &amp;quot; + message[&amp;#39;msg&amp;#39;])&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;room&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;load&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;out_file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;STDOUT_FILENAME&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
                &lt;span class="s1"&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;stdout&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="n"&gt;STDERR_FILENAME&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getsize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;out_file&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;10240000&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write_message&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;file is too large!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;out_file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;r&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seek&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SEEK_END&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                    &lt;span class="n"&gt;fsize&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tell&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
                    &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seek&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;max&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fsize&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
                    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readlines&lt;/span&gt;&lt;span class="p"&gt;()[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;800&lt;/span&gt;&lt;span class="p"&gt;:]:&lt;/span&gt;
                        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write_message&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{}:{}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;msg&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
                                                          &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;on_close&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;WebSocket closed&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;LISTENERS&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;pass&lt;/span&gt;


&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;tail_file&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;where&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stdout_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tell&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stdout_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;stdout_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seek&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;element&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;LISTENERS&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write_message&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stdout:{}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;where&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stderr_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tell&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="n"&gt;line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;stderr_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;readline&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;stderr_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seek&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;where&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;element&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;LISTENERS&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;element&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write_message&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;stderr:{}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;


&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;STDOUT_FILENAME&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;logs/tail.log&amp;#39;&lt;/span&gt;
    &lt;span class="n"&gt;STDERR_FILENAME&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;logs/tail_err.log&amp;#39;&lt;/span&gt;
    &lt;span class="n"&gt;STDOUT_FILENAME&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abspath&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;STDOUT_FILENAME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;STDERR_FILENAME&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;abspath&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;STDERR_FILENAME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;LISTENERS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="n"&gt;stdout_file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;STDOUT_FILENAME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;stderr_file&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;STDERR_FILENAME&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;stdout_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seek&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getsize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;STDOUT_FILENAME&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
    &lt;span class="n"&gt;stderr_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;seek&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;os&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getsize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;STDERR_FILENAME&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="n"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;create_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="n"&gt;http_server&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tornado&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;httpserver&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;HTTPServer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;app&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;http_server&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;listen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;8000&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;0.0.0.0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;tailed_callback&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tornado&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ioloop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;PeriodicCallback&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;tail_file&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;tailed_callback&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="n"&gt;io_loop&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;tornado&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ioloop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;IOLoop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;io_loop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;start&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;SystemExit&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="ne"&gt;KeyboardInterrupt&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;io_loop&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stop&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;stdout_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;stderr_file&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content><category term="python"></category><category term="tornado"></category><category term="log"></category></entry><entry><title>python运行超时设置</title><link href="http://honmaple.me/articles/2017/11/python%E8%BF%90%E8%A1%8C%E8%B6%85%E6%97%B6%E8%AE%BE%E7%BD%AE.html" rel="alternate"></link><published>2017-11-08T16:43:26+08:00</published><updated>2017-11-08T16:43:26+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-11-08:/articles/2017/11/python运行超时设置.html</id><summary type="html">
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;signal&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TimeoutError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;error_message&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Timer expired&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_handle_timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;TimeoutError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SIGALRM&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;_handle_timeout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alarm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;finally&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alarm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;

    &lt;span class="k"&gt;return …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;signal&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TimeoutError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ne"&gt;Exception&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;error_message&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Timer expired&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_handle_timeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signum&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;frame&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="n"&gt;TimeoutError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;error_message&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;SIGALRM&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;_handle_timeout&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alarm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;seconds&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;finally&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;signal&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;alarm&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;

        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;_timeout&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content><category term="python"></category><category term="coding"></category></entry><entry><title>一个很好的想法</title><link href="http://honmaple.me/articles/2017/11/%E4%B8%80%E4%B8%AA%E5%BE%88%E5%A5%BD%E7%9A%84%E6%83%B3%E6%B3%95.html" rel="alternate"></link><published>2017-11-05T23:28:38+08:00</published><updated>2017-11-05T23:28:38+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-11-05:/articles/2017/11/一个很好的想法.html</id><summary type="html">
&lt;p&gt;我有这样一个想法&lt;/p&gt;

&lt;p&gt;有这么一个&lt;b&gt;app&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;它可以自定义表单，然后保存到本地或者远程数据库&lt;/li&gt;
&lt;li&gt;还可以填写一个远程url，验证的token，或者其他验证需要的header信息&lt;/li&gt;
&lt;li&gt;填好之后就可以提交相关的表单
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;好吧,其实是写说说，写博客使用的&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;它还有另外一个功能: &lt;b&gt;上传图片&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;同样是先填写远程url,验证信息&lt;/li&gt;
&lt;li&gt;填写其它相关信息&lt;/li&gt;
&lt;li&gt;选择本地图片进行上传&lt;/li&gt;
&lt;li&gt;上传成功后返回相应的url链接
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;好吧,越来越像朋友圈和QQ空间了&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;b&gt;但是，它可以自定义发布和上传的url呀!&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;最后，如果要更大，更远一些，可以对使用者的博客等内容进行相应的聚合,分类,成为一个优质的移动聚合平台.&lt;/p&gt;

&lt;p&gt;嗯，好想法，就等谁实现了&lt;/p&gt;</summary><content type="html">
&lt;p&gt;我有这样一个想法&lt;/p&gt;

&lt;p&gt;有这么一个&lt;b&gt;app&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;它可以自定义表单，然后保存到本地或者远程数据库&lt;/li&gt;
&lt;li&gt;还可以填写一个远程url，验证的token，或者其他验证需要的header信息&lt;/li&gt;
&lt;li&gt;填好之后就可以提交相关的表单
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;好吧,其实是写说说，写博客使用的&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;它还有另外一个功能: &lt;b&gt;上传图片&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;同样是先填写远程url,验证信息&lt;/li&gt;
&lt;li&gt;填写其它相关信息&lt;/li&gt;
&lt;li&gt;选择本地图片进行上传&lt;/li&gt;
&lt;li&gt;上传成功后返回相应的url链接
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;好吧,越来越像朋友圈和QQ空间了&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;b&gt;但是，它可以自定义发布和上传的url呀!&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;最后，如果要更大，更远一些，可以对使用者的博客等内容进行相应的聚合,分类,成为一个优质的移动聚合平台.&lt;/p&gt;

&lt;p&gt;嗯，好想法，就等谁实现了&lt;/p&gt;</content><category term="life"></category></entry><entry><title>我走过的地方，每一处都是风景</title><link href="http://honmaple.me/articles/2017/10/%E6%88%91%E8%B5%B0%E8%BF%87%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%8C%E6%AF%8F%E4%B8%80%E5%A4%84%E9%83%BD%E6%98%AF%E9%A3%8E%E6%99%AF.html" rel="alternate"></link><published>2017-10-22T23:57:07+08:00</published><updated>2017-10-22T23:57:07+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-10-22:/articles/2017/10/我走过的地方，每一处都是风景.html</id><summary type="html">

&lt;p&gt;杭州还是挺美的,不过有些拍不出那种感觉
&lt;div class="row"&gt;
  &lt;div class="col-md-6"&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171105_180212.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171105_180212.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153403.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153403.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153442.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153442.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153330.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153330.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
  &lt;/div&gt;
  &lt;div class="col-md-6"&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153435.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153435.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_152826.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_152826.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_154506.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_154506.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_135804.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_135804.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;</summary><content type="html">

&lt;p&gt;杭州还是挺美的,不过有些拍不出那种感觉
&lt;div class="row"&gt;
  &lt;div class="col-md-6"&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171105_180212.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171105_180212.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153403.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153403.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153442.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153442.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153330.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153330.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
  &lt;/div&gt;
  &lt;div class="col-md-6"&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153435.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_153435.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_152826.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_152826.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_154506.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_154506.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
    &lt;a href="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_135804.jpg-show" data-fancybox="image"&gt;&lt;img data-src="https://honmaple.b0.upaiyun.com/images/jpg/2017/10/IMG_20171021_135804.jpg-thumb" class="lazyload" /&gt;&lt;/a&gt;
  &lt;/div&gt;
&lt;/div&gt;&lt;/p&gt;</content><category term="life"></category><category term="travel"></category></entry><entry><title>为pelican增加上一篇下一篇功能</title><link href="http://honmaple.me/articles/2017/10/%E4%B8%BApelican%E5%A2%9E%E5%8A%A0%E4%B8%8A%E4%B8%80%E7%AF%87%E4%B8%8B%E4%B8%80%E7%AF%87%E5%8A%9F%E8%83%BD.html" rel="alternate"></link><published>2017-10-22T22:40:28+08:00</published><updated>2017-10-22T22:40:28+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-10-22:/articles/2017/10/为pelican增加上一篇下一篇功能.html</id><summary type="html">

&lt;p&gt;功能实现很简单, &lt;b&gt;pelican&lt;/b&gt;也有类似的插件实现 &lt;a href="https://github.com/getpelican/pelican-plugins/tree/master/neighbors"&gt;https://github.com/getpelican/pelican-plugins/tree/master/neighbors&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;不过自己实现起来更爽不是吗? 而且类似&lt;b&gt;prev_article_in_category&lt;/b&gt;和&lt;b&gt;prev_article_in_subcategory&lt;/b&gt;的功能我并不需要&lt;/p&gt;

&lt;p&gt;首先参考&lt;b&gt;pelican&lt;/b&gt;的文档,基础实现
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;add_neighbors&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="o"&gt;....&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;register&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;signals&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;article_generator_finalized&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;add_neighbors&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;然后在&lt;b&gt;generator.articles&lt;/b&gt;列表上进行操作,为article增加&lt;b&gt;previous_article&lt;/b&gt;和&lt;b&gt;next_article&lt;/b&gt;对象&lt;/p&gt;

&lt;p&gt;先进行排序(按时间)
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;articles&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;articles&lt;/span&gt;
&lt;span class="n"&gt;articles&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/p&gt;</summary><content type="html">

&lt;p&gt;功能实现很简单, &lt;b&gt;pelican&lt;/b&gt;也有类似的插件实现 &lt;a href="https://github.com/getpelican/pelican-plugins/tree/master/neighbors"&gt;https://github.com/getpelican/pelican-plugins/tree/master/neighbors&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;不过自己实现起来更爽不是吗? 而且类似&lt;b&gt;prev_article_in_category&lt;/b&gt;和&lt;b&gt;prev_article_in_subcategory&lt;/b&gt;的功能我并不需要&lt;/p&gt;

&lt;p&gt;首先参考&lt;b&gt;pelican&lt;/b&gt;的文档,基础实现
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;add_neighbors&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="o"&gt;....&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;register&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="n"&gt;signals&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;article_generator_finalized&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;add_neighbors&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;然后在&lt;b&gt;generator.articles&lt;/b&gt;列表上进行操作,为article增加&lt;b&gt;previous_article&lt;/b&gt;和&lt;b&gt;next_article&lt;/b&gt;对象&lt;/p&gt;

&lt;p&gt;先进行排序(按时间)
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;articles&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;articles&lt;/span&gt;
&lt;span class="n"&gt;articles&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;reverse&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;然后可以使用&lt;b&gt;iter&lt;/b&gt;关键字,把列表变成生成器,使用next()( &lt;code&gt;python2用a.next(),python3用a.__next__()&lt;/code&gt;)获取下一个可迭代对象&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;pre_article&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;
&lt;span class="n"&gt;articles_iter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;iter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;articles&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:])&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;article&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;articles&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;next_article&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;next&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;articles_iter&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;setattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;article&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;previous_article&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;pre_article&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;setattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;article&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;next_article&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;next_article&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;pre_article&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;article&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;最后，在模板template中增加相关html代码，示例:
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;{% if article.previous_article %}
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;previous&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{{ SITEURL }}/{{ article.previous_article.url }}&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Previous article: {{ article.previous_article.title }}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;i&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fa fa-chevron-left&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;i&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    {{ article.previous_article.title }}
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
{% endif %}
{% if article.next_article %}
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;next&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt; &lt;span class="na"&gt;href&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;{{ SITEURL }}/{{ article.next_article.url }}&amp;quot;&lt;/span&gt; &lt;span class="na"&gt;title&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Next article: {{ article.previous_article.title }}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    {{ article.next_article.title }}
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;i&lt;/span&gt; &lt;span class="na"&gt;class&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;fa fa-chevron-right&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;i&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;a&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;li&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
{% endif %}
&lt;/pre&gt;&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;ok,就这样&lt;/p&gt;</content><category term="python"></category><category term="pelican"></category></entry><entry><title>时间format输出格式参考</title><link href="http://honmaple.me/articles/2017/10/%E6%97%B6%E9%97%B4format%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F%E5%8F%82%E8%80%83.html" rel="alternate"></link><published>2017-10-19T16:59:15+08:00</published><updated>2017-10-19T16:59:15+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-10-19:/articles/2017/10/时间format输出格式参考.html</id><summary type="html">
&lt;blockquote&gt;
&lt;p&gt;date --help&lt;/p&gt;
&lt;/blockquote&gt;

&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;%%&lt;/td&gt;&lt;td&gt;一个文字的 %&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%a&lt;/td&gt;&lt;td&gt;当前locale 的星期名缩写(例如： 日，代表星期日)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%A&lt;/td&gt;&lt;td&gt;当前locale 的星期名全称 (如：星期日)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%b&lt;/td&gt;&lt;td&gt;当前locale 的月名缩写 (如：一，代表一月)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%B&lt;/td&gt;&lt;td&gt;当前locale 的月名全称 (如：一月)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%c&lt;/td&gt;&lt;td&gt;当前locale 的日期和时间 (如：2005年3月3日 星期四 23:05:25)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%C&lt;/td&gt;&lt;td&gt;世纪；比如 %Y，通常为省略当前年份的后两位数字(例如：20)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%d&lt;/td&gt;&lt;td&gt;按月计的日期(例如：01)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%D&lt;/td&gt;&lt;td&gt;按月计的日期；等于%m …&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</summary><content type="html">
&lt;blockquote&gt;
&lt;p&gt;date --help&lt;/p&gt;
&lt;/blockquote&gt;

&lt;table&gt;
&lt;tr&gt;
&lt;td&gt;%%&lt;/td&gt;&lt;td&gt;一个文字的 %&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%a&lt;/td&gt;&lt;td&gt;当前locale 的星期名缩写(例如： 日，代表星期日)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%A&lt;/td&gt;&lt;td&gt;当前locale 的星期名全称 (如：星期日)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%b&lt;/td&gt;&lt;td&gt;当前locale 的月名缩写 (如：一，代表一月)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%B&lt;/td&gt;&lt;td&gt;当前locale 的月名全称 (如：一月)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%c&lt;/td&gt;&lt;td&gt;当前locale 的日期和时间 (如：2005年3月3日 星期四 23:05:25)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%C&lt;/td&gt;&lt;td&gt;世纪；比如 %Y，通常为省略当前年份的后两位数字(例如：20)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%d&lt;/td&gt;&lt;td&gt;按月计的日期(例如：01)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%D&lt;/td&gt;&lt;td&gt;按月计的日期；等于%m/%d/%y&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%e&lt;/td&gt;&lt;td&gt;按月计的日期，添加空格，等于%_d&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%F&lt;/td&gt;&lt;td&gt;完整日期格式，等价于 %Y-%m-%d&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%g&lt;/td&gt;&lt;td&gt;ISO-8601 格式年份的最后两位 (参见%G)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%G&lt;/td&gt;&lt;td&gt;ISO-8601 格式年份 (参见%V)，一般只和 %V 结合使用&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%h&lt;/td&gt;&lt;td&gt;等于%b&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%H&lt;/td&gt;&lt;td&gt;小时(00-23)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%I&lt;/td&gt;&lt;td&gt;小时(00-12)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%j&lt;/td&gt;&lt;td&gt;按年计的日期(001-366)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%k&lt;/td&gt;&lt;td&gt;hour, space padded ( 0..23); same as %_H&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%l&lt;/td&gt;&lt;td&gt;hour, space padded ( 1..12); same as %_I&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%m&lt;/td&gt;&lt;td&gt;month (01..12)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%M&lt;/td&gt;&lt;td&gt;minute (00..59)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%n&lt;/td&gt;&lt;td&gt;a newline&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%N&lt;/td&gt;&lt;td&gt;nanoseconds (000000000..999999999)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%p&lt;/td&gt;&lt;td&gt;locale's equivalent of either AM or PM; blank if not known&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%P&lt;/td&gt;&lt;td&gt;like %p, but lower case&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%q&lt;/td&gt;&lt;td&gt;quarter of year (1..4)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%r&lt;/td&gt;&lt;td&gt;locale's 12-hour clock time (e.g., 11:11:04 PM)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%R&lt;/td&gt;&lt;td&gt;24-hour hour and minute; same as %H:%M&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;seconds since 1970-01-01 00:00:00 UTC&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%S&lt;/td&gt;&lt;td&gt;秒(00-60)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%t&lt;/td&gt;&lt;td&gt;输出制表符 Tab&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%T&lt;/td&gt;&lt;td&gt;时间，等于%H:%M:%S&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%u&lt;/td&gt;&lt;td&gt;星期，1 代表星期一&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%U&lt;/td&gt;&lt;td&gt;一年中的第几周，以周日为每星期第一天(00-53)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%V&lt;/td&gt;&lt;td&gt;ISO-8601 格式规范下的一年中第几周，以周一为每星期第一天(01-53)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%w&lt;/td&gt;&lt;td&gt;一星期中的第几日(0-6)，0 代表周一&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%W&lt;/td&gt;&lt;td&gt;一年中的第几周，以周一为每星期第一天(00-53)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%x&lt;/td&gt;&lt;td&gt;当前locale 下的日期描述 (如：12/31/99)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%X&lt;/td&gt;&lt;td&gt;当前locale 下的时间描述 (如：23:13:48)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%y&lt;/td&gt;&lt;td&gt;年份最后两位数位 (00-99)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%Y&lt;/td&gt;&lt;td&gt;年份&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%z +hhmm&lt;/td&gt;&lt;td&gt;数字时区(例如，-0400)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%:z +hh:mm&lt;/td&gt;&lt;td&gt;数字时区(例如，-04:00)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%::z +hh:mm:ss&lt;/td&gt;&lt;td&gt;数字时区(例如，-04:00:00)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%:::z&lt;/td&gt;&lt;td&gt;数字时区带有必要的精度 (例如，-04，+05:30)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%Z&lt;/td&gt;&lt;td&gt;按字母表排序的时区缩写 (例如，EDT)&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;

&lt;p&gt;&lt;a href="http://www.cplusplus.com/reference/ctime/strftime/"&gt;http://www.cplusplus.com/reference/ctime/strftime/&lt;/a&gt;&lt;/p&gt;

&lt;table&gt;
&lt;tr&gt;
&lt;th&gt;specifier&lt;/th&gt;&lt;th&gt;Replaced by&lt;/th&gt;&lt;th&gt;Example&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%a&lt;/td&gt;&lt;td&gt;Abbreviated weekday name *&lt;/td&gt;&lt;td&gt;Thu&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%A&lt;/td&gt;&lt;td&gt;Full weekday name *&lt;/td&gt;&lt;td&gt;Thursday&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%b&lt;/td&gt;&lt;td&gt;Abbreviated month name *&lt;/td&gt;&lt;td&gt;Aug&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%B&lt;/td&gt;&lt;td&gt;Full month name *&lt;/td&gt;&lt;td&gt;August&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%c&lt;/td&gt;&lt;td&gt;Date and time representation *&lt;/td&gt;&lt;td&gt;Thu Aug 23 14:55:02 2001&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%C&lt;/td&gt;&lt;td&gt;Year divided by 100 and truncated to integer (00-99)&lt;/td&gt;&lt;td&gt;20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%d&lt;/td&gt;&lt;td&gt;Day of the month, zero-padded (01-31)&lt;/td&gt;&lt;td&gt;23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%D&lt;/td&gt;&lt;td&gt;Short MM/DD/YY date, equivalent to %m/%d/%y&lt;/td&gt;&lt;td&gt;08/23/01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%e&lt;/td&gt;&lt;td&gt;Day of the month, space-padded ( 1-31)&lt;/td&gt;&lt;td&gt;23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%F&lt;/td&gt;&lt;td&gt;Short YYYY-MM-DD date, equivalent to %Y-%m-%d&lt;/td&gt;&lt;td&gt;2001-08-23&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%g&lt;/td&gt;&lt;td&gt;Week-based year, last two digits (00-99)&lt;/td&gt;&lt;td&gt;01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%G&lt;/td&gt;&lt;td&gt;Week-based year&lt;/td&gt;&lt;td&gt;2001&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%h&lt;/td&gt;&lt;td&gt;Abbreviated month name * (same as %b)&lt;/td&gt;&lt;td&gt;Aug&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%H&lt;/td&gt;&lt;td&gt;Hour in 24h format (00-23)&lt;/td&gt;&lt;td&gt;14&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%I&lt;/td&gt;&lt;td&gt;Hour in 12h format (01-12)&lt;/td&gt;&lt;td&gt;02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%j&lt;/td&gt;&lt;td&gt;Day of the year (001-366)&lt;/td&gt;&lt;td&gt;235&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%m&lt;/td&gt;&lt;td&gt;Month as a decimal number (01-12)&lt;/td&gt;&lt;td&gt;08&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%M&lt;/td&gt;&lt;td&gt;Minute (00-59)&lt;/td&gt;&lt;td&gt;55&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%n&lt;/td&gt;&lt;td&gt;New-line character ('\n')&lt;/td&gt;&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%p&lt;/td&gt;&lt;td&gt;AM or PM designation&lt;/td&gt;&lt;td&gt;PM&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%r&lt;/td&gt;&lt;td&gt;12-hour clock time *&lt;/td&gt;&lt;td&gt;02:55:02 pm&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%R&lt;/td&gt;&lt;td&gt;24-hour HH:MM time, equivalent to %H:%M&lt;/td&gt;&lt;td&gt;14:55&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%S&lt;/td&gt;&lt;td&gt;Second (00-61)&lt;/td&gt;&lt;td&gt;02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%t&lt;/td&gt;&lt;td&gt;Horizontal-tab character ('\t')&lt;/td&gt;&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%T&lt;/td&gt;&lt;td&gt;ISO 8601 time format (HH:MM:SS), equivalent to %H:%M:%S&lt;/td&gt;&lt;td&gt;14:55:02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%u&lt;/td&gt;&lt;td&gt;ISO 8601 weekday as number with Monday as 1 (1-7)&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%U&lt;/td&gt;&lt;td&gt;Week number with the first Sunday as the first day of week one (00-53)&lt;/td&gt;&lt;td&gt;33&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%V&lt;/td&gt;&lt;td&gt;ISO 8601 week number (01-53)&lt;/td&gt;&lt;td&gt;34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%w&lt;/td&gt;&lt;td&gt;Weekday as a decimal number with Sunday as 0 (0-6)&lt;/td&gt;&lt;td&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%W&lt;/td&gt;&lt;td&gt;Week number with the first Monday as the first day of week one (00-53)&lt;/td&gt;&lt;td&gt;34&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%x&lt;/td&gt;&lt;td&gt;Date representation *&lt;/td&gt;&lt;td&gt;08/23/01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%X&lt;/td&gt;&lt;td&gt;Time representation *&lt;/td&gt;&lt;td&gt;14:55:02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%y&lt;/td&gt;&lt;td&gt;Year, last two digits (00-99)&lt;/td&gt;&lt;td&gt;01&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%Y&lt;/td&gt;&lt;td&gt;Year&lt;/td&gt;&lt;td&gt;2001&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%z&lt;/td&gt;&lt;td&gt;ISO 8601 offset from UTC in timezone (1 minute=1, 1 hour=100),If timezone cannot be determined, no characters&lt;/td&gt;&lt;td&gt;+100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%Z&lt;/td&gt;&lt;td&gt;Timezone name or abbreviation *,if timezone cannot be determined, no characters&lt;/td&gt;&lt;td&gt;CDT&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;%%&lt;/td&gt;&lt;td&gt;A % sign&lt;/td&gt;&lt;td&gt;%&lt;/td&gt;
&lt;/tr&gt;
&lt;/table&gt;</content><category term="date"></category></entry><entry><title>lua中匪夷所思的table长度</title><link href="http://honmaple.me/articles/2017/10/lua%E4%B8%AD%E5%8C%AA%E5%A4%B7%E6%89%80%E6%80%9D%E7%9A%84table%E9%95%BF%E5%BA%A6.html" rel="alternate"></link><published>2017-10-10T00:00:00+08:00</published><updated>2017-10-10T00:00:00+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-10-10:/articles/2017/10/lua中匪夷所思的table长度.html</id><summary type="html">
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 3&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 3&lt;/span&gt;

&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;6&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;6&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 3&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 3&lt;/span&gt;

&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;3&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;6&amp;quot;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;7&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;4&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;4&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;nil&lt;/span&gt;
&lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;#&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;     &lt;span class="c1"&gt;-- output: 6&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;Lua 5.3.4&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;输出就是这么匪夷所思,所以, &lt;b&gt;不要在Lua的table中使用nil值，如果一个元素要删除，直接remove&lt;/b&gt;&lt;/p&gt;</content><category term="lua"></category></entry><entry><title>ansible快速部署加速方案</title><link href="http://honmaple.me/articles/2017/10/ansible%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E5%8A%A0%E9%80%9F%E6%96%B9%E6%A1%88.html" rel="alternate"></link><published>2017-10-08T00:00:00+08:00</published><updated>2017-10-08T00:00:00+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-10-08:/articles/2017/10/ansible快速部署加速方案.html</id><summary type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-2847809"&gt;加速&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-40828725"&gt;问题&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-49851788"&gt;方案&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-2901432"&gt;目标&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-81793856"&gt;web界面&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-43254016"&gt;任务队列&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;ansible是基于Python的 &lt;b&gt;自动化部署&lt;/b&gt; 方案,但是目前只是通过命令行
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ansible -i hosts all -a &amp;#39;uptime&amp;#39;
# or
ansible-playbook -i hosts playbook.yml -e &amp;#39;args&amp;#39; -t deploy
&lt;/pre&gt;&lt;/div&gt;

实现自动化部署.&lt;/p&gt;

&lt;p&gt;长此以往，虽然可以实现所谓的自动化，但产品业务线多且杂的情况下，项目很难维护，更不用说以文件为存储的表现形式很差,针对目前使用ansible的经验以及使用中的困难,可以针对性的提出一些解决方案&lt;/p&gt;

&lt;h3 id="org-2847809"&gt;加速&lt;/h3&gt;

&lt;h4 id="org-40828725"&gt;问题&lt;/h4&gt;
&lt;p&gt;自动化部署其中最大的障碍就是 &lt;b&gt;网络&lt;/b&gt; 的原因&lt;/p&gt;

&lt;p&gt;其中需要通过网络上传一些模板文件,有的甚至还需要上传一些压缩包,虽然说几MB的东西很快就能上传成功，但如果把这上传文件所需要的2秒乘以上百，上千台主机呢,更不用说ansible的表现形式就是一个任务一个任务的往下执行,假如在上传模板这一步卡住 …&lt;/p&gt;</summary><content type="html">&lt;div id="table-of-contents"&gt;&lt;h2&gt;Table of Contents&lt;/h2&gt;&lt;div id="text-table-of-contents"&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-2847809"&gt;加速&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-40828725"&gt;问题&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-49851788"&gt;方案&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-2901432"&gt;目标&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#org-81793856"&gt;web界面&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#org-43254016"&gt;任务队列&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;ansible是基于Python的 &lt;b&gt;自动化部署&lt;/b&gt; 方案,但是目前只是通过命令行
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ansible -i hosts all -a &amp;#39;uptime&amp;#39;
# or
ansible-playbook -i hosts playbook.yml -e &amp;#39;args&amp;#39; -t deploy
&lt;/pre&gt;&lt;/div&gt;

实现自动化部署.&lt;/p&gt;

&lt;p&gt;长此以往，虽然可以实现所谓的自动化，但产品业务线多且杂的情况下，项目很难维护，更不用说以文件为存储的表现形式很差,针对目前使用ansible的经验以及使用中的困难,可以针对性的提出一些解决方案&lt;/p&gt;

&lt;h3 id="org-2847809"&gt;加速&lt;/h3&gt;

&lt;h4 id="org-40828725"&gt;问题&lt;/h4&gt;
&lt;p&gt;自动化部署其中最大的障碍就是 &lt;b&gt;网络&lt;/b&gt; 的原因&lt;/p&gt;

&lt;p&gt;其中需要通过网络上传一些模板文件,有的甚至还需要上传一些压缩包,虽然说几MB的东西很快就能上传成功，但如果把这上传文件所需要的2秒乘以上百，上千台主机呢,更不用说ansible的表现形式就是一个任务一个任务的往下执行,假如在上传模板这一步卡住(等待所有服务器上传成功),这时某台未模板化的服务器的某服务需要重启，是不是会出问题呢&lt;/p&gt;

&lt;h4 id="org-49851788"&gt;方案&lt;/h4&gt;
&lt;p&gt;针对这一问题,目前想到的解决方案如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;b&gt;适当增加fork数&lt;/b&gt;
&lt;p&gt;目前fork数默认为50，可以适当增加&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;b&gt;大文件使用内网(外网)下载&lt;/b&gt;
&lt;p&gt;从部署机上上传文件可能会出现这样那样的问题，尤其是上传到国外服务器时经常会出现ansible playbook的任务卡住问题(其实是正在以几KB/s的龟速运行)，所以其中大于xxMB的文件(压缩包)全部使用从远程服务器上下载方式,并且全部进行加密处理&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;b&gt;把超过几百台服务器的节点分组多进程运行&lt;/b&gt;
&lt;p&gt;服务器一旦多了，对应任务的等待时间也就多了，所以将500台的节点分为十组，每组50台,使用多进程分别同时运行，这样可以有效减少任务等待时间,需要注意每组运行失败的服务器。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;b&gt;把经常出问题或者网络不太好的节点放到最后运行&lt;/b&gt;
&lt;p&gt;像中国移动以及香港，国外的某些节点在运行ansible playbook的时候总会或多或少的出些问题,这些节点可以考虑放到最后,并且需要找出问题原因进行优化&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="org-2901432"&gt;目标&lt;/h3&gt;

&lt;h4 id="org-81793856"&gt;web界面&lt;/h4&gt;
&lt;p&gt;使用过ansible的同学一定知道ansible-tower，它是ansible的web方式部署，通过web界面就可以添加删除任务,并且运行ansible playbook,可惜，它是收费的 /捂脸&lt;/p&gt;

&lt;h4 id="org-43254016"&gt;任务队列&lt;/h4&gt;
&lt;p&gt;把ansible playbook放到任务队列里，由消费者去消费对应的任务&lt;/p&gt;

&lt;p&gt;未完待续...&lt;/p&gt;</content><category term="linux"></category><category term="ansible"></category></entry><entry><title>ansible-playbook中tasks单进程</title><link href="http://honmaple.me/articles/2017/09/ansible-playbook%E4%B8%ADtasks%E5%8D%95%E8%BF%9B%E7%A8%8B.html" rel="alternate"></link><published>2017-09-19T00:00:00+08:00</published><updated>2017-09-19T00:00:00+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-09-19:/articles/2017/09/ansible-playbook中tasks单进程.html</id><summary type="html">
&lt;p&gt;之前有一个需求,ansible-playbook中需要某一步单步执行,也就是说在有多台服务器时,某个任务只能一台服务器执行完后,另一台服务器才能执行,否者对应集群的服务会出问题&lt;/p&gt;

&lt;p&gt;这是一个很简单的需求,ansible中也有对应的实现, &lt;code&gt;--fork 1&lt;/code&gt; 或者 使用 &lt;code&gt;serial&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;但是如果有人忘记加 &lt;code&gt;--fork 1&lt;/code&gt; 了呢，而且该任务是在子任务中，使用 &lt;b&gt;include&lt;/b&gt; 加载, &lt;code&gt;serial&lt;/code&gt; 关键字无法在某一特定任务中使用,只能与 &lt;b&gt;hosts&lt;/b&gt; 同级&lt;/p&gt;

&lt;p&gt;所幸，在这里 &lt;a href="https://www.bountysource.com/issues/26342862-support-for-serial-on-an-individual-task"&gt;https://www.bountysource.com/issues/26342862-support-for-serial-on-an-individual-task&lt;/a&gt; 找到了解决办法,使用 &lt;b&gt;delegate_to&lt;/b&gt;&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;restart&lt;/span&gt;
  &lt;span class="c1"&gt;# serial: 1 would be the proper solution here, but …&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">
&lt;p&gt;之前有一个需求,ansible-playbook中需要某一步单步执行,也就是说在有多台服务器时,某个任务只能一台服务器执行完后,另一台服务器才能执行,否者对应集群的服务会出问题&lt;/p&gt;

&lt;p&gt;这是一个很简单的需求,ansible中也有对应的实现, &lt;code&gt;--fork 1&lt;/code&gt; 或者 使用 &lt;code&gt;serial&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;但是如果有人忘记加 &lt;code&gt;--fork 1&lt;/code&gt; 了呢，而且该任务是在子任务中，使用 &lt;b&gt;include&lt;/b&gt; 加载, &lt;code&gt;serial&lt;/code&gt; 关键字无法在某一特定任务中使用,只能与 &lt;b&gt;hosts&lt;/b&gt; 同级&lt;/p&gt;

&lt;p&gt;所幸，在这里 &lt;a href="https://www.bountysource.com/issues/26342862-support-for-serial-on-an-individual-task"&gt;https://www.bountysource.com/issues/26342862-support-for-serial-on-an-individual-task&lt;/a&gt; 找到了解决办法,使用 &lt;b&gt;delegate_to&lt;/b&gt;&lt;/p&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="n"&gt;restart&lt;/span&gt;
  &lt;span class="c1"&gt;# serial: 1 would be the proper solution here, but that can only be set on play level&lt;/span&gt;
  &lt;span class="c1"&gt;# upstream issue: https://github.com/ansible/ansible/issues/12170&lt;/span&gt;
  &lt;span class="n"&gt;run_once&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;true&lt;/span&gt;
  &lt;span class="n"&gt;with_items&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;{{play_hosts}}&amp;#39;&lt;/span&gt;
  &lt;span class="n"&gt;delegate_to&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;{{ item }}&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;/bin/service restart&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content><category term="linux"></category><category term="ansible"></category></entry><entry><title>那里有座山</title><link href="http://honmaple.me/articles/2017/09/%E9%82%A3%E9%87%8C%E6%9C%89%E5%BA%A7%E5%B1%B1.html" rel="alternate"></link><published>2017-09-15T00:00:00+08:00</published><updated>2017-09-15T00:00:00+08:00</updated><author><name>honmaple</name></author><id>tag:honmaple.me,2017-09-15:/articles/2017/09/那里有座山.html</id><summary type="html">
&lt;div class="org-center"&gt;
&lt;blockquote&gt;
&lt;p class="org-verse"&gt;
这里有座山&lt;br/&gt;
那里有座山&lt;br/&gt;
你在那里&lt;br/&gt;
我在这里
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;

&lt;div class="org-center"&gt;
&lt;p class="org-verse"&gt;
我们都有着自己的骄傲&lt;br/&gt;
谁都不想为谁低头&lt;br/&gt;
&lt;br/&gt;
这里有座山&lt;br/&gt;
那里有座山&lt;br/&gt;
至少&lt;br/&gt;
我还可以远远的看到你&lt;br/&gt;
&lt;br/&gt;
你在那里&lt;br/&gt;
你在哪里&lt;br/&gt;
而我&lt;br/&gt;
一直都在这里&lt;br/&gt;
&lt;br/&gt;
一直都在这里
&lt;/p&gt;
&lt;/div&gt;</summary><content type="html">
&lt;div class="org-center"&gt;
&lt;blockquote&gt;
&lt;p class="org-verse"&gt;
这里有座山&lt;br/&gt;
那里有座山&lt;br/&gt;
你在那里&lt;br/&gt;
我在这里
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/div&gt;

&lt;div class="org-center"&gt;
&lt;p class="org-verse"&gt;
我们都有着自己的骄傲&lt;br/&gt;
谁都不想为谁低头&lt;br/&gt;
&lt;br/&gt;
这里有座山&lt;br/&gt;
那里有座山&lt;br/&gt;
至少&lt;br/&gt;
我还可以远远的看到你&lt;br/&gt;
&lt;br/&gt;
你在那里&lt;br/&gt;
你在哪里&lt;br/&gt;
而我&lt;br/&gt;
一直都在这里&lt;br/&gt;
&lt;br/&gt;
一直都在这里
&lt;/p&gt;
&lt;/div&gt;</content><category term="life"></category><category term="love"></category></entry></feed>