<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>HonMaple's Blog</title><link>http://honmaple.org/</link><description></description><lastBuildDate>Tue, 02 Feb 2016 00:00:00 +0800</lastBuildDate><item><title>关于flask-wtf中的validators</title><link>http://honmaple.org/articles/2016/02/%E5%85%B3%E4%BA%8Eflask-wtf%E4%B8%AD%E7%9A%84validators.html</link><description>&lt;blockquote&gt;
&lt;p&gt;以前都是"吃快餐",利用别人的例子进行修改，弄得自己不明不白的，这次放假，静下心来好好的看看官方文档，
才发现写的代码有很多不必要的东西，可以进行很多优化  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;flask-wtforms是一个优秀的flask扩展，可惜官方文档说的不明不白，只是简单的说了大概的
功能,如果想要更好的利用这个扩展，请google wtforms,或者&lt;a href="http://wtforms.readthedocs.org/en/latest/"&gt;看这里&lt;/a&gt;  &lt;/p&gt;
&lt;p&gt;这里记录一下wtforms的&lt;strong&gt;validators&lt;/strong&gt;&lt;br /&gt;
&lt;a href="http://wtforms.simplecodes.com/docs/1.0.1/validators.html"&gt;参考文档&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="n"&gt;RegisterForm&lt;/span&gt;(&lt;span class="n"&gt;Form&lt;/span&gt;):
    &lt;span class="nb"&gt;name&lt;/span&gt; = &lt;span class="n"&gt;StringField&lt;/span&gt;(&lt;span class="s"&gt;&amp;#39;用户名:&amp;#39;&lt;/span&gt;)
    &lt;span class="n"&gt;email&lt;/span&gt; = &lt;span class="n"&gt;StringField&lt;/span&gt;(&lt;span class="s"&gt;&amp;#39;邮箱:&amp;#39;&lt;/span&gt;)
    &lt;span class="n"&gt;passwd&lt;/span&gt; = &lt;span class="n"&gt;PasswordField&lt;/span&gt;(&lt;span class="s"&gt;&amp;#39;密码:&amp;#39;&lt;/span&gt;)
    &lt;span class="n"&gt;repasswd&lt;/span&gt; = &lt;span class="n"&gt;PasswordField&lt;/span&gt;(&lt;span class="s"&gt;&amp;#39;重复密码:&amp;#39;&lt;/span&gt;)
    &lt;span class="n"&gt;register&lt;/span&gt; = &lt;span class="n"&gt;SubmitField&lt;/span&gt;(&lt;span class="s"&gt;&amp;#39;注册&amp;#39;&lt;/span&gt;)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这只是一个最简单注册表单&lt;/p&gt;
&lt;h4&gt;慢慢地加上一些要求:&lt;/h4&gt;
&lt;h4&gt;输入不能为空&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;wtforms.validators&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Required&lt;/span&gt;
&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;StringField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;用户名:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Required&lt;/span&gt;&lt;span class="p"&gt;()])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;限制name长度&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;wtforms.validators&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Length&lt;/span&gt;
&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;StringField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;用户名:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Length&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;min&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                           &lt;span class="nb"&gt;max&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;)])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;判断邮箱格式是否正确&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;wtforms.validators&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Email&lt;/span&gt;
&lt;span class="n"&gt;email&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;StringField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;邮箱&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                    &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Email&lt;/span&gt;&lt;span class="p"&gt;()])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;比较两次密码是否一致&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;wtforms.validators&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Email&lt;/span&gt;
&lt;span class="n"&gt;passwd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;PasswordField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;密码:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;EqualTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;repasswd&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)])&lt;/span&gt;
&lt;span class="n"&gt;repasswd&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;PasswordField&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;重复密码:&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;自定义错误信息&lt;/h4&gt;
&lt;p&gt;默认错误信息可以通过  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;form = RegisterForm()
print(form.errors) //或者print(form.name.errors)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;查看&lt;br /&gt;
比如输入不能为空的默认错误信息  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;#39;This field is required.&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;想要修改默认信息,请使用&lt;em&gt;message&lt;/em&gt;&lt;br /&gt;
比如:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;name = StringField(&amp;#39;用户名:&amp;#39;,
                   [Required(message=u&amp;#39;输入不能为空&amp;#39;)])
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;同样的  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Length(min=4,
       max=25,
       message=u&amp;#39;用户名长度在4到25个字符之间&amp;#39;)
Email(message=u&amp;#39;错误的邮箱地址&amp;#39;)
EqualTo(&amp;#39;confirm&amp;#39;,message=u&amp;#39;两次密码不一致&amp;#39;)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;这样就不用在视图文件不停地判断了,不要像我原先那样  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;if form.name.data == &amp;#39;&amp;#39; or form.passwd.data == &amp;#39;&amp;#39;:
    flash(u&amp;#39;输入不能为空&amp;#39;)
if form.repasswd.data != form.passwd.data:
    flash(u&amp;#39;两次密码不一致&amp;#39;)
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ok,就这样,这里写的不完善，不过对于我来说暂时够用了&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">2016-02-02 22:49:36.640594</dc:creator><pubDate>Tue, 02 Feb 2016 00:00:00 +0800</pubDate><guid isPermaLink="false">tag:honmaple.org,2016-02-02:articles/2016/02/关于flask-wtf中的validators.html</guid><category>flask</category><category>wtforms</category></item></channel></rss>